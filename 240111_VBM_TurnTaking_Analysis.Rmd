---
title: "Code for Temporal Dynamics of Child-Adult Conversations Across Social Contexts and Tasks"
output: html_document
date: "2024-25-10"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
## Load libraries
library(pacman)
pacman::p_load(tidyverse,
               ggcorrplot,
               job,
               cowplot,
               ggrain,
               here, 
               brms,
               readxl,
               ggridges,
               viridis,
               patchwork,
               ggbeeswarm,
               faux,
               bayestestR,
               see,
               modelr,
               xtable,
               gghalves)
```

# Functions, Models and Datasets to be Used
```{r}
ChildLatency_m1 <- readRDS(here( "VBMTurnTakingFiles", "models", "ChildLatency_m1_sigma_Visit_v1_finalJuly_InterceptsPlusSlopes.rds"))
AdultLatency_m1 <- readRDS(here( "VBMTurnTakingFiles", "models","AdultLatency_m1July.rds"))
ChildLatency_m1_no <- readRDS(here( "VBMTurnTakingFiles", "models", "ChildLatency_m1_noJuly.rds"))
AdultLatency_m1_no <- readRDS(here( "VBMTurnTakingFiles", "models", "AdultLatency_m1_noJuly.rds"))
OverlappingChild_m <- readRDS(here( "VBMTurnTakingFiles", "models", "OverlappingChild_m.rds"))
OverlappingAdult_m <- readRDS(here( "VBMTurnTakingFiles", "models", "OverlappingAdult_m.rds"))
ChildLatency_m2_ID <- readRDS(here( "VBMTurnTakingFiles", "models", "ChildLatency_m2_ID.rds"))
AdultLatency_m2_ID <- readRDS(here( "VBMTurnTakingFiles", "models", "AdultLatency_m2_ID.rds"))
ChildLatency_m3_pred <- readRDS(here( "VBMTurnTakingFiles", "models", "ChildLatency_m3_predJulyJuly.rds"))
AdultLatency_m3_pred <- readRDS(here( "VBMTurnTakingFiles", "models", "AdultLatency_m3_pred.rds"))
m_dyad_coupling_adaptation <- readRDS(here( "VBMTurnTakingFiles", "models", "m_dyad_coupling_adaptation.rds"))
ChildLatency_m1_Gender  <- readRDS(here( "VBMTurnTakingFiles", "models", "ChildLatency_m1_Gender.rds"))
ChildLatency_pred_m3_morethanthreewords  <- readRDS(here( "VBMTurnTakingFiles", "models", "ChildLatency_pred_m3_morethanthreewords.rds"))
ChildLatency_m1_sigma_Visit <- readRDS(here( "VBMTurnTakingFiles", "models", "ChildLatency_m1_sigma_Visit_v1_finalJuly.rds"))
ChildLatency_m1_no_sigma_no_beta <- readRDS(here( "VBMTurnTakingFiles", "models", "ChildLatency_m1_sigma_Visit_v1_finalJuly_no_sigma_no_beta.rds"))
ChildLatency_m1_no_beta_with_sigma <- readRDS(here( "VBMTurnTakingFiles", "models", "ChildLatency_m1_sigma_Visit_v1_finalJulyJuly_no_beta.rds"))
ChildLatency_m2_ID_NoOverlaps <- readRDS(here( "VBMTurnTakingFiles", "models", "ChildLatency_m2_ID_NoOverlapsJulyJuly.rds"))
ChildLatency_ID_pred_m3_no_backchannel <- readRDS(here( "VBMTurnTakingFiles", "models", "ChildLatency_ID_pred_m1_no_backchannel.rds"))
ChildLatency_ID_pred_m3_morethanthreewords <- readRDS(here( "VBMTurnTakingFiles", "models", "ChildLatency_pred_m3_morethanthreewords.rds"))
ChildLatency_m1_surrogate <- readRDS(here( "VBMTurnTakingFiles", "models", "ChildLatency_m1_surrogateNew.rds"))
OverlappingChild_m2_IndividualDifferences <- readRDS(here("VBMTurnTakingFiles", "models", "OverlappingChild_m2_IndividualDifferencesJuly.rds"))

#Function to extract relevant hypothesis data from models:
extract_relevant_data <- function(model, hypothesisformula, TestDescription) {
  
  hypothesis <- hypothesis(model, hypothesisformula)
  
  relevant_data <- hypothesis$hypothesis[, c("Estimate", "CI.Lower", "CI.Upper", "Evid.Ratio")] %>%
    mutate(Estimate = Estimate * 1000) %>%
    mutate(CI.Lower = CI.Lower * 1000) %>%
    mutate(CI.Upper = CI.Upper * 1000)
  
  relevant_data$TestDescription <- TestDescription
  
  return(relevant_data)
}

#Function to extract relevant hypothesis data from models:
extract_relevant_nonlatency_data <- function(model, hypothesisformula, TestDescription) {
  
  hypothesis <- hypothesis(model, hypothesisformula)
  
  relevant_data <- hypothesis$hypothesis[, c("Estimate", "CI.Lower", "CI.Upper", "Evid.Ratio")]
  
  relevant_data$TestDescription <- TestDescription
  
  return(relevant_data)
}

#Function to extract relevant hypothesis data from models:
extract_relevant_sd_data <- function(model, hypothesisformula, TestDescription) {
  
  hypothesis <- hypothesis(model, hypothesisformula, class = "sd", group = "ID")
  
  relevant_data <- hypothesis$hypothesis[, c("Estimate", "CI.Lower", "CI.Upper", "Evid.Ratio")] %>%
    mutate(Estimate = Estimate * 1000) %>%
    mutate(CI.Lower = CI.Lower * 1000) %>%
    mutate(CI.Upper = CI.Upper * 1000)
  
  relevant_data$TestDescription <- TestDescription
  
  return(relevant_data)
}

#Function to extract relevant hypothesis data from models:
extract_relevant_sdvisit_data <- function(model, hypothesisformula, TestDescription) {
  
  hypothesis <- hypothesis(model, hypothesisformula, class = "sd", group = "Visit")
  
  relevant_data <- hypothesis$hypothesis[, c("Estimate", "CI.Lower", "CI.Upper", "Evid.Ratio")] %>%
    mutate(Estimate = Estimate * 1000) %>%
    mutate(CI.Lower = CI.Lower * 1000) %>%
    mutate(CI.Upper = CI.Upper * 1000)
  
  relevant_data$TestDescription <- TestDescription
  
  return(relevant_data)
}

#Function to extract relevant hypothesis data from models:
extract_relevant_sigma_data <- function(model, hypothesisformula, TestDescription) {
  
  hypothesis <- hypothesis(model, hypothesisformula)
  
  relevant_data <- hypothesis$hypothesis[, c("Estimate", "CI.Lower", "CI.Upper", "Evid.Ratio")] %>%
    mutate(Estimate = exp(Estimate) * 1000) %>%
    mutate(CI.Lower = exp(CI.Lower) * 1000) %>%
    mutate(CI.Upper = exp(CI.Upper) * 1000)
  
  relevant_data$TestDescription <- TestDescription
  
  return(relevant_data)
}

#Function to extract relevant posterior for visits from model:
Visitextract_and_rename <- function(post, diagnosis, task, familiarity) {
  col_names <- paste0("r_Visit[", 1:7, ",", diagnosis, ":", task, ":", familiarity, "]")
  new_names <- paste0("Visit", 1:7)
  
  post[, col_names] %>%
    dplyr::rename_at(vars(all_of(col_names)), ~ new_names)
}

# Function to take the correlation data and make correlation plots:
generate_corr_plot <- function(data, title) {
  #cor_matrix <- cor(data)
  ggcorrplot(data, method = "circle", lab = TRUE, type = "lower", digits = 2, lab_size = 5) +
    ggtitle(title) +
    ylab('') +
    xlab('') +
    theme(plot.title = element_text(hjust = 0.5, size = 20, face ="bold"),
          axis.text.x = element_text(size = 20, color = "black"),
          axis.title.x = element_text(size = 20),
          axis.text.y = element_text(size = 20, color = "black"),
          axis.title.y = element_text(size = 20),
          legend.title = element_blank(),
          #legend.position = "none",
          strip.background = element_rect(color = "white", fill = "white", linewidth = 1.5, linetype = "solid"),
          strip.text.x = element_text(size = 20, color = "black", face ="bold"))
}

#Read in the data
d <- read.csv('/work/VBMTurnTakingFiles/data/d.csv')
d_dyadic <- read.csv('/work/VBMTurnTakingFiles/data/d_dyadic.csv')
```

# RQ1, Child Response Latencies across Different Conditions
```{r, eval = FALSE}
Latency_f1 <- bf(
  Latency ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task:Familiarity | r | Visit), 
  sigma ~ 0 + Diagnosis:Task:Familiarity + Diagnosis:Task:Familiarity:Visit +
    (0 + Task:Familiarity:Visit | p | gr(ID, by = Diagnosis)),
  beta ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis))  +  
    (0 + Diagnosis:Task:Familiarity | r | Visit))

priorChild <- c(
  prior(normal(1, 1), class = b),
  prior(normal(0, 0.3), class = sd),
  prior(normal(0, 1), class = b, dpar = beta),
  prior(normal(0, 0.1), class = sd, dpar = beta),
  prior(normal(0, 1), class = b, dpar = sigma),
  prior(normal(0, 0.1), class = sd, dpar = sigma),
  prior(lkj(2), class = cor)
)

job::job({
  ChildLatency_m1 <- brm(
    Latency_f1,
    data = subset(d, InterTurn == "Child2Adult"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = T,
    backend = "cmdstanr",
    iter = 3000,
    warmup = 500,
    init = 0,
    chains = 2,
    cores = 64,
    file = here("models","ChildLatency_m1_v1_finalJulyJuly"),
    control = list(adapt_delta = 0.99, max_treedepth = 20),
    stan_model_args = list(stanc_options = list("O1")))
})

pp_check(ChildLatency_m1, ndraws = 100)
```

## Hypothesis Tests
```{r}
# Overall Estimates in Autism Group
OverallLatencyThreeConditionsASD <- extract_relevant_data(ChildLatency_m1,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                      "OverallLatencyThreeConditionsASD")

MGOverallLatencyASD <- extract_relevant_data(ChildLatency_m1,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                      "MGOverallLatencyASD>0")

Q_F_OverallLatencyASD <- extract_relevant_data(ChildLatency_m1,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > 0",
                      "Q_F_OverallLatencyASD>0")

Q_UF_OverallLatencyASD <- extract_relevant_data(ChildLatency_m1,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > 0",
                      "Q_UF_OverallLatencyASD>0")

# Overall Estimates in TD Group
OverallLatencyThreeConditionsTD <- extract_relevant_data(ChildLatency_m1,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3 > 0",
                      "OverallLatencyThreeConditionsTD")

MGOverallLatencyTDC <- extract_relevant_data(ChildLatency_m1,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                      "MGOverallLatencyTDC>0")

Q_F_OverallLatencyTDC <- extract_relevant_data(ChildLatency_m1,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar > 0",
                      "Q_F_OverallLatencyTDC>0")

Q_UF_OverallLatencyTDC <- extract_relevant_data(ChildLatency_m1,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > 0",
                      "Q_UF_OverallLatencyTDC>0")

# Overall Differences between Autism Group and Typical Development Group
OverallLatencyThreeConditionsASDFasterTD <- extract_relevant_data(ChildLatency_m1,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 
                                <
                                (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3",
                      "OverallLatencyThreeConditionsASD<TD")


# Overall values for Beta parameter
BetaParameterASD_MG <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                 "BetaParameterASD_MG")

BetaParameterASD_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < 0",
                 "BetaParameterASD_Q_F")

BetaParameterASD_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < 0",
                 "BetaParameterASD_Q_UF")

BetaParameterASD_Overall <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "(beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar +
                 beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar +
                 beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) / 3 < 0",
                 "BetaParameterASD_Overall")

# Differences, Typical Development Group with Long Pauses
BetaParameterTDC_MG <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                 "BetaParameterTDC_MG")

BetaParameterTDC_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar < 0",
                 "BetaParameterTDC_Q_F")

BetaParameterTDC_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar < 0",
                 "BetaParameterTDC_Q_UF")

BetaParameterTDC_Overall <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "(beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar +
                 beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +
                 beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3 < 0",
                 "BetaParameterTDC_Overall")




WithinGroupBetaParameterASD_MG_Slower_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                 "WithinGroupBetaParameterASD_MG_Slower_Q_F")

WithinGroupBetaParameterASD_Q_F_Slower_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                 "WithinGroupBetaParameterASD_Q_F_Slower_Q_UF")

WithinGroupBetaParameterTDC_MG_Slower_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                 "WithinGroupBetaParameterTDC_MG_Slower_Q_F")

WithinGroupBetaParameterTDC_Q_F_Slower_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                 "WithinGroupBetaParameterTDC_Q_F_Slower_Q_UF")

DifferenceInDifferenceBetaParameterBetweenGroupsMGBiggerQ_F <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "(beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar - beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) > 
                 (beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar - beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar)",
                 "DifferenceInDifferenceBetaParameterBetweenGroupsMGBiggerQ_F")

DifferenceInDifferenceBetaParameterBetweenGroupsFamiliarityBiggerUnfamiliarity <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "(beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar - beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar) < 
                 (beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar - beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)",
                 "DifferenceInDifferenceBetaParameterBetweenGroupsFamiliarityBiggerUnfamiliarity")

# Differences between Autism Group and Typical Development Group with Long Pauses
OverallBetaParameterASDLowerTD <- extract_relevant_nonlatency_data(ChildLatency_m1,
                 "(beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar + beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) / 3 < ((beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3)",
                 "OverallBetaParameterASD<TD")

BetaParameterASDFasterTD_MG <- extract_relevant_nonlatency_data(ChildLatency_m1,
                      "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                      "BetaParameter_ASD_MG<TD_MG")

BetaParameterASDFasterTD_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1,
                      "beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "BetaParameter_ASD_MG<TD_Q_F")

BetaParameterASDFasterTD_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1,
                      "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                      "BetaParameter_ASD_MG<TD_Q_UF")

# Differences within Autism Group across Conditions:
WithinASDGroupMGSlowerQuestionsFamiliar <- extract_relevant_data(ChildLatency_m1,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                      "WithinASDGroupMG>QuestionsFamiliar")

# Differences within TD Group across Conditions:
WithinTDGroupMGSlowerQuestionsFamiliar <- extract_relevant_data(ChildLatency_m1,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinTDGroupMG>QuestionsFamiliar")

# Differences within Autism Group across Familiarity:
WithinAutismGroupQuestionsUnfamiliarSlowerFamiliar <- extract_relevant_data(ChildLatency_m1,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                      "WithinAutismGroupQuestionsUnfamiliar>Familiar")

# Differences within TD Group across Familiarity:
WithinTDGroupQuestionsUnfamiliarSlowerFamiliar <- extract_relevant_data(ChildLatency_m1,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinTDGroupQuestionsUnfamiliar>Familiar")

# Differences between Autism Group and Typical Development Group Within MatchingGame
WithinConditionsMatchingGameASDFasterTD <- extract_relevant_data(ChildLatency_m1,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                      "WithinConditionsMatchingGameASD<TD")

# Differences between Autism Group and Typical Development Group Within Familiar Questions:
WithinConditionsQuestionsFamiliarASDFasterTD <- extract_relevant_data(ChildLatency_m1,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinConditionsQuestionsFamiliarASD<TD")

# Differences between Autism Group and Typical Development Group Within Unfamiliar Questions:
WithinConditionsQuestionsUnfamiliarASDFasterTD <- extract_relevant_data(ChildLatency_m1,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                      "WithinConditionsQuestionsUnfamiliarASD<TD")

# Differences between Autism Group and Typical Development Group in Differences within Familiarity
DifferenceInDifferenceBetweenGroupsUnfamiliarBiggerFamiliarity <- extract_relevant_data(ChildLatency_m1,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) < 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                      "DifferenceInDifferenceBetweenGroupsUnfamiliar>Familiarity")

# Differences between Autism Group and Typical Development Group in Differences within Conditions
DifferenceInDifferenceBetweenGroupsMGBiggerThanConversations <- extract_relevant_data(ChildLatency_m1,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) > 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                      "DifferenceInDifferenceBetweenGroupsMG>Conversations")

# Overall Subject Variability in Autismm Group
SubjectVariabilityASD <- extract_relevant_sd_data(ChildLatency_m1, 
                                               "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisASD + TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD)/3 > 0",
                                               "SubjectVariabilityASD")

SubjectVariabilityASD_MG <- extract_relevant_sd_data(ChildLatency_m1, 
                                               "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_MG")

SubjectVariabilityASD_Q_F <- extract_relevant_sd_data(ChildLatency_m1, 
                                               "TaskQuestions:FamiliarityFamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_Q_F")

SubjectVariabilityASD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1, 
                                               "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_Q_UF")

# Overall Subject Variability in TD Group
SubjectVariabilityTD <- extract_relevant_sd_data(ChildLatency_m1, 
                                               "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisTDC + TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC)/3 > 0",
                                               "SubjectVariabilityTD")

SubjectVariabilityTD_MG <- extract_relevant_sd_data(ChildLatency_m1, 
                                               "TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_MG")

SubjectVariabilityTD_Q_F <- extract_relevant_sd_data(ChildLatency_m1, 
                                               "TaskQuestions:FamiliarityFamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_Q_F")

SubjectVariabilityTD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1, 
                                               "TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_Q_UF")

# Overall Subject Variability in TD Group
SubjectVariabilityASDSmallerThanTD <- extract_relevant_sd_data(ChildLatency_m1,
                                              "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisASD + TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD) / 3 <
                                              (TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisTDC + TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC) / 3",
                                               "SubjectVariabilityASD<TD")


SubjectVariabilityASDSmallerThanTD_MG <- extract_relevant_sd_data(ChildLatency_m1,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD  <
                                              TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_MG<TD_MG")

SubjectVariabilityASDSmallerThanTD_Q_F <- extract_relevant_sd_data(ChildLatency_m1,
                                              "TaskQuestions:FamiliarityFamiliar:DiagnosisASD  <
                                              TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_Q_F<TD_Q_F")

SubjectVariabilityASDSmallerThanTD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD  <
                                              TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_Q_UF<TD_Q_UF")

SubjectVariabilityASD_MG_SmallerThan_Q_F <- extract_relevant_sd_data(ChildLatency_m1,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD > TaskQuestions:FamiliarityFamiliar:DiagnosisASD",
                                               "SubjectVariabilityASD_MG_SmallerThan_Q_F")

SubjectVariabilityASD_Q_F_SmallerThan_Q_UF <- extract_relevant_sd_data(ChildLatency_m1,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD > TaskQuestions:FamiliarityFamiliar:DiagnosisASD",
                                               "SubjectVariabilityASD_Q_F_SmallerThan_Q_UF")

SubjectVariabilityTDC_MG_SmallerThan_Q_F <- extract_relevant_sd_data(ChildLatency_m1,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC < TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityTDC_MG_SmallerThan_Q_F")

SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF <- extract_relevant_sd_data(ChildLatency_m1,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC > TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF")

DifferenceInDifferenceSubjectVariabilityUnfamiliarSmallerFamiliarity <- extract_relevant_sd_data(ChildLatency_m1,
                                              "(TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD - TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC) 
                                              < 
                                              (TaskQuestions:FamiliarityFamiliar:DiagnosisASD - TaskQuestions:FamiliarityFamiliar:DiagnosisTDC)",
                                              "DifferenceInDifferenceSubjectVariabilityUnfamiliarBiggerFamiliarity")

DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions <- extract_relevant_sd_data(ChildLatency_m1,
                                              "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC - TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD) 
                                              < 
                                              (TaskQuestions:FamiliarityFamiliar:DiagnosisTDC - TaskQuestions:FamiliarityFamiliar:DiagnosisASD)",
                                              "DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions")

# Overall Visit Variability across visits in Autism Group
VisitVariabilityASDOverall <- extract_relevant_sdvisit_data(ChildLatency_m1, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                                               "VisitVariabilityASDOverall")

# Overall Visit Variability across visits in TD Group
VisitVariabilityTDCOverall <- extract_relevant_sdvisit_data(ChildLatency_m1, 
                                               "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                                               "VisitVariabilityTDCOverall")


VisitVariabilityASDOverallHigherTDSOverall <- extract_relevant_sdvisit_data(ChildLatency_m1, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 >
                                               (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3",
                                               "VisitVariabilityASDOverallLowerTDSOverall")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASDMG <- extract_relevant_sdvisit_data(ChildLatency_m1, 
                                               "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                                               "VisitVariabilityASDMG")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1, 
                                               "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                                               "VisitVariabilityTDMG")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASD_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > 0",
                                               "VisitVariabilityASD_Q_F")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDC_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1, 
                                               "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar > 0",
                                               "VisitVariabilityTDC_Q_F")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASD_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > 0",
                                               "VisitVariabilityASD_Q_UF")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDC_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1, 
                                               "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > 0",
                                               "VisitVariabilityTDC_Q_UF")

# Overall Subject Variability across visits, differences
VisitVariabilityASDMGSlowerThanTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1, 
                                               "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar",
                                               "VisitVariabilityASDMG>TDMG")

# Overall Subject Variability across visits, differences
VisitVariabilityASD_Q_F_SlowerThanTD_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                                               "VisitVariabilityASD_Q_F_SlowerThanTD_Q_F")

# Overall Subject Variability across visits, differences
VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                                               "VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF")

#DifferenceInDifference:
DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity <- extract_relevant_sdvisit_data(ChildLatency_m1, 
                                               "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)
                                               < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity")

DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)
                                               > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG")


# Overall Sigma Variability across visits in Autism Group
SigmaASDOverall <- extract_relevant_sigma_data(ChildLatency_m1, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 < 0",
                                               "SigmaASDOverall")

# Overall Sigma Variability across visits in TD Group
SigmaTDCOverall <- extract_relevant_sigma_data(ChildLatency_m1, 
                                               "(sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) /3 < 0",
                                               "SigmaTDCOverall")


SigmaASDOverallHigherTDSOverall <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 >
                                               (sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3",
                                               "SigmaASDOverallHigherTDSOverall")

# Subject Variability across visits MG in Autism Group
SigmaASDMG <- extract_relevant_sigma_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < 0",
                                               "SigmaASDMG")

# Overall Subject Variability across visits in TD Group
SigmaTDMG <- extract_relevant_sigma_data(ChildLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < 0",
                                               "SigmaTDMG")

# Subject Variability across visits MG in Autism Group
SigmaASD_Q_F <- extract_relevant_sigma_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < 0",
                                               "SigmaASD_Q_F")

# Overall Subject Variability across visits in TD Group
SigmaTDC_Q_F <- extract_relevant_sigma_data(ChildLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar < 0",
                                               "SigmaTDC_Q_F")


# Subject Variability across visits MG in Autism Group
SigmaASD_Q_UF <- extract_relevant_sigma_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < 0 ",
                                               "SigmaASD_Q_UF")

# Overall Subject Variability across visits in TD Group
SigmaTDC_Q_UF <- extract_relevant_sigma_data(ChildLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar < 0",
                                               "SigmaTDC_Q_UF")

# Overall Subject Variability across visits, differences
SigmaASDMGSlowerThanTDMG <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                                               "SigmaASDMGSlowerThanTDMG")

# Overall Subject Variability across visits, differences
SigmaASD_Q_F_SlowerThanTD_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                                               "SigmaASD_Q_F_SlowerThanTD_Q_F")

# Overall Subject Variability across visits, differences
SigmaASD_Q_UF_SlowerThanTD_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                                               "SigmaASD_Q_UF_SlowerThanTD_Q_UF")

# Sigma across visits, differences
SigmaASD_MG_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit < 0",
                                               "SigmaASD_MG_VisitLowerZero")

SigmaTDC_MG_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit > 0",
                                               "SigmaTDC_MG_VisitLowerZero")

SigmaASD_MG_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
                                               "SigmaASD_MG_VisitLowerTDC")

SigmaASD_Overall_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit + 
                                               sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit +
                                               sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 < 0",
                                               "SigmaASD_Overall_VisitLowerZero")

SigmaTDC_Overall_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "(sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit + 
                                               sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit +
                                               sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 < 0",
                                               "SigmaTDC_Overall_VisitLowerZero")

# Sigma across visits, differences
SigmaASD_Q_F_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit > 0",
                                               "SigmaASD_Q_F_VisitLowerZero")

SigmaTDC_Q_F_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit < 0",
                                               "SigmaTDC_Q_F_VisitLowerZero")

SigmaASD_Q_F_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
                                               "SigmaASD_Q_F_VisitLowerTDC")

# Sigma across visits, differences
SigmaASD_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < 0",
                                               "SigmaASD_Q_UF_VisitLowerZero")

SigmaTDC_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > 0",
                                               "SigmaTDC_Q_UF_VisitLowerZero")

SigmaASD_Q_UF_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
                                               "SigmaASD_Q_UF_VisitLowerTDC")

SigmaVisitOverall_ASDLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit + 
                                               sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit +
                                               sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 > (sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit + 
                                               sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit +
                                               sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) /3",
                                               "SigmaVisitOverall_ASDLowerTDC")

#DifferenceInDifference:
DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "(sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)
                                               > (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity")

DifferenceInDifferenceSigmaASDMGSmallerThanTDMG <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)
                                               > (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceSigmaASDMGSmallerThanTDMG")

#WithinGroups
WithinGroupSigmaASD_Q_F_Faster_UF <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaASD_Q_FFaster_UF")

WithinGroupSigmaTDC_Q_F_Faster_UF <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaTDC_Q_F_Faster_UF")

WithinGroupSigmaASD_Q_F_Faster_MG <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaASD_Q_F_Faster_MG")

WithinGroupSigmaTDC_Q_F_Faster_MG <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaTDC_Q_F_Faster_MG")


WithinGroupSigmaASD_Q_F_Lower_UF_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit",
                                               "WithinGroupSigmaASD_Q_F_Lower_UF_Visit")

WithinGroupSigmaTDC_Q_F_Lower_UF_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit",
                                               "WithinGroupSigmaTDC_Q_F_Lower_UF_Visit")

WithinGroupSigmaASD_Q_F_Lower_MG_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit",
                                               "WithinGroupSigmaASD_Q_F_Lower_MG_Visit")

WithinGroupSigmaTDC_Q_F_Lower_MG_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
                                               "WithinGroupSigmaTDC_Q_F_Lower_MG_Visit")


SigmaTDC_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > 0",
                                               "SigmaTDC_Q_UF_VisitLowerZero")

SigmaASD_Q_UF_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
                                               "SigmaASD_Q_UF_VisitLowerTDC")


DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "(sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) <
                                               (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit)", "DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF")


DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit) <
                                               (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit)", "DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F")



# Correlation Estimates across visits in Autism Group
post <- as_draws_df(ChildLatency_m1)


# Apply the function for each case
cor_post_mu_MG_ASD <- Visitextract_and_rename(post, "DiagnosisASD", "TaskMatchingGame", "FamiliarityFamiliar") %>%
  cor() %>%
  as.matrix()

cor_post_mu_MG_TDC <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskMatchingGame", "FamiliarityFamiliar") %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_ASD_Familiar <- Visitextract_and_rename(post, "DiagnosisASD", "TaskQuestions", "FamiliarityFamiliar") %>%
  select(Visit2, Visit4, Visit6) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_TDC_Familiar <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskQuestions", "FamiliarityFamiliar") %>%
  select(Visit2, Visit4, Visit6) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_ASD_Unfamiliar <- Visitextract_and_rename(post, "DiagnosisASD", "TaskQuestions", "FamiliarityUnfamiliar") %>%
  select(Visit1, Visit3, Visit5, Visit7) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_TDC_Unfamiliar <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskQuestions", "FamiliarityUnfamiliar") %>%
  select(Visit1, Visit3, Visit5, Visit7) %>%
  cor() %>%
  as.matrix()

diag(cor_post_mu_MG_ASD) <- NA
diag(cor_post_mu_MG_TDC) <- NA
diag(cor_post_mu_Q_ASD_Familiar) <- NA
diag(cor_post_mu_Q_TDC_Familiar) <- NA
diag(cor_post_mu_Q_ASD_Unfamiliar) <- NA
diag(cor_post_mu_Q_TDC_Unfamiliar) <- NA

CorrelationSummaryStatistics <- tibble(
       Estimate = c(mean(cor_post_mu_MG_ASD, na.rm = TRUE), mean(cor_post_mu_Q_ASD_Familiar, na.rm = TRUE), mean(cor_post_mu_Q_ASD_Unfamiliar, na.rm = TRUE), 
                    mean(cor_post_mu_MG_TDC, na.rm = TRUE), mean(cor_post_mu_Q_TDC_Familiar, na.rm = TRUE), mean(cor_post_mu_Q_TDC_Unfamiliar, na.rm = TRUE)),
       CI.Lower = c(quantile(cor_post_mu_MG_ASD, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Familiar, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Unfamiliar, probs = 0.025, na.rm = TRUE), 
                    quantile(cor_post_mu_MG_TDC, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Familiar, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Unfamiliar, probs = 0.025, na.rm = TRUE)),
       CI.Upper = c(quantile(cor_post_mu_MG_ASD, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Familiar, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Unfamiliar, probs = 0.975, na.rm = TRUE), 
                    quantile(cor_post_mu_MG_TDC, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Familiar, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Unfamiliar, probs = 0.975, na.rm = TRUE)),
       Evid.Ratio = c(NA, NA, NA, NA, NA, NA),
       TestDescription = c(
  "CorrelationAcrossVisitsASDMG", "CorrelationAcrossVisitsASDFamiliarQuestions", "CorrelationAcrossVisitsASDUnfamiliarQuestions",
  "CorrelationAcrossVisitsTDMG", "CorrelationAcrossVisitsTDFamiliarQuestions", "CorrelationAcrossVisitsTDUnfamiliarQuestions"),
       )

HypothesisResultsChildLatenciesModel1 <- rbind(OverallLatencyThreeConditionsASD,
                                               OverallLatencyThreeConditionsTD,
                                               MGOverallLatencyASD,
                                               Q_F_OverallLatencyASD,
                                               Q_UF_OverallLatencyASD,
                                               MGOverallLatencyTDC,
                                               Q_F_OverallLatencyTDC,
                                               Q_UF_OverallLatencyTDC,
                                               BetaParameterASD_MG,
                                               BetaParameterASD_Q_F,
                                               BetaParameterASD_Q_UF,
                                               BetaParameterASD_Overall,
                                               BetaParameterTDC_MG,
                                               BetaParameterTDC_Q_F,
                                               BetaParameterTDC_Q_UF,
                                               BetaParameterTDC_Overall,
                                               OverallBetaParameterASDLowerTD,
                                               BetaParameterASDFasterTD_MG,
                                               BetaParameterASDFasterTD_Q_F,
                                               BetaParameterASDFasterTD_Q_UF,
                                               WithinGroupBetaParameterASD_MG_Slower_Q_F,
                                               WithinGroupBetaParameterTDC_MG_Slower_Q_F,
                                               DifferenceInDifferenceBetaParameterBetweenGroupsMGBiggerQ_F,
                                               WithinGroupBetaParameterASD_Q_F_Slower_Q_UF,
                                               WithinGroupBetaParameterTDC_Q_F_Slower_Q_UF,
                                               DifferenceInDifferenceBetaParameterBetweenGroupsFamiliarityBiggerUnfamiliarity,
                                               OverallLatencyThreeConditionsASDFasterTD,
                                               WithinASDGroupMGSlowerQuestionsFamiliar,
                                               WithinTDGroupMGSlowerQuestionsFamiliar,
                                               WithinAutismGroupQuestionsUnfamiliarSlowerFamiliar,
                                               WithinTDGroupQuestionsUnfamiliarSlowerFamiliar,
                                               WithinConditionsMatchingGameASDFasterTD,
                                               WithinConditionsQuestionsFamiliarASDFasterTD,
                                               WithinConditionsQuestionsUnfamiliarASDFasterTD,
                                               DifferenceInDifferenceBetweenGroupsUnfamiliarBiggerFamiliarity,
                                               DifferenceInDifferenceBetweenGroupsMGBiggerThanConversations,
                                               SubjectVariabilityASD,
                                               SubjectVariabilityTD,
                                               SubjectVariabilityASDSmallerThanTD,
                                               SubjectVariabilityASD_MG,
                                               SubjectVariabilityASD_Q_F,
                                               SubjectVariabilityASD_Q_UF,
                                               SubjectVariabilityTD_MG,
                                               SubjectVariabilityTD_Q_F,
                                               SubjectVariabilityTD_Q_UF,
                                               SubjectVariabilityASDSmallerThanTD_MG,
                                               SubjectVariabilityASDSmallerThanTD_Q_F,
                                               SubjectVariabilityASDSmallerThanTD_Q_UF,
                                               SubjectVariabilityASD_MG_SmallerThan_Q_F,
                                               SubjectVariabilityASD_Q_F_SmallerThan_Q_UF,
                                               SubjectVariabilityTDC_MG_SmallerThan_Q_F,
                                               SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF,
                                               DifferenceInDifferenceSubjectVariabilityUnfamiliarSmallerFamiliarity,
                                               DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions,
                                               VisitVariabilityASDMG,
                                               VisitVariabilityTDMG,
                                               VisitVariabilityASD_Q_F,
                                               VisitVariabilityTDC_Q_F,
                                               VisitVariabilityASD_Q_UF,
                                               VisitVariabilityTDC_Q_UF,
                                               VisitVariabilityASDOverall,
                                               VisitVariabilityTDCOverall,
                                               VisitVariabilityASDMGSlowerThanTDMG,
                                               VisitVariabilityASD_Q_F_SlowerThanTD_Q_F,
                                               VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF,
                                               VisitVariabilityASDOverallHigherTDSOverall,
                                               DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG,
                                               DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity,
                                               SigmaASDOverall,
                                               SigmaTDCOverall,
                                               SigmaASDOverallHigherTDSOverall,
                                               SigmaASDMG,
                                               SigmaTDMG,
                                               SigmaASD_Q_F,
                                               SigmaTDC_Q_F,
                                               SigmaASD_Q_UF,
                                               SigmaTDC_Q_UF,
                                               SigmaASDMGSlowerThanTDMG,
                                               SigmaASD_Q_F_SlowerThanTD_Q_F,
                                               SigmaASD_Q_UF_SlowerThanTD_Q_UF,
                                               SigmaASD_MG_VisitLowerZero,
                                               SigmaTDC_MG_VisitLowerZero,
                                               SigmaASD_MG_VisitLowerTDC,
                                               SigmaASD_Q_F_VisitLowerZero,
                                               SigmaTDC_Q_F_VisitLowerZero,
                                               SigmaASD_Q_F_VisitLowerTDC,
                                               SigmaASD_Q_UF_VisitLowerZero,
                                               SigmaTDC_Q_UF_VisitLowerZero,
                                               SigmaASD_Q_UF_VisitLowerTDC,
                                               SigmaASD_Overall_VisitLowerZero,
                                               SigmaTDC_Overall_VisitLowerZero,
                                               WithinGroupSigmaASD_Q_F_Lower_UF_Visit,
                                               WithinGroupSigmaTDC_Q_F_Lower_UF_Visit,
                                               WithinGroupSigmaASD_Q_F_Lower_MG_Visit,
                                               WithinGroupSigmaTDC_Q_F_Lower_MG_Visit,
                                               WithinGroupSigmaASD_Q_F_Faster_UF,
                                               WithinGroupSigmaTDC_Q_F_Faster_UF,
                                               WithinGroupSigmaASD_Q_F_Faster_MG,
                                               WithinGroupSigmaTDC_Q_F_Faster_MG,
                                               SigmaVisitOverall_ASDLowerTDC,
                                               DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF,
                                               DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F,
                                               DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity,
                                               DifferenceInDifferenceSigmaASDMGSmallerThanTDMG,
                                               CorrelationSummaryStatistics) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(HypothesisResultsChildLatenciesModel1, here('VBMTurnTakingFiles/stats_for_paper/model1_child_stats_for_paper.csv'))
```

## Visualisation of Model Estimates
```{r}
newdata <- subset(d, InterTurn == "Child2Adult") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) 

C2P_PredictedData <- as_tibble(predict(ChildLatency_m1, newdata = newdata)) %>%
  mutate(Visit = newdata$Visit) %>%
  mutate(Diagnosis = newdata$Diagnosis) %>%
  mutate(ID = newdata$ID) %>%
  mutate(Familiarity = newdata$Familiarity) %>%
  mutate(Task = newdata$Task) %>%
  mutate(size = Q97.5-Q2.5) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  group_by(Diagnosis, ID, Familiarity, Task) %>%
  dplyr::summarise(Estimate = mean(Estimate)) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

Posterior_df <- as_draws_df(ChildLatency_m1)

condition_posterior_TDC_MG <- Posterior_df[,"b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "MatchingGame",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_ASD_MG <- Posterior_df[,"b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "MatchingGame",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_TDC_Q_F <- Posterior_df[,"b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "Questions",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_ASD_Q_F <- Posterior_df[,"b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "Questions",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_TDC_Q_UF <- Posterior_df[,"b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar"] %>%
  mutate(Familiarity = "Unfamiliar",
         Task = "Questions",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent"))) 

condition_posterior_ASD_Q_UF <- Posterior_df[,"b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar"] %>%
  mutate(Familiarity = "Unfamiliar",
         Task = "Questions",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

posteriors <- rbind(condition_posterior_ASD_MG, condition_posterior_TDC_MG,
      condition_posterior_ASD_Q_F, condition_posterior_TDC_Q_F, 
      condition_posterior_ASD_Q_UF, condition_posterior_TDC_Q_UF)

Model1_Plot_Child_Conditions <- ggplot() +
  geom_rect(aes(xmin=-Inf, xmax = 1.47, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_rect(aes(xmin=1.47, xmax = 2.48, ymin=-Inf, ymax=Inf), fill = "honeydew3", alpha = 0.3) +
  geom_rect(aes(xmin=2.48, xmax = 3.6, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_boxplot(aes(Condition, Estimate, color = Diagnosis, fill = Diagnosis), filter(posteriors, Diagnosis == "Autism Group"), width = 0.05, color = "black", position = position_nudge(x = -0.30), alpha = 0.9, outliers = F, show.legend = T) +
  geom_boxplot(aes(Condition, Estimate, color = Diagnosis, fill = Diagnosis), filter(posteriors, Diagnosis == "Typical Development"), width = 0.05, color = "black", position = position_nudge(x = -0.10), alpha = 0.9, outliers = F, show.legend = T) +
  geom_point(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "#009E73", alpha = 0.7, data = filter(C2P_PredictedData, Diagnosis == "Autism Group"), size = 2, position = position_nudge(x = -.22)) + 
  geom_point(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "#CC79A7", alpha = 0.7, data = filter(C2P_PredictedData, Diagnosis == "Typical Development"), size = 2, position = position_nudge(x = -.18)) + 
  geom_half_violin(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "black", alpha = 0.9, data = filter(posteriors, Diagnosis == "Autism Group"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  geom_half_violin(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "black", alpha = 0.9, data = filter(posteriors, Diagnosis == "Typical Development"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  #scale_fill_okabeito() +
  #scale_color_okabeito() +
  xlab(' ') +
  coord_flip() +
  ylab('Average Child Response Latency (seconds)') +
  guides(color = guide_legend(reverse=TRUE), fill = guide_legend(reverse=TRUE)) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 15, color = "black"),
        legend.title = element_blank(),
        legend.position = c(0.25, 0.92),
        legend.key.size = unit(3, "lines"),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key = element_rect(fill = "transparent", color = NA),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 15, color = "black"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

Model1_Plot_Child_Conditions
```

## Visualisation of Correlation Structures
```{r}
# Generate the plots
ASD_MG <- generate_corr_plot(cor_post_mu_MG_ASD, 'Autism Group: Matching With Parent')
TD_MG <- generate_corr_plot(cor_post_mu_MG_TDC, 'Typical Development: Matching With Parent')

ASD_Q_Fam  <- generate_corr_plot(cor_post_mu_Q_ASD_Familiar, 'Autism Group: Convo With Parent')
TD_Q_Fam  <- generate_corr_plot(cor_post_mu_Q_TDC_Familiar, 'Typical Development: Convo With Parent')

ASD_Q_Unfam  <- generate_corr_plot(cor_post_mu_Q_ASD_Unfamiliar, 'Autism Group: Convo With Experimenter')
TD_Q_Unfam  <- generate_corr_plot(cor_post_mu_Q_TDC_Unfamiliar, 'Typical Development: Convo With Experimenter')

CorrelationMatricesChild <- cowplot::plot_grid(ASD_MG, TD_MG, ASD_Q_Fam, TD_Q_Fam, ASD_Q_Unfam, TD_Q_Unfam, nrow = 3)

newdata <- subset(d, InterTurn == "Child2Adult") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) 

C2P_PredictedData <- as_tibble(predict(ChildLatency_m1, newdata = newdata)) %>%
  mutate(Visit = newdata$Visit) %>%
  mutate(Diagnosis = newdata$Diagnosis) %>%
  mutate(ID = newdata$ID) %>%
  mutate(Familiarity = newdata$Familiarity) %>%
  mutate(Task = newdata$Task) %>%
  mutate(size = Q97.5-Q2.5) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  group_by(Diagnosis, ID, Familiarity, Task) %>%
  dplyr::summarise(Estimate = mean(Estimate)) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

temp <- C2P_PredictedData %>%
  pivot_wider(values_from = Estimate, names_from = Condition) %>%
  group_by(Diagnosis, ID) %>%
  dplyr::summarise(`Matching With Parent` = mean(`Matching With Parent`, na.rm = T),
                   `Convo With Parent` = mean(`Convo With Parent`, na.rm = T),
                   `Convo With Experimenter` = mean(`Convo With Experimenter`, na.rm = T))

ID_cor_ASD <- temp %>%
  filter(Diagnosis == "Autism Group") 

ID_cor_TD <- temp %>%
  filter(Diagnosis == "Typical Development") 

ID_cor_ASD <- ID_cor_ASD[, 3:5] %>%
  cor() %>%
  as.matrix()

ID_cor_TD <- ID_cor_TD[, 3:5] %>%
  cor() %>%
  as.matrix()

a <- generate_corr_plot(ID_cor_ASD, 'Autism Group, Individual Correlations Across Contexts')
b <- generate_corr_plot(ID_cor_TD, 'Typical Development, Individual Correlations Across Contexts')
cowplot::plot_grid(a, b)

C2P_PredictedData <- C2P_PredictedData %>%
  mutate(ID = as.factor(ID))

context_correlation <- ggplot(C2P_PredictedData, aes(x = Condition, y = Estimate, color = ID)) +
  geom_rain(alpha = 1, rain.side = 'f1x1', id.long.var = "ID",
            point.args.pos = list(size = 4, position = position_jitter(width = 0.1, height = 0, seed = 42)), 
            line.args.pos = list(linewidth = 2, alpha = 1, position = position_jitter(width = 0.1, height = 0, seed = 42))) + 
  facet_wrap(~Diagnosis) +
  guides(color = guide_legend(reverse=TRUE), fill = guide_legend(reverse=TRUE)) +
  scale_color_manual(values = viridis(n = 50)) +
  ylab('Child Response Latency (seconds)') +
  xlab(' ') +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 20),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"))

```

## Visualisation of Increasing Familiarity across Visits
```{r}
newdata <- subset(d, InterTurn == "Child2Adult") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) 

C2P_PredictedData <- as_tibble(predict(ChildLatency_m1, newdata = newdata)) %>%
  mutate(Visit = newdata$Visit) %>%
  mutate(Diagnosis = newdata$Diagnosis) %>%
  mutate(ID = newdata$ID) %>%
  mutate(Familiarity = newdata$Familiarity) %>%
  mutate(Task = newdata$Task) %>%
  mutate(size = Q97.5-Q2.5) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  group_by(Diagnosis, ID, Familiarity, Task, Visit) %>%
  dplyr::summarise(Estimate = mean(Estimate)) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent"))) %>%
  mutate(Visit = jitter(Visit, amount = 0.2))

C2P_Change_In_FamiliarityPlot <- ggplot(C2P_PredictedData) +
  #geom_rect(aes(xmin=-Inf, xmax = 1.47, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  #geom_rect(aes(xmin=1.47, xmax = 2.48, ymin=-Inf, ymax=Inf), fill = "honeydew3", alpha = 0.3) +
  #geom_rect(aes(xmin=2.48, xmax = 3.6, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_point(aes(x = Visit, y = Estimate, fill = Diagnosis, color = Diagnosis), alpha = 0.5, data = C2P_PredictedData, size = 2, show.legend = FALSE) + 
  geom_smooth(aes(x = Visit, y = Estimate, fill = Diagnosis, color = Diagnosis), alpha = 0.5, data = C2P_PredictedData, method = 'lm') +
  scale_x_continuous(breaks = seq(1, 7, 1), limits = c(1, 7)) +
  scale_fill_manual(values = c("#009E73", "#CC79A7", "darkgreen")) +
  scale_color_manual(values = c("#009E73", "#CC79A7", "darkgreen")) +
  xlab('Visit') +
  facet_wrap(~Condition) +
  ylab('Child Response Latency (seconds)') +
  guides(color = guide_legend(reverse=FALSE), fill = guide_legend(show = FALSE)) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        legend.position = c(0.5, 0.91),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key = element_rect(fill = "transparent", color = NA),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())
C2P_Change_In_FamiliarityPlot
```

# RQ1, Adult Response Latencies across Different Conditions
```{r, eval = FALSE}
job::job({
  AdultLatency_m1 <- brm(
    Latency_f1,
    subset(d, InterTurn == "Adult2Child"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = T,
    backend = "cmdstanr",
    #threads = threading(2),
    iter = 3000,
    warmup = 500,
    init = 0,
    chains = 2,
    cores = 64,
    file = here::here("models","AdultLatency_m1July"),
    control = list(adapt_delta = 0.90, max_treedepth = 10),
    stan_model_args = list(stanc_options = list("O1"))
  )
})

pp_check(AdultLatency_m1, ndraws = 100)
```

## Hypothesis Tests
```{r}
# Overall Estimates in Autism Group
OverallLatencyThreeConditionsASD <- extract_relevant_data(AdultLatency_m1,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                      "OverallLatencyThreeConditionsASD")

MGOverallLatencyASD <- extract_relevant_data(AdultLatency_m1,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                      "MGOverallLatencyASD>0")

Q_F_OverallLatencyASD <- extract_relevant_data(AdultLatency_m1,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > 0",
                      "Q_F_OverallLatencyASD>0")

Q_UF_OverallLatencyASD <- extract_relevant_data(AdultLatency_m1,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > 0",
                      "Q_UF_OverallLatencyASD>0")

# Overall Estimates in TD Group
OverallLatencyThreeConditionsTD <- extract_relevant_data(AdultLatency_m1,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3 > 0",
                      "OverallLatencyThreeConditionsTD")

MGOverallLatencyTDC <- extract_relevant_data(AdultLatency_m1,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                      "MGOverallLatencyTDC>0")

Q_F_OverallLatencyTDC <- extract_relevant_data(AdultLatency_m1,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar > 0",
                      "Q_F_OverallLatencyTDC>0")

Q_UF_OverallLatencyTDC <- extract_relevant_data(AdultLatency_m1,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > 0",
                      "Q_UF_OverallLatencyTDC>0")

# Overall Differences between Autism Group and Typical Development Group
OverallLatencyThreeConditionsASDFasterTD <- extract_relevant_data(AdultLatency_m1,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 
                                <
                                (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3",
                      "OverallLatencyThreeConditionsASD<TD")


# Overall values for Beta parameter
BetaParameterASD_MG <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                 "BetaParameterASD_MG")

BetaParameterASD_Q_F <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < 0",
                 "BetaParameterASD_Q_F")

BetaParameterASD_Q_UF <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < 0",
                 "BetaParameterASD_Q_UF")

BetaParameterASD_Overall <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "(beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar +
                 beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar +
                 beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) / 3 < 0",
                 "BetaParameterASD_Overall")

# Differences, Typical Development Group with Long Pauses
BetaParameterTDC_MG <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                 "BetaParameterTDC_MG")

BetaParameterTDC_Q_F <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar < 0",
                 "BetaParameterTDC_Q_F")

BetaParameterTDC_Q_UF <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar < 0",
                 "BetaParameterTDC_Q_UF")

BetaParameterTDC_Overall <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "(beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar +
                 beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +
                 beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3 < 0",
                 "BetaParameterTDC_Overall")

WithinGroupBetaParameterASD_MG_Slower_Q_F <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                 "WithinGroupBetaParameterASD_MG_Slower_Q_F")

WithinGroupBetaParameterASD_Q_F_Slower_Q_UF <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                 "WithinGroupBetaParameterASD_Q_F_Slower_Q_UF")

WithinGroupBetaParameterTDC_MG_Slower_Q_F <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                 "WithinGroupBetaParameterTDC_MG_Slower_Q_F")

WithinGroupBetaParameterTDC_Q_F_Slower_Q_UF <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                 "WithinGroupBetaParameterTDC_Q_F_Slower_Q_UF")

DifferenceInDifferenceBetaParameterBetweenGroupsMGBiggerQ_F <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "(beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar - beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) > 
                 (beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar - beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar)",
                 "DifferenceInDifferenceBetaParameterBetweenGroupsMGBiggerQ_F")

DifferenceInDifferenceBetaParameterBetweenGroupsFamiliarityBiggerUnfamiliarity <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "(beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar - beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar) < 
                 (beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar - beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)",
                 "DifferenceInDifferenceBetaParameterBetweenGroupsFamiliarityBiggerUnfamiliarity")

# Differences between Autism Group and Typical Development Group with Long Pauses
OverallBetaParameterASDLowerTD <- extract_relevant_nonlatency_data(AdultLatency_m1,
                 "(beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar + beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) / 3 < ((beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3)",
                 "OverallBetaParameterASD<TD")

BetaParameterASDFasterTD_MG <- extract_relevant_nonlatency_data(AdultLatency_m1,
                      "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                      "BetaParameter_ASD_MG<TD_MG")

BetaParameterASDFasterTD_Q_F <- extract_relevant_nonlatency_data(AdultLatency_m1,
                      "beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "BetaParameter_ASD_MG<TD_Q_F")

BetaParameterASDFasterTD_Q_UF <- extract_relevant_nonlatency_data(AdultLatency_m1,
                      "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                      "BetaParameter_ASD_MG<TD_Q_UF")

# Differences within Autism Group across Conditions:
WithinASDGroupMGSlowerQuestionsFamiliar <- extract_relevant_data(AdultLatency_m1,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                      "WithinASDGroupMG>QuestionsFamiliar")

# Differences within TD Group across Conditions:
WithinTDGroupMGSlowerQuestionsFamiliar <- extract_relevant_data(AdultLatency_m1,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinTDGroupMG>QuestionsFamiliar")

# Differences within Autism Group across Familiarity:
WithinAutismGroupQuestionsUnfamiliarSlowerFamiliar <- extract_relevant_data(AdultLatency_m1,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                      "WithinAutismGroupQuestionsUnfamiliar>Familiar")

# Differences within TD Group across Familiarity:
WithinTDGroupQuestionsUnfamiliarSlowerFamiliar <- extract_relevant_data(AdultLatency_m1,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinTDGroupQuestionsUnfamiliar>Familiar")

# Differences between Autism Group and Typical Development Group Within MatchingGame
WithinConditionsMatchingGameASDFasterTD <- extract_relevant_data(AdultLatency_m1,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                      "WithinConditionsMatchingGameASD<TD")

# Differences between Autism Group and Typical Development Group Within Familiar Questions:
WithinConditionsQuestionsFamiliarASDFasterTD <- extract_relevant_data(AdultLatency_m1,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinConditionsQuestionsFamiliarASD<TD")

# Differences between Autism Group and Typical Development Group Within Unfamiliar Questions:
WithinConditionsQuestionsUnfamiliarASDFasterTD <- extract_relevant_data(AdultLatency_m1,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                      "WithinConditionsQuestionsUnfamiliarASD<TD")

# Differences between Autism Group and Typical Development Group in Differences within Familiarity
DifferenceInDifferenceBetweenGroupsUnfamiliarBiggerFamiliarity <- extract_relevant_data(AdultLatency_m1,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) < 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                      "DifferenceInDifferenceBetweenGroupsUnfamiliar>Familiarity")

# Differences between Autism Group and Typical Development Group in Differences within Conditions
DifferenceInDifferenceBetweenGroupsMGBiggerThanConversations <- extract_relevant_data(AdultLatency_m1,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) > 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                      "DifferenceInDifferenceBetweenGroupsMG>Conversations")

# Overall Subject Variability in Autismm Group
SubjectVariabilityASD <- extract_relevant_sd_data(AdultLatency_m1, 
                                               "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisASD + TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD)/3 > 0",
                                               "SubjectVariabilityASD")

SubjectVariabilityASD_MG <- extract_relevant_sd_data(AdultLatency_m1, 
                                               "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_MG")

SubjectVariabilityASD_Q_F <- extract_relevant_sd_data(AdultLatency_m1, 
                                               "TaskQuestions:FamiliarityFamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_Q_F")

SubjectVariabilityASD_Q_UF <- extract_relevant_sd_data(AdultLatency_m1, 
                                               "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_Q_UF")

# Overall Subject Variability in TD Group
SubjectVariabilityTD <- extract_relevant_sd_data(AdultLatency_m1, 
                                               "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisTDC + TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC)/3 > 0",
                                               "SubjectVariabilityTD")

SubjectVariabilityTD_MG <- extract_relevant_sd_data(AdultLatency_m1, 
                                               "TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_MG")

SubjectVariabilityTD_Q_F <- extract_relevant_sd_data(AdultLatency_m1, 
                                               "TaskQuestions:FamiliarityFamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_Q_F")

SubjectVariabilityTD_Q_UF <- extract_relevant_sd_data(AdultLatency_m1, 
                                               "TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_Q_UF")

# Overall Subject Variability in TD Group
SubjectVariabilityASDSmallerThanTD <- extract_relevant_sd_data(AdultLatency_m1,
                                              "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisASD + TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD) / 3 <
                                              (TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisTDC + TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC) / 3",
                                               "SubjectVariabilityASD<TD")


SubjectVariabilityASDSmallerThanTD_MG <- extract_relevant_sd_data(AdultLatency_m1,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD  <
                                              TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_MG<TD_MG")

SubjectVariabilityASDSmallerThanTD_Q_F <- extract_relevant_sd_data(AdultLatency_m1,
                                              "TaskQuestions:FamiliarityFamiliar:DiagnosisASD  <
                                              TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_Q_F<TD_Q_F")

SubjectVariabilityASDSmallerThanTD_Q_UF <- extract_relevant_sd_data(AdultLatency_m1,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD  <
                                              TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_Q_UF<TD_Q_UF")

SubjectVariabilityASD_MG_SmallerThan_Q_F <- extract_relevant_sd_data(AdultLatency_m1,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD > TaskQuestions:FamiliarityFamiliar:DiagnosisASD",
                                               "SubjectVariabilityASD_MG_SmallerThan_Q_F")

SubjectVariabilityASD_Q_F_SmallerThan_Q_UF <- extract_relevant_sd_data(AdultLatency_m1,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD > TaskQuestions:FamiliarityFamiliar:DiagnosisASD",
                                               "SubjectVariabilityASD_Q_F_SmallerThan_Q_UF")

SubjectVariabilityTDC_MG_SmallerThan_Q_F <- extract_relevant_sd_data(AdultLatency_m1,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC < TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityTDC_MG_SmallerThan_Q_F")

SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF <- extract_relevant_sd_data(AdultLatency_m1,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC > TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF")

DifferenceInDifferenceSubjectVariabilityUnfamiliarSmallerFamiliarity <- extract_relevant_sd_data(AdultLatency_m1,
                                              "(TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD - TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC) 
                                              < 
                                              (TaskQuestions:FamiliarityFamiliar:DiagnosisASD - TaskQuestions:FamiliarityFamiliar:DiagnosisTDC)",
                                              "DifferenceInDifferenceSubjectVariabilityUnfamiliarBiggerFamiliarity")

DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions <- extract_relevant_sd_data(AdultLatency_m1,
                                              "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC - TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD) 
                                              < 
                                              (TaskQuestions:FamiliarityFamiliar:DiagnosisTDC - TaskQuestions:FamiliarityFamiliar:DiagnosisASD)",
                                              "DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions")

# Overall Visit Variability across visits in Autism Group
VisitVariabilityASDOverall <- extract_relevant_sdvisit_data(AdultLatency_m1, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                                               "VisitVariabilityASDOverall")

# Overall Visit Variability across visits in TD Group
VisitVariabilityTDCOverall <- extract_relevant_sdvisit_data(AdultLatency_m1, 
                                               "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                                               "VisitVariabilityTDCOverall")


VisitVariabilityASDOverallHigherTDSOverall <- extract_relevant_sdvisit_data(AdultLatency_m1, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 >
                                               (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3",
                                               "VisitVariabilityASDOverallLowerTDSOverall")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASDMG <- extract_relevant_sdvisit_data(AdultLatency_m1, 
                                               "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                                               "VisitVariabilityASDMG")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDMG <- extract_relevant_sdvisit_data(AdultLatency_m1, 
                                               "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                                               "VisitVariabilityTDMG")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASD_Q_F <- extract_relevant_sdvisit_data(AdultLatency_m1, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > 0",
                                               "VisitVariabilityASD_Q_F")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDC_Q_F <- extract_relevant_sdvisit_data(AdultLatency_m1, 
                                               "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar > 0",
                                               "VisitVariabilityTDC_Q_F")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASD_Q_UF <- extract_relevant_sdvisit_data(AdultLatency_m1, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > 0",
                                               "VisitVariabilityASD_Q_UF")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDC_Q_UF <- extract_relevant_sdvisit_data(AdultLatency_m1, 
                                               "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > 0",
                                               "VisitVariabilityTDC_Q_UF")

# Overall Subject Variability across visits, differences
VisitVariabilityASDMGSlowerThanTDMG <- extract_relevant_sdvisit_data(AdultLatency_m1, 
                                               "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar",
                                               "VisitVariabilityASDMG>TDMG")

# Overall Subject Variability across visits, differences
VisitVariabilityASD_Q_F_SlowerThanTD_Q_F <- extract_relevant_sdvisit_data(AdultLatency_m1, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                                               "VisitVariabilityASD_Q_F_SlowerThanTD_Q_F")

# Overall Subject Variability across visits, differences
VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF <- extract_relevant_sdvisit_data(AdultLatency_m1, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                                               "VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF")

#DifferenceInDifference:
DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity <- extract_relevant_sdvisit_data(AdultLatency_m1, 
                                               "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)
                                               < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity")

DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG <- extract_relevant_sdvisit_data(AdultLatency_m1, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)
                                               > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG")


# Overall Sigma Variability across visits in Autism Group
SigmaASDOverall <- extract_relevant_sigma_data(AdultLatency_m1, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 < 0",
                                               "SigmaASDOverall")

# Overall Sigma Variability across visits in TD Group
SigmaTDCOverall <- extract_relevant_sigma_data(AdultLatency_m1, 
                                               "(sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) /3 < 0",
                                               "SigmaTDCOverall")


SigmaASDOverallHigherTDSOverall <- extract_relevant_nonlatency_data(AdultLatency_m1, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 >
                                               (sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3",
                                               "SigmaASDOverallHigherTDSOverall")

# Subject Variability across visits MG in Autism Group
SigmaASDMG <- extract_relevant_sigma_data(AdultLatency_m1, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < 0",
                                               "SigmaASDMG")

# Overall Subject Variability across visits in TD Group
SigmaTDMG <- extract_relevant_sigma_data(AdultLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < 0",
                                               "SigmaTDMG")

# Subject Variability across visits MG in Autism Group
SigmaASD_Q_F <- extract_relevant_sigma_data(AdultLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < 0",
                                               "SigmaASD_Q_F")

# Overall Subject Variability across visits in TD Group
SigmaTDC_Q_F <- extract_relevant_sigma_data(AdultLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar < 0",
                                               "SigmaTDC_Q_F")


# Subject Variability across visits MG in Autism Group
SigmaASD_Q_UF <- extract_relevant_sigma_data(AdultLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < 0 ",
                                               "SigmaASD_Q_UF")

# Overall Subject Variability across visits in TD Group
SigmaTDC_Q_UF <- extract_relevant_sigma_data(AdultLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar < 0",
                                               "SigmaTDC_Q_UF")

# Overall Subject Variability across visits, differences
SigmaASDMGSlowerThanTDMG <- extract_relevant_nonlatency_data(AdultLatency_m1, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                                               "SigmaASDMGSlowerThanTDMG")

# Overall Subject Variability across visits, differences
SigmaASD_Q_F_SlowerThanTD_Q_F <- extract_relevant_nonlatency_data(AdultLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                                               "SigmaASD_Q_F_SlowerThanTD_Q_F")

# Overall Subject Variability across visits, differences
SigmaASD_Q_UF_SlowerThanTD_Q_UF <- extract_relevant_nonlatency_data(AdultLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                                               "SigmaASD_Q_UF_SlowerThanTD_Q_UF")

# Sigma across visits, differences
# SigmaASD_MG_VisitLowerZero <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit < 0",
#                                                "SigmaASD_MG_VisitLowerZero")
# 
# SigmaTDC_MG_VisitLowerZero <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit > 0",
#                                                "SigmaTDC_MG_VisitLowerZero")
# 
# SigmaASD_MG_VisitLowerTDC <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "SigmaASD_MG_VisitLowerTDC")
# 
# SigmaASD_Overall_VisitLowerZero <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit + 
#                                                sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit +
#                                                sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 < 0",
#                                                "SigmaASD_Overall_VisitLowerZero")
# 
# SigmaTDC_Overall_VisitLowerZero <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "(sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit + 
#                                                sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit +
#                                                sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 < 0",
#                                                "SigmaTDC_Overall_VisitLowerZero")
# 
# # Sigma across visits, differences
# SigmaASD_Q_F_VisitLowerZero <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit > 0",
#                                                "SigmaASD_Q_F_VisitLowerZero")
# 
# SigmaTDC_Q_F_VisitLowerZero <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit < 0",
#                                                "SigmaTDC_Q_F_VisitLowerZero")
# 
# SigmaASD_Q_F_VisitLowerTDC <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "SigmaASD_Q_F_VisitLowerTDC")
# 
# # Sigma across visits, differences
# SigmaASD_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < 0",
#                                                "SigmaASD_Q_UF_VisitLowerZero")
# 
# SigmaTDC_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > 0",
#                                                "SigmaTDC_Q_UF_VisitLowerZero")
# 
# SigmaASD_Q_UF_VisitLowerTDC <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "SigmaASD_Q_UF_VisitLowerTDC")
# 
# SigmaVisitOverall_ASDLowerTDC <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit + 
#                                                sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit +
#                                                sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 > (sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit + 
#                                                sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit +
#                                                sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) /3",
#                                                "SigmaVisitOverall_ASDLowerTDC")

#DifferenceInDifference:
DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity <- extract_relevant_nonlatency_data(AdultLatency_m1, 
                                               "(sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)
                                               > (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity")

DifferenceInDifferenceSigmaASDMGSmallerThanTDMG <- extract_relevant_nonlatency_data(AdultLatency_m1, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)
                                               > (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceSigmaASDMGSmallerThanTDMG")

#WithinGroups
WithinGroupSigmaASD_Q_F_Faster_UF <- extract_relevant_nonlatency_data(AdultLatency_m1, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaASD_Q_FFaster_UF")

WithinGroupSigmaTDC_Q_F_Faster_UF <- extract_relevant_nonlatency_data(AdultLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaTDC_Q_F_Faster_UF")

WithinGroupSigmaASD_Q_F_Faster_MG <- extract_relevant_nonlatency_data(AdultLatency_m1, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaASD_Q_F_Faster_MG")

WithinGroupSigmaTDC_Q_F_Faster_MG <- extract_relevant_nonlatency_data(AdultLatency_m1, 
                                               "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaTDC_Q_F_Faster_MG")


# WithinGroupSigmaASD_Q_F_Lower_UF_Visit <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit",
#                                                "WithinGroupSigmaASD_Q_F_Lower_UF_Visit")
# 
# WithinGroupSigmaTDC_Q_F_Lower_UF_Visit <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit",
#                                                "WithinGroupSigmaTDC_Q_F_Lower_UF_Visit")
# 
# WithinGroupSigmaASD_Q_F_Lower_MG_Visit <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "WithinGroupSigmaASD_Q_F_Lower_MG_Visit")
# 
# WithinGroupSigmaTDC_Q_F_Lower_MG_Visit <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "WithinGroupSigmaTDC_Q_F_Lower_MG_Visit")
# 
# 
# SigmaTDC_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > 0",
#                                                "SigmaTDC_Q_UF_VisitLowerZero")
# 
# SigmaASD_Q_UF_VisitLowerTDC <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "SigmaASD_Q_UF_VisitLowerTDC")
# 
# 
# DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "(sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) <
#                                                (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit)", "DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF")
# 
# 
# DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F <- extract_relevant_nonlatency_data(AdultLatency_m1, 
#                                                "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit) <
#                                                (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit)", "DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F")



# Correlation Estimates across visits in Autism Group
post <- as_draws_df(AdultLatency_m1)


# Apply the function for each case
cor_post_mu_MG_ASD <- Visitextract_and_rename(post, "DiagnosisASD", "TaskMatchingGame", "FamiliarityFamiliar") %>%
  cor() %>%
  as.matrix()

cor_post_mu_MG_TDC <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskMatchingGame", "FamiliarityFamiliar") %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_ASD_Familiar <- Visitextract_and_rename(post, "DiagnosisASD", "TaskQuestions", "FamiliarityFamiliar") %>%
  select(Visit2, Visit4, Visit6) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_TDC_Familiar <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskQuestions", "FamiliarityFamiliar") %>%
  select(Visit2, Visit4, Visit6) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_ASD_Unfamiliar <- Visitextract_and_rename(post, "DiagnosisASD", "TaskQuestions", "FamiliarityUnfamiliar") %>%
  select(Visit1, Visit3, Visit5, Visit7) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_TDC_Unfamiliar <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskQuestions", "FamiliarityUnfamiliar") %>%
  select(Visit1, Visit3, Visit5, Visit7) %>%
  cor() %>%
  as.matrix()

diag(cor_post_mu_MG_ASD) <- NA
diag(cor_post_mu_MG_TDC) <- NA
diag(cor_post_mu_Q_ASD_Familiar) <- NA
diag(cor_post_mu_Q_TDC_Familiar) <- NA
diag(cor_post_mu_Q_ASD_Unfamiliar) <- NA
diag(cor_post_mu_Q_TDC_Unfamiliar) <- NA

CorrelationSummaryStatistics <- tibble(
       Estimate = c(mean(cor_post_mu_MG_ASD, na.rm = TRUE), mean(cor_post_mu_Q_ASD_Familiar, na.rm = TRUE), mean(cor_post_mu_Q_ASD_Unfamiliar, na.rm = TRUE), 
                    mean(cor_post_mu_MG_TDC, na.rm = TRUE), mean(cor_post_mu_Q_TDC_Familiar, na.rm = TRUE), mean(cor_post_mu_Q_TDC_Unfamiliar, na.rm = TRUE)),
       CI.Lower = c(quantile(cor_post_mu_MG_ASD, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Familiar, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Unfamiliar, probs = 0.025, na.rm = TRUE), 
                    quantile(cor_post_mu_MG_TDC, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Familiar, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Unfamiliar, probs = 0.025, na.rm = TRUE)),
       CI.Upper = c(quantile(cor_post_mu_MG_ASD, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Familiar, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Unfamiliar, probs = 0.975, na.rm = TRUE), 
                    quantile(cor_post_mu_MG_TDC, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Familiar, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Unfamiliar, probs = 0.975, na.rm = TRUE)),
       Evid.Ratio = c(NA, NA, NA, NA, NA, NA),
       TestDescription = c(
  "CorrelationAcrossVisitsASDMG", "CorrelationAcrossVisitsASDFamiliarQuestions", "CorrelationAcrossVisitsASDUnfamiliarQuestions",
  "CorrelationAcrossVisitsTDMG", "CorrelationAcrossVisitsTDFamiliarQuestions", "CorrelationAcrossVisitsTDUnfamiliarQuestions"),
       )

HypothesisResultsAdultlatenciesModel1 <- rbind(OverallLatencyThreeConditionsASD,
                                               OverallLatencyThreeConditionsTD,
                                               MGOverallLatencyASD,
                                               Q_F_OverallLatencyASD,
                                               Q_UF_OverallLatencyASD,
                                               MGOverallLatencyTDC,
                                               Q_F_OverallLatencyTDC,
                                               Q_UF_OverallLatencyTDC,
                                               BetaParameterASD_MG,
                                               BetaParameterASD_Q_F,
                                               BetaParameterASD_Q_UF,
                                               BetaParameterASD_Overall,
                                               BetaParameterTDC_MG,
                                               BetaParameterTDC_Q_F,
                                               BetaParameterTDC_Q_UF,
                                               BetaParameterTDC_Overall,
                                               OverallBetaParameterASDLowerTD,
                                               BetaParameterASDFasterTD_MG,
                                               BetaParameterASDFasterTD_Q_F,
                                               BetaParameterASDFasterTD_Q_UF,
                                               WithinGroupBetaParameterASD_MG_Slower_Q_F,
                                               WithinGroupBetaParameterTDC_MG_Slower_Q_F,
                                               DifferenceInDifferenceBetaParameterBetweenGroupsMGBiggerQ_F,
                                               WithinGroupBetaParameterASD_Q_F_Slower_Q_UF,
                                               WithinGroupBetaParameterTDC_Q_F_Slower_Q_UF,
                                               DifferenceInDifferenceBetaParameterBetweenGroupsFamiliarityBiggerUnfamiliarity,
                                               OverallLatencyThreeConditionsASDFasterTD,
                                               WithinASDGroupMGSlowerQuestionsFamiliar,
                                               WithinTDGroupMGSlowerQuestionsFamiliar,
                                               WithinAutismGroupQuestionsUnfamiliarSlowerFamiliar,
                                               WithinTDGroupQuestionsUnfamiliarSlowerFamiliar,
                                               WithinConditionsMatchingGameASDFasterTD,
                                               WithinConditionsQuestionsFamiliarASDFasterTD,
                                               WithinConditionsQuestionsUnfamiliarASDFasterTD,
                                               DifferenceInDifferenceBetweenGroupsUnfamiliarBiggerFamiliarity,
                                               DifferenceInDifferenceBetweenGroupsMGBiggerThanConversations,
                                               SubjectVariabilityASD,
                                               SubjectVariabilityTD,
                                               SubjectVariabilityASDSmallerThanTD,
                                               SubjectVariabilityASD_MG,
                                               SubjectVariabilityASD_Q_F,
                                               SubjectVariabilityASD_Q_UF,
                                               SubjectVariabilityTD_MG,
                                               SubjectVariabilityTD_Q_F,
                                               SubjectVariabilityTD_Q_UF,
                                               SubjectVariabilityASDSmallerThanTD_MG,
                                               SubjectVariabilityASDSmallerThanTD_Q_F,
                                               SubjectVariabilityASDSmallerThanTD_Q_UF,
                                               SubjectVariabilityASD_MG_SmallerThan_Q_F,
                                               SubjectVariabilityASD_Q_F_SmallerThan_Q_UF,
                                               SubjectVariabilityTDC_MG_SmallerThan_Q_F,
                                               SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF,
                                               DifferenceInDifferenceSubjectVariabilityUnfamiliarSmallerFamiliarity,
                                               DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions,
                                               VisitVariabilityASDMG,
                                               VisitVariabilityTDMG,
                                               VisitVariabilityASD_Q_F,
                                               VisitVariabilityTDC_Q_F,
                                               VisitVariabilityASD_Q_UF,
                                               VisitVariabilityTDC_Q_UF,
                                               VisitVariabilityASDOverall,
                                               VisitVariabilityTDCOverall,
                                               VisitVariabilityASDMGSlowerThanTDMG,
                                               VisitVariabilityASD_Q_F_SlowerThanTD_Q_F,
                                               VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF,
                                               VisitVariabilityASDOverallHigherTDSOverall,
                                               DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG,
                                               DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity,
                                               SigmaASDOverall,
                                               SigmaTDCOverall,
                                               SigmaASDOverallHigherTDSOverall,
                                               SigmaASDMG,
                                               SigmaTDMG,
                                               SigmaASD_Q_F,
                                               SigmaTDC_Q_F,
                                               SigmaASD_Q_UF,
                                               SigmaTDC_Q_UF,
                                               SigmaASDMGSlowerThanTDMG,
                                               SigmaASD_Q_F_SlowerThanTD_Q_F,
                                               SigmaASD_Q_UF_SlowerThanTD_Q_UF,
                                               # SigmaASD_MG_VisitLowerZero,
                                               # SigmaTDC_MG_VisitLowerZero,
                                               # SigmaASD_MG_VisitLowerTDC,
                                               # SigmaASD_Q_F_VisitLowerZero,
                                               # SigmaTDC_Q_F_VisitLowerZero,
                                               # SigmaASD_Q_F_VisitLowerTDC,
                                               # SigmaASD_Q_UF_VisitLowerZero,
                                               # SigmaTDC_Q_UF_VisitLowerZero,
                                               # SigmaASD_Q_UF_VisitLowerTDC,
                                               # SigmaASD_Overall_VisitLowerZero,
                                               # SigmaTDC_Overall_VisitLowerZero,
                                               # WithinGroupSigmaASD_Q_F_Lower_UF_Visit,
                                               # WithinGroupSigmaTDC_Q_F_Lower_UF_Visit,
                                               # WithinGroupSigmaASD_Q_F_Lower_MG_Visit,
                                               # WithinGroupSigmaTDC_Q_F_Lower_MG_Visit,
                                               WithinGroupSigmaASD_Q_F_Faster_UF,
                                               WithinGroupSigmaTDC_Q_F_Faster_UF,
                                               WithinGroupSigmaASD_Q_F_Faster_MG,
                                               WithinGroupSigmaTDC_Q_F_Faster_MG,
                                               #SigmaVisitOverall_ASDLowerTDC,
                                               # DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF,
                                               # DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F,
                                               DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity,
                                               DifferenceInDifferenceSigmaASDMGSmallerThanTDMG,
                                               CorrelationSummaryStatistics) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(HypothesisResultsAdultlatenciesModel1, 'stats_for_paper/model1_adult_stats_for_paper.csv')
```

## Visualisation of Model Estimates
```{r}
newdata <- subset(d, InterTurn == "Child2Adult") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) 

C2P_PredictedData <- as_tibble(predict(AdultLatency_m1, newdata = newdata)) %>%
  mutate(Visit = newdata$Visit) %>%
  mutate(Diagnosis = newdata$Diagnosis) %>%
  mutate(ID = newdata$ID) %>%
  mutate(Familiarity = newdata$Familiarity) %>%
  mutate(Task = newdata$Task) %>%
  mutate(size = Q97.5-Q2.5) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  group_by(Diagnosis, ID, Familiarity, Task) %>%
  dplyr::summarise(Estimate = mean(Estimate)) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

Posterior_df <- as_draws_df(AdultLatency_m1)

condition_posterior_TDC_MG <- Posterior_df[,"b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "MatchingGame",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_ASD_MG <- Posterior_df[,"b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "MatchingGame",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_TDC_Q_F <- Posterior_df[,"b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "Questions",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_ASD_Q_F <- Posterior_df[,"b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "Questions",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_TDC_Q_UF <- Posterior_df[,"b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar"] %>%
  mutate(Familiarity = "Unfamiliar",
         Task = "Questions",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent"))) 

condition_posterior_ASD_Q_UF <- Posterior_df[,"b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar"] %>%
  mutate(Familiarity = "Unfamiliar",
         Task = "Questions",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

posteriors <- rbind(condition_posterior_ASD_MG, condition_posterior_TDC_MG,
      condition_posterior_ASD_Q_F, condition_posterior_TDC_Q_F, 
      condition_posterior_ASD_Q_UF, condition_posterior_TDC_Q_UF)

Model1_Plot_Adult_Conditions <- ggplot() +
  geom_rect(aes(xmin=-Inf, xmax = 1.47, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_rect(aes(xmin=1.47, xmax = 2.48, ymin=-Inf, ymax=Inf), fill = "honeydew3", alpha = 0.3) +
  geom_rect(aes(xmin=2.48, xmax = 3.6, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_boxplot(aes(Condition, Estimate, color = Diagnosis, fill = Diagnosis), filter(posteriors, Diagnosis == "Autism Group"), width = 0.05, color = "black", position = position_nudge(x = -0.30), alpha = 0.9, outliers = F, show.legend = T) +
  geom_boxplot(aes(Condition, Estimate, color = Diagnosis, fill = Diagnosis), filter(posteriors, Diagnosis == "Typical Development"), width = 0.05, color = "black", position = position_nudge(x = -0.10), alpha = 0.9, outliers = F, show.legend = T) +
  geom_point(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "#009E73", alpha = 0.7, data = filter(C2P_PredictedData, Diagnosis == "Autism Group"), size = 2, position = position_nudge(x = -.22)) + 
  geom_point(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "#CC79A7", alpha = 0.7, data = filter(C2P_PredictedData, Diagnosis == "Typical Development"), size = 2, position = position_nudge(x = -.18)) + 
  geom_half_violin(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "black", alpha = 0.9, data = filter(posteriors, Diagnosis == "Autism Group"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  geom_half_violin(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "black", alpha = 0.9, data = filter(posteriors, Diagnosis == "Typical Development"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  #scale_fill_okabeito() +
  #scale_color_okabeito() +
  xlab(' ') +
  coord_flip() +
  ylab('Average Adult Response Latency (seconds)') +
  guides(color = guide_legend(reverse=TRUE), fill = guide_legend(reverse=TRUE)) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 15, color = "black"),
        legend.title = element_blank(),
        legend.position = c(0.25, 0.92),
        legend.key.size = unit(3, "lines"),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key = element_rect(fill = "transparent", color = NA),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 15, color = "black"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

Model1_Plot_Adult_Conditions
```

## Visualisation of Correlation Structures
```{r}
post <- as_draws_df(AdultLatency_m1)

# Generate the plots
ASD_MG <- generate_corr_plot(cor_post_mu_MG_ASD, 'Autism Group: Matching With Parent')
TD_MG <- generate_corr_plot(cor_post_mu_MG_TDC, 'Typical Development: Matching With Parent')

ASD_Q_Fam  <- generate_corr_plot(cor_post_mu_Q_ASD_Familiar, 'Autism Group: Convo With Parent')
TD_Q_Fam  <- generate_corr_plot(cor_post_mu_Q_TDC_Familiar, 'Typical Development: Convo With Parent')

ASD_Q_Unfam  <- generate_corr_plot(cor_post_mu_Q_ASD_Unfamiliar, 'Autism Group: Convo With Experimenter')
TD_Q_Unfam  <- generate_corr_plot(cor_post_mu_Q_TDC_Unfamiliar, 'Typical Development: Convo With Experimenter')

CorrelationMatrices_Adult <- cowplot::plot_grid(ASD_MG, TD_MG, ASD_Q_Fam, TD_Q_Fam, ASD_Q_Unfam, TD_Q_Unfam, nrow = 3)
```

## Visualisation of Increasing Familiarity across Visits
```{r}
newdata <- subset(d, InterTurn == "Adult2Child") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) 

P2C_PredictedData <- as_tibble(predict(AdultLatency_m1, newdata = newdata)) %>%
  mutate(Visit = newdata$Visit) %>%
  mutate(Diagnosis = newdata$Diagnosis) %>%
  mutate(ID = newdata$ID) %>%
  mutate(Familiarity = newdata$Familiarity) %>%
  mutate(Task = newdata$Task) %>%
  mutate(size = Q97.5-Q2.5) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  group_by(Diagnosis, ID, Familiarity, Task, Visit) %>%
  dplyr::summarise(Estimate = mean(Estimate)) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent"))) %>%
  mutate(Visit = jitter(Visit, amount = 0.2))

P2C_Change_In_FamiliarityPlot <- ggplot(P2C_PredictedData) +
  #geom_rect(aes(xmin=-Inf, xmax = 1.47, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  #geom_rect(aes(xmin=1.47, xmax = 2.48, ymin=-Inf, ymax=Inf), fill = "honeydew3", alpha = 0.3) +
  #geom_rect(aes(xmin=2.48, xmax = 3.6, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_point(aes(x = Visit, y = Estimate, fill = Diagnosis, color = Diagnosis), alpha = 0.5, data = P2C_PredictedData, size = 2, show.legend = FALSE) + 
  geom_smooth(aes(x = Visit, y = Estimate, fill = Diagnosis, color = Diagnosis), alpha = 0.5, data = P2C_PredictedData, method = 'lm') +
  scale_x_continuous(breaks = seq(1, 7, 1), limits = c(1, 7)) +
  scale_fill_manual(values = c("#009E73", "#CC79A7", "darkgreen")) +
  scale_color_manual(values = c("#009E73", "#CC79A7", "darkgreen")) +
  xlab('Visit') +
  facet_wrap(~Condition) +
  ylab('Adult Response Latency (seconds)') +
  guides(color = guide_legend(reverse=FALSE), fill = guide_legend(show = FALSE)) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        legend.position = c(0.5, 0.91),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key = element_rect(fill = "transparent", color = NA),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())
P2C_Change_In_FamiliarityPlot
```

# RQ2, Probability of Children Overlapping
```{r}
d <- d %>% mutate(
  overlapping = ifelse(Latency > 0, 0, 1),
  overlapping_child = ifelse(SelfChild2 > 0, 0, 1),
  overlapping_adult = ifelse(SelfAdult2 > 0, 0, 1)
)

Overlapping_f1 <- bf(
  overlapping ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task | r | Visit))

priorChild_overlapping <- c(
  prior(normal(0, 1), class = b),
  prior(normal(0,0.3), class = sd),
  prior(lkj(3), class = cor)
)

OverlappingChild_m <- brm(
  Overlapping_f1,
  subset(d, InterTurn == "Child2Adult"),
  family = bernoulli(),
  prior = priorChild_overlapping,
  sample_prior = T,
  file = here("VBMTurnTakingFiles", "models", "OverlappingChild_m"),
  backend = "cmdstanr",
  #threads = threading(2),
  iter = 4000,
  warmup = 500,
  init = 0,
  chains = 2,
  cores = 64,
  control = list(adapt_delta = 0.90, max_treedepth = 10),
  stan_model_args = list(stanc_options = list("O1"))
)
pp_check(OverlappingChild_m, ndraws = 100)
```

## Visualisation of Model Estimates
```{r}
newdata <- subset(d, InterTurn == "Child2Adult") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) 

C2P_PredictedOverlapData <- as_tibble(predict(OverlappingChild_m, newdata = newdata)) %>%
  mutate(Visit = newdata$Visit) %>%
  mutate(Diagnosis = newdata$Diagnosis) %>%
  mutate(ID = newdata$ID) %>%
  mutate(Familiarity = newdata$Familiarity) %>%
  mutate(Task = newdata$Task) %>%
  mutate(size = Q97.5-Q2.5) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Visit_x = jitter(Visit)) %>%
  group_by(Diagnosis, ID, Familiarity, Task) %>%
  dplyr::summarise(Estimate = mean(Estimate)) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent"))) %>%
  mutate(Estimate = Estimate * 100)

Posterior_df <- as_draws_df(OverlappingChild_m)

condition_posterior_TDC_MG <- Posterior_df[,"b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "MatchingGame",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_ASD_MG <- Posterior_df[,"b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "MatchingGame",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_TDC_Q_F <- Posterior_df[,"b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "Questions",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_ASD_Q_F <- Posterior_df[,"b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "Questions",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_TDC_Q_UF <- Posterior_df[,"b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar"] %>%
  mutate(Familiarity = "Unfamiliar",
         Task = "Questions",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent"))) 


condition_posterior_ASD_Q_UF <- Posterior_df[,"b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar"] %>%
  mutate(Familiarity = "Unfamiliar",
         Task = "Questions",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

posteriors <- rbind(condition_posterior_ASD_MG, condition_posterior_TDC_MG,
      condition_posterior_ASD_Q_F, condition_posterior_TDC_Q_F, 
      condition_posterior_ASD_Q_UF, condition_posterior_TDC_Q_UF) %>%
  mutate(Estimate = (plogis(Estimate))) %>%
  mutate(Estimate = Estimate * 100)

C2P_PredictedOverlapDataOverall <- ggplot() +
  geom_rect(aes(xmin=-Inf, xmax = 1.47, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_rect(aes(xmin=1.47, xmax = 2.48, ymin=-Inf, ymax=Inf), fill = "honeydew3", alpha = 0.3) +
  geom_rect(aes(xmin=2.48, xmax = 3.6, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_boxplot(aes(Condition, Estimate, color = Diagnosis, fill = Diagnosis), filter(posteriors, Diagnosis == "Autism Group"), width = 0.05, color = "black", position = position_nudge(x = -0.30), alpha = 0.9, outliers = F, show.legend = T) +
  geom_boxplot(aes(Condition, Estimate, color = Diagnosis, fill = Diagnosis), filter(posteriors, Diagnosis == "Typical Development"), width = 0.05, color = "black", position = position_nudge(x = -0.10), alpha = 0.9, outliers = F, show.legend = T) +
  geom_point(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "#009E73", alpha = 0.7, data = filter(C2P_PredictedOverlapData, Diagnosis == "Autism Group"), size = 2, position = position_nudge(x = -.22)) + 
  geom_point(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "#CC79A7", alpha = 0.7, data = filter(C2P_PredictedOverlapData, Diagnosis == "Typical Development"), size = 2, position = position_nudge(x = -.18)) + 
  geom_half_violin(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "black", alpha = 0.7, data = filter(posteriors, Diagnosis == "Autism Group"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  geom_half_violin(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "black", alpha = 0.7, data = filter(posteriors, Diagnosis == "Typical Development"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  xlab(' ') +
  coord_flip() +
  ylab('Percentage of Overlaps in Child Speech') +
  guides(color = guide_legend(reverse=TRUE), fill = guide_legend(reverse=TRUE)) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 15, color = "black"),
        legend.title = element_blank(),
        legend.position = c(0.7, 0.95),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key = element_rect(fill = "transparent", color = NA),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 15, color = "black"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

C2P_PredictedOverlapDataOverall
```

## Hypothesis Tests
```{r}
ASD_OverlapsHigherThanZero <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) +
           inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) +
           inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar))/3 >
           0",
           "ASD_OverlapsHigherThanZero")

ASD_MG_F <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) > 0",
           "ASD_MG_F")

ASD_Q_F <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) > 0",
           "ASD_Q_F")

ASD_Q_UF <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) > 0",
           "ASD_Q_UF")

TDC_OverlapsHigherThanZero <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "(inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) +
           inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar) +
           inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar))/3 >
           0",
           "TDC_OverlapsHigherThanZero")

TD_MG_F <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) > 0",
           "TD_MG_F")

TD_Q_F <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar) > 0",
           "TD_Q_F")

TD_Q_UF <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) > 0",
           "TD_Q_UF")



WithinGroup_ASD_MG_F_Higher_Q_F <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) < inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar)",
           "WithinGroup_ASD_MG_F_Higher_Q_F")

WithinGroup_ASD_Q_F_Higher_Q_UF <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) < inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)",
           "WithinGroup_ASD_Q_F_Higher_Q_UF")

WithinGroup_TDC_MG_F_Higher_Q_F <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) > inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
           "WithinGroup_TDC_MG_F_Higher_Q_F")

WithinGroup_TDC_Q_F_Higher_Q_UF <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar) < inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)",
           "WithinGroup_TDC_Q_F_Higher_Q_UF")


ASDOverlapsHigherThanTDCArossConditions <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) +
            inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) +
            inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar))/3 >
            (inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) +
            inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar) +
            inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar))/3",
           "ASDOverlapsHigherThanTDCArossConditions")

ASDOverlapsHigherThanTDCWithinMatchingGame <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) > inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)",
           "ASDOverlapsHigherThanTDCWithinMatchingGame")

ASDOverlapsHigherThanTDCWithinQFamiliar <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) > inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
           "ASDOverlapsHigherThanTDCWithinQFamiliar")

ASDOverlapsHigherThanTDCWithinQUnfamiliar <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) > inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)",
           "ASDOverlapsHigherThanTDCWithinQUnfamiliar")

#Differences between groups according to Condition
DifferencesBetweenGroupsQuestionsHigherMatchingGame <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) - inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)) <
           (inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar))",
           "DifferenceInDifferenceBetweenGroupsASDHigherTDCMatchingGame")

#Differences between groups according to Familiarty
DifferencesBetweenGroupsUnfamiliarityHigherFamiliarity <- extract_relevant_nonlatency_data(OverlappingChild_m, 
           "(inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)) <
           (inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar))",
           "DifferenceInDifferenceBetweenGroupsUnfamiliarityHigherFamiliarity")


HypothesisResultsChildOverlaps <- rbind(ASD_OverlapsHigherThanZero,
                                        TDC_OverlapsHigherThanZero,
                                        ASD_MG_F,
                                        ASD_Q_F,
                                        ASD_Q_UF,
                                        TD_MG_F,
                                        TD_Q_F,
                                        TD_Q_UF,
                                        ASDOverlapsHigherThanTDCArossConditions,
                                        ASDOverlapsHigherThanTDCWithinMatchingGame,
                                        ASDOverlapsHigherThanTDCWithinQFamiliar,
                                        ASDOverlapsHigherThanTDCWithinQUnfamiliar,
                                        DifferencesBetweenGroupsQuestionsHigherMatchingGame, 
                                        DifferencesBetweenGroupsUnfamiliarityHigherFamiliarity,
                                        WithinGroup_ASD_MG_F_Higher_Q_F,
                                        WithinGroup_ASD_Q_F_Higher_Q_UF,
                                        WithinGroup_TDC_MG_F_Higher_Q_F,
                                        WithinGroup_TDC_Q_F_Higher_Q_UF) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(HypothesisResultsChildOverlaps, 'stats_for_paper/bernoulli_overlaps_stats_for_paper.csv')
```


# RQ2, Probability of Adults Overlapping
```{r}
job::job({
  OverlappingAdult_m <- brm(
  Overlapping_f1,
  subset(d, InterTurn == "Adult2Child"),
  family = bernoulli(),
  prior = priorChild_overlapping,
  sample_prior = T,
  backend = "cmdstanr",
  iter = 4000,
  warmup = 500,
  init = 0,
  file = here("models", "OverlappingAdult_m"),
  chains = 2,
  cores = 64,
  control = list(adapt_delta = 0.99, max_treedepth = 20),
  stan_model_args = list(stanc_options = list("O1"))
)
})

pp_check(OverlappingAdult_m, ndraws = 100)
```
## Visualisation of Model Estimates
```{r}
newdata <- subset(d, InterTurn == "Adult2Child") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) 

C2P_PredictedOverlapData <- as_tibble(predict(OverlappingAdult_m, newdata = newdata)) %>%
  mutate(Visit = newdata$Visit) %>%
  mutate(Diagnosis = newdata$Diagnosis) %>%
  mutate(ID = newdata$ID) %>%
  mutate(Familiarity = newdata$Familiarity) %>%
  mutate(Task = newdata$Task) %>%
  mutate(size = Q97.5-Q2.5) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Visit_x = jitter(Visit)) %>%
  group_by(Diagnosis, ID, Familiarity, Task) %>%
  dplyr::summarise(Estimate = mean(Estimate)) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent"))) %>%
  mutate(Estimate = Estimate * 100)

Posterior_df <- as_draws_df(OverlappingAdult_m)

condition_posterior_TDC_MG <- Posterior_df[,"b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "MatchingGame",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_ASD_MG <- Posterior_df[,"b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "MatchingGame",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_TDC_Q_F <- Posterior_df[,"b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "Questions",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_ASD_Q_F <- Posterior_df[,"b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "Questions",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_TDC_Q_UF <- Posterior_df[,"b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar"] %>%
  mutate(Familiarity = "Unfamiliar",
         Task = "Questions",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent"))) 


condition_posterior_ASD_Q_UF <- Posterior_df[,"b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar"] %>%
  mutate(Familiarity = "Unfamiliar",
         Task = "Questions",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

posteriors <- rbind(condition_posterior_ASD_MG, condition_posterior_TDC_MG,
      condition_posterior_ASD_Q_F, condition_posterior_TDC_Q_F, 
      condition_posterior_ASD_Q_UF, condition_posterior_TDC_Q_UF) %>%
  mutate(Estimate = (plogis(Estimate))) %>%
  mutate(Estimate = Estimate * 100)

P2C_PredictedOverlapDataOverall <- ggplot() +
  geom_rect(aes(xmin=-Inf, xmax = 1.47, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_rect(aes(xmin=1.47, xmax = 2.48, ymin=-Inf, ymax=Inf), fill = "honeydew3", alpha = 0.3) +
  geom_rect(aes(xmin=2.48, xmax = 3.6, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_boxplot(aes(Condition, Estimate, color = Diagnosis, fill = Diagnosis), filter(posteriors, Diagnosis == "Autism Group"), width = 0.05, color = "black", position = position_nudge(x = -0.30), alpha = 0.9, outliers = F, show.legend = T) +
  geom_boxplot(aes(Condition, Estimate, color = Diagnosis, fill = Diagnosis), filter(posteriors, Diagnosis == "Typical Development"), width = 0.05, color = "black", position = position_nudge(x = -0.10), alpha = 0.9, outliers = F, show.legend = T) +
  geom_point(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "#009E73", alpha = 0.7, data = filter(C2P_PredictedOverlapData, Diagnosis == "Autism Group"), size = 2, position = position_nudge(x = -.22)) + 
  geom_point(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "#CC79A7", alpha = 0.7, data = filter(C2P_PredictedOverlapData, Diagnosis == "Typical Development"), size = 2, position = position_nudge(x = -.18)) + 
  geom_half_violin(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "black", alpha = 0.7, data = filter(posteriors, Diagnosis == "Autism Group"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  geom_half_violin(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "black", alpha = 0.7, data = filter(posteriors, Diagnosis == "Typical Development"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  xlab(' ') +
  coord_flip() +
  ylab('Percentage of Overlaps in Adult Speech') +
  guides(color = guide_legend(reverse=TRUE), fill = guide_legend(reverse=TRUE)) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 15, color = "black"),
        legend.title = element_blank(),
        legend.position = c(0.7, 0.95),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key = element_rect(fill = "transparent", color = NA),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 15, color = "black"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

P2C_PredictedOverlapDataOverall
```

## Hypothesis Tests
```{r}
ASD_OverlapsHigherThanZero <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) +
           inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) +
           inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar))/3 >
           0",
           "ASD_OverlapsHigherThanZero")

ASD_MG_F <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) > 0",
           "ASD_MG_F")

ASD_Q_F <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) > 0",
           "ASD_Q_F")

ASD_Q_UF <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) > 0",
           "ASD_Q_UF")

TDC_OverlapsHigherThanZero <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "(inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) +
           inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar) +
           inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar))/3 >
           0",
           "TDC_OverlapsHigherThanZero")

TD_MG_F <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) > 0",
           "TD_MG_F")

TD_Q_F <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar) > 0",
           "TD_Q_F")

TD_Q_UF <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) > 0",
           "TD_Q_UF")



WithinGroup_ASD_MG_F_Higher_Q_F <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) < inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar)",
           "WithinGroup_ASD_MG_F_Higher_Q_F")

WithinGroup_ASD_Q_F_Higher_Q_UF <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) < inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)",
           "WithinGroup_ASD_Q_F_Higher_Q_UF")

WithinGroup_TDC_MG_F_Higher_Q_F <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) > inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
           "WithinGroup_TDC_MG_F_Higher_Q_F")

WithinGroup_TDC_Q_F_Higher_Q_UF <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar) < inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)",
           "WithinGroup_TDC_Q_F_Higher_Q_UF")


ASDOverlapsHigherThanTDCArossConditions <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) +
            inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) +
            inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar))/3 >
            (inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) +
            inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar) +
            inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar))/3",
           "ASDOverlapsHigherThanTDCArossConditions")

ASDOverlapsHigherThanTDCWithinMatchingGame <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) > inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)",
           "ASDOverlapsHigherThanTDCWithinMatchingGame")

ASDOverlapsHigherThanTDCWithinQFamiliar <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) > inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
           "ASDOverlapsHigherThanTDCWithinQFamiliar")

ASDOverlapsHigherThanTDCWithinQUnfamiliar <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) > inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)",
           "ASDOverlapsHigherThanTDCWithinQUnfamiliar")

#Differences between groups according to Condition
DifferencesBetweenGroupsQuestionsHigherMatchingGame <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) - inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)) <
           (inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar))",
           "DifferenceInDifferenceBetweenGroupsASDHigherTDCMatchingGame")

#Differences between groups according to Familiarty
DifferencesBetweenGroupsUnfamiliarityHigherFamiliarity <- extract_relevant_nonlatency_data(OverlappingAdult_m, 
           "(inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)) <
           (inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar))",
           "DifferenceInDifferenceBetweenGroupsUnfamiliarityHigherFamiliarity")


HypothesisResultsAdultOverlaps <- rbind(ASD_OverlapsHigherThanZero,
                                        TDC_OverlapsHigherThanZero,
                                        ASD_MG_F,
                                        ASD_Q_F,
                                        ASD_Q_UF,
                                        TD_MG_F,
                                        TD_Q_F,
                                        TD_Q_UF,
                                        ASDOverlapsHigherThanTDCArossConditions,
                                        ASDOverlapsHigherThanTDCWithinMatchingGame,
                                        ASDOverlapsHigherThanTDCWithinQFamiliar,
                                        ASDOverlapsHigherThanTDCWithinQUnfamiliar,
                                        DifferencesBetweenGroupsQuestionsHigherMatchingGame, 
                                        DifferencesBetweenGroupsUnfamiliarityHigherFamiliarity,
                                        WithinGroup_ASD_MG_F_Higher_Q_F,
                                        WithinGroup_ASD_Q_F_Higher_Q_UF,
                                        WithinGroup_TDC_MG_F_Higher_Q_F,
                                        WithinGroup_TDC_Q_F_Higher_Q_UF) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(HypothesisResultsAdultOverlaps, 'stats_for_paper/bernoulli_adultoverlaps_stats_for_paper.csv')
```

# RQ3, Child Latency Individual Differences Model
```{r}
Latency_ID_f1 <- bf(
  Latency ~ 0 + Diagnosis:Task:Familiarity + 
    Diagnosis:Task:Familiarity:LanguageS_scaled + 
    Diagnosis:Task:Familiarity:AwarenessS_scaled + 
    Diagnosis:Task:Familiarity:MotivationS_scaled + 
    Diagnosis:Task:Familiarity:CognitionS_scaled + 
    Diagnosis:Task:Familiarity:MotorS_scaled + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task | r | Visit), 
  sigma ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task | r | Visit),
  beta ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis))  +  
    (0 + Diagnosis:Task | r | Visit))

priorChild <- c(
  prior(normal(0, 5), class = b),
  prior(normal(0, 0.3), class = sd),
  prior(normal(0, 0.2), class = b, dpar = beta),
  prior(normal(0, 0.3), class = sd, dpar = beta),
  prior(normal(0, 0.3), class = b, dpar = sigma),
  prior(normal(0, 0.5), class = sd, dpar = sigma),
  prior(lkj(3), class = cor)
)

ChildLatency_m2_ID <- brm(
    Latency_ID_f1,
    data = subset(d, InterTurn == "Child2Adult"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = T,
    backend = "cmdstanr",
    iter = 6000,
    warmup = 500,
    init = 0,
    chains = 4,
    cores = 64,
    file = here::here("VBMTurnTakingFiles", "models", "ChildLatency_m2_ID"),
    control = list(adapt_delta = 0.95, max_treedepth = 15),
    stan_model_args = list(stanc_options = list("O1"))
  )
```

## Hypothesis Tests
```{r}
LanguageASD_TG_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageASD_TG_F")

LanguageASD_Q_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageASD_Q_F")

LanguageASD_Q_UF <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > 0",
                      "LanguageASD_Q_UF")

LanguageASD_overall <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > 0",
                      "LanguageASD_overall")

LanguageTDC_TG_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_TG_F")

LanguageTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_Q_F")

LanguageTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_Q_UF")

LanguageTDC_overall <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > 0",
                      "LanguageTDC_overall")

MotorASD_TG_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled < 0", "MotorASD_TG_F")
MotorASD_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled < 0", "MotorASD_Q_F")
MotorASD_Q_UF <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled < 0", "MotorASD_Q_UF")

#1
WithinGroupMotorASD_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled", "WithinGroupMotorASD_MGSlower_Q_F")

WithinGroupMotorASD_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled", "WithinGroupMotorASD_Q_UFSlower_Q_F")
#2
WithinGroupCognitionASD_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled < DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled", "WithinGroupCognitionASD_MGSlower_Q_F")

WithinGroupCognitionASD_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled", "WithinGroupCognitionASD_Q_UFSlower_Q_F")
#3
WithinGroupAwarenessASD_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled < DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled", "WithinGroupAwarenessASD_MGSlower_Q_F")

WithinGroupAwarenessASD_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled < DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled", "WithinGroupAwarenessASD_Q_UFSlower_Q_F")
#4
WithinGroupMotivationASD_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled", "WithinGroupMotivationASD_MGSlower_Q_F")

WithinGroupMotivationASD_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled", "WithinGroupMotivationASD_Q_UFSlower_Q_F")
#5
WithinGroupLanguageASD_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled", "WithinGroupLanguageASD_MGSlower_Q_F")

WithinGroupLanguageASD_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled", "WithinGroupLanguageASD_Q_UFSlower_Q_F")

#1
WithinGroupMotorTDC_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled", "WithinGroupMotorTDC_MGSlower_Q_F")

WithinGroupMotorTDC_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled", "WithinGroupMotorTDC_Q_UFSlower_Q_F")
#2
WithinGroupCognitionTDC_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled", "WithinGroupCognitionTDC_MGSlower_Q_F")

WithinGroupCognitionTDC_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled", "WithinGroupCognitionTDC_Q_UFSlower_Q_F")
#3
WithinGroupAwarenessTDC_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled", "WithinGroupAwarenessTDC_MGSlower_Q_F")

WithinGroupAwarenessTDC_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled", "WithinGroupAwarenessTDC_Q_UFSlower_Q_F")
#4
WithinGroupMotivationTDC_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled", "WithinGroupMotivationTDC_MGSlower_Q_F")

WithinGroupMotivationTDC_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled", "WithinGroupMotivationTDC_Q_UFSlower_Q_F")
#5
WithinGroupLanguageTDC_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled", "WithinGroupLanguageTDC_MGSlower_Q_F")

WithinGroupLanguageTDC_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled", "WithinGroupLanguageTDC_Q_UFSlower_Q_F")

MotorASD_overall <- extract_relevant_data(ChildLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)/3 < 0",  "MotorASD_overall")

MotorTDC_TG_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled < 0", "MotorTDC_TG_F")
MotorTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled < 0", "MotorTDC_Q_F")
MotorTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled < 0", "MotorTDC_Q_UF")
MotorTDC_overall <- extract_relevant_data(ChildLatency_m2_ID, "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)/3 < 0", "MotorTDC_overall")

CognitionASD_TG_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled < 0", "CognitionASD_TG_F")
CognitionASD_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled < 0", "CognitionASD_Q_F")
CognitionASD_Q_UF <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled < 0","CognitionASD_Q_UF")
CognitionASD_overall <- extract_relevant_data(ChildLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)/3 < 0","CognitionASD_overall")

CognitionTDC_TG_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled < 0","CognitionTDC_TG_F")
CognitionTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled < 0","CognitionTDC_Q_F")
CognitionTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled < 0","CognitionTDC_Q_UF")
CognitionTDC_overall <- extract_relevant_data(ChildLatency_m2_ID, "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)/3 < 0","CognitionTDC_overall")

AwarenessASD_TG_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled > 0","AwarenessASD_TG_F")
AwarenessASD_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled > 0","AwarenessASD_Q_F")
AwarenessASD_Q_UF <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled < 0", "AwarenessASD_Q_UF")
AwarenessASD_overall <- extract_relevant_data(ChildLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)/3 > 0", "AwarenessASD_overall")

AwarenessTDC_TG_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled > 0", "AwarenessTDC_TG_F")
AwarenessTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled > 0","AwarenessTDC_Q_F")
AwarenessTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled > 0","AwarenessTDC_Q_UF")
AwarenessTDC_overall <- extract_relevant_data(ChildLatency_m2_ID, "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)/3 > 0","AwarenessTDC_overall")

MotivationASD_TG_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled > 0","MotivationASD_TG_F")
MotivationASD_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled > 0","MotivationASD_Q_F")
MotivationASD_Q_UF <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled > 0","MotivationASD_Q_UF")
MotivationASD_overall <-extract_relevant_data(ChildLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)/3 > 0","MotivationASD_overall")

MotivationTDC_TG_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled < 0","MotivationTDC_TG_F")
MotivationTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled > 0","MotivationTDC_Q_F")
MotivationTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled > 0","MotivationTDC_Q_UF")
MotivationTDC_overall <- extract_relevant_data(ChildLatency_m2_ID, "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)/3 > 0","MotivationTDC_overall")


LanguageASD_TG_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageASD_TG_F")

LanguageASD_Q_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageASD_Q_F")

LanguageASD_Q_UF <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > 0",
                      "LanguageASD_Q_UF")

LanguageASD_overall <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > 0",
                      "LanguageASD_overall")

LanguageTDC_TG_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled < 0",
                      "LanguageTDC_TG_F")

LanguageTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_Q_F")

LanguageTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_Q_UF")

LanguageTDC_overall <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > 0",
                      "LanguageTDC_overall")


LanguageOverallASDSlowerTDC <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3",
                      "LanguageOverallASDSlowerTDC")

MotorOverallASDSlowerTDC <- extract_relevant_data(ChildLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)/3 > 
                                          (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)/3",  
                                          "MotorOverallASDFasterTDC")

CognitionOverallASDSlowerTDC <- extract_relevant_data(ChildLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)/3 >
                                              (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)/3",
                                              "CognitionOverallASDSlowerTDC")

AwarenessOverallASDFasterTDC <- extract_relevant_data(ChildLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)/3 < (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)/3", "AwarenessOverallASDSlowerTDC")

MotivationOverallASDFasterTDC <-extract_relevant_data(ChildLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)/3 > (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)/3","MotivationOverallASDFasterTDC")

LanguageOverallASDSlowerTDC_MG <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_MG")

LanguageOverallASDSlowerTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_Q_F")

LanguageOverallASDSlowerTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_Q_UF")


MotorOverallASDSlowerTDC_MG <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled > DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled",
                      "MotorOverallASDSlowerTDC_MG")

MotorOverallASDSlowerTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled",
                      "MotorOverallASDSlowerTDC_Q_F")

MotorOverallASDSlowerTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled",
                      "MotorOverallASDSlowerTDC_Q_UF")

CognitionOverallASDSlowerTDC_MG <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled > DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled",
                      "CognitionOverallASDSlowerTDC_MG")

CognitionOverallASDSlowerTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled",
                      "CognitionOverallASDSlowerTDC_Q_F")

CognitionOverallASDSlowerTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled",
                      "CognitionOverallASDSlowerTDC_Q_UF")

AwarenessOverallASDSlowerTDC_MG <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled",
                      "AwarenessOverallASDSlowerTDC_MG")

AwarenessOverallASDSlowerTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled",
                      "AwarenessOverallASDSlowerTDC_Q_F")

AwarenessOverallASDSlowerTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled",
                      "AwarenessOverallASDSlowerTDC_Q_UF")

MotivationOverallASDSlowerTDC_MG <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled > DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled",
                      "MotivationOverallASDSlowerTDC_MG")

MotivationOverallASDSlowerTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled",
                      "MotivationOverallASDSlowerTDC_Q_F")

MotivationOverallASDSlowerTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled",
                      "MotivationOverallASDSlowerTDC_Q_UF")


DifferenceInDifferenceLanguageMGSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled)",
                      "DifferenceInDifferenceLanguageMGSlowerQ_F")

DifferenceInDifferenceLanguageUFSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled)",
                      "DifferenceInDifferenceLanguageUFSlowerQ_F")

DifferenceInDifferenceMotorMGSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled)",
                      "DifferenceInDifferenceMotorMGSlowerQ_F")

DifferenceInDifferenceMotorUFSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled)",
                      "DifferenceInDifferenceMotorUFSlowerQ_F")

DifferenceInDifferenceCognitionMGSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled)",
                      "DifferenceInDifferenceCognitionMGSlowerQ_F")

DifferenceInDifferenceCognitionUFSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled)",
                      "DifferenceInDifferenceCognitionUFSlowerQ_F")

DifferenceInDifferenceAwarenessMGSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled)
                      < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled)",
                      "DifferenceInDifferenceAwarenessMGSlowerQ_F")

DifferenceInDifferenceAwarenessUFSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)
                      < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled)",
                      "DifferenceInDifferenceAwarenessUFSlowerQ_F")

DifferenceInDifferenceMotivationMGSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled)",
                      "DifferenceInDifferenceMotivationMGSlowerQ_F")

DifferenceInDifferenceMotivationUFSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)
                      < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled)",
                      "DifferenceInDifferenceMotivationUFSlowerQ_F")

LanguageOverallASDSlowerTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_Q_F")

LanguageOverallASDSlowerTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_Q_UF")

hypothesis_data_full <- rbind(
                              MotorASD_TG_F, MotorASD_Q_F, MotorASD_Q_UF, MotorASD_overall,
                              MotorTDC_TG_F, MotorTDC_Q_F, MotorTDC_Q_UF, MotorTDC_overall,
                              
                              CognitionASD_TG_F, CognitionASD_Q_F, CognitionASD_Q_UF, CognitionASD_overall,
                              CognitionTDC_TG_F, CognitionTDC_Q_F, CognitionTDC_Q_UF, CognitionTDC_overall,
                              
                              LanguageASD_TG_F, LanguageASD_Q_F, LanguageASD_Q_UF, LanguageASD_overall,
                              LanguageTDC_TG_F, LanguageTDC_Q_F, LanguageTDC_Q_UF, LanguageTDC_overall,
                              
                              AwarenessASD_TG_F, AwarenessASD_Q_F, AwarenessASD_Q_UF, AwarenessASD_overall,
                              AwarenessTDC_TG_F, AwarenessTDC_Q_F, AwarenessTDC_Q_UF, AwarenessTDC_overall,
                              
                              MotivationASD_TG_F, MotivationASD_Q_F, MotivationASD_Q_UF, MotivationASD_overall,
                              MotivationTDC_TG_F, MotivationTDC_Q_F, MotivationTDC_Q_UF, MotivationTDC_overall,
                              
                              LanguageOverallASDSlowerTDC, MotorOverallASDSlowerTDC, CognitionOverallASDSlowerTDC, AwarenessOverallASDFasterTDC, MotivationOverallASDFasterTDC,
                              
                              LanguageOverallASDSlowerTDC_MG, LanguageOverallASDSlowerTDC_Q_F, LanguageOverallASDSlowerTDC_Q_UF,
                              CognitionOverallASDSlowerTDC_MG, CognitionOverallASDSlowerTDC_Q_F, CognitionOverallASDSlowerTDC_Q_UF,
                              MotorOverallASDSlowerTDC_MG, MotorOverallASDSlowerTDC_Q_F, MotorOverallASDSlowerTDC_Q_UF,
                              AwarenessOverallASDSlowerTDC_MG, AwarenessOverallASDSlowerTDC_Q_F, AwarenessOverallASDSlowerTDC_Q_UF,
                              MotivationOverallASDSlowerTDC_MG, MotivationOverallASDSlowerTDC_Q_F, MotivationOverallASDSlowerTDC_Q_UF,
                              
                              DifferenceInDifferenceLanguageMGSlowerQ_F, DifferenceInDifferenceLanguageUFSlowerQ_F,
                              DifferenceInDifferenceMotorMGSlowerQ_F, DifferenceInDifferenceMotorUFSlowerQ_F,
                              DifferenceInDifferenceMotivationMGSlowerQ_F, DifferenceInDifferenceMotivationUFSlowerQ_F,
                              DifferenceInDifferenceCognitionMGSlowerQ_F, DifferenceInDifferenceCognitionUFSlowerQ_F,
                              DifferenceInDifferenceAwarenessMGSlowerQ_F, DifferenceInDifferenceAwarenessUFSlowerQ_F,
                              
                              WithinGroupLanguageASD_MGSlower_Q_F, WithinGroupLanguageASD_Q_UFSlower_Q_F,
                              WithinGroupCognitionASD_MGSlower_Q_F, WithinGroupCognitionASD_Q_UFSlower_Q_F,
                              WithinGroupMotorASD_MGSlower_Q_F, WithinGroupMotorASD_Q_UFSlower_Q_F,
                              WithinGroupAwarenessASD_MGSlower_Q_F, WithinGroupAwarenessASD_Q_UFSlower_Q_F,
                              WithinGroupMotivationASD_MGSlower_Q_F, WithinGroupMotivationASD_Q_UFSlower_Q_F,
                              
                              WithinGroupLanguageTDC_MGSlower_Q_F, WithinGroupLanguageTDC_Q_UFSlower_Q_F,
                              WithinGroupCognitionTDC_MGSlower_Q_F, WithinGroupCognitionTDC_Q_UFSlower_Q_F,
                              WithinGroupMotorTDC_MGSlower_Q_F, WithinGroupMotorTDC_Q_UFSlower_Q_F,
                              WithinGroupAwarenessTDC_MGSlower_Q_F, WithinGroupAwarenessTDC_Q_UFSlower_Q_F,
                              WithinGroupMotivationTDC_MGSlower_Q_F, WithinGroupMotivationTDC_Q_UFSlower_Q_F
                              
                              
                              ) %>%
  rename("value" = TestDescription) %>%
  #mutate(Estimate = round(Estimate, 1)) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 1 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -1 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 1 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 1 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -1 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -1 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(hypothesis_data_full, here('VBMTurnTakingFiles', 'stats_for_paper/model2_child_stats_for_paper.csv'))
```

## Visualisation of Model Estimates
```{r}
hypothesis_data_overall <- hypothesis_data_full[1:40, ] %>%
  #filter(str_detect(value, "overall")) %>%
  mutate(Parameter = sapply(strsplit(value, "_"), `[`,1)) %>%
  mutate(Diagnosis = sapply(Parameter, function(x) substr(x, nchar(x) - 2, nchar(x)))) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Parameter = str_replace(Parameter, "ASD", "")) %>%
  mutate(Parameter = str_replace(Parameter, "TDC", "")) %>%
  mutate(Parameter = factor(Parameter, levels = c("Motivation", "Awareness", "Language", "Cognition", "Motor"))) %>%
  mutate(Condition = sub(".*_(TG_F|Q_F|Q_UF)$", "\\1", value)) %>%
  mutate(Condition = str_replace_all(Condition, 
                                     c("MotorASD_overall" = "Overall", 
                                       "MotorTDC_overall" = "Overall", 
                                       "CognitionASD_overall" = "Overall", 
                                       "CognitionTDC_overall" = "Overall", 
                                       "LanguageASD_overall" = "Overall", 
                                       "LanguageTDC_overall" = "Overall",
                                       "AwarenessASD_overall" = "Overall", 
                                       "AwarenessTDC_overall" = "Overall", 
                                       "MotivationASD_overall" = "Overall", 
                                       "MotivationTDC_overall" = "Overall"))) %>%
  mutate(Condition = str_replace_all(Condition, 
                                     c("TG_F" = "Matching With Parent", 
                                       "Q_F" = "Convo With Parent", 
                                       "Q_UF" = "Convo With Experimenter",
                                       "Overall" = "Aggregated Estimate"))) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter", "Aggregated Estimate")))

Posterior_df <- as_draws_df(ChildLatency_m2_ID)

create_condition_posterior <- function(Posterior_df, Diagnosis, Task, Familiarity, Parameter) {
  column_name <- paste0("b_Diagnosis", Diagnosis, ":Task", Task, ":Familiarity", Familiarity, ":", Parameter)
  
  condition_posterior <- Posterior_df[, column_name] %>%
    mutate(Familiarity = Familiarity,
           Task = Task,
           Diagnosis = Diagnosis,
           Parameter = Parameter) %>%
    rename("Estimate" = !!sym(column_name)) %>%
    mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
    mutate(Condition = case_when(
      Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
      Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
      Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
    mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))
  
  return(condition_posterior)
}

Languagecondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "LanguageS_scaled")
Languagecondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "LanguageS_scaled")
Languagecondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "LanguageS_scaled")

Languagecondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "LanguageS_scaled")
Languagecondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "LanguageS_scaled")
Languagecondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "LanguageS_scaled")

Cognitioncondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "CognitionS_scaled")
Cognitioncondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "CognitionS_scaled")
Cognitioncondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "CognitionS_scaled")

Cognitioncondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "CognitionS_scaled")
Cognitioncondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "CognitionS_scaled")
Cognitioncondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "CognitionS_scaled")

Motorcondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "MotorS_scaled")
Motorcondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "MotorS_scaled")
Motorcondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "MotorS_scaled")

Motorcondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "MotorS_scaled")
Motorcondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "MotorS_scaled")
Motorcondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "MotorS_scaled")

Awarenesscondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "AwarenessS_scaled")
Awarenesscondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "AwarenessS_scaled")
Awarenesscondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "AwarenessS_scaled")

Awarenesscondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "AwarenessS_scaled")
Awarenesscondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "AwarenessS_scaled")
Awarenesscondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "AwarenessS_scaled")

Motivationcondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "MotivationS_scaled")
Motivationcondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "MotivationS_scaled")
Motivationcondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "MotivationS_scaled")

Motivationcondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "MotivationS_scaled")
Motivationcondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "MotivationS_scaled")
Motivationcondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "MotivationS_scaled")

full_posterior_predictions <- rbind(Languagecondition_posterior_TDC_MG, Languagecondition_posterior_TDC_Q_F, Languagecondition_posterior_TDC_Q_UF, 
      Languagecondition_posterior_ASD_MG, Languagecondition_posterior_ASD_Q_F, Languagecondition_posterior_ASD_Q_UF,
      
      Motorcondition_posterior_TDC_MG, Motorcondition_posterior_TDC_Q_F, Motorcondition_posterior_TDC_Q_UF, 
      Motorcondition_posterior_ASD_MG, Motorcondition_posterior_ASD_Q_F, Motorcondition_posterior_ASD_Q_UF,
  
      Awarenesscondition_posterior_TDC_MG, Awarenesscondition_posterior_TDC_Q_F, Awarenesscondition_posterior_TDC_Q_UF, 
      Awarenesscondition_posterior_ASD_MG, Awarenesscondition_posterior_ASD_Q_F, Awarenesscondition_posterior_ASD_Q_UF,
      
      Cognitioncondition_posterior_TDC_MG, Cognitioncondition_posterior_TDC_Q_F, Cognitioncondition_posterior_TDC_Q_UF, 
      Cognitioncondition_posterior_ASD_MG, Cognitioncondition_posterior_ASD_Q_F, Cognitioncondition_posterior_ASD_Q_UF,

      Motivationcondition_posterior_TDC_MG, Motivationcondition_posterior_TDC_Q_F, Motivationcondition_posterior_TDC_Q_UF, 
      Motivationcondition_posterior_ASD_MG, Motivationcondition_posterior_ASD_Q_F, Motivationcondition_posterior_ASD_Q_UF) %>%
  mutate(Parameter = str_replace(Parameter, "S_scaled", "")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter", "Aggregated Estimate"))) %>%
  mutate(Parameter = str_replace_all(Parameter, c("Motivation" = "Social Motivation",
                                                  "Cognition" = "Social Cognition",
                                                  "Awareness" = "Social Awareness"))) %>%
  mutate(Parameter = factor(Parameter, levels = c("Motor", "Language", "Social Motivation", "Social Awareness", "Social Cognition")))
  
Model2_Plot_Child_Conditions <- ggplot() +
  annotate("rect", xmin=-Inf, xmax = 1.47, ymin=-Inf, ymax=Inf, fill="honeydew4", color = "honeydew4", alpha = .3) +
  annotate("rect", xmin=1.47, xmax = 2.48, ymin=-Inf, ymax=Inf, fill="honeydew3", color = "honeydew3", alpha = .3) +
  annotate("rect", xmin=2.48, xmax = 3.49, ymin=-Inf, ymax=Inf, fill="honeydew4", color = "honeydew4", alpha = .3) +
  annotate("rect", xmin=3.49, xmax = 4.5, ymin=-Inf, ymax=Inf, fill="honeydew3", color = "honeydew3", alpha = .3) +
  annotate("rect", xmin= 4.5, xmax = Inf, ymin=-Inf, ymax=Inf, fill="honeydew4", color = "honeydew4", alpha = .3) +
  geom_hline(yintercept = 0, linetype = 2) +
  geom_vline(xintercept = 2.48, linetype = 1, color = "black", linewidth = 1) +
  geom_boxplot(aes(Parameter, Estimate, fill = Diagnosis, color = Diagnosis), data = filter(full_posterior_predictions, Diagnosis == "Autism Group"), position = position_nudge(x = -0.1), width = 0.05, color = "black", alpha = 0.9, outliers = F) +
  geom_boxplot(aes(Parameter, Estimate, fill = Diagnosis, color = Diagnosis), data = filter(full_posterior_predictions, Diagnosis == "Typical Development"), position = position_nudge(x = -0.2), width = 0.05, color = "black", alpha = 0.9, outliers = F) +
  geom_half_violin(aes(Parameter, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "black", alpha = 0.9, data = filter(full_posterior_predictions, Diagnosis == "Autism Group"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  geom_half_violin(aes(Parameter, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "black", alpha = 0.9, data = filter(full_posterior_predictions, Diagnosis == "Typical Development"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  facet_wrap(~Condition, scales = "free_x", nrow = 1) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  xlab(' ') +
  coord_flip() +
  ylab('Change in Child Response Latency (seconds)') +
  scale_y_continuous(breaks = c(-1, 0, 1), limits = c(-1.5, 1.2)) +
  guides(color = "none", fill = guide_legend(reverse=TRUE)) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 15, color = "black"),
        legend.title = element_blank(),
        legend.position = c(0.4, 0.95),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(3, "lines"),
        legend.key = element_rect(fill = "transparent", color = NA),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

Model2_Plot_Child_Conditions
```

# RQ3, Adult Latency Individual Differences Model
```{r}
job::job({
  AdultLatency_m2_ID <- brm(
    Latency_ID_f1,
    data = subset(d, InterTurn == "Adult2Child"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = T,
    backend = "cmdstanr",
    iter = 3000,
    warmup = 500,
    init = 0,
    chains = 2,
    cores = 64,
    file = here::here("models", "AdultLatency_m2_ID"),
    control = list(adapt_delta = 0.95, max_treedepth = 15),
    stan_model_args = list(stanc_options = list("O1"))
  )
})

pp_check(AdultLatency_m2_ID, ndraws = 100)
```

## Hypothesis Tests
```{r}
LanguageASD_TG_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageASD_TG_F")

LanguageASD_Q_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageASD_Q_F")

LanguageASD_Q_UF <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > 0",
                      "LanguageASD_Q_UF")

LanguageASD_overall <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > 0",
                      "LanguageASD_overall")

LanguageTDC_TG_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_TG_F")

LanguageTDC_Q_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_Q_F")

LanguageTDC_Q_UF <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_Q_UF")

LanguageTDC_overall <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > 0",
                      "LanguageTDC_overall")

MotorASD_TG_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled < 0", "MotorASD_TG_F")
MotorASD_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled < 0", "MotorASD_Q_F")
MotorASD_Q_UF <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled < 0", "MotorASD_Q_UF")

#1
WithinGroupMotorASD_MGSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled", "WithinGroupMotorASD_MGSlower_Q_F")

WithinGroupMotorASD_Q_UFSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled", "WithinGroupMotorASD_Q_UFSlower_Q_F")
#2
WithinGroupCognitionASD_MGSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled < DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled", "WithinGroupCognitionASD_MGSlower_Q_F")

WithinGroupCognitionASD_Q_UFSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled", "WithinGroupCognitionASD_Q_UFSlower_Q_F")
#3
WithinGroupAwarenessASD_MGSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled < DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled", "WithinGroupAwarenessASD_MGSlower_Q_F")

WithinGroupAwarenessASD_Q_UFSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled < DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled", "WithinGroupAwarenessASD_Q_UFSlower_Q_F")
#4
WithinGroupMotivationASD_MGSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled", "WithinGroupMotivationASD_MGSlower_Q_F")

WithinGroupMotivationASD_Q_UFSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled", "WithinGroupMotivationASD_Q_UFSlower_Q_F")
#5
WithinGroupLanguageASD_MGSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled", "WithinGroupLanguageASD_MGSlower_Q_F")

WithinGroupLanguageASD_Q_UFSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled", "WithinGroupLanguageASD_Q_UFSlower_Q_F")

#1
WithinGroupMotorTDC_MGSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled", "WithinGroupMotorTDC_MGSlower_Q_F")

WithinGroupMotorTDC_Q_UFSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled", "WithinGroupMotorTDC_Q_UFSlower_Q_F")
#2
WithinGroupCognitionTDC_MGSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled", "WithinGroupCognitionTDC_MGSlower_Q_F")

WithinGroupCognitionTDC_Q_UFSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled", "WithinGroupCognitionTDC_Q_UFSlower_Q_F")
#3
WithinGroupAwarenessTDC_MGSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled", "WithinGroupAwarenessTDC_MGSlower_Q_F")

WithinGroupAwarenessTDC_Q_UFSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled", "WithinGroupAwarenessTDC_Q_UFSlower_Q_F")
#4
WithinGroupMotivationTDC_MGSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled", "WithinGroupMotivationTDC_MGSlower_Q_F")

WithinGroupMotivationTDC_Q_UFSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled", "WithinGroupMotivationTDC_Q_UFSlower_Q_F")
#5
WithinGroupLanguageTDC_MGSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled", "WithinGroupLanguageTDC_MGSlower_Q_F")

WithinGroupLanguageTDC_Q_UFSlower_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled", "WithinGroupLanguageTDC_Q_UFSlower_Q_F")

MotorASD_overall <- extract_relevant_data(AdultLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)/3 < 0",  "MotorASD_overall")

MotorTDC_TG_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled < 0", "MotorTDC_TG_F")
MotorTDC_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled < 0", "MotorTDC_Q_F")
MotorTDC_Q_UF <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled < 0", "MotorTDC_Q_UF")
MotorTDC_overall <- extract_relevant_data(AdultLatency_m2_ID, "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)/3 < 0", "MotorTDC_overall")

CognitionASD_TG_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled < 0", "CognitionASD_TG_F")
CognitionASD_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled < 0", "CognitionASD_Q_F")
CognitionASD_Q_UF <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled < 0","CognitionASD_Q_UF")
CognitionASD_overall <- extract_relevant_data(AdultLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)/3 < 0","CognitionASD_overall")

CognitionTDC_TG_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled < 0","CognitionTDC_TG_F")
CognitionTDC_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled < 0","CognitionTDC_Q_F")
CognitionTDC_Q_UF <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled < 0","CognitionTDC_Q_UF")
CognitionTDC_overall <- extract_relevant_data(AdultLatency_m2_ID, "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)/3 < 0","CognitionTDC_overall")

AwarenessASD_TG_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled > 0","AwarenessASD_TG_F")
AwarenessASD_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled > 0","AwarenessASD_Q_F")
AwarenessASD_Q_UF <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled > 0", "AwarenessASD_Q_UF")
AwarenessASD_overall <- extract_relevant_data(AdultLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)/3 > 0", "AwarenessASD_overall")

AwarenessTDC_TG_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled > 0", "AwarenessTDC_TG_F")
AwarenessTDC_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled > 0","AwarenessTDC_Q_F")
AwarenessTDC_Q_UF <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled > 0","AwarenessTDC_Q_UF")
AwarenessTDC_overall <- extract_relevant_data(AdultLatency_m2_ID, "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)/3 > 0","AwarenessTDC_overall")

MotivationASD_TG_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled > 0","MotivationASD_TG_F")
MotivationASD_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled > 0","MotivationASD_Q_F")
MotivationASD_Q_UF <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled > 0","MotivationASD_Q_UF")
MotivationASD_overall <-extract_relevant_data(AdultLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)/3 > 0","MotivationASD_overall")

MotivationTDC_TG_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled < 0","MotivationTDC_TG_F")
MotivationTDC_Q_F <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled < 0","MotivationTDC_Q_F")
MotivationTDC_Q_UF <- extract_relevant_data(AdultLatency_m2_ID, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled < 0","MotivationTDC_Q_UF")
MotivationTDC_overall <- extract_relevant_data(AdultLatency_m2_ID, "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)/3 > 0","MotivationTDC_overall")


LanguageASD_TG_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageASD_TG_F")

LanguageASD_Q_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageASD_Q_F")

LanguageASD_Q_UF <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > 0",
                      "LanguageASD_Q_UF")

LanguageASD_overall <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > 0",
                      "LanguageASD_overall")

LanguageTDC_TG_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_TG_F")

LanguageTDC_Q_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_Q_F")

LanguageTDC_Q_UF <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_Q_UF")

LanguageTDC_overall <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > 0",
                      "LanguageTDC_overall")


LanguageOverallASDSlowerTDC <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3",
                      "LanguageOverallASDSlowerTDC")

MotorOverallASDSlowerTDC <- extract_relevant_data(AdultLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)/3 > 
                                          (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)/3",  
                                          "MotorOverallASDFasterTDC")

CognitionOverallASDSlowerTDC <- extract_relevant_data(AdultLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)/3 >
                                              (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)/3",
                                              "CognitionOverallASDSlowerTDC")

AwarenessOverallASDFasterTDC <- extract_relevant_data(AdultLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)/3 < (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)/3", "AwarenessOverallASDSlowerTDC")

MotivationOverallASDFasterTDC <-extract_relevant_data(AdultLatency_m2_ID, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)/3 > (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)/3","MotivationOverallASDFasterTDC")

LanguageOverallASDSlowerTDC_MG <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_MG")

LanguageOverallASDSlowerTDC_Q_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_Q_F")

LanguageOverallASDSlowerTDC_Q_UF <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_Q_UF")


MotorOverallASDSlowerTDC_MG <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled > DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled",
                      "MotorOverallASDSlowerTDC_MG")

MotorOverallASDSlowerTDC_Q_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled",
                      "MotorOverallASDSlowerTDC_Q_F")

MotorOverallASDSlowerTDC_Q_UF <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled",
                      "MotorOverallASDSlowerTDC_Q_UF")

CognitionOverallASDSlowerTDC_MG <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled > DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled",
                      "CognitionOverallASDSlowerTDC_MG")

CognitionOverallASDSlowerTDC_Q_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled",
                      "CognitionOverallASDSlowerTDC_Q_F")

CognitionOverallASDSlowerTDC_Q_UF <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled",
                      "CognitionOverallASDSlowerTDC_Q_UF")

AwarenessOverallASDSlowerTDC_MG <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled",
                      "AwarenessOverallASDSlowerTDC_MG")

AwarenessOverallASDSlowerTDC_Q_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled",
                      "AwarenessOverallASDSlowerTDC_Q_F")

AwarenessOverallASDSlowerTDC_Q_UF <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled",
                      "AwarenessOverallASDSlowerTDC_Q_UF")

MotivationOverallASDSlowerTDC_MG <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled > DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled",
                      "MotivationOverallASDSlowerTDC_MG")

MotivationOverallASDSlowerTDC_Q_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled",
                      "MotivationOverallASDSlowerTDC_Q_F")

MotivationOverallASDSlowerTDC_Q_UF <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled",
                      "MotivationOverallASDSlowerTDC_Q_UF")


DifferenceInDifferenceLanguageMGSlowerQ_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled)",
                      "DifferenceInDifferenceLanguageMGSlowerQ_F")

DifferenceInDifferenceLanguageUFSlowerQ_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled)",
                      "DifferenceInDifferenceLanguageUFSlowerQ_F")

DifferenceInDifferenceMotorMGSlowerQ_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled)",
                      "DifferenceInDifferenceMotorMGSlowerQ_F")

DifferenceInDifferenceMotorUFSlowerQ_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled)",
                      "DifferenceInDifferenceMotorUFSlowerQ_F")

DifferenceInDifferenceCognitionMGSlowerQ_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled)",
                      "DifferenceInDifferenceCognitionMGSlowerQ_F")

DifferenceInDifferenceCognitionUFSlowerQ_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled)",
                      "DifferenceInDifferenceCognitionUFSlowerQ_F")

DifferenceInDifferenceAwarenessMGSlowerQ_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled)
                      < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled)",
                      "DifferenceInDifferenceAwarenessMGSlowerQ_F")

DifferenceInDifferenceAwarenessUFSlowerQ_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)
                      < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled)",
                      "DifferenceInDifferenceAwarenessUFSlowerQ_F")

DifferenceInDifferenceMotivationMGSlowerQ_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled)",
                      "DifferenceInDifferenceMotivationMGSlowerQ_F")

DifferenceInDifferenceMotivationUFSlowerQ_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)
                      < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled)",
                      "DifferenceInDifferenceMotivationUFSlowerQ_F")

LanguageOverallASDSlowerTDC_Q_F <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_Q_F")

LanguageOverallASDSlowerTDC_Q_UF <- extract_relevant_data(AdultLatency_m2_ID,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_Q_UF")

hypothesis_data_full <- rbind(
                              MotorASD_TG_F, MotorASD_Q_F, MotorASD_Q_UF, MotorASD_overall,
                              MotorTDC_TG_F, MotorTDC_Q_F, MotorTDC_Q_UF, MotorTDC_overall,
                              
                              CognitionASD_TG_F, CognitionASD_Q_F, CognitionASD_Q_UF, CognitionASD_overall,
                              CognitionTDC_TG_F, CognitionTDC_Q_F, CognitionTDC_Q_UF, CognitionTDC_overall,
                              
                              LanguageASD_TG_F, LanguageASD_Q_F, LanguageASD_Q_UF, LanguageASD_overall,
                              LanguageTDC_TG_F, LanguageTDC_Q_F, LanguageTDC_Q_UF, LanguageTDC_overall,
                              
                              AwarenessASD_TG_F, AwarenessASD_Q_F, AwarenessASD_Q_UF, AwarenessASD_overall,
                              AwarenessTDC_TG_F, AwarenessTDC_Q_F, AwarenessTDC_Q_UF, AwarenessTDC_overall,
                              
                              MotivationASD_TG_F, MotivationASD_Q_F, MotivationASD_Q_UF, MotivationASD_overall,
                              MotivationTDC_TG_F, MotivationTDC_Q_F, MotivationTDC_Q_UF, MotivationTDC_overall,
                              
                              LanguageOverallASDSlowerTDC, MotorOverallASDSlowerTDC, CognitionOverallASDSlowerTDC, AwarenessOverallASDFasterTDC, MotivationOverallASDFasterTDC,
                              
                              LanguageOverallASDSlowerTDC_MG, LanguageOverallASDSlowerTDC_Q_F, LanguageOverallASDSlowerTDC_Q_UF,
                              CognitionOverallASDSlowerTDC_MG, CognitionOverallASDSlowerTDC_Q_F, CognitionOverallASDSlowerTDC_Q_UF,
                              MotorOverallASDSlowerTDC_MG, MotorOverallASDSlowerTDC_Q_F, MotorOverallASDSlowerTDC_Q_UF,
                              AwarenessOverallASDSlowerTDC_MG, AwarenessOverallASDSlowerTDC_Q_F, AwarenessOverallASDSlowerTDC_Q_UF,
                              MotivationOverallASDSlowerTDC_MG, MotivationOverallASDSlowerTDC_Q_F, MotivationOverallASDSlowerTDC_Q_UF,
                              
                              DifferenceInDifferenceLanguageMGSlowerQ_F, DifferenceInDifferenceLanguageUFSlowerQ_F,
                              DifferenceInDifferenceMotorMGSlowerQ_F, DifferenceInDifferenceMotorUFSlowerQ_F,
                              DifferenceInDifferenceMotivationMGSlowerQ_F, DifferenceInDifferenceMotivationUFSlowerQ_F,
                              DifferenceInDifferenceCognitionMGSlowerQ_F, DifferenceInDifferenceCognitionUFSlowerQ_F,
                              DifferenceInDifferenceAwarenessMGSlowerQ_F, DifferenceInDifferenceAwarenessUFSlowerQ_F,
                              
                              WithinGroupLanguageASD_MGSlower_Q_F, WithinGroupLanguageASD_Q_UFSlower_Q_F,
                              WithinGroupCognitionASD_MGSlower_Q_F, WithinGroupCognitionASD_Q_UFSlower_Q_F,
                              WithinGroupMotorASD_MGSlower_Q_F, WithinGroupMotorASD_Q_UFSlower_Q_F,
                              WithinGroupAwarenessASD_MGSlower_Q_F, WithinGroupAwarenessASD_Q_UFSlower_Q_F,
                              WithinGroupMotivationASD_MGSlower_Q_F, WithinGroupMotivationASD_Q_UFSlower_Q_F,
                              
                              WithinGroupLanguageTDC_MGSlower_Q_F, WithinGroupLanguageTDC_Q_UFSlower_Q_F,
                              WithinGroupCognitionTDC_MGSlower_Q_F, WithinGroupCognitionTDC_Q_UFSlower_Q_F,
                              WithinGroupMotorTDC_MGSlower_Q_F, WithinGroupMotorTDC_Q_UFSlower_Q_F,
                              WithinGroupAwarenessTDC_MGSlower_Q_F, WithinGroupAwarenessTDC_Q_UFSlower_Q_F,
                              WithinGroupMotivationTDC_MGSlower_Q_F, WithinGroupMotivationTDC_Q_UFSlower_Q_F
                              
                              
                              ) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(hypothesis_data_full, here('VBMTurnTakingFiles', 'stats_for_paper/model2_adult_stats_for_paper.csv'))
```

## Visualisation of Model Estimates
```{r}
hypothesis_data_overall <- hypothesis_data_full[1:40, ] %>%
  #filter(str_detect(value, "overall")) %>%
  mutate(Parameter = sapply(strsplit(value, "_"), `[`,1)) %>%
  mutate(Diagnosis = sapply(Parameter, function(x) substr(x, nchar(x) - 2, nchar(x)))) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Parameter = str_replace(Parameter, "ASD", "")) %>%
  mutate(Parameter = str_replace(Parameter, "TDC", "")) %>%
  mutate(Parameter = factor(Parameter, levels = c("Motivation", "Awareness", "Language", "Cognition", "Motor"))) %>%
  mutate(Condition = sub(".*_(TG_F|Q_F|Q_UF)$", "\\1", value)) %>%
  mutate(Condition = str_replace_all(Condition, 
                                     c("MotorASD_overall" = "Overall", 
                                       "MotorTDC_overall" = "Overall", 
                                       "CognitionASD_overall" = "Overall", 
                                       "CognitionTDC_overall" = "Overall", 
                                       "LanguageASD_overall" = "Overall", 
                                       "LanguageTDC_overall" = "Overall",
                                       "AwarenessASD_overall" = "Overall", 
                                       "AwarenessTDC_overall" = "Overall", 
                                       "MotivationASD_overall" = "Overall", 
                                       "MotivationTDC_overall" = "Overall"))) %>%
  mutate(Condition = str_replace_all(Condition, 
                                     c("TG_F" = "Matching With Parent", 
                                       "Q_F" = "Convo With Parent", 
                                       "Q_UF" = "Convo With Experimenter",
                                       "Overall" = "Aggregated Estimate"))) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter", "Aggregated Estimate")))

Posterior_df <- as_draws_df(AdultLatency_m2_ID)

create_condition_posterior <- function(Posterior_df, Diagnosis, Task, Familiarity, Parameter) {
  column_name <- paste0("b_Diagnosis", Diagnosis, ":Task", Task, ":Familiarity", Familiarity, ":", Parameter)
  
  condition_posterior <- Posterior_df[, column_name] %>%
    mutate(Familiarity = Familiarity,
           Task = Task,
           Diagnosis = Diagnosis,
           Parameter = Parameter) %>%
    rename("Estimate" = !!sym(column_name)) %>%
    mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
    mutate(Condition = case_when(
      Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
      Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
      Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
    mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))
  
  return(condition_posterior)
}

Languagecondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "LanguageS_scaled")
Languagecondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "LanguageS_scaled")
Languagecondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "LanguageS_scaled")

Languagecondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "LanguageS_scaled")
Languagecondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "LanguageS_scaled")
Languagecondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "LanguageS_scaled")

Cognitioncondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "CognitionS_scaled")
Cognitioncondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "CognitionS_scaled")
Cognitioncondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "CognitionS_scaled")

Cognitioncondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "CognitionS_scaled")
Cognitioncondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "CognitionS_scaled")
Cognitioncondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "CognitionS_scaled")

Motorcondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "MotorS_scaled")
Motorcondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "MotorS_scaled")
Motorcondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "MotorS_scaled")

Motorcondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "MotorS_scaled")
Motorcondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "MotorS_scaled")
Motorcondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "MotorS_scaled")

Awarenesscondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "AwarenessS_scaled")
Awarenesscondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "AwarenessS_scaled")
Awarenesscondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "AwarenessS_scaled")

Awarenesscondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "AwarenessS_scaled")
Awarenesscondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "AwarenessS_scaled")
Awarenesscondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "AwarenessS_scaled")

Motivationcondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "MotivationS_scaled")
Motivationcondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "MotivationS_scaled")
Motivationcondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "MotivationS_scaled")

Motivationcondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "MotivationS_scaled")
Motivationcondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "MotivationS_scaled")
Motivationcondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "MotivationS_scaled")

full_posterior_predictions <- rbind(Languagecondition_posterior_TDC_MG, Languagecondition_posterior_TDC_Q_F, Languagecondition_posterior_TDC_Q_UF, 
      Languagecondition_posterior_ASD_MG, Languagecondition_posterior_ASD_Q_F, Languagecondition_posterior_ASD_Q_UF,
      
      Motorcondition_posterior_TDC_MG, Motorcondition_posterior_TDC_Q_F, Motorcondition_posterior_TDC_Q_UF, 
      Motorcondition_posterior_ASD_MG, Motorcondition_posterior_ASD_Q_F, Motorcondition_posterior_ASD_Q_UF,
  
      Awarenesscondition_posterior_TDC_MG, Awarenesscondition_posterior_TDC_Q_F, Awarenesscondition_posterior_TDC_Q_UF, 
      Awarenesscondition_posterior_ASD_MG, Awarenesscondition_posterior_ASD_Q_F, Awarenesscondition_posterior_ASD_Q_UF,
      
      Cognitioncondition_posterior_TDC_MG, Cognitioncondition_posterior_TDC_Q_F, Cognitioncondition_posterior_TDC_Q_UF, 
      Cognitioncondition_posterior_ASD_MG, Cognitioncondition_posterior_ASD_Q_F, Cognitioncondition_posterior_ASD_Q_UF,

      Motivationcondition_posterior_TDC_MG, Motivationcondition_posterior_TDC_Q_F, Motivationcondition_posterior_TDC_Q_UF, 
      Motivationcondition_posterior_ASD_MG, Motivationcondition_posterior_ASD_Q_F, Motivationcondition_posterior_ASD_Q_UF) %>%
  mutate(Parameter = str_replace(Parameter, "S_scaled", "")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter", "Aggregated Estimate"))) %>%
  mutate(Parameter = str_replace_all(Parameter, c("Motivation" = "Social Motivation",
                                                  "Cognition" = "Social Cognition",
                                                  "Awareness" = "Social Awareness"))) %>%
  mutate(Parameter = factor(Parameter, levels = c("Motor", "Language", "Social Motivation", "Social Awareness", "Social Cognition")))
  
Model2_Plot_Adult_Conditions <- ggplot() +
  annotate("rect", xmin=-Inf, xmax = 1.47, ymin=-Inf, ymax=Inf, fill="honeydew4", color = "honeydew4", alpha = .3) +
  annotate("rect", xmin=1.47, xmax = 2.48, ymin=-Inf, ymax=Inf, fill="honeydew3", color = "honeydew3", alpha = .3) +
  annotate("rect", xmin=2.48, xmax = 3.49, ymin=-Inf, ymax=Inf, fill="honeydew4", color = "honeydew4", alpha = .3) +
  annotate("rect", xmin=3.49, xmax = 4.5, ymin=-Inf, ymax=Inf, fill="honeydew3", color = "honeydew3", alpha = .3) +
  annotate("rect", xmin= 4.5, xmax = Inf, ymin=-Inf, ymax=Inf, fill="honeydew4", color = "honeydew4", alpha = .3) +
  geom_hline(yintercept = 0, linetype = 2) +
  geom_vline(xintercept = 2.48, linetype = 1, color = "black", linewidth = 1) +
  geom_boxplot(aes(Parameter, Estimate, fill = Diagnosis, color = Diagnosis), data = filter(full_posterior_predictions, Diagnosis == "Autism Group"), position = position_nudge(x = -0.1), width = 0.05, color = "black", alpha = 0.9, outliers = F) +
  geom_boxplot(aes(Parameter, Estimate, fill = Diagnosis, color = Diagnosis), data = filter(full_posterior_predictions, Diagnosis == "Typical Development"), position = position_nudge(x = -0.2), width = 0.05, color = "black", alpha = 0.9, outliers = F) +
  geom_half_violin(aes(Parameter, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "black", alpha = 0.9, data = filter(full_posterior_predictions, Diagnosis == "Autism Group"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  geom_half_violin(aes(Parameter, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "black", alpha = 0.9, data = filter(full_posterior_predictions, Diagnosis == "Typical Development"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  facet_wrap(~Condition, scales = "free_x", nrow = 1) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  xlab(' ') +
  coord_flip() +
  ylab('Change in Adult Response Latency (seconds)') +
  scale_y_continuous(breaks = c(-1, 0, 1), limits = c(-1.5, 1.2)) +
  guides(color = "none", fill = guide_legend(reverse=TRUE)) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 15, color = "black"),
        legend.title = element_blank(),
        legend.position = c(0.07, 0.95),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(3, "lines"),
        legend.key = element_rect(fill = "transparent", color = NA),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

Model2_Plot_Adult_Conditions
```

# RQ3, Child Overlapping according to Individual Differences
```{r}
d <- d %>% mutate(
  overlapping = ifelse(Latency > 0, 0, 1),
  overlapping_child = ifelse(SelfChild2 > 0, 0, 1),
  overlapping_adult = ifelse(SelfAdult2 > 0, 0, 1)
)

overlap_data <- subset(d, InterTurn == "Child2Adult")

Overlapping_f2 <- bf(
  overlapping ~ 0 + Diagnosis:Task:Familiarity + 
    Diagnosis:Task:Familiarity:LanguageS_scaled + 
    Diagnosis:Task:Familiarity:AwarenessS_scaled + 
    Diagnosis:Task:Familiarity:MotivationS_scaled + 
    Diagnosis:Task:Familiarity:CognitionS_scaled + 
    Diagnosis:Task:Familiarity:MotorS_scaled + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task | r | Visit))

priorChild_overlapping <- c(
  prior(normal(0, 1), class = b),
  prior(normal(0, 0.3), class = sd),
  prior(lkj(3), class = cor)
)

job::job({
  OverlappingChild_m2_IndividualDifferences <- brm(
  Overlapping_f2,
  subset(d, InterTurn == "Child2Adult"),
  family = bernoulli(),
  prior = priorChild_overlapping,
  sample_prior = T,
  file = here("VBMTurnTakingFiles","models", "OverlappingChild_m2_IndividualDifferencesJuly"),
  backend = "cmdstanr",
  #threads = threading(2),
  iter = 4000,
  warmup = 500,
  init = 0,
  chains = 2,
  cores = 64,
  control = list(adapt_delta = 0.90, max_treedepth = 10),
  stan_model_args = list(stanc_options = list("O1"))
)
})

pp_check(OverlappingChild_m2_IndividualDifferences, ndraws = 100)
summary(OverlappingChild_m2_IndividualDifferences)
```

## Visualisation of Model Estimates
```{r}
#Linguistic Skills
newdata <- subset(d, InterTurn == "Child2Adult") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) %>%
  mutate(AwarenessS_scaled = median(overlap_data$AwarenessS_scaled, na.rm = TRUE),
         MotivationS_scaled = median(overlap_data$MotivationS_scaled, na.rm = TRUE),
         CognitionS_scaled = median(overlap_data$CognitionS_scaled, na.rm = TRUE),
         MotorS_scaled = median(overlap_data$MotorS_scaled, na.rm = TRUE))

join_data <- expand.grid(ID = unique(overlap_data$ID), 
                         LanguageS_scaled = seq(from = min(overlap_data$LanguageS_scaled, na.rm = TRUE), to = max(overlap_data$LanguageS_scaled, na.rm = TRUE), length.out = 10))

newdatanew <- left_join(newdata, join_data, by = "ID", relationship = "many-to-many") %>%
  filter(ID %in% unique(OverlappingChild_m2_IndividualDifferences$data$ID))

# Predict probabilities
predictions <- predict(object = OverlappingChild_m2_IndividualDifferences, newdata = newdatanew, allow_new_levels = TRUE, ndraws = 50)
newdatanew$Probability <- predictions[, "Estimate"]

# Combine the results
results <- cbind(newdatanew, Probability = predictions[, "Estimate"]) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter"))) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development"))

ProportionOverlapsLanguage <- results %>%
  ggplot() +
  geom_smooth(aes(x = LanguageS_scaled, y = Probability...11, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.8, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = LanguageS_scaled, y = Probability...11, color = Diagnosis), linewidth = 2.5, se = F, method = "lm", show.legend = FALSE) +
  #facet_wrap(~ Condition) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
  guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1))) +
  #ggtitle('Child Response Latency with Adult Utterance Predictability') +
  ylab('Proportion of Overlaps') +
  xlab('Linguistic Skills (scaled)')+
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        #legend.position = c(0.8, 0.9),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(3, "lines"),
        legend.position = c(0.5, 0.8),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"))

#Cognitive Skills
newdata <- subset(d, InterTurn == "Child2Adult") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) %>%
  mutate(AwarenessS_scaled = median(overlap_data$AwarenessS_scaled, na.rm = TRUE),
         MotivationS_scaled = median(overlap_data$MotivationS_scaled, na.rm = TRUE),
         LanguageS_scaled = median(overlap_data$LanguageS_scaled, na.rm = TRUE),
         MotorS_scaled = median(overlap_data$MotorS_scaled, na.rm = TRUE)) %>%
  filter(ID %in% unique(OverlappingChild_m2_IndividualDifferences$data$ID))

join_data <- expand.grid(ID = unique(overlap_data$ID), 
                         CognitionS_scaled = seq(from = min(overlap_data$CognitionS_scaled, na.rm = TRUE), to = max(overlap_data$CognitionS_scaled, na.rm = TRUE), length.out = 10))

newdatanew <- left_join(newdata, join_data, by = "ID", relationship = "many-to-many")

# Predict probabilities
predictions <- fitted(OverlappingChild_m2_IndividualDifferences, newdata = newdatanew, allow_new_levels = TRUE, ndraws = 50)
newdatanew$Probability <- predictions[, "Estimate"]

# Combine the results
results <- cbind(newdatanew, Probability = predictions[, "Estimate"]) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))

ProportionOverlapsCognitiveSkills <- results %>%
  ggplot() +
  geom_smooth(aes(x = CognitionS_scaled, y = Probability...11, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.8, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = CognitionS_scaled, y = Probability...11, color = Diagnosis), linewidth = 2.5, se = F, method = "lm", show.legend = FALSE) +
  #facet_wrap(~ Condition) +
  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1))) +
  #ggtitle('Child Response Latency with Adult Utterance Predictability') +
  ylab('Proportion of Overlaps') +
  xlab('Cognitive Skills (scaled)')+
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        #legend.position = c(0.8, 0.9),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(3, "lines"),
        legend.position = "none",
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"))

#Motor Skills
newdata <- subset(d, InterTurn == "Child2Adult") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) %>%
  mutate(AwarenessS_scaled = median(overlap_data$AwarenessS_scaled, na.rm = TRUE),
         MotivationS_scaled = median(overlap_data$MotivationS_scaled, na.rm = TRUE),
         LanguageS_scaled = median(overlap_data$LanguageS_scaled, na.rm = TRUE),
         CognitionS_scaled = median(overlap_data$CognitionS_scaled, na.rm = TRUE)) %>%
  filter(ID %in% unique(OverlappingChild_m2_IndividualDifferences$data$ID))

join_data <- expand.grid(ID = unique(overlap_data$ID), 
                         MotorS_scaled = seq(from = min(overlap_data$MotorS_scaled, na.rm = TRUE), to = max(overlap_data$MotorS_scaled, na.rm = TRUE), length.out = 10))

newdatanew <- left_join(newdata, join_data, by = "ID", relationship = "many-to-many")

# Predict probabilities
predictions <- fitted(OverlappingChild_m2_IndividualDifferences, newdata = newdatanew, allow_new_levels = TRUE, ndraws = 50)
newdatanew$Probability <- predictions[, "Estimate"]

# Combine the results
results <- cbind(newdatanew, Probability = predictions[, "Estimate"]) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))

ProportionOverlapsMotorSkills <- results %>%
  ggplot() +
  geom_smooth(aes(x = MotorS_scaled, y = Probability...11, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.4, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = MotorS_scaled, y = Probability...11, color = Diagnosis), linewidth = 2.5, se = F, method = "lm", show.legend = FALSE) +
  #facet_wrap(~ Condition) +
  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1))) +
  #ggtitle('Child Response Latency with Adult Utterance Predictability') +
  ylab('Proportion of Overlaps') +
  xlab('Motor Skills (scaled)')+
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        #legend.position = c(0.8, 0.9),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(3, "lines"),
        legend.position = "none",
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"))

#Social Awareness Skills
newdata <- subset(d, InterTurn == "Child2Adult") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) %>%
  mutate(MotorS_scaled = median(overlap_data$MotorS_scaled, na.rm = TRUE),
         MotivationS_scaled = median(overlap_data$MotivationS_scaled, na.rm = TRUE),
         LanguageS_scaled = median(overlap_data$LanguageS_scaled, na.rm = TRUE),
         CognitionS_scaled = median(overlap_data$CognitionS_scaled, na.rm = TRUE)) %>%
  filter(ID %in% unique(OverlappingChild_m2_IndividualDifferences$data$ID))

join_data <- expand.grid(ID = unique(overlap_data$ID), 
                         AwarenessS_scaled = seq(from = min(overlap_data$AwarenessS_scaled, na.rm = TRUE), to = max(overlap_data$AwarenessS_scaled, na.rm = TRUE), length.out = 10))

newdatanew <- left_join(newdata, join_data, by = "ID", relationship = "many-to-many")

# Predict probabilities
predictions <- fitted(OverlappingChild_m2_IndividualDifferences, newdata = newdatanew, allow_new_levels = TRUE, ndraws = 50)
newdatanew$Probability <- predictions[, "Estimate"]

# Combine the results
results <- cbind(newdatanew, Probability = predictions[, "Estimate"]) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))

ProportionOverlapsAwarenessSkills <- results %>%
  ggplot() +
  geom_smooth(aes(x = AwarenessS_scaled, y = Probability...11, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.4, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = AwarenessS_scaled, y = Probability...11, color = Diagnosis), linewidth = 2.5, se = F, method = "lm", show.legend = FALSE) +
  #facet_wrap(~ Condition) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
  guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1))) +
  #ggtitle('Child Response Latency with Adult Utterance Predictability') +
  ylab('Proportion of Overlaps') +
  xlab('Awareness Skills (scaled)')+
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        #legend.position = c(0.8, 0.9),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(3, "lines"),
        legend.position = "none",
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"))

#Social Motivation Skills
newdata <- subset(d, InterTurn == "Child2Adult") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) %>%
  mutate(MotorS_scaled = median(overlap_data$MotorS_scaled, na.rm = TRUE),
         AwarenessS_scaled = median(overlap_data$AwarenessS_scaled, na.rm = TRUE),
         LanguageS_scaled = median(overlap_data$LanguageS_scaled, na.rm = TRUE),
         CognitionS_scaled = median(overlap_data$CognitionS_scaled, na.rm = TRUE)) %>%
  filter(ID %in% unique(OverlappingChild_m2_IndividualDifferences$data$ID))

join_data <- expand.grid(ID = unique(overlap_data$ID), 
                         MotivationS_scaled = seq(from = min(overlap_data$MotivationS_scaled, na.rm = TRUE), to = max(overlap_data$MotivationS_scaled, na.rm = TRUE), length.out = 10))

newdatanew <- left_join(newdata, join_data, by = "ID", relationship = "many-to-many")

# Predict probabilities
predictions <- fitted(OverlappingChild_m2_IndividualDifferences, newdata = newdatanew, allow_new_levels = TRUE, ndraws = 50)
newdatanew$Probability <- predictions[, "Estimate"]

# Combine the results
results <- cbind(newdatanew, Probability = predictions[, "Estimate"]) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))

ProportionOverlapsMotivationSkills <- results %>%
  ggplot() +
  geom_smooth(aes(x = MotivationS_scaled, y = Probability...11, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.4, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = MotivationS_scaled, y = Probability...11, color = Diagnosis), linewidth = 2.5, se = F, method = "lm", show.legend = FALSE) +
  #facet_wrap(~ Condition) +
  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1))) +
  #ggtitle('Child Response Latency with Adult Utterance Predictability') +
  ylab('Proportion of Overlaps') +
  xlab('Motivation Skills (scaled)')+
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        #legend.position = c(0.8, 0.9),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(3, "lines"),
        legend.position = "none",
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"))

Model2_OverlapsIndividualDifferences <- cowplot::plot_grid(ProportionOverlapsMotorSkills, ProportionOverlapsCognitiveSkills, ProportionOverlapsLanguage, ProportionOverlapsAwarenessSkills, ProportionOverlapsMotivationSkills, nrow = 3)
Model2_OverlapsIndividualDifferences
```

### Hypothesis Tests
```{r}
ASD_OverlapsHigherThanZero <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) +
           inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) +
           inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar))/3 >
           0",
           "ASD_OverlapsHigherThanZero")

ASD_MG_F <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) > 0",
           "ASD_MG_F")

ASD_Q_F <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) > 0",
           "ASD_Q_F")

ASD_Q_UF <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) > 0",
           "ASD_Q_UF")

TDC_OverlapsHigherThanZero <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) +
           inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar) +
           inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar))/3 >
           0",
           "TDC_OverlapsHigherThanZero")

TD_MG_F <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) > 0",
           "TD_MG_F")

TD_Q_F <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar) > 0",
           "TD_Q_F")

TD_Q_UF <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) > 0",
           "TD_Q_UF")

ASDOverlapsHigherThanTDCArossConditions <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) +
            inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) +
            inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar))/3 >
            (inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) +
            inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar) +
            inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar))/3",
           "ASDOverlapsHigherThanTDCArossConditions")

ASDOverlapsHigherThanTDCWithinMatchingGame <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) > inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)",
           "ASDOverlapsHigherThanTDCWithinMatchingGame")

ASDOverlapsHigherThanTDCWithinQFamiliar <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) > inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
           "ASDOverlapsHigherThanTDCWithinQFamiliar")

ASDOverlapsHigherThanTDCWithinQUnfamiliar <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) > inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)",
           "ASDOverlapsHigherThanTDCWithinQUnfamiliar")

#Differences between groups according to Condition
DifferencesBetweenGroupsQuestionsHigherMatchingGame <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) - inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)) <
           (inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar))",
           "DifferenceInDifferenceBetweenGroupsASDHigherTDCMatchingGame")

#Differences between groups according to Familiarty
DifferencesBetweenGroupsUnfamiliarityHigherFamiliarity <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)) <
           (inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar))",
           "DifferenceInDifferenceBetweenGroupsUnfamiliarityHigherFamiliarity")

#Cognitive Skills
ASD_OverlapsHigherThanZero_Cognition <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled) +
           inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled) +
           inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled))/3 >
           0",
           "ASD_OverlapsHigherThanZero_Cognition")

ASD_MG_F_Cognition <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled) > 0",
           "ASD_MG_F_Cognition")

ASD_Q_F_Cognition <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled) > 0",
           "ASD_Q_F_Cognition")

ASD_Q_UF_Cognition <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled) > 0",
           "ASD_Q_UF_Cognition")

TDC_OverlapsHigherThanZero_Cognition <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled) +
           inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled) +
           inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled))/3 >
           0",
           "TDC_OverlapsHigherThanZero_Cognition")

TD_MG_F_Cognition <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled) > 0",
           "TD_MG_F_Cognition")

TD_Q_F_Cognition <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled) > 0",
           "TD_Q_F_Cognition")

TD_Q_UF_Cognition <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled) > 0",
           "TD_Q_UF_Cognition")

ASDOverlapsHigherThanTDCArossConditions_Cognition <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled) +
            inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled) +
            inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled))/3 >
            (inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled) +
            inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled) +
            inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled))/3",
           "ASDOverlapsHigherThanTDCArossConditions_Cognition")

ASDOverlapsHigherThanTDCWithinMatchingGame_Cognition <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled) > inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled)",
           "ASDOverlapsHigherThanTDCWithinMatchingGame_Cognition")

ASDOverlapsHigherThanTDCWithinQFamiliar_Cognition <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled) > inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled)",
           "ASDOverlapsHigherThanTDCWithinQFamiliar_Cognition")

ASDOverlapsHigherThanTDCWithinQUnfamiliar_Cognition <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled) > inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)",
           "ASDOverlapsHigherThanTDCWithinQUnfamiliar_Cognition")

#Differences between groups according to Condition
DifferencesBetweenGroupsQuestionsHigherMatchingGame_Cognition <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled) - inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled)) <
           (inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled))",
           "DifferencesBetweenGroupsQuestionsHigherMatchingGame_Cognition")

#Differences between groups according to Familiarty
DifferencesBetweenGroupsUnfamiliarityHigherFamiliarity_Cognition <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)) <
           (inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled))",
           "DifferencesBetweenGroupsUnfamiliarityHigherFamiliarity_Cognition")

#Language Skills
ASD_OverlapsHigherThanZero_Language <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled) +
           inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled) +
           inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled))/3 >
           0",
           "ASD_OverlapsHigherThanZero_Language")

ASD_MG_F_Language <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled) > 0",
           "ASD_MG_F_Language")

ASD_Q_F_Language <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled) > 0",
           "ASD_Q_F_Language")

ASD_Q_UF_Language <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled) > 0",
           "ASD_Q_UF_Language")

TDC_OverlapsHigherThanZero_Language <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled) +
           inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled) +
           inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled))/3 >
           0",
           "TDC_OverlapsHigherThanZero_Language")

TD_MG_F_Language <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled) > 0",
           "TD_MG_F_Language")

TD_Q_F_Language <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled) > 0",
           "TD_Q_F_Language")

TD_Q_UF_Language <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled) > 0",
           "TD_Q_UF_Language")

ASDOverlapsHigherThanTDCArossConditions_Language <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled) +
            inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled) +
            inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled))/3 >
            (inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled) +
            inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled) +
            inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled))/3",
           "ASDOverlapsHigherThanTDCArossConditions_Language")

ASDOverlapsHigherThanTDCWithinMatchingGame_Language <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled) > inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled)",
           "ASDOverlapsHigherThanTDCWithinMatchingGame_Language")

ASDOverlapsHigherThanTDCWithinQFamiliar_Language <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled) > inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled)",
           "ASDOverlapsHigherThanTDCWithinQFamiliar_Language")

ASDOverlapsHigherThanTDCWithinQUnfamiliar_Language <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled) > inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)",
           "ASDOverlapsHigherThanTDCWithinQUnfamiliar_Language")

#Differences between groups according to Condition
DifferencesBetweenGroupsQuestionsHigherMatchingGame_Language <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled) - inv_logit_scaled(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled)) <
           (inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled))",
           "DifferencesBetweenGroupsQuestionsHigherMatchingGame_Language")

#Differences between groups according to Familiarty
DifferencesBetweenGroupsUnfamiliarityHigherFamiliarity_Language <- extract_relevant_nonlatency_data(OverlappingChild_m2_IndividualDifferences, 
           "(inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)) <
           (inv_logit_scaled(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled) - inv_logit_scaled(DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled))",
           "DifferencesBetweenGroupsUnfamiliarityHigherFamiliarity_Language")






HypothesisResultsChildOverlaps <- rbind(ASD_OverlapsHigherThanZero,
                                        TDC_OverlapsHigherThanZero,
                                        ASD_MG_F,
                                        ASD_Q_F,
                                        ASD_Q_UF,
                                        TD_MG_F,
                                        TD_Q_F,
                                        TD_Q_UF,
                                        ASDOverlapsHigherThanTDCArossConditions,
                                        ASDOverlapsHigherThanTDCWithinMatchingGame,
                                        ASDOverlapsHigherThanTDCWithinQFamiliar,
                                        ASDOverlapsHigherThanTDCWithinQUnfamiliar,
                                        DifferencesBetweenGroupsQuestionsHigherMatchingGame, 
                                        DifferencesBetweenGroupsUnfamiliarityHigherFamiliarity,
                                        ASD_OverlapsHigherThanZero_Cognition,
                                        TDC_OverlapsHigherThanZero_Cognition,
                                        ASD_MG_F_Cognition,
                                        ASD_Q_F_Cognition,
                                        ASD_Q_UF_Cognition,
                                        TD_MG_F_Cognition,
                                        TD_Q_F_Cognition,
                                        TD_Q_UF_Cognition,
                                        ASDOverlapsHigherThanTDCArossConditions_Cognition,
                                        ASDOverlapsHigherThanTDCWithinMatchingGame_Cognition,
                                        ASDOverlapsHigherThanTDCWithinQFamiliar_Cognition,
                                        ASDOverlapsHigherThanTDCWithinQUnfamiliar_Cognition,
                                        DifferencesBetweenGroupsQuestionsHigherMatchingGame_Cognition, 
                                        DifferencesBetweenGroupsUnfamiliarityHigherFamiliarity_Cognition,
                                        
                                        ASD_OverlapsHigherThanZero_Language,
                                        TDC_OverlapsHigherThanZero_Language,
                                        ASD_MG_F_Language,
                                        ASD_Q_F_Language,
                                        ASD_Q_UF_Language,
                                        TD_MG_F_Language,
                                        TD_Q_F_Language,
                                        TD_Q_UF_Language,
                                        ASDOverlapsHigherThanTDCArossConditions_Language,
                                        ASDOverlapsHigherThanTDCWithinMatchingGame_Language,
                                        ASDOverlapsHigherThanTDCWithinQFamiliar_Language,
                                        ASDOverlapsHigherThanTDCWithinQUnfamiliar_Language,
                                        DifferencesBetweenGroupsQuestionsHigherMatchingGame_Language, 
                                        DifferencesBetweenGroupsUnfamiliarityHigherFamiliarity_Language) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(HypothesisResultsChildOverlaps, 'stats_for_paper/bernoulli_overlaps_IndividualDifferences_stats_for_paper.csv')
```

# RQ4, Model with Predictability and Child Latencies
```{r}
predictabilityoverviewacrossconditions <- d %>%
  group_by(Task,Familiarity, Diagnosis) %>%
  filter(InterTurn == "Child2Adult") %>%
  dplyr::summarise(OtherPredictability_mean = mean(OtherPredictability),
                   OtherPredictability_sd = sd(OtherPredictability, na.rm = T),
                   OwnPredictability_mean = mean(OwnPredictability),
                   OwnPredictability_sd = sd(OwnPredictability, na.rm = T)) %>%
  mutate(OtherPredictability = paste(round(OtherPredictability_mean, 2), "(", round(OtherPredictability_sd, 2), ")")) %>%
  mutate(OwnPredictability = paste(round(OwnPredictability_mean, 2), "(", round(OwnPredictability_sd, 2), ")")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent"))) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  ungroup() %>%
  #select(-OtherPredictability_mean, OtherPredictability_sd, OwnPredictability_mean, OwnPredictability_sd, -Task, -Familiarity) %>%
  select(Condition, Diagnosis, OtherPredictability, OwnPredictability)

xtable(predictabilityoverviewacrossconditions)

Latency_ID_pred_f1 <- bf(
  Latency ~ 0 + Diagnosis:Task:Familiarity + 
    Diagnosis:Task:Familiarity:LanguageS_scaled + 
    Diagnosis:Task:Familiarity:LanguageS_scaled:OwnPredictability +
    Diagnosis:Task:Familiarity:LanguageS_scaled:OtherPredictability + 
    Diagnosis:Task:Familiarity:OwnPredictability +
    Diagnosis:Task:Familiarity:OtherPredictability + 
    Diagnosis:Task:Familiarity:AwarenessS_scaled + 
    Diagnosis:Task:Familiarity:MotivationS_scaled + 
    Diagnosis:Task:Familiarity:CognitionS_scaled + 
    Diagnosis:Task:Familiarity:MotorS_scaled + 
    (0 + Task:Familiarity + Task:Familiarity:OtherPredictability + Task:Familiarity:OwnPredictability | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task:Familiarity | r | Visit), 
  sigma ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task:Familiarity | r | Visit),
  beta ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis))  +  
    (0 + Diagnosis:Task:Familiarity | r | Visit))

priorChild <- c(
  prior(normal(1, 1), class = b),
  prior(normal(0, 0.3), class = sd),
  prior(normal(0, 1), class = b, dpar = beta),
  prior(normal(0, 0.1), class = sd, dpar = beta),
  prior(normal(0, 1), class = b, dpar = sigma),
  prior(normal(0, 0.1), class = sd, dpar = sigma),
  prior(lkj(2), class = cor)
)

job::job({
  ChildLatency_m3_pred <- brm(
    Latency_ID_pred_f1,
    data = subset(d, InterTurn == "Child2Adult"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = T,
    backend = "cmdstanr",
    iter = 3000,
    warmup = 500,
    init = 0,
    chains = 2,
    cores = 64,
    file = here::here("models","ChildLatency_m3_predJulyJuly"),
    control = list(adapt_delta = 0.90, max_treedepth = 15))
})

pp_check(ChildLatency_m3_pred, ndraws = 100)
```

## Visualisation of Model Estimates, Other Predictability
```{r}
d_pred_newdata <- d %>%
  group_by(ID, Task, Familiarity, Diagnosis, Visit) %>%
  data_grid(OtherPredictability = seq_range(d$OtherPredictability, n = 20)) %>%
  mutate(LanguageS_scaled = mean(d$LanguageS_scaled, na.rm = T)) %>%
  mutate(OwnPredictability = mean(d$OwnPredictability, na.rm = T)) %>%
  mutate(AwarenessS_scaled = mean(d$AwarenessS_scaled, na.rm = T)) %>%
  mutate(MotivationS_scaled = mean(d$MotivationS_scaled, na.rm = T)) %>%
  mutate(CognitionS_scaled = mean(d$CognitionS_scaled, na.rm = T)) %>%
  mutate(MotorS_scaled = mean(d$MotorS_scaled, na.rm = T)) %>%
  filter(ID %in% unique(ChildLatency_m3_pred$data$ID))

pred_data <- add_predicted_draws(ChildLatency_m3_pred,newdata = d_pred_newdata, allow_new_levels = T, value = ".prediction", ndraws = 50)

OtherPredictabilityPlotData <- pred_data %>%
  group_by(ID, Task, Familiarity, Diagnosis, OtherPredictability) %>%
  dplyr::summarise(mean = mean(.prediction)) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))

OtherPredictabilityPlot <- OtherPredictabilityPlotData %>%
  ggplot() +
  geom_smooth(aes(x = OtherPredictability, y = mean, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.6, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = OtherPredictability, y = mean, color = Diagnosis), linewidth = 2.5, method = "lm", se = FALSE, show.legend = FALSE) +
  facet_wrap(~ Condition) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 1, linewidth = 3))) +
  scale_y_continuous(limits = c(-0.5, 2), breaks = c(-1, -0.5, 0, 0.5, 1, 1.5, 2)) +
  scale_x_continuous(limits = c(-2.5, 2.5), breaks = c(-2, -1, 0, 1, 2)) +
  #ggtitle('Child Response Latency with Adult Utterance Predictability') +
  ylab('Child Response Latency (seconds)') +
  xlab('Predictability of Previous Adult Utterance (z-score)') +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        #axis.line.y =  element_blank(),
        legend.position = c(0.3, 0.9),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(2, "lines"),
        #axis.line.x =  element_blank(),
        panel.border = element_blank(),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"))

OtherPredictabilityPlot
OwnOtherPredictability <- cowplot::plot_grid(OtherPredictabilityPlot, OwnPredictabilityPlot, nrow = 2)
OwnOtherPredictability

# Combine plots with plot_grid
combined_plot <- plot_grid(
  OtherPredictabilityPlot, OwnPredictabilityPlot,
  ncol = 1,                 # Stack plots vertically
  align = 'v',              # Align plots vertically
  axis = 'l',              # Align plots on the left edge
  rel_heights = c(1, 1)    # Equal heights for both plots
)

# Combine the plots
combined_plot <- plot_grid(
  OtherPredictabilityPlot, OwnPredictabilityPlot,
  ncol = 1,
  align = 'v',
  axis = 'l',
  rel_heights = c(1, 1)
)

# Create the final plot with adjusted y-axis label
OwnOtherPredictability <- ggdraw(clip = "off") +  # Important: turn off clipping
  draw_plot(combined_plot, x = 0.01) +  # Shift plot right to make room for label
  draw_text(
    "Child Response Latency (seconds)",
    x = 0.01,                    # Move label more to the left
    y = 0.5,                     # Center vertically
    angle = 90,                  # Rotate text
    vjust = 0.5,                 # Center the text on its position
    size = 20                    # Adjust text size if needed
  )
OwnOtherPredictability

```

## Visualisation of Model Estimates, Own Predictability
```{r}
d_pred_newdata <- d %>%
  group_by(ID, Task, Familiarity, Diagnosis, Visit) %>%
  data_grid(OwnPredictability = seq_range(d$OwnPredictability, n = 25)) %>%
  mutate(LanguageS_scaled = mean(d$LanguageS_scaled, na.rm = T)) %>%
  mutate(OtherPredictability = mean(d$OtherPredictability, na.rm = T)) %>%
  mutate(AwarenessS_scaled = mean(d$AwarenessS_scaled, na.rm = T)) %>%
  mutate(MotivationS_scaled = mean(d$MotivationS_scaled, na.rm = T)) %>%
  mutate(CognitionS_scaled = mean(d$CognitionS_scaled, na.rm = T)) %>%
  mutate(MotorS_scaled = mean(d$MotorS_scaled, na.rm = T)) %>%
  filter(ID %in% unique(ChildLatency_m3_pred$data$ID))
  
pred_data <- add_predicted_draws(object = ChildLatency_m3_pred, 
                newdata = d_pred_newdata, allow_new_levels = T,
                value = ".prediction", ndraws = 50)

PredictabilityPlotData <- pred_data %>%
  group_by(ID, Task, Familiarity, Diagnosis, OwnPredictability) %>%
  dplyr::summarise(mean = mean(.prediction)) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))

OwnPredictabilityPlot <- PredictabilityPlotData %>%
  ggplot() +
  #geom_rect(aes(xmin=-Inf, xmax = Inf, ymin=-Inf, ymax=Inf), fill = "honeydew3", alpha = 0.3) +
  geom_smooth(aes(x = OwnPredictability, y = mean, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.4, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = OwnPredictability, y = mean, color = Diagnosis), linewidth = 2.5, se = FALSE, method = "lm", show.legend = F) +
  facet_wrap(~ Condition) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  scale_y_continuous(limits = c(-0.5, 2), breaks = c(-1, -0.5, 0, 0.5, 1, 1.5, 2)) +
  scale_x_continuous(limits = c(-2.5, 2.5), breaks = c(-2, -1, 0, 1, 2)) +
  #ggtitle('Child Response Latency with Own Utterance Predictability') +
  ylab('Child Response Latency (seconds)') +
  xlab('Predictability of Own Utterance (z-score)') +
  #guides(fill = "none", color = guide_legend(reverse=TRUE)) +
  guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1))) +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.title.y = element_blank(),  # Remove y axis title
        #axis.text.y = element_blank(),   # Remove y axis text
        axis.ticks.y = element_blank(),   # Remove y axis ticks
        axis.text.y = element_text(size = 20, color = "black"),
        #axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        legend.position = "none",
        #legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        #legend.key.size = unit(3, "lines"),
        panel.border = element_blank(),
        legend.text = element_text(size = 20),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_blank())

OwnPredictabilityPlot
```

## Hypothesis Tests
```{r}
ASD_OtherPredictability_MG_F <- extract_relevant_data(ChildLatency_m3_pred,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability < 0",
                                                      "ASD_OtherPredictability_MG_F")

TDC_OtherPredictability_MG_F <- extract_relevant_data(ChildLatency_m3_pred, 
                                           "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability < 0",
                                           "TDC_OtherPredictability_MG_F")

ASD_OtherPredictability_Q_F <- extract_relevant_data(ChildLatency_m3_pred, 
                                          "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability < 0",
                                          "ASD_OtherPredictability_Q_F")
TDC_OtherPredictability_Q_F <- extract_relevant_data(ChildLatency_m3_pred, 
                                          "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability < 0",
                                          "TDC_OtherPredictability_Q_F")

ASD_OtherPredictability_Q_UF <- extract_relevant_data(ChildLatency_m3_pred, 
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability < 0",
                                           "ASD_OtherPredictability_Q_UF")
TDC_OtherPredictability_Q_UF <- extract_relevant_data(ChildLatency_m3_pred,
                                                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability < 0",
                                                      "TDC_OtherPredictability_Q_UF")

ASD_OtherPredictability_overall <- extract_relevant_data(ChildLatency_m3_pred, 
"((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3) < 0", "ASD_OtherPredictability_overall")

TDC_OtherPredictability_overall <- extract_relevant_data(ChildLatency_m3_pred,
"((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3) < 0",
"TDC_OtherPredictability_overall")

WithinGroupASD_OtherPredictability_MG_Higher_Q_F <- extract_relevant_data(ChildLatency_m3_pred, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability", 
"WithinGroupASD_OtherPredictability_MG_Higher_Q_F")

WithinGroupASD_OtherPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(ChildLatency_m3_pred, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability < DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability", 
"WithinGroupASD_OtherPredictability_Q_F_Higher_Q_UF")

WithinGroupTDC_OtherPredictability_MG_Higher_Q_F <- extract_relevant_data(ChildLatency_m3_pred, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability", 
"WithinGroupTDC_OtherPredictability_MG_Higher_Q_F")

WithinGroupTDC_OtherPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(ChildLatency_m3_pred, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability", 
"WithinGroupTDC_OtherPredictability_Q_F_Higher_Q_UF")

OtherPredictabilityHypothesesFull <- rbind(ASD_OtherPredictability_MG_F, ASD_OtherPredictability_Q_F, ASD_OtherPredictability_Q_UF,
      TDC_OtherPredictability_MG_F, TDC_OtherPredictability_Q_F, TDC_OtherPredictability_Q_UF,
      ASD_OtherPredictability_overall, TDC_OtherPredictability_overall, WithinGroupASD_OtherPredictability_MG_Higher_Q_F, WithinGroupASD_OtherPredictability_Q_F_Higher_Q_UF, WithinGroupTDC_OtherPredictability_MG_Higher_Q_F, WithinGroupTDC_OtherPredictability_Q_F_Higher_Q_UF)


OtherPredictability_MG_F_ASDHigherTDC <- extract_relevant_data(ChildLatency_m3_pred,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability < 
           DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability",
                                                      "OtherPredictability_MG_F_ASDHigherTDC")

OtherPredictability_Q_F_ASDHigherTDC <- extract_relevant_data(ChildLatency_m3_pred,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability",
                                                      "OtherPredictability_Q_F_ASDHigherTDC")

OtherPredictability_Q_UF_ASDHigherTDC <- extract_relevant_data(ChildLatency_m3_pred,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability",
                                                      "OtherPredictability_Q_UF_ASDHigherTDC")

OtherPredictability_overall_ASDHigherTDC <- extract_relevant_data(ChildLatency_m3_pred, 
                                                       "((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3) >
                                                       ((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3)",
                                                       "OtherPredictability_overall_ASDHigherTDC")
                                                       
DifferenceOtherPredictability_ASDLowerMatchingGameTDCVersusQuestions <- extract_relevant_data(ChildLatency_m3_pred,
            "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability) <
            (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability)",
            "DifferenceOtherPredictability_ASDLowerMatchingGameTDCVersusQuestions")

DifferenceOtherPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity <- extract_relevant_data(ChildLatency_m3_pred,
            "(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability) >
            (DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability)",
            "DifferenceOtherPredictability_ASDHigherFamiliarityTDCVersusUnfamiliarity")

OtherPredictabilityComparisonsHypothesesFull <- rbind(
      OtherPredictabilityHypothesesFull,
      OtherPredictability_MG_F_ASDHigherTDC,
      OtherPredictability_Q_F_ASDHigherTDC,
      OtherPredictability_Q_UF_ASDHigherTDC,
      OtherPredictability_overall_ASDHigherTDC,
      DifferenceOtherPredictability_ASDLowerMatchingGameTDCVersusQuestions,
      DifferenceOtherPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 1 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -1 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 1 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 1 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -1 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -1 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

#Let's add the same hypotheses for OwnPredictability:
ASD_OwnPredictability_MG_F <- extract_relevant_data(ChildLatency_m3_pred,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability < 0",
                                                      "ASD_OwnPredictability_MG_F")

TDC_OwnPredictability_MG_F <- extract_relevant_data(ChildLatency_m3_pred, 
                                           "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability > 0",
                                           "TDC_OwnPredictability_MG_F")

ASD_OwnPredictability_Q_F <- extract_relevant_data(ChildLatency_m3_pred, 
                                          "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability > 0",
                                          "ASD_OwnPredictability_Q_F")
TDC_OwnPredictability_Q_F <- extract_relevant_data(ChildLatency_m3_pred, 
                                          "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability > 0",
                                          "TDC_OwnPredictability_Q_F")

ASD_OwnPredictability_Q_UF <- extract_relevant_data(ChildLatency_m3_pred, 
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability > 0",
                                           "ASD_OwnPredictability_Q_UF")
TDC_OwnPredictability_Q_UF <- extract_relevant_data(ChildLatency_m3_pred,
                                                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability > 0",
                                                      "TDC_OwnPredictability_Q_UF")


ASD_OwnPredictability_overall <- extract_relevant_data(ChildLatency_m3_pred, 
"((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3) > 0", "ASD_OwnPredictability_overall")

TDC_OwnPredictability_overall <- extract_relevant_data(ChildLatency_m3_pred,
"((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3) > 0",
"TDC_OwnPredictability_overall")

WithinGroupASD_OwnPredictability_MG_Higher_Q_F <- extract_relevant_data(ChildLatency_m3_pred, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability < DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability", 
"WithinGroupASD_OwnPredictability_MG_Higher_Q_F")

WithinGroupASD_OwnPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(ChildLatency_m3_pred, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability < DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability", 
"WithinGroupASD_OwnPredictability_Q_F_Higher_Q_UF")

WithinGroupTDC_OwnPredictability_MG_Higher_Q_F <- extract_relevant_data(ChildLatency_m3_pred, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability", 
"WithinGroupTDC_OwnPredictability_MG_Higher_Q_F")

WithinGroupTDC_OwnPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(ChildLatency_m3_pred, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability", 
"WithinGroupTDC_OwnPredictability_Q_F_Higher_Q_UF")


OwnPredictabilityHypothesesFull <- rbind(ASD_OwnPredictability_MG_F, ASD_OwnPredictability_Q_F, ASD_OwnPredictability_Q_UF,
      TDC_OwnPredictability_MG_F, TDC_OwnPredictability_Q_F, TDC_OwnPredictability_Q_UF,
      ASD_OwnPredictability_overall, TDC_OwnPredictability_overall, WithinGroupASD_OwnPredictability_MG_Higher_Q_F, WithinGroupASD_OwnPredictability_Q_F_Higher_Q_UF, WithinGroupTDC_OwnPredictability_MG_Higher_Q_F, WithinGroupTDC_OwnPredictability_Q_F_Higher_Q_UF)


OwnPredictability_MG_F_ASDHigherTDC <- extract_relevant_data(ChildLatency_m3_pred,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability < 
           DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability",
                                                      "OwnPredictability_MG_F_ASDHigherTDC")

OwnPredictability_Q_F_ASDHigherTDC <- extract_relevant_data(ChildLatency_m3_pred,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability",
                                                      "OwnPredictability_Q_F_ASDHigherTDC")

OwnPredictability_Q_UF_ASDHigherTDC <- extract_relevant_data(ChildLatency_m3_pred,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability",
                                                      "OwnPredictability_Q_UF_ASDHigherTDC")

OwnPredictability_overall_ASDHigherTDC <- extract_relevant_data(ChildLatency_m3_pred, 
                                                       "((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3) >
                                                       ((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3)",
                                                       "OwnPredictability_overall_ASDHigherTDC")
                                                       
DifferenceOwnPredictability_ASDLowerMatchingGameTDCVersusQuestions <- extract_relevant_data(ChildLatency_m3_pred,
            "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability) <
            (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability)",
            "DifferenceOwnPredictability_ASDLowerMatchingGameTDCVersusQuestions")

DifferenceOwnPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity <- extract_relevant_data(ChildLatency_m3_pred,
            "(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability) <
            (DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability)",
            "DifferenceOwnPredictability_ASDHigherFamiliarityTDCVersusUnfamiliarity")

OwnPredictabilityComparisonsHypothesesFull <- rbind(
      OwnPredictabilityHypothesesFull,
      OwnPredictability_MG_F_ASDHigherTDC,
      OwnPredictability_Q_F_ASDHigherTDC,
      OwnPredictability_Q_UF_ASDHigherTDC,
      OwnPredictability_overall_ASDHigherTDC,
      DifferenceOwnPredictability_ASDLowerMatchingGameTDCVersusQuestions,
      DifferenceOwnPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 1 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -1 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 1 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 1 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -1 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -1 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

PredictabilityComparisonsHypothesesFull <- rbind(OtherPredictabilityComparisonsHypothesesFull, OwnPredictabilityComparisonsHypothesesFull)

write.csv(PredictabilityComparisonsHypothesesFull, 'stats_for_paper/model3_Child_Predictability_stats_for_paper.csv')
```


# RQ4, Model with Predictability and Adult Latencies
```{r}
job::job({
  AdultLatency_m3_pred <- brm(
    Latency_ID_pred_f1,
    subset(d, InterTurn == "Adult2Child"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = T,
    backend = "cmdstanr",
    iter = 3000,
    warmup = 500,
    init = 0,
    chains = 2,
    cores = 64,
    file = here::here("VBMTurnTakingFiles","models","AdultLatency_m3_predJuly"),
    control = list(adapt_delta = 0.999, max_treedepth = 20),
    stan_model_args = list(stanc_options = list("O1"))
  )
})
warnings()
pp_check(AdultLatency_m3_pred, ndraws = 100)
```

## Visualisation of Model Estimates, Other Predictability
```{r}
d_pred_newdata <- d %>%
  group_by(ID, Task, Familiarity, Diagnosis, Visit) %>%
  data_grid(OtherPredictability = seq_range(d$OtherPredictability, n = 25)) %>%
  mutate(LanguageS_scaled = mean(d$LanguageS_scaled, na.rm = T)) %>%
  mutate(OwnPredictability = mean(d$OwnPredictability, na.rm = T)) %>%
  mutate(AwarenessS_scaled = mean(d$AwarenessS_scaled, na.rm = T)) %>%
  mutate(MotivationS_scaled = mean(d$MotivationS_scaled, na.rm = T)) %>%
  mutate(CognitionS_scaled = mean(d$CognitionS_scaled, na.rm = T)) %>%
  mutate(MotorS_scaled = mean(d$MotorS_scaled, na.rm = T)) %>%
  filter(ID %in% unique(AdultLatency_m3_pred$data$ID))
  
pred_data <- add_predicted_draws(object = AdultLatency_m3_pred, 
                newdata = d_pred_newdata, allow_new_levels = T,
                value = ".prediction", ndraws = 50)

OtherPredictabilityPlotData <- pred_data %>%
  group_by(ID, Task, Familiarity, Diagnosis, OtherPredictability) %>%
  dplyr::summarise(mean = mean(.prediction)) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))

OtherPredictabilityPlot <- OtherPredictabilityPlotData %>%
  ggplot() +
  geom_smooth(aes(x = OtherPredictability, y = mean, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.6, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = OtherPredictability, y = mean, color = Diagnosis), linewidth = 2.5, method = "lm", se = FALSE, show.legend = FALSE) +
  facet_wrap(~ Condition) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 1, linewidth = 3))) +
  scale_y_continuous(limits = c(-0.5, 2), breaks = c(-1, -0.5, 0, 0.5, 1, 1.5, 2)) +
  scale_x_continuous(limits = c(-2.5, 2.5), breaks = c(-2, -1, 0, 1, 2)) +
  #ggtitle('Child Response Latency with Adult Utterance Predictability') +
  ylab('Adult Response Latency (seconds)') +
  xlab('Predictability of Previous Child Utterance (z-score)') +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        #axis.line.y =  element_blank(),
        legend.position = c(0.3, 0.9),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(2, "lines"),
        #axis.line.x =  element_blank(),
        panel.border = element_blank(),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"))
```

## Visualisation of Model Estimates, Own Predictability
```{r}
d_pred_newdata <- d %>%
  group_by(ID, Task, Familiarity, Diagnosis, Visit) %>%
  data_grid(OwnPredictability = seq_range(d$OwnPredictability, n = 25)) %>%
  mutate(LanguageS_scaled = mean(d$LanguageS_scaled, na.rm = T)) %>%
  mutate(OtherPredictability = mean(d$OtherPredictability, na.rm = T)) %>%
  mutate(AwarenessS_scaled = mean(d$AwarenessS_scaled, na.rm = T)) %>%
  mutate(MotivationS_scaled = mean(d$MotivationS_scaled, na.rm = T)) %>%
  mutate(CognitionS_scaled = mean(d$CognitionS_scaled, na.rm = T)) %>%
  mutate(MotorS_scaled = mean(d$MotorS_scaled, na.rm = T)) %>%
  filter(ID %in% unique(AdultLatency_m3_pred$data$ID))
  
pred_data <- add_predicted_draws(object = AdultLatency_m3_pred, 
                newdata = d_pred_newdata, allow_new_levels = T,
                value = ".prediction", ndraws = 50)

PredictabilityPlotData <- pred_data %>%
  group_by(ID, Task, Familiarity, Diagnosis, OwnPredictability) %>%
  dplyr::summarise(mean = mean(.prediction)) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))

OwnPredictabilityPlot <- PredictabilityPlotData %>%
  ggplot() +
  #geom_rect(aes(xmin=-Inf, xmax = Inf, ymin=-Inf, ymax=Inf), fill = "honeydew3", alpha = 0.3) +
  geom_smooth(aes(x = OwnPredictability, y = mean, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.4, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = OwnPredictability, y = mean, color = Diagnosis), linewidth = 2.5, se = FALSE, method = "lm", show.legend = F) +
  facet_wrap(~ Condition) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  scale_y_continuous(limits = c(-0.5, 2), breaks = c(-1, -0.5, 0, 0.5, 1, 1.5, 2)) +
  scale_x_continuous(limits = c(-2.5, 2.5), breaks = c(-2, -1, 0, 1, 2)) +
  #ggtitle('Child Response Latency with Own Utterance Predictability') +
  ylab('Child Response Latency (seconds)') +
  xlab('Predictability of Own Utterance (z-score)') +
  #guides(fill = "none", color = guide_legend(reverse=TRUE)) +
  guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1))) +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.title.y = element_blank(),  # Remove y axis title
        #axis.text.y = element_blank(),   # Remove y axis text
        axis.ticks.y = element_blank(),   # Remove y axis ticks
        axis.text.y = element_text(size = 20, color = "black"),
        #axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        legend.position = "none",
        #legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        #legend.key.size = unit(3, "lines"),
        panel.border = element_blank(),
        legend.text = element_text(size = 20),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_blank())

OwnPredictabilityPlot

# Combine plots with plot_grid
combined_plot <- plot_grid(
  OtherPredictabilityPlot, OwnPredictabilityPlot,
  ncol = 1,                 # Stack plots vertically
  align = 'v',              # Align plots vertically
  axis = 'l',              # Align plots on the left edge
  rel_heights = c(1, 1)    # Equal heights for both plots
)

# Combine the plots
combined_plot <- plot_grid(
  OtherPredictabilityPlot, OwnPredictabilityPlot,
  ncol = 1,
  align = 'v',
  axis = 'l',
  rel_heights = c(1, 1)
)

# Create the final plot with adjusted y-axis label
OwnOtherPredictabilityAdult <- ggdraw(clip = "off") +  # Important: turn off clipping
  draw_plot(combined_plot, x = 0.01) +  # Shift plot right to make room for label
  draw_text(
    "Adult Response Latency (seconds)",
    x = 0.01,                    # Move label more to the left
    y = 0.5,                     # Center vertically
    angle = 90,                  # Rotate text
    vjust = 0.5,                 # Center the text on its position
    size = 20                    # Adjust text size if needed
  )
OwnOtherPredictabilityAdult

```

## Hypothesis Tests
```{r}
ASD_OtherPredictability_MG_F <- extract_relevant_data(AdultLatency_m3_pred,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability < 0",
                                                      "ASD_OtherPredictability_MG_F")

TDC_OtherPredictability_MG_F <- extract_relevant_data(AdultLatency_m3_pred, 
                                           "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability < 0",
                                           "TDC_OtherPredictability_MG_F")

ASD_OtherPredictability_Q_F <- extract_relevant_data(AdultLatency_m3_pred, 
                                          "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability < 0",
                                          "ASD_OtherPredictability_Q_F")
TDC_OtherPredictability_Q_F <- extract_relevant_data(AdultLatency_m3_pred, 
                                          "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability < 0",
                                          "TDC_OtherPredictability_Q_F")

ASD_OtherPredictability_Q_UF <- extract_relevant_data(AdultLatency_m3_pred, 
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability < 0",
                                           "ASD_OtherPredictability_Q_UF")
TDC_OtherPredictability_Q_UF <- extract_relevant_data(AdultLatency_m3_pred,
                                                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability < 0",
                                                      "TDC_OtherPredictability_Q_UF")

ASD_OtherPredictability_overall <- extract_relevant_data(AdultLatency_m3_pred, 
"((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3) < 0", "ASD_OtherPredictability_overall")

TDC_OtherPredictability_overall <- extract_relevant_data(AdultLatency_m3_pred,
"((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3) < 0",
"TDC_OtherPredictability_overall")

WithinGroupASD_OtherPredictability_MG_Higher_Q_F <- extract_relevant_data(AdultLatency_m3_pred, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability", 
"WithinGroupASD_OtherPredictability_MG_Higher_Q_F")

WithinGroupASD_OtherPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(AdultLatency_m3_pred, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability < DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability", 
"WithinGroupASD_OtherPredictability_Q_F_Higher_Q_UF")

WithinGroupTDC_OtherPredictability_MG_Higher_Q_F <- extract_relevant_data(AdultLatency_m3_pred, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability", 
"WithinGroupTDC_OtherPredictability_MG_Higher_Q_F")

WithinGroupTDC_OtherPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(AdultLatency_m3_pred, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability", 
"WithinGroupTDC_OtherPredictability_Q_F_Higher_Q_UF")

OtherPredictabilityHypothesesFull <- rbind(ASD_OtherPredictability_MG_F, ASD_OtherPredictability_Q_F, ASD_OtherPredictability_Q_UF,
      TDC_OtherPredictability_MG_F, TDC_OtherPredictability_Q_F, TDC_OtherPredictability_Q_UF,
      ASD_OtherPredictability_overall, TDC_OtherPredictability_overall, WithinGroupASD_OtherPredictability_MG_Higher_Q_F, WithinGroupASD_OtherPredictability_Q_F_Higher_Q_UF, WithinGroupTDC_OtherPredictability_MG_Higher_Q_F, WithinGroupTDC_OtherPredictability_Q_F_Higher_Q_UF)


OtherPredictability_MG_F_ASDHigherTDC <- extract_relevant_data(AdultLatency_m3_pred,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability < 
           DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability",
                                                      "OtherPredictability_MG_F_ASDHigherTDC")

OtherPredictability_Q_F_ASDHigherTDC <- extract_relevant_data(AdultLatency_m3_pred,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability",
                                                      "OtherPredictability_Q_F_ASDHigherTDC")

OtherPredictability_Q_UF_ASDHigherTDC <- extract_relevant_data(AdultLatency_m3_pred,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability",
                                                      "OtherPredictability_Q_UF_ASDHigherTDC")

OtherPredictability_overall_ASDHigherTDC <- extract_relevant_data(AdultLatency_m3_pred, 
                                                       "((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3) >
                                                       ((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3)",
                                                       "OtherPredictability_overall_ASDHigherTDC")
                                                       
DifferenceOtherPredictability_ASDLowerMatchingGameTDCVersusQuestions <- extract_relevant_data(AdultLatency_m3_pred,
            "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability) <
            (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability)",
            "DifferenceOtherPredictability_ASDLowerMatchingGameTDCVersusQuestions")

DifferenceOtherPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity <- extract_relevant_data(AdultLatency_m3_pred,
            "(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability) >
            (DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability)",
            "DifferenceOtherPredictability_ASDHigherFamiliarityTDCVersusUnfamiliarity")

OtherPredictabilityComparisonsHypothesesFull <- rbind(
      OtherPredictabilityHypothesesFull,
      OtherPredictability_MG_F_ASDHigherTDC,
      OtherPredictability_Q_F_ASDHigherTDC,
      OtherPredictability_Q_UF_ASDHigherTDC,
      OtherPredictability_overall_ASDHigherTDC,
      DifferenceOtherPredictability_ASDLowerMatchingGameTDCVersusQuestions,
      DifferenceOtherPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

#Let's add the same hypotheses for OwnPredictability:
ASD_OwnPredictability_MG_F <- extract_relevant_data(AdultLatency_m3_pred,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability < 0",
                                                      "ASD_OwnPredictability_MG_F")

TDC_OwnPredictability_MG_F <- extract_relevant_data(AdultLatency_m3_pred, 
                                           "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability > 0",
                                           "TDC_OwnPredictability_MG_F")

ASD_OwnPredictability_Q_F <- extract_relevant_data(AdultLatency_m3_pred, 
                                          "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability > 0",
                                          "ASD_OwnPredictability_Q_F")
TDC_OwnPredictability_Q_F <- extract_relevant_data(AdultLatency_m3_pred, 
                                          "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability > 0",
                                          "TDC_OwnPredictability_Q_F")

ASD_OwnPredictability_Q_UF <- extract_relevant_data(AdultLatency_m3_pred, 
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability > 0",
                                           "ASD_OwnPredictability_Q_UF")
TDC_OwnPredictability_Q_UF <- extract_relevant_data(AdultLatency_m3_pred,
                                                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability > 0",
                                                      "TDC_OwnPredictability_Q_UF")


ASD_OwnPredictability_overall <- extract_relevant_data(AdultLatency_m3_pred, 
"((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3) > 0", "ASD_OwnPredictability_overall")

TDC_OwnPredictability_overall <- extract_relevant_data(AdultLatency_m3_pred,
"((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3) > 0",
"TDC_OwnPredictability_overall")

WithinGroupASD_OwnPredictability_MG_Higher_Q_F <- extract_relevant_data(AdultLatency_m3_pred, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability < DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability", 
"WithinGroupASD_OwnPredictability_MG_Higher_Q_F")

WithinGroupASD_OwnPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(AdultLatency_m3_pred, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability < DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability", 
"WithinGroupASD_OwnPredictability_Q_F_Higher_Q_UF")

WithinGroupTDC_OwnPredictability_MG_Higher_Q_F <- extract_relevant_data(AdultLatency_m3_pred, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability", 
"WithinGroupTDC_OwnPredictability_MG_Higher_Q_F")

WithinGroupTDC_OwnPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(AdultLatency_m3_pred, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability", 
"WithinGroupTDC_OwnPredictability_Q_F_Higher_Q_UF")


OwnPredictabilityHypothesesFull <- rbind(ASD_OwnPredictability_MG_F, ASD_OwnPredictability_Q_F, ASD_OwnPredictability_Q_UF,
      TDC_OwnPredictability_MG_F, TDC_OwnPredictability_Q_F, TDC_OwnPredictability_Q_UF,
      ASD_OwnPredictability_overall, TDC_OwnPredictability_overall, WithinGroupASD_OwnPredictability_MG_Higher_Q_F, WithinGroupASD_OwnPredictability_Q_F_Higher_Q_UF, WithinGroupTDC_OwnPredictability_MG_Higher_Q_F, WithinGroupTDC_OwnPredictability_Q_F_Higher_Q_UF)


OwnPredictability_MG_F_ASDHigherTDC <- extract_relevant_data(AdultLatency_m3_pred,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability < 
           DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability",
                                                      "OwnPredictability_MG_F_ASDHigherTDC")

OwnPredictability_Q_F_ASDHigherTDC <- extract_relevant_data(AdultLatency_m3_pred,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability",
                                                      "OwnPredictability_Q_F_ASDHigherTDC")

OwnPredictability_Q_UF_ASDHigherTDC <- extract_relevant_data(AdultLatency_m3_pred,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability",
                                                      "OwnPredictability_Q_UF_ASDHigherTDC")

OwnPredictability_overall_ASDHigherTDC <- extract_relevant_data(AdultLatency_m3_pred, 
                                                       "((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3) >
                                                       ((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3)",
                                                       "OwnPredictability_overall_ASDHigherTDC")
                                                       
DifferenceOwnPredictability_ASDLowerMatchingGameTDCVersusQuestions <- extract_relevant_data(AdultLatency_m3_pred,
            "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability) <
            (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability)",
            "DifferenceOwnPredictability_ASDLowerMatchingGameTDCVersusQuestions")

DifferenceOwnPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity <- extract_relevant_data(AdultLatency_m3_pred,
            "(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability) <
            (DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability)",
            "DifferenceOwnPredictability_ASDHigherFamiliarityTDCVersusUnfamiliarity")

OwnPredictabilityComparisonsHypothesesFull <- rbind(
      OwnPredictabilityHypothesesFull,
      OwnPredictability_MG_F_ASDHigherTDC,
      OwnPredictability_Q_F_ASDHigherTDC,
      OwnPredictability_Q_UF_ASDHigherTDC,
      OwnPredictability_overall_ASDHigherTDC,
      DifferenceOwnPredictability_ASDLowerMatchingGameTDCVersusQuestions,
      DifferenceOwnPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

PredictabilityComparisonsHypothesesFull <- rbind(OtherPredictabilityComparisonsHypothesesFull, OwnPredictabilityComparisonsHypothesesFull)

write.csv(PredictabilityComparisonsHypothesesFull, 'stats_for_paper/model3_Adult_Predictability_stats_for_paper.csv')
```

# RQ5, Reciprocal Adaptation
```{r}
DyadicC2P <- bf(ChildLatency ~ 
                           
                          0 + Diagnosis:Task:Familiarity +
                           
                          Diagnosis:Task:Familiarity:PrevOtherLatency + Diagnosis:Task:Familiarity:PrevSelfLatency +
                           
                           (0 + Task:Familiarity + Task:Familiarity:PrevOtherLatency + Task:Familiarity:PrevSelfLatency | gr(ID, by = Diagnosis)),
                           
                         
                         sigma ~ 0 + Diagnosis:Task:Familiarity + (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)))
                           
DyadicP2C <- bf(AdultLatency ~ 
                           
                          0 + Diagnosis:Task:Familiarity +
                           
                          Diagnosis:Task:Familiarity:AdultPrevOtherLatency + Diagnosis:Task:Familiarity:AdultPrevSelfLatency +
                           
                           (0 + Task:Familiarity + Task:Familiarity:AdultPrevOtherLatency + Task:Familiarity:AdultPrevSelfLatency | gr(ID, by = Diagnosis)),

                         sigma ~ 0 + Diagnosis:Task:Familiarity + (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)))
                          
priors3 <- c(prior(normal(0, 5), class = b, resp = AdultLatency),
             prior(normal(0, 5), class = b, resp = ChildLatency),
             prior(gamma(2, 2), class = beta, resp = ChildLatency),
             prior(gamma(2, 2), class = beta, resp = AdultLatency),
             prior(lkj(2), class = cor),
             prior(normal(1, 5), class = sd, resp = ChildLatency),
             prior(normal(1, 5), class = sd, resp = AdultLatency),
             
            prior(normal(0, .5), class = b, dpar = "sigma", resp = ChildLatency),
            prior(normal(0, .5), class = sd, dpar = "sigma", resp = ChildLatency),
             
             prior(normal(0, .5), class = b, dpar = "sigma", resp = AdultLatency),
             prior(normal(0, .5), class = sd, dpar = "sigma", resp = AdultLatency)
)

m_dyad_coupling_adaptation <- brm(
  DyadicC2P + DyadicP2C + set_rescor(FALSE),
  family = exgaussian(),
  data = d_dyadic,
  prior = priors3,
  sample_prior = "yes",
  iter = 2000,
  init = 0,
  warmup = 500,
  cores = 64,
  chains = 2,
  backend = "cmdstanr",
  file = here::here("models","m_dyad_coupling_adaptation"),
  control = list(adapt_delta = .90, max_treedepth = 15),
  save_pars = save_pars(all = TRUE))

pp_check(m_dyad_coupling_adaptation, ndraws = 150, resp = "ChildLatency")
pp_check(m_dyad_coupling_adaptation, ndraws = 150, resp = "AdultLatency")
```

## Child Latencies

### Hypothesis Tests
```{r}
#Let's start with interpersonal adjustment
ASD_MG_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "ChildLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:PrevOtherLatency > 0",
           "ASD_MG_F")

TDC_MG_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "ChildLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:PrevOtherLatency > 0",
           "TDC_MG_F")

ASD_Q_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency > 0",
           "ASD_Q_F")

TDC_Q_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency > 0",
           "TDC_Q_F")

ASD_Q_UF <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:PrevOtherLatency < 0",
           "ASD_Q_UF")

TDC_Q_UF <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:PrevOtherLatency > 0",
           "TDC_Q_UF")

ASD_overall <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "((ChildLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:PrevOtherLatency +
           ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency +
           ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:PrevOtherLatency)/3) > 0",
           "ASD_overall")

TDC_overall <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "((ChildLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:PrevOtherLatency +
           ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency +
           ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:PrevOtherLatency)/3) > 0",
           "TDC_overall")

InterpersonalAdjustmentOverallHypotheses <- rbind(ASD_MG_F, ASD_Q_F, ASD_Q_UF, ASD_overall,
                                                  TDC_MG_F, TDC_Q_F, TDC_Q_UF, TDC_overall)

InterpersonalAdjustment_MG_F_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "ChildLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:PrevOtherLatency > 
           ChildLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:PrevOtherLatency",
                                                      "InterpersonalAdjustment_MG_F_ASDHigherTDC")

InterpersonalAdjustment_Q_F_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency > 
           ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency",
                                                      "InterpersonalAdjustment_Q_F_ASDHigherTDC")

InterpersonalAdjustment_Q_UF_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:PrevOtherLatency > 
           ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:PrevOtherLatency",
                                                      "InterpersonalAdjustment_Q_UF_ASDHigherTDC")

InterpersonalAdjustment_overall_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation, 
                                                       "((ChildLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:PrevOtherLatency +
                                                       ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency +
                                                       ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:PrevOtherLatency) / 3) >
                                                       ((ChildLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:PrevOtherLatency +
                                                       ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency +
                                                       ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:PrevOtherLatency) / 3)",
                                                       "InterpersonalAdjustment_overall_ASDHigherTDC")
                                                       
DifferenceInterpersonalAdjustment_ASDLowerMatchingGameTDCVersusQuestions <- extract_relevant_data(m_dyad_coupling_adaptation,
            "(ChildLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:PrevOtherLatency - ChildLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:PrevOtherLatency) <
            (ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency - ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency)",
            "DifferenceInterpersonalAdjustment_ASDLowerMatchingGameTDCVersusQuestions")

DifferenceInterpersonalAdjustment_ASDHigherFamiliarityTDCVersusUnfamiliarity <- extract_relevant_data(m_dyad_coupling_adaptation,
            "(ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency - ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency) >
            (ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:PrevOtherLatency - ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:PrevOtherLatency)",
            "DifferenceInterpersonalAdjustment_ASDHigherFamiliarityTDCVersusUnfamiliarity")

TDCWithinGroupInterpersonalAdjustment_Q_F_HigherQ_UF <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency > 
           ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:PrevOtherLatency",
                                                      "TDCWithinGroupInterpersonalAdjustment_Q_F_HigherQ_UF")

ASDWithinGroupInterpersonalAdjustment_Q_F_HigherQ_UF <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency > 
           ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:PrevOtherLatency",
                                                      "ASDWithinGroupInterpersonalAdjustment_Q_F_HigherQ_UF")

TDCWithinGroupInterpersonalAdjustment_MG_HigherQ_F <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "ChildLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:PrevOtherLatency > 
           ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency",
                                                      "TDCWithinGroupInterpersonalAdjustment_MG_HigherQ_F")

ASDWithinGroupInterpersonalAdjustment_MG_HigherQ_F <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "ChildLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:PrevOtherLatency < 
           ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevOtherLatency",
                                                      "ASDWithinGroupInterpersonalAdjustment_MG_HigherQ_F")


InterpersonalComparisonsHypothesesFull <- rbind(
      InterpersonalAdjustmentOverallHypotheses,
      InterpersonalAdjustment_MG_F_ASDHigherTDC,
      InterpersonalAdjustment_Q_F_ASDHigherTDC,
      InterpersonalAdjustment_Q_UF_ASDHigherTDC,
      InterpersonalAdjustment_overall_ASDHigherTDC,
      DifferenceInterpersonalAdjustment_ASDLowerMatchingGameTDCVersusQuestions,
      DifferenceInterpersonalAdjustment_ASDHigherFamiliarityTDCVersusUnfamiliarity,
      TDCWithinGroupInterpersonalAdjustment_Q_F_HigherQ_UF,
      ASDWithinGroupInterpersonalAdjustment_Q_F_HigherQ_UF,
      TDCWithinGroupInterpersonalAdjustment_MG_HigherQ_F,
      ASDWithinGroupInterpersonalAdjustment_MG_HigherQ_F) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 1 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -1 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 1 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 1 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -1 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -1 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(InterpersonalComparisonsHypothesesFull, 'stats_for_paper/model4_ChildInterpersonalAdjustmentComparisonsHypothesesFull_stats_for_paper.csv')

# Let's extract the same for SelfLatency:
ASD_MG_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "ChildLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:PrevSelfLatency > 0",
           "ASD_MG_F")

TDC_MG_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "ChildLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:PrevSelfLatency > 0",
           "TDC_MG_F")

ASD_Q_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency > 0",
           "ASD_Q_F")

TDC_Q_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency > 0",
           "TDC_Q_F")

ASD_Q_UF <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:PrevSelfLatency > 0",
           "ASD_Q_UF")

TDC_Q_UF <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:PrevSelfLatency < 0",
           "TDC_Q_UF")

ASD_overall <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "((ChildLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:PrevSelfLatency +
           ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency +
           ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:PrevSelfLatency)/3) > 0",
           "ASD_overall")

TDC_overall <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "((ChildLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:PrevSelfLatency +
           ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency +
           ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:PrevSelfLatency)/3) > 0",
           "TDC_overall")

SelfAdjustmentOverallHypotheses <- rbind(ASD_MG_F, ASD_Q_F, ASD_Q_UF, ASD_overall,
                                                  TDC_MG_F, TDC_Q_F, TDC_Q_UF, TDC_overall)

SelfAdjustment_MG_F_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "ChildLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:PrevSelfLatency < 
           ChildLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:PrevSelfLatency",
                                                      "SelfAdjustment_MG_F_ASDHigherTDC")

SelfAdjustment_Q_F_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency > 
           ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency",
                                                      "SelfAdjustment_Q_F_ASDHigherTDC")

SelfAdjustment_Q_UF_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:PrevSelfLatency > 
           ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:PrevSelfLatency",
                                                      "SelfAdjustment_Q_UF_ASDHigherTDC")

SelfAdjustment_overall_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation, 
                                                       "((ChildLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:PrevSelfLatency +
                                                       ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency +
                                                       ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:PrevSelfLatency) / 3) >
                                                       ((ChildLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:PrevSelfLatency +
                                                       ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency +
                                                       ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:PrevSelfLatency) / 3)",
                                                       "SelfAdjustment_overall_ASDHigherTDC")
                                                       
DifferenceSelfAdjustment_ASDLowerMatchingGameTDCVersusQuestions <- extract_relevant_data(m_dyad_coupling_adaptation,
            "(ChildLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:PrevSelfLatency - ChildLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:PrevSelfLatency) <
            (ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency - ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency)",
            "DifferenceSelfAdjustment_ASDLowerMatchingGameTDCVersusQuestions")

DifferenceSelfAdjustment_ASDHigherFamiliarityTDCVersusUnfamiliarity <- extract_relevant_data(m_dyad_coupling_adaptation,
            "(ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency - ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency) <
            (ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:PrevSelfLatency - ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:PrevSelfLatency)",
            "DifferenceSelfAdjustment_ASDHigherFamiliarityTDCVersusUnfamiliarity")


TDCWithinGroupSelfAdjustment_Q_F_HigherQ_UF <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency > 
           ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:PrevSelfLatency",
                                                      "TDCWithinGroupSelfAdjustment_Q_F_HigherQ_UF")

ASDWithinGroupSelfAdjustment_Q_F_HigherQ_UF <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency > 
           ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:PrevSelfLatency",
                                                      "ASDWithinGroupSelfAdjustment_Q_F_HigherQ_UF")

TDCWithinGroupSelfAdjustment_MG_HigherQ_F <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "ChildLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:PrevSelfLatency > 
           ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency",
                                                      "TDCWithinGroupSelfAdjustment_MG_HigherQ_F")

ASDWithinGroupSelfAdjustment_MG_HigherQ_F <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "ChildLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:PrevSelfLatency < 
           ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:PrevSelfLatency",
                                                      "ASDWithinGroupSelfAdjustment_MG_HigherQ_F")

SelfAdjustmentComparisonsHypothesesFull <- rbind(
      SelfAdjustmentOverallHypotheses,
      SelfAdjustment_MG_F_ASDHigherTDC,
      SelfAdjustment_Q_F_ASDHigherTDC,
      SelfAdjustment_Q_UF_ASDHigherTDC,
      SelfAdjustment_overall_ASDHigherTDC,
      DifferenceSelfAdjustment_ASDLowerMatchingGameTDCVersusQuestions,
      DifferenceSelfAdjustment_ASDHigherFamiliarityTDCVersusUnfamiliarity,
      TDCWithinGroupSelfAdjustment_Q_F_HigherQ_UF,
      ASDWithinGroupSelfAdjustment_Q_F_HigherQ_UF,
      TDCWithinGroupSelfAdjustment_MG_HigherQ_F,
      ASDWithinGroupSelfAdjustment_MG_HigherQ_F) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 1 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -1 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 1 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 1 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -1 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -1 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(SelfAdjustmentComparisonsHypothesesFull, 'stats_for_paper/model4_ChildSelfAdjustmentComparisonsHypothesesFull_stats_for_paper.csv')
```

### Visualisation of Model Estimates, Interpersonal Adjustment
```{r}
d_dyadic_model_newdata <- d_dyadic %>%
  group_by(ID, Task, Familiarity, Diagnosis) %>%
  data_grid(PrevOtherLatency = seq_range(m_dyad_coupling_adaptation$data$PrevOtherLatency, n = 50)) %>%
  mutate(PrevSelfLatency = mean(m_dyad_coupling_adaptation$data$PrevSelfLatency, na.rm = T))

pred_data <- add_predicted_draws(object = m_dyad_coupling_adaptation, 
                newdata = d_dyadic_model_newdata,
                resp = "ChildLatency", value = ".prediction", ndraws = 50)

dyadic_predicted_data <- pred_data %>%
  group_by(ID, Task, Familiarity, Diagnosis, PrevOtherLatency) %>%
  dplyr::summarise(mean = mean(.prediction)) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development"))  %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))

InterpersonalAdjustmentPlot <- dyadic_predicted_data %>%
  ggplot() +
  geom_smooth(aes(x = PrevOtherLatency, y = mean, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.4, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = PrevOtherLatency, y = mean, color = Diagnosis),  linewidth = 2.5, method = "lm", se = F, show.legend = F) +
  facet_wrap(~ Condition) +
  #ylim(c(-0)) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  scale_x_continuous(breaks = seq(0, 5, by = 1), limits = c(0, 3.5)) +
  scale_y_continuous(breaks = c(-2, -1, 0, 1, 2)) +
  #ggtitle("Turn-by-Turn Interpersonal Adjustment for Child Latencies") +
  guides(fill = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1)),
         color = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1, fill = NA))) +
  ylab('Child Response Latency (sec)') +
  xlab('Previous Adult Response Latency (seconds)') +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        #axis.line.y =  element_blank(),
        legend.position = c(0.3, 0.9),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(2, "lines"),
        #axis.line.x =  element_blank(),
        panel.border = element_blank(),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"))
InterpersonalAdjustmentPlot
```

### Visualisation of Model Estimates, Self Adjustment
```{r}
d_dyadic_model_newdata <- d_dyadic %>%
  group_by(ID, Task, Familiarity, Diagnosis) %>%
  data_grid(PrevSelfLatency = seq_range(d_dyadic$PrevSelfLatency, n = 50)) %>%
  mutate(PrevOtherLatency = mean(d_dyadic$PrevOtherLatency, na.rm = T))

pred_data <- add_predicted_draws(object = m_dyad_coupling_adaptation, 
                newdata = d_dyadic_model_newdata,
                resp = "ChildLatency", value = ".prediction", ndraws = 50)

dyadic_predicted_data <- pred_data %>%
  group_by(ID, Task, Familiarity, Diagnosis, PrevSelfLatency) %>%
  dplyr::summarise(mean = mean(.prediction)) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development"))  %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))

SelfAdjustmentPlot <- dyadic_predicted_data %>%
  ggplot() +
  geom_smooth(aes(x = PrevSelfLatency, y = mean, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.4, se = FALSE) +
  geom_smooth(aes(x = PrevSelfLatency, y = mean, color = Diagnosis), linewidth = 2.5, method = "lm", se = F) +
  facet_wrap(~ Condition) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  #ggtitle('Turn-By-Turn Self Adjustment') +
  ylab('Child Response Latency (sec)') +
  xlab('Previous Child Response Latency (seconds)') +
  scale_x_continuous(breaks = seq(0, 5, by = 1), limits = c(0, 3.5)) +
  scale_y_continuous(limits = c(0, 2), breaks = c(-2, -1, 0, 1, 2)) +
  guides(fill = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1)),
         color = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1, fill = NA))) +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.title.y = element_blank(),  # Remove y axis title
        #axis.text.y = element_blank(),   # Remove y axis text
        #axis.ticks.y = element_blank(),   # Remove y axis ticks
        axis.text.y = element_text(size = 20, color = "black"),
        #axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        legend.position = "none",
        #legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        #legend.key.size = unit(3, "lines"),
        panel.border = element_blank(),
        legend.text = element_text(size = 20),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_blank())
SelfAdjustmentPlot

# Combine plots with plot_grid
combined_plot <- plot_grid(
  InterpersonalAdjustmentPlot, SelfAdjustmentPlot,
  ncol = 1,                 # Stack plots vertically
  align = 'v',              # Align plots vertically
  axis = 'l',              # Align plots on the left edge
  rel_heights = c(1, 1)    # Equal heights for both plots
)

# Combine the plots
combined_plot <- plot_grid(
  InterpersonalAdjustmentPlot, SelfAdjustmentPlot,
  ncol = 1,
  align = 'v',
  axis = 'l',
  rel_heights = c(1, 1)
)

# Create the final plot with adjusted y-axis label
SelfAndInterpersonalAdjustmentPlots <- ggdraw(clip = "off") +  # Important: turn off clipping
  draw_plot(combined_plot, x = 0.02) +  # Shift plot right to make room for label
  draw_text(
    "Child Response Latency (seconds)",
    x = 0.01,                    # Move label more to the left
    y = 0.5,                     # Center vertically
    angle = 90,                  # Rotate text
    vjust = 0.5,                 # Center the text on its position
    size = 20                    # Adjust text size if needed
  )



```

## Adult Latencies

### Hypothesis Tests
```{r}
#Let's start with interpersonal adjustment
ASD_MG_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "AdultLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AdultPrevOtherLatency > 0",
           "ASD_MG_F")

TDC_MG_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "AdultLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AdultPrevOtherLatency > 0",
           "TDC_MG_F")

ASD_Q_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency > 0",
           "ASD_Q_F")

TDC_Q_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency > 0",
           "TDC_Q_F")

ASD_Q_UF <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AdultPrevOtherLatency < 0",
           "ASD_Q_UF")

TDC_Q_UF <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AdultPrevOtherLatency > 0",
           "TDC_Q_UF")

ASD_overall <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "((AdultLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AdultPrevOtherLatency +
           AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency +
           AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AdultPrevOtherLatency)/3) > 0",
           "ASD_overall")

TDC_overall <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "((AdultLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AdultPrevOtherLatency +
           AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency +
           AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AdultPrevOtherLatency)/3) > 0",
           "TDC_overall")

InterpersonalAdjustmentOverallHypotheses <- rbind(ASD_MG_F, ASD_Q_F, ASD_Q_UF, ASD_overall,
                                                  TDC_MG_F, TDC_Q_F, TDC_Q_UF, TDC_overall)

InterpersonalAdjustment_MG_F_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "AdultLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AdultPrevOtherLatency > 
           AdultLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AdultPrevOtherLatency",
                                                      "InterpersonalAdjustment_MG_F_ASDHigherTDC")

InterpersonalAdjustment_Q_F_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency > 
           AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency",
                                                      "InterpersonalAdjustment_Q_F_ASDHigherTDC")

InterpersonalAdjustment_Q_UF_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AdultPrevOtherLatency > 
           AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AdultPrevOtherLatency",
                                                      "InterpersonalAdjustment_Q_UF_ASDHigherTDC")

InterpersonalAdjustment_overall_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation, 
                                                       "((AdultLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AdultPrevOtherLatency +
                                                       AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency +
                                                       AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AdultPrevOtherLatency) / 3) >
                                                       ((AdultLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AdultPrevOtherLatency +
                                                       AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency +
                                                       AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AdultPrevOtherLatency) / 3)",
                                                       "InterpersonalAdjustment_overall_ASDHigherTDC")
                                                       
DifferenceInterpersonalAdjustment_ASDLowerMatchingGameTDCVersusQuestions <- extract_relevant_data(m_dyad_coupling_adaptation,
            "(AdultLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AdultPrevOtherLatency - AdultLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AdultPrevOtherLatency) <
            (AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency - AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency)",
            "DifferenceInterpersonalAdjustment_ASDLowerMatchingGameTDCVersusQuestions")

DifferenceInterpersonalAdjustment_ASDHigherFamiliarityTDCVersusUnfamiliarity <- extract_relevant_data(m_dyad_coupling_adaptation,
            "(AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency - AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency) >
            (AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AdultPrevOtherLatency - AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AdultPrevOtherLatency)",
            "DifferenceInterpersonalAdjustment_ASDHigherFamiliarityTDCVersusUnfamiliarity")

TDCWithinGroupInterpersonalAdjustment_Q_F_HigherQ_UF <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency > 
           AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AdultPrevOtherLatency",
                                                      "TDCWithinGroupInterpersonalAdjustment_Q_F_HigherQ_UF")

ASDWithinGroupInterpersonalAdjustment_Q_F_HigherQ_UF <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency > 
           AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AdultPrevOtherLatency",
                                                      "ASDWithinGroupInterpersonalAdjustment_Q_F_HigherQ_UF")

TDCWithinGroupInterpersonalAdjustment_MG_HigherQ_F <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "AdultLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AdultPrevOtherLatency > 
           AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency",
                                                      "TDCWithinGroupInterpersonalAdjustment_MG_HigherQ_F")

ASDWithinGroupInterpersonalAdjustment_MG_HigherQ_F <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "AdultLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AdultPrevOtherLatency < 
           AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevOtherLatency",
                                                      "ASDWithinGroupInterpersonalAdjustment_MG_HigherQ_F")


InterpersonalComparisonsHypothesesFull <- rbind(
      InterpersonalAdjustmentOverallHypotheses,
      InterpersonalAdjustment_MG_F_ASDHigherTDC,
      InterpersonalAdjustment_Q_F_ASDHigherTDC,
      InterpersonalAdjustment_Q_UF_ASDHigherTDC,
      InterpersonalAdjustment_overall_ASDHigherTDC,
      DifferenceInterpersonalAdjustment_ASDLowerMatchingGameTDCVersusQuestions,
      DifferenceInterpersonalAdjustment_ASDHigherFamiliarityTDCVersusUnfamiliarity,
      TDCWithinGroupInterpersonalAdjustment_Q_F_HigherQ_UF,
      ASDWithinGroupInterpersonalAdjustment_Q_F_HigherQ_UF,
      TDCWithinGroupInterpersonalAdjustment_MG_HigherQ_F,
      ASDWithinGroupInterpersonalAdjustment_MG_HigherQ_F) %>%
  rename("value" = TestDescription) %>%
  #mutate(Estimate = round(Estimate, 1)) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(InterpersonalComparisonsHypothesesFull, 'stats_for_paper/model4_AdultInterpersonalAdjustmentComparisonsHypothesesFull_stats_for_paper.csv')

# Let's extract the same for SelfLatency:
ASD_MG_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "AdultLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AdultPrevSelfLatency > 0",
           "ASD_MG_F")

TDC_MG_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "AdultLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AdultPrevSelfLatency > 0",
           "TDC_MG_F")

ASD_Q_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency > 0",
           "ASD_Q_F")

TDC_Q_F <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency > 0",
           "TDC_Q_F")

ASD_Q_UF <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AdultPrevSelfLatency > 0",
           "ASD_Q_UF")

TDC_Q_UF <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AdultPrevSelfLatency < 0",
           "TDC_Q_UF")

ASD_overall <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "((AdultLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AdultPrevSelfLatency +
           AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency +
           AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AdultPrevSelfLatency)/3) > 0",
           "ASD_overall")

TDC_overall <- extract_relevant_data(m_dyad_coupling_adaptation, 
           "((AdultLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AdultPrevSelfLatency +
           AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency +
           AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AdultPrevSelfLatency)/3) > 0",
           "TDC_overall")

SelfAdjustmentOverallHypotheses <- rbind(ASD_MG_F, ASD_Q_F, ASD_Q_UF, ASD_overall,
                                                  TDC_MG_F, TDC_Q_F, TDC_Q_UF, TDC_overall)

SelfAdjustment_MG_F_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "AdultLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AdultPrevSelfLatency < 
           AdultLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AdultPrevSelfLatency",
                                                      "SelfAdjustment_MG_F_ASDHigherTDC")

SelfAdjustment_Q_F_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency > 
           AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency",
                                                      "SelfAdjustment_Q_F_ASDHigherTDC")

SelfAdjustment_Q_UF_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AdultPrevSelfLatency > 
           AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AdultPrevSelfLatency",
                                                      "SelfAdjustment_Q_UF_ASDHigherTDC")

SelfAdjustment_overall_ASDHigherTDC <- extract_relevant_data(m_dyad_coupling_adaptation, 
                                                       "((AdultLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AdultPrevSelfLatency +
                                                       AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency +
                                                       AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AdultPrevSelfLatency) / 3) >
                                                       ((AdultLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AdultPrevSelfLatency +
                                                       AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency +
                                                       AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AdultPrevSelfLatency) / 3)",
                                                       "SelfAdjustment_overall_ASDHigherTDC")
                                                       
DifferenceSelfAdjustment_ASDLowerMatchingGameTDCVersusQuestions <- extract_relevant_data(m_dyad_coupling_adaptation,
            "(AdultLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AdultPrevSelfLatency - AdultLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AdultPrevSelfLatency) <
            (AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency - AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency)",
            "DifferenceSelfAdjustment_ASDLowerMatchingGameTDCVersusQuestions")

DifferenceSelfAdjustment_ASDHigherFamiliarityTDCVersusUnfamiliarity <- extract_relevant_data(m_dyad_coupling_adaptation,
            "(AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency - AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency) <
            (AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AdultPrevSelfLatency - AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AdultPrevSelfLatency)",
            "DifferenceSelfAdjustment_ASDHigherFamiliarityTDCVersusUnfamiliarity")


TDCWithinGroupSelfAdjustment_Q_F_HigherQ_UF <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency > 
           AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AdultPrevSelfLatency",
                                                      "TDCWithinGroupSelfAdjustment_Q_F_HigherQ_UF")

ASDWithinGroupSelfAdjustment_Q_F_HigherQ_UF <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency > 
           AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AdultPrevSelfLatency",
                                                      "ASDWithinGroupSelfAdjustment_Q_F_HigherQ_UF")

TDCWithinGroupSelfAdjustment_MG_HigherQ_F <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "AdultLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AdultPrevSelfLatency > 
           AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency",
                                                      "TDCWithinGroupSelfAdjustment_MG_HigherQ_F")

ASDWithinGroupSelfAdjustment_MG_HigherQ_F <- extract_relevant_data(m_dyad_coupling_adaptation,
                                                      "AdultLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AdultPrevSelfLatency < 
           AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AdultPrevSelfLatency",
                                                      "ASDWithinGroupSelfAdjustment_MG_HigherQ_F")

SelfAdjustmentComparisonsHypothesesFull <- rbind(
      SelfAdjustmentOverallHypotheses,
      SelfAdjustment_MG_F_ASDHigherTDC,
      SelfAdjustment_Q_F_ASDHigherTDC,
      SelfAdjustment_Q_UF_ASDHigherTDC,
      SelfAdjustment_overall_ASDHigherTDC,
      DifferenceSelfAdjustment_ASDLowerMatchingGameTDCVersusQuestions,
      DifferenceSelfAdjustment_ASDHigherFamiliarityTDCVersusUnfamiliarity,
      TDCWithinGroupSelfAdjustment_Q_F_HigherQ_UF,
      ASDWithinGroupSelfAdjustment_Q_F_HigherQ_UF,
      TDCWithinGroupSelfAdjustment_MG_HigherQ_F,
      ASDWithinGroupSelfAdjustment_MG_HigherQ_F) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(SelfAdjustmentComparisonsHypothesesFull, 'stats_for_paper/model4_AdultSelfAdjustmentComparisonsHypothesesFull_stats_for_paper.csv')
```

### Visualisation of Model Estimates, Interpersonal Adjustment
```{r}
d_dyadic_model_newdata <- d_dyadic %>%
  group_by(ID, Task, Familiarity, Diagnosis) %>%
  data_grid(AdultPrevOtherLatency = seq_range(m_dyad_coupling_adaptation$data$AdultPrevOtherLatency, n = 50)) %>%
  mutate(AdultPrevSelfLatency = mean(m_dyad_coupling_adaptation$data$AdultPrevSelfLatency, na.rm = T))

pred_data <- add_predicted_draws(object = m_dyad_coupling_adaptation, 
                newdata = d_dyadic_model_newdata,
                resp = "AdultLatency", value = ".prediction")

dyadic_predicted_data <- pred_data %>%
  group_by(ID, Task, Familiarity, Diagnosis, AdultPrevOtherLatency) %>%
  dplyr::summarise(mean = mean(.prediction)) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development"))  %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))

InterpersonalAdjustmentPlotAdult <- dyadic_predicted_data %>%
  ggplot() +
  geom_smooth(aes(x = AdultPrevOtherLatency, y = mean, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.4, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = AdultPrevOtherLatency, y = mean, color = Diagnosis),  linewidth = 2.5, method = "lm", se = F, show.legend = F) +
  facet_wrap(~ Condition) +
  #ylim(c(-0)) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  scale_x_continuous(breaks = seq(0, 5, by = 1), limits = c(0, 3.5)) +
  scale_y_continuous(breaks = c(-2, -1, 0, 1, 2)) +
  #ggtitle("Turn-by-Turn Interpersonal Adjustment for Child Latencies") +
  guides(fill = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1)),
         color = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1, fill = NA))) +
  ylab('Adult Response Latency (seconds)') +
  xlab('Previous Child Response Latency (seconds)') +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        #axis.line.y =  element_blank(),
        legend.position = c(0.3, 0.9),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(2, "lines"),
        #axis.line.x =  element_blank(),
        panel.border = element_blank(),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"))
InterpersonalAdjustmentPlotAdult

```

### Visualisation of Model Estimates, Self Adjustment
```{r}
d_dyadic_model_newdata <- d_dyadic %>%
  group_by(ID, Task, Familiarity, Diagnosis) %>%
  data_grid(AdultPrevSelfLatency = seq_range(d_dyadic$AdultPrevSelfLatency, n = 50)) %>%
  mutate(AdultPrevOtherLatency = mean(d_dyadic$AdultPrevOtherLatency, na.rm = T))

pred_data <- add_predicted_draws(object = m_dyad_coupling_adaptation, 
                newdata = d_dyadic_model_newdata,
                resp = "AdultLatency", value = ".prediction")

dyadic_predicted_data <- pred_data %>%
  group_by(ID, Task, Familiarity, Diagnosis, AdultPrevSelfLatency) %>%
  dplyr::summarise(mean = mean(.prediction)) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development"))  %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))


SelfAdjustmentPlotAdult <- dyadic_predicted_data %>%
  ggplot() +
  geom_smooth(aes(x = AdultPrevSelfLatency, y = mean, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.4, se = FALSE) +
  geom_smooth(aes(x = AdultPrevSelfLatency, y = mean, color = Diagnosis), linewidth = 2.5, method = "lm", se = F) +
  facet_wrap(~ Condition) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  #ggtitle('Turn-By-Turn Self Adjustment') +
  ylab('Adult Response Latency (seconds)') +
  xlab('Previous Adult Response Latency (seconds)') +
  scale_x_continuous(breaks = seq(0, 5, by = 1), limits = c(0, 3.5)) +
  scale_y_continuous(limits = c(0, 2), breaks = c(-2, -1, 0, 1, 2)) +
  guides(fill = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1)),
         color = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1, fill = NA))) +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.title.y = element_blank(),  # Remove y axis title
        #axis.text.y = element_blank(),   # Remove y axis text
        #axis.ticks.y = element_blank(),   # Remove y axis ticks
        axis.text.y = element_text(size = 20, color = "black"),
        #axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        legend.position = "none",
        #legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        #legend.key.size = unit(3, "lines"),
        panel.border = element_blank(),
        legend.text = element_text(size = 20),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_blank())
SelfAdjustmentPlotAdult


# Combine plots with plot_grid
combined_plot <- plot_grid(
  InterpersonalAdjustmentPlotAdult, SelfAdjustmentPlotAdult,
  ncol = 1,                 # Stack plots vertically
  align = 'v',              # Align plots vertically
  axis = 'l',              # Align plots on the left edge
  rel_heights = c(1, 1)    # Equal heights for both plots
)

# Combine the plots
combined_plot <- plot_grid(
  InterpersonalAdjustmentPlotAdult, SelfAdjustmentPlotAdult,
  ncol = 1,
  align = 'v',
  axis = 'l',
  rel_heights = c(1, 1)
)

# Create the final plot with adjusted y-axis label
SelfAndInterpersonalAdjustmentPlotsAdult <- ggdraw(clip = "off") +  # Important: turn off clipping
  draw_plot(combined_plot, x = 0.02) +  # Shift plot right to make room for label
  draw_text(
    "Adult Response Latency (seconds)",
    x = 0.01,                    # Move label more to the left
    y = 0.5,                     # Center vertically
    angle = 90,                  # Rotate text
    vjust = 0.5,                 # Center the text on its position
    size = 20                    # Adjust text size if needed
  )




```

# Control Analyses
## RQ1, Child Response Latencies across Different Conditions, No Overlaps
```{r, eval = F}
d_no <- d %>% 
  subset(Latency > 0) %>%
  filter(InterTurn == "Child2Adult")

Latency_f1 <- bf(
  Latency ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task:Familiarity | r | Visit), 
  sigma ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)),
  beta ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis))  +  
    (0 + Diagnosis:Task:Familiarity | r | Visit))

priorChild_no <- c(
  prior(normal(0, 2), class = b, lb = 0),
  prior(normal(0, 0.3), class = sd),
  prior(normal(0, 1), class = b, dpar = beta),
  prior(normal(0, 0.1), class = sd, dpar = beta),
  prior(normal(0, 1), class = b, dpar = sigma),
  prior(normal(0, 0.1), class = sd, dpar = sigma),
  prior(lkj(2), class = cor)
)

job::job({
  ChildLatency_m1_no <- brm(
    Latency_f1,
    data = d_no,
    family = exgaussian,
    prior = priorChild_no,
    sample_prior = T,
    backend = "cmdstanr",
    iter = 4000,
    warmup = 500,
    init = 0,
    chains = 2,
    cores = 64,
    file = here("models","ChildLatency_m1_noJulyJuly"),
    control = list(adapt_delta = 0.99, max_treedepth = 15),
    stan_model_args = list(stanc_options = list("O1"))
  )
})

pp_check(ChildLatency_m1_no, ndraws = 100)

ChildLatency_m1_no$formula
```

### Hypothesis Tests
```{r}
# Overall Estimates in Autism Group
OverallLatencyThreeConditionsASD <- extract_relevant_data(ChildLatency_m1_no,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                      "OverallLatencyThreeConditionsASD")

MGOverallLatencyASD <- extract_relevant_data(ChildLatency_m1_no,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                      "MGOverallLatencyASD>0")

Q_F_OverallLatencyASD <- extract_relevant_data(ChildLatency_m1_no,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > 0",
                      "Q_F_OverallLatencyASD>0")

Q_UF_OverallLatencyASD <- extract_relevant_data(ChildLatency_m1_no,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > 0",
                      "Q_UF_OverallLatencyASD>0")

# Overall Estimates in TD Group
OverallLatencyThreeConditionsTD <- extract_relevant_data(ChildLatency_m1_no,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3 > 0",
                      "OverallLatencyThreeConditionsTD")

MGOverallLatencyTDC <- extract_relevant_data(ChildLatency_m1_no,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                      "MGOverallLatencyTDC>0")

Q_F_OverallLatencyTDC <- extract_relevant_data(ChildLatency_m1_no,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar > 0",
                      "Q_F_OverallLatencyTDC>0")

Q_UF_OverallLatencyTDC <- extract_relevant_data(ChildLatency_m1_no,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > 0",
                      "Q_UF_OverallLatencyTDC>0")

# Overall Differences between Autism Group and Typical Development Group
OverallLatencyThreeConditionsASDFasterTD <- extract_relevant_data(ChildLatency_m1_no,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 
                                <
                                (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3",
                      "OverallLatencyThreeConditionsASD<TD")


# Overall values for Beta parameter
BetaParameterASD_MG <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                 "BetaParameterASD_MG")

BetaParameterASD_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < 0",
                 "BetaParameterASD_Q_F")

BetaParameterASD_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < 0",
                 "BetaParameterASD_Q_UF")

BetaParameterASD_Overall <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "(beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar +
                 beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar +
                 beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) / 3 < 0",
                 "BetaParameterASD_Overall")

# Differences, Typical Development Group with Long Pauses
BetaParameterTDC_MG <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                 "BetaParameterTDC_MG")

BetaParameterTDC_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar < 0",
                 "BetaParameterTDC_Q_F")

BetaParameterTDC_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar < 0",
                 "BetaParameterTDC_Q_UF")

BetaParameterTDC_Overall <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "(beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar +
                 beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +
                 beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3 < 0",
                 "BetaParameterTDC_Overall")




WithinGroupBetaParameterASD_MG_Slower_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                 "WithinGroupBetaParameterASD_MG_Slower_Q_F")

WithinGroupBetaParameterASD_Q_F_Slower_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                 "WithinGroupBetaParameterASD_Q_F_Slower_Q_UF")

WithinGroupBetaParameterTDC_MG_Slower_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                 "WithinGroupBetaParameterTDC_MG_Slower_Q_F")

WithinGroupBetaParameterTDC_Q_F_Slower_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                 "WithinGroupBetaParameterTDC_Q_F_Slower_Q_UF")

DifferenceInDifferenceBetaParameterBetweenGroupsMGBiggerQ_F <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "(beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar - beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) > 
                 (beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar - beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar)",
                 "DifferenceInDifferenceBetaParameterBetweenGroupsMGBiggerQ_F")

DifferenceInDifferenceBetaParameterBetweenGroupsFamiliarityBiggerUnfamiliarity <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "(beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar - beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar) < 
                 (beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar - beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)",
                 "DifferenceInDifferenceBetaParameterBetweenGroupsFamiliarityBiggerUnfamiliarity")

# Differences between Autism Group and Typical Development Group with Long Pauses
OverallBetaParameterASDLowerTD <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                 "(beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar + beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) / 3 < ((beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3)",
                 "OverallBetaParameterASD<TD")

BetaParameterASDFasterTD_MG <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                      "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                      "BetaParameter_ASD_MG<TD_MG")

BetaParameterASDFasterTD_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                      "beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "BetaParameter_ASD_MG<TD_Q_F")

BetaParameterASDFasterTD_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_no,
                      "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                      "BetaParameter_ASD_MG<TD_Q_UF")

# Differences within Autism Group across Conditions:
WithinASDGroupMGSlowerQuestionsFamiliar <- extract_relevant_data(ChildLatency_m1_no,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                      "WithinASDGroupMG>QuestionsFamiliar")

# Differences within TD Group across Conditions:
WithinTDGroupMGSlowerQuestionsFamiliar <- extract_relevant_data(ChildLatency_m1_no,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinTDGroupMG>QuestionsFamiliar")

# Differences within Autism Group across Familiarity:
WithinAutismGroupQuestionsUnfamiliarSlowerFamiliar <- extract_relevant_data(ChildLatency_m1_no,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                      "WithinAutismGroupQuestionsUnfamiliar>Familiar")

# Differences within TD Group across Familiarity:
WithinTDGroupQuestionsUnfamiliarSlowerFamiliar <- extract_relevant_data(ChildLatency_m1_no,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinTDGroupQuestionsUnfamiliar>Familiar")

# Differences between Autism Group and Typical Development Group Within MatchingGame
WithinConditionsMatchingGameASDFasterTD <- extract_relevant_data(ChildLatency_m1_no,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                      "WithinConditionsMatchingGameASD<TD")

# Differences between Autism Group and Typical Development Group Within Familiar Questions:
WithinConditionsQuestionsFamiliarASDFasterTD <- extract_relevant_data(ChildLatency_m1_no,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinConditionsQuestionsFamiliarASD<TD")

# Differences between Autism Group and Typical Development Group Within Unfamiliar Questions:
WithinConditionsQuestionsUnfamiliarASDFasterTD <- extract_relevant_data(ChildLatency_m1_no,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                      "WithinConditionsQuestionsUnfamiliarASD<TD")

# Differences between Autism Group and Typical Development Group in Differences within Familiarity
DifferenceInDifferenceBetweenGroupsUnfamiliarBiggerFamiliarity <- extract_relevant_data(ChildLatency_m1_no,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) < 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                      "DifferenceInDifferenceBetweenGroupsUnfamiliar>Familiarity")

# Differences between Autism Group and Typical Development Group in Differences within Conditions
DifferenceInDifferenceBetweenGroupsMGBiggerThanConversations <- extract_relevant_data(ChildLatency_m1_no,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) > 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                      "DifferenceInDifferenceBetweenGroupsMG>Conversations")

# Overall Subject Variability in Autismm Group
SubjectVariabilityASD <- extract_relevant_sd_data(ChildLatency_m1_no, 
                                               "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisASD + TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD)/3 > 0",
                                               "SubjectVariabilityASD")

SubjectVariabilityASD_MG <- extract_relevant_sd_data(ChildLatency_m1_no, 
                                               "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_MG")

SubjectVariabilityASD_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no, 
                                               "TaskQuestions:FamiliarityFamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_Q_F")

SubjectVariabilityASD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no, 
                                               "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_Q_UF")

# Overall Subject Variability in TD Group
SubjectVariabilityTD <- extract_relevant_sd_data(ChildLatency_m1_no, 
                                               "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisTDC + TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC)/3 > 0",
                                               "SubjectVariabilityTD")

SubjectVariabilityTD_MG <- extract_relevant_sd_data(ChildLatency_m1_no, 
                                               "TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_MG")

SubjectVariabilityTD_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no, 
                                               "TaskQuestions:FamiliarityFamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_Q_F")

SubjectVariabilityTD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no, 
                                               "TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_Q_UF")

# Overall Subject Variability in TD Group
SubjectVariabilityASDSmallerThanTD <- extract_relevant_sd_data(ChildLatency_m1_no,
                                              "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisASD + TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD) / 3 <
                                              (TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisTDC + TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC) / 3",
                                               "SubjectVariabilityASD<TD")


SubjectVariabilityASDSmallerThanTD_MG <- extract_relevant_sd_data(ChildLatency_m1_no,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD  <
                                              TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_MG<TD_MG")

SubjectVariabilityASDSmallerThanTD_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no,
                                              "TaskQuestions:FamiliarityFamiliar:DiagnosisASD  <
                                              TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_Q_F<TD_Q_F")

SubjectVariabilityASDSmallerThanTD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD  <
                                              TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_Q_UF<TD_Q_UF")

SubjectVariabilityASD_MG_SmallerThan_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD > TaskQuestions:FamiliarityFamiliar:DiagnosisASD",
                                               "SubjectVariabilityASD_MG_SmallerThan_Q_F")

SubjectVariabilityASD_Q_F_SmallerThan_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD > TaskQuestions:FamiliarityFamiliar:DiagnosisASD",
                                               "SubjectVariabilityASD_Q_F_SmallerThan_Q_UF")

SubjectVariabilityTDC_MG_SmallerThan_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC < TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityTDC_MG_SmallerThan_Q_F")

SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC > TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF")

DifferenceInDifferenceSubjectVariabilityUnfamiliarSmallerFamiliarity <- extract_relevant_sd_data(ChildLatency_m1_no,
                                              "(TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD - TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC) 
                                              < 
                                              (TaskQuestions:FamiliarityFamiliar:DiagnosisASD - TaskQuestions:FamiliarityFamiliar:DiagnosisTDC)",
                                              "DifferenceInDifferenceSubjectVariabilityUnfamiliarBiggerFamiliarity")

DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions <- extract_relevant_sd_data(ChildLatency_m1_no,
                                              "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC - TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD) 
                                              < 
                                              (TaskQuestions:FamiliarityFamiliar:DiagnosisTDC - TaskQuestions:FamiliarityFamiliar:DiagnosisASD)",
                                              "DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions")

# Overall Visit Variability across visits in Autism Group
VisitVariabilityASDOverall <- extract_relevant_sdvisit_data(ChildLatency_m1_no, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                                               "VisitVariabilityASDOverall")

# Overall Visit Variability across visits in TD Group
VisitVariabilityTDCOverall <- extract_relevant_sdvisit_data(ChildLatency_m1_no, 
                                               "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                                               "VisitVariabilityTDCOverall")


VisitVariabilityASDOverallHigherTDSOverall <- extract_relevant_sdvisit_data(ChildLatency_m1_no, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 >
                                               (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3",
                                               "VisitVariabilityASDOverallLowerTDSOverall")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_no, 
                                               "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                                               "VisitVariabilityASDMG")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_no, 
                                               "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                                               "VisitVariabilityTDMG")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASD_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1_no, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > 0",
                                               "VisitVariabilityASD_Q_F")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDC_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1_no, 
                                               "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar > 0",
                                               "VisitVariabilityTDC_Q_F")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASD_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1_no, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > 0",
                                               "VisitVariabilityASD_Q_UF")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDC_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1_no, 
                                               "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > 0",
                                               "VisitVariabilityTDC_Q_UF")

# Overall Subject Variability across visits, differences
VisitVariabilityASDMGSlowerThanTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_no, 
                                               "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar",
                                               "VisitVariabilityASDMG>TDMG")

# Overall Subject Variability across visits, differences
VisitVariabilityASD_Q_F_SlowerThanTD_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1_no, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                                               "VisitVariabilityASD_Q_F_SlowerThanTD_Q_F")

# Overall Subject Variability across visits, differences
VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1_no, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                                               "VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF")

#DifferenceInDifference:
DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity <- extract_relevant_sdvisit_data(ChildLatency_m1_no, 
                                               "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)
                                               < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity")

DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_no, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)
                                               > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG")


# Overall Sigma Variability across visits in Autism Group
SigmaASDOverall <- extract_relevant_sigma_data(ChildLatency_m1_no, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 < 0",
                                               "SigmaASDOverall")

# Overall Sigma Variability across visits in TD Group
SigmaTDCOverall <- extract_relevant_sigma_data(ChildLatency_m1_no, 
                                               "(sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) /3 < 0",
                                               "SigmaTDCOverall")


SigmaASDOverallHigherTDSOverall <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 >
                                               (sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3",
                                               "SigmaASDOverallHigherTDSOverall")

# Subject Variability across visits MG in Autism Group
SigmaASDMG <- extract_relevant_sigma_data(ChildLatency_m1_no, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < 0",
                                               "SigmaASDMG")

# Overall Subject Variability across visits in TD Group
SigmaTDMG <- extract_relevant_sigma_data(ChildLatency_m1_no, 
                                               "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < 0",
                                               "SigmaTDMG")

# Subject Variability across visits MG in Autism Group
SigmaASD_Q_F <- extract_relevant_sigma_data(ChildLatency_m1_no, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < 0",
                                               "SigmaASD_Q_F")

# Overall Subject Variability across visits in TD Group
SigmaTDC_Q_F <- extract_relevant_sigma_data(ChildLatency_m1_no, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar < 0",
                                               "SigmaTDC_Q_F")


# Subject Variability across visits MG in Autism Group
SigmaASD_Q_UF <- extract_relevant_sigma_data(ChildLatency_m1_no, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < 0 ",
                                               "SigmaASD_Q_UF")

# Overall Subject Variability across visits in TD Group
SigmaTDC_Q_UF <- extract_relevant_sigma_data(ChildLatency_m1_no, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar < 0",
                                               "SigmaTDC_Q_UF")

# Overall Subject Variability across visits, differences
SigmaASDMGSlowerThanTDMG <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                                               "SigmaASDMGSlowerThanTDMG")

# Overall Subject Variability across visits, differences
SigmaASD_Q_F_SlowerThanTD_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                                               "SigmaASD_Q_F_SlowerThanTD_Q_F")

# Overall Subject Variability across visits, differences
SigmaASD_Q_UF_SlowerThanTD_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                                               "SigmaASD_Q_UF_SlowerThanTD_Q_UF")

# Sigma across visits, differences
# SigmaASD_MG_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit < 0",
#                                                "SigmaASD_MG_VisitLowerZero")

# SigmaTDC_MG_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit > 0",
#                                                "SigmaTDC_MG_VisitLowerZero")
# 
# SigmaASD_MG_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "SigmaASD_MG_VisitLowerTDC")
# 
# SigmaASD_Overall_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit + 
#                                                sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit +
#                                                sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 < 0",
#                                                "SigmaASD_Overall_VisitLowerZero")
# 
# SigmaTDC_Overall_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "(sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit + 
#                                                sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit +
#                                                sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 < 0",
#                                                "SigmaTDC_Overall_VisitLowerZero")
# 
# # Sigma across visits, differences
# SigmaASD_Q_F_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit > 0",
#                                                "SigmaASD_Q_F_VisitLowerZero")
# 
# SigmaTDC_Q_F_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit < 0",
#                                                "SigmaTDC_Q_F_VisitLowerZero")
# 
# SigmaASD_Q_F_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "SigmaASD_Q_F_VisitLowerTDC")
# 
# # Sigma across visits, differences
# SigmaASD_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < 0",
#                                                "SigmaASD_Q_UF_VisitLowerZero")
# 
# SigmaTDC_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > 0",
#                                                "SigmaTDC_Q_UF_VisitLowerZero")
# 
# SigmaASD_Q_UF_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "SigmaASD_Q_UF_VisitLowerTDC")
# 
# SigmaVisitOverall_ASDLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit + 
#                                                sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit +
#                                                sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 > (sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit + 
#                                                sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit +
#                                                sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) /3",
#                                                "SigmaVisitOverall_ASDLowerTDC")

#DifferenceInDifference:
DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
                                               "(sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)
                                               > (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity")

DifferenceInDifferenceSigmaASDMGSmallerThanTDMG <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)
                                               > (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceSigmaASDMGSmallerThanTDMG")

#WithinGroups
WithinGroupSigmaASD_Q_F_Faster_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaASD_Q_FFaster_UF")

WithinGroupSigmaTDC_Q_F_Faster_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaTDC_Q_F_Faster_UF")

WithinGroupSigmaASD_Q_F_Faster_MG <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaASD_Q_F_Faster_MG")

WithinGroupSigmaTDC_Q_F_Faster_MG <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
                                               "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaTDC_Q_F_Faster_MG")


# WithinGroupSigmaASD_Q_F_Lower_UF_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit",
#                                                "WithinGroupSigmaASD_Q_F_Lower_UF_Visit")
# 
# WithinGroupSigmaTDC_Q_F_Lower_UF_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit",
#                                                "WithinGroupSigmaTDC_Q_F_Lower_UF_Visit")
# 
# WithinGroupSigmaASD_Q_F_Lower_MG_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "WithinGroupSigmaASD_Q_F_Lower_MG_Visit")
# 
# WithinGroupSigmaTDC_Q_F_Lower_MG_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "WithinGroupSigmaTDC_Q_F_Lower_MG_Visit")
# 
# 
# SigmaTDC_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > 0",
#                                                "SigmaTDC_Q_UF_VisitLowerZero")
# 
# SigmaASD_Q_UF_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "SigmaASD_Q_UF_VisitLowerTDC")
# 
# 
# DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "(sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) <
#                                                (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit)", "DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF")
# 
# 
# DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_no, 
#                                                "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit) <
#                                                (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit)", "DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F")



# Correlation Estimates across visits in Autism Group
post <- as_draws_df(ChildLatency_m1_no)


# Apply the function for each case
cor_post_mu_MG_ASD <- Visitextract_and_rename(post, "DiagnosisASD", "TaskMatchingGame", "FamiliarityFamiliar") %>%
  cor() %>%
  as.matrix()

cor_post_mu_MG_TDC <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskMatchingGame", "FamiliarityFamiliar") %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_ASD_Familiar <- Visitextract_and_rename(post, "DiagnosisASD", "TaskQuestions", "FamiliarityFamiliar") %>%
  select(Visit2, Visit4, Visit6) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_TDC_Familiar <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskQuestions", "FamiliarityFamiliar") %>%
  select(Visit2, Visit4, Visit6) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_ASD_Unfamiliar <- Visitextract_and_rename(post, "DiagnosisASD", "TaskQuestions", "FamiliarityUnfamiliar") %>%
  select(Visit1, Visit3, Visit5, Visit7) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_TDC_Unfamiliar <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskQuestions", "FamiliarityUnfamiliar") %>%
  select(Visit1, Visit3, Visit5, Visit7) %>%
  cor() %>%
  as.matrix()

diag(cor_post_mu_MG_ASD) <- NA
diag(cor_post_mu_MG_TDC) <- NA
diag(cor_post_mu_Q_ASD_Familiar) <- NA
diag(cor_post_mu_Q_TDC_Familiar) <- NA
diag(cor_post_mu_Q_ASD_Unfamiliar) <- NA
diag(cor_post_mu_Q_TDC_Unfamiliar) <- NA

CorrelationSummaryStatistics <- tibble(
       Estimate = c(mean(cor_post_mu_MG_ASD, na.rm = TRUE), mean(cor_post_mu_Q_ASD_Familiar, na.rm = TRUE), mean(cor_post_mu_Q_ASD_Unfamiliar, na.rm = TRUE), 
                    mean(cor_post_mu_MG_TDC, na.rm = TRUE), mean(cor_post_mu_Q_TDC_Familiar, na.rm = TRUE), mean(cor_post_mu_Q_TDC_Unfamiliar, na.rm = TRUE)),
       CI.Lower = c(quantile(cor_post_mu_MG_ASD, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Familiar, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Unfamiliar, probs = 0.025, na.rm = TRUE), 
                    quantile(cor_post_mu_MG_TDC, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Familiar, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Unfamiliar, probs = 0.025, na.rm = TRUE)),
       CI.Upper = c(quantile(cor_post_mu_MG_ASD, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Familiar, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Unfamiliar, probs = 0.975, na.rm = TRUE), 
                    quantile(cor_post_mu_MG_TDC, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Familiar, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Unfamiliar, probs = 0.975, na.rm = TRUE)),
       Evid.Ratio = c(NA, NA, NA, NA, NA, NA),
       TestDescription = c(
  "CorrelationAcrossVisitsASDMG", "CorrelationAcrossVisitsASDFamiliarQuestions", "CorrelationAcrossVisitsASDUnfamiliarQuestions",
  "CorrelationAcrossVisitsTDMG", "CorrelationAcrossVisitsTDFamiliarQuestions", "CorrelationAcrossVisitsTDUnfamiliarQuestions"),
       )

HypothesisResultsChildLatenciesModel1 <- rbind(OverallLatencyThreeConditionsASD,
                                               OverallLatencyThreeConditionsTD,
                                               MGOverallLatencyASD,
                                               Q_F_OverallLatencyASD,
                                               Q_UF_OverallLatencyASD,
                                               MGOverallLatencyTDC,
                                               Q_F_OverallLatencyTDC,
                                               Q_UF_OverallLatencyTDC,
                                               BetaParameterASD_MG,
                                               BetaParameterASD_Q_F,
                                               BetaParameterASD_Q_UF,
                                               BetaParameterASD_Overall,
                                               BetaParameterTDC_MG,
                                               BetaParameterTDC_Q_F,
                                               BetaParameterTDC_Q_UF,
                                               BetaParameterTDC_Overall,
                                               OverallBetaParameterASDLowerTD,
                                               BetaParameterASDFasterTD_MG,
                                               BetaParameterASDFasterTD_Q_F,
                                               BetaParameterASDFasterTD_Q_UF,
                                               WithinGroupBetaParameterASD_MG_Slower_Q_F,
                                               WithinGroupBetaParameterTDC_MG_Slower_Q_F,
                                               DifferenceInDifferenceBetaParameterBetweenGroupsMGBiggerQ_F,
                                               WithinGroupBetaParameterASD_Q_F_Slower_Q_UF,
                                               WithinGroupBetaParameterTDC_Q_F_Slower_Q_UF,
                                               DifferenceInDifferenceBetaParameterBetweenGroupsFamiliarityBiggerUnfamiliarity,
                                               OverallLatencyThreeConditionsASDFasterTD,
                                               WithinASDGroupMGSlowerQuestionsFamiliar,
                                               WithinTDGroupMGSlowerQuestionsFamiliar,
                                               WithinAutismGroupQuestionsUnfamiliarSlowerFamiliar,
                                               WithinTDGroupQuestionsUnfamiliarSlowerFamiliar,
                                               WithinConditionsMatchingGameASDFasterTD,
                                               WithinConditionsQuestionsFamiliarASDFasterTD,
                                               WithinConditionsQuestionsUnfamiliarASDFasterTD,
                                               DifferenceInDifferenceBetweenGroupsUnfamiliarBiggerFamiliarity,
                                               DifferenceInDifferenceBetweenGroupsMGBiggerThanConversations,
                                               SubjectVariabilityASD,
                                               SubjectVariabilityTD,
                                               SubjectVariabilityASDSmallerThanTD,
                                               SubjectVariabilityASD_MG,
                                               SubjectVariabilityASD_Q_F,
                                               SubjectVariabilityASD_Q_UF,
                                               SubjectVariabilityTD_MG,
                                               SubjectVariabilityTD_Q_F,
                                               SubjectVariabilityTD_Q_UF,
                                               SubjectVariabilityASDSmallerThanTD_MG,
                                               SubjectVariabilityASDSmallerThanTD_Q_F,
                                               SubjectVariabilityASDSmallerThanTD_Q_UF,
                                               SubjectVariabilityASD_MG_SmallerThan_Q_F,
                                               SubjectVariabilityASD_Q_F_SmallerThan_Q_UF,
                                               SubjectVariabilityTDC_MG_SmallerThan_Q_F,
                                               SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF,
                                               DifferenceInDifferenceSubjectVariabilityUnfamiliarSmallerFamiliarity,
                                               DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions,
                                               VisitVariabilityASDMG,
                                               VisitVariabilityTDMG,
                                               VisitVariabilityASD_Q_F,
                                               VisitVariabilityTDC_Q_F,
                                               VisitVariabilityASD_Q_UF,
                                               VisitVariabilityTDC_Q_UF,
                                               VisitVariabilityASDOverall,
                                               VisitVariabilityTDCOverall,
                                               VisitVariabilityASDMGSlowerThanTDMG,
                                               VisitVariabilityASD_Q_F_SlowerThanTD_Q_F,
                                               VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF,
                                               VisitVariabilityASDOverallHigherTDSOverall,
                                               DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG,
                                               DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity,
                                               SigmaASDOverall,
                                               SigmaTDCOverall,
                                               SigmaASDOverallHigherTDSOverall,
                                               SigmaASDMG,
                                               SigmaTDMG,
                                               SigmaASD_Q_F,
                                               SigmaTDC_Q_F,
                                               SigmaASD_Q_UF,
                                               SigmaTDC_Q_UF,
                                               SigmaASDMGSlowerThanTDMG,
                                               SigmaASD_Q_F_SlowerThanTD_Q_F,
                                               SigmaASD_Q_UF_SlowerThanTD_Q_UF,
                                               SigmaASD_MG_VisitLowerZero,
                                               SigmaTDC_MG_VisitLowerZero,
                                               SigmaASD_MG_VisitLowerTDC,
                                               SigmaASD_Q_F_VisitLowerZero,
                                               SigmaTDC_Q_F_VisitLowerZero,
                                               SigmaASD_Q_F_VisitLowerTDC,
                                               SigmaASD_Q_UF_VisitLowerZero,
                                               SigmaTDC_Q_UF_VisitLowerZero,
                                               SigmaASD_Q_UF_VisitLowerTDC,
                                               SigmaASD_Overall_VisitLowerZero,
                                               SigmaTDC_Overall_VisitLowerZero,
                                               WithinGroupSigmaASD_Q_F_Lower_UF_Visit,
                                               WithinGroupSigmaTDC_Q_F_Lower_UF_Visit,
                                               WithinGroupSigmaASD_Q_F_Lower_MG_Visit,
                                               WithinGroupSigmaTDC_Q_F_Lower_MG_Visit,
                                               WithinGroupSigmaASD_Q_F_Faster_UF,
                                               WithinGroupSigmaTDC_Q_F_Faster_UF,
                                               WithinGroupSigmaASD_Q_F_Faster_MG,
                                               WithinGroupSigmaTDC_Q_F_Faster_MG,
                                               SigmaVisitOverall_ASDLowerTDC,
                                               DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF,
                                               DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F,
                                               DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity,
                                               DifferenceInDifferenceSigmaASDMGSmallerThanTDMG,
                                               CorrelationSummaryStatistics) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))


write.csv(HypothesisResultsChildLatenciesModel1, here('VBMTurnTakingFiles/stats_for_paper/model1_childnooverlaps_stats_for_paper.csv'))
```

### Visualisation of Model Estimates
```{r}
newdata <- subset(d, InterTurn == "Child2Adult") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) 

C2P_PredictedData <- as_tibble(predict(ChildLatency_m1_no, newdata = newdata)) %>%
  mutate(Visit = newdata$Visit) %>%
  mutate(Diagnosis = newdata$Diagnosis) %>%
  mutate(ID = newdata$ID) %>%
  mutate(Familiarity = newdata$Familiarity) %>%
  mutate(Task = newdata$Task) %>%
  mutate(size = Q97.5-Q2.5) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  group_by(Diagnosis, ID, Familiarity, Task) %>%
  dplyr::summarise(Estimate = mean(Estimate)) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

Posterior_df <- as_draws_df(ChildLatency_m1_no)

condition_posterior_TDC_MG <- Posterior_df[,"b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "MatchingGame",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_ASD_MG <- Posterior_df[,"b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "MatchingGame",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_TDC_Q_F <- Posterior_df[,"b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "Questions",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_ASD_Q_F <- Posterior_df[,"b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "Questions",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_TDC_Q_UF <- Posterior_df[,"b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar"] %>%
  mutate(Familiarity = "Unfamiliar",
         Task = "Questions",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent"))) 

condition_posterior_ASD_Q_UF <- Posterior_df[,"b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar"] %>%
  mutate(Familiarity = "Unfamiliar",
         Task = "Questions",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

posteriors <- rbind(condition_posterior_ASD_MG, condition_posterior_TDC_MG,
      condition_posterior_ASD_Q_F, condition_posterior_TDC_Q_F, 
      condition_posterior_ASD_Q_UF, condition_posterior_TDC_Q_UF)

Model1_Plot_Child_ConditionsNoOverlaps <- ggplot() +
  geom_rect(aes(xmin=-Inf, xmax = 1.47, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_rect(aes(xmin=1.47, xmax = 2.48, ymin=-Inf, ymax=Inf), fill = "honeydew3", alpha = 0.3) +
  geom_rect(aes(xmin=2.48, xmax = 3.6, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_boxplot(aes(Condition, Estimate, color = Diagnosis, fill = Diagnosis), filter(posteriors, Diagnosis == "Autism Group"), width = 0.05, color = "black", position = position_nudge(x = -0.30), alpha = 0.9, outliers = F, show.legend = T) +
  geom_boxplot(aes(Condition, Estimate, color = Diagnosis, fill = Diagnosis), filter(posteriors, Diagnosis == "Typical Development"), width = 0.05, color = "black", position = position_nudge(x = -0.10), alpha = 0.9, outliers = F, show.legend = T) +
  geom_point(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "#009E73", alpha = 0.7, data = filter(C2P_PredictedData, Diagnosis == "Autism Group"), size = 2, position = position_nudge(x = -.22)) + 
  geom_point(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "#CC79A7", alpha = 0.7, data = filter(C2P_PredictedData, Diagnosis == "Typical Development"), size = 2, position = position_nudge(x = -.18)) + 
  geom_half_violin(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "black", alpha = 0.9, data = filter(posteriors, Diagnosis == "Autism Group"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  geom_half_violin(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "black", alpha = 0.9, data = filter(posteriors, Diagnosis == "Typical Development"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  #scale_fill_okabeito() +
  #scale_color_okabeito() +
  xlab(' ') +
  coord_flip() +
  ylab('Average Child Response Latency (seconds)') +
  guides(color = guide_legend(reverse=TRUE), fill = guide_legend(reverse=TRUE)) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 15, color = "black"),
        legend.title = element_blank(),
        legend.position = c(0.25, 0.92),
        legend.key.size = unit(3, "lines"),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key = element_rect(fill = "transparent", color = NA),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 15, color = "black"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())
Model1_Plot_Child_ConditionsNoOverlaps
```

## RQ1, Adult Response Latencies across Different Conditions, No Overlaps
```{r, eval = F}
d_no_adult <- d %>% 
  subset(Latency > 0) %>%
  filter(InterTurn == "Adult2Child")

job::job({
  AdultLatency_m1_no <- brm(
    Latency_f1,
    d_no_adult,
    family = exgaussian,
    prior = priorChild_no,
    sample_prior = T,
    backend = "cmdstanr",
    iter = 3000,
    warmup = 500,
    init = 0,
    chains = 2,
    cores = 64,
    file = here("models", "AdultLatency_m1_noJuly.rds"),
    control = list(adapt_delta = 0.999, max_treedepth = 20),
    stan_model_args = list(stanc_options = list("O1"))
  )
})
```

### Hypothesis Tests
```{r}
# Overall Estimates in Autism Group
OverallLatencyThreeConditionsASD <- extract_relevant_data(AdultLatency_m1_no,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                      "OverallLatencyThreeConditionsASD")

MGOverallLatencyASD <- extract_relevant_data(AdultLatency_m1_no,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                      "MGOverallLatencyASD>0")

Q_F_OverallLatencyASD <- extract_relevant_data(AdultLatency_m1_no,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > 0",
                      "Q_F_OverallLatencyASD>0")

Q_UF_OverallLatencyASD <- extract_relevant_data(AdultLatency_m1_no,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > 0",
                      "Q_UF_OverallLatencyASD>0")

# Overall Estimates in TD Group
OverallLatencyThreeConditionsTD <- extract_relevant_data(AdultLatency_m1_no,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3 > 0",
                      "OverallLatencyThreeConditionsTD")

MGOverallLatencyTDC <- extract_relevant_data(AdultLatency_m1_no,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                      "MGOverallLatencyTDC>0")

Q_F_OverallLatencyTDC <- extract_relevant_data(AdultLatency_m1_no,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar > 0",
                      "Q_F_OverallLatencyTDC>0")

Q_UF_OverallLatencyTDC <- extract_relevant_data(AdultLatency_m1_no,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > 0",
                      "Q_UF_OverallLatencyTDC>0")

# Overall Differences between Autism Group and Typical Development Group
OverallLatencyThreeConditionsASDFasterTD <- extract_relevant_data(AdultLatency_m1_no,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 
                                <
                                (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3",
                      "OverallLatencyThreeConditionsASD<TD")


# Overall values for Beta parameter
BetaParameterASD_MG <- extract_relevant_nonlatency_data(AdultLatency_m1_no,
                 "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                 "BetaParameterASD_MG")

BetaParameterASD_Q_F <- extract_relevant_nonlatency_data(AdultLatency_m1_no,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < 0",
                 "BetaParameterASD_Q_F")

BetaParameterASD_Q_UF <- extract_relevant_nonlatency_data(AdultLatency_m1_no,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < 0",
                 "BetaParameterASD_Q_UF")

BetaParameterASD_Overall <- extract_relevant_nonlatency_data(AdultLatency_m1_no,
                 "(beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar +
                 beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar +
                 beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) / 3 < 0",
                 "BetaParameterASD_Overall")

# Differences, Typical Development Group with Long Pauses
BetaParameterTDC_MG <- extract_relevant_nonlatency_data(AdultLatency_m1_no,
                 "beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                 "BetaParameterTDC_MG")

BetaParameterTDC_Q_F <- extract_relevant_nonlatency_data(AdultLatency_m1_no,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar < 0",
                 "BetaParameterTDC_Q_F")

BetaParameterTDC_Q_UF <- extract_relevant_nonlatency_data(AdultLatency_m1_no,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar < 0",
                 "BetaParameterTDC_Q_UF")

BetaParameterTDC_Overall <- extract_relevant_nonlatency_data(AdultLatency_m1_no,
                 "(beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar +
                 beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +
                 beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3 < 0",
                 "BetaParameterTDC_Overall")

# Differences between Autism Group and Typical Development Group with Long Pauses
OverallBetaParameterASDLowerTD <- extract_relevant_nonlatency_data(AdultLatency_m1_no,
                 "(beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar + beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) / 3 < ((beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3)",
                 "OverallBetaParameterASD<TD")

BetaParameterASDFasterTD_MG <- extract_relevant_nonlatency_data(AdultLatency_m1_no,
                      "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                      "BetaParameter_ASD_MG<TD_MG")

BetaParameterASDFasterTD_Q_F <- extract_relevant_nonlatency_data(AdultLatency_m1_no,
                      "beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "BetaParameter_ASD_MG<TD_Q_F")

BetaParameterASDFasterTD_Q_UF <- extract_relevant_nonlatency_data(AdultLatency_m1_no,
                      "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                      "BetaParameter_ASD_MG<TD_Q_UF")

# Differences within Autism Group across Conditions:
WithinASDGroupMGSlowerQuestionsFamiliar <- extract_relevant_data(AdultLatency_m1_no,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                      "WithinASDGroupMG>QuestionsFamiliar")

# Differences within TD Group across Conditions:
WithinTDGroupMGSlowerQuestionsFamiliar <- extract_relevant_data(AdultLatency_m1_no,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinTDGroupMG>QuestionsFamiliar")

# Differences within Autism Group across Familiarity:
WithinAutismGroupQuestionsUnfamiliarSlowerFamiliar <- extract_relevant_data(AdultLatency_m1_no,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                      "WithinAutismGroupQuestionsUnfamiliar>Familiar")

# Differences within TD Group across Familiarity:
WithinTDGroupQuestionsUnfamiliarSlowerFamiliar <- extract_relevant_data(AdultLatency_m1_no,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinTDGroupQuestionsUnfamiliar>Familiar")

# Differences between Autism Group and Typical Development Group Within MatchingGame
WithinConditionsMatchingGameASDFasterTD <- extract_relevant_data(AdultLatency_m1_no,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                      "WithinConditionsMatchingGameASD<TD")

# Differences between Autism Group and Typical Development Group Within Familiar Questions:
WithinConditionsQuestionsFamiliarASDFasterTD <- extract_relevant_data(AdultLatency_m1_no,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinConditionsQuestionsFamiliarASD<TD")

# Differences between Autism Group and Typical Development Group Within Unfamiliar Questions:
WithinConditionsQuestionsUnfamiliarASDFasterTD <- extract_relevant_data(AdultLatency_m1_no,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                      "WithinConditionsQuestionsUnfamiliarASD<TD")

# Differences between Autism Group and Typical Development Group in Differences within Familiarity
DifferenceInDifferenceBetweenGroupsUnfamiliarBiggerFamiliarity <- extract_relevant_data(AdultLatency_m1_no,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) > 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                      "DifferenceInDifferenceBetweenGroupsUnfamiliar>Familiarity")

# Differences between Autism Group and Typical Development Group in Differences within Conditions
DifferenceInDifferenceBetweenGroupsMGBiggerThanConversations <- extract_relevant_data(AdultLatency_m1_no,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) > 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                      "DifferenceInDifferenceBetweenGroupsMG>Conversations")

# Overall Subject Variability in Autismm Group
SubjectVariabilityASD <- extract_relevant_sd_data(AdultLatency_m1_no, 
                                               "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisASD + TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD)/3 > 0",
                                               "SubjectVariabilityASD")

SubjectVariabilityASD_MG <- extract_relevant_sd_data(AdultLatency_m1_no, 
                                               "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_MG")

SubjectVariabilityASD_Q_F <- extract_relevant_sd_data(AdultLatency_m1_no, 
                                               "TaskQuestions:FamiliarityFamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_Q_F")

SubjectVariabilityASD_Q_UF <- extract_relevant_sd_data(AdultLatency_m1_no, 
                                               "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_Q_UF")

# Overall Subject Variability in TD Group
SubjectVariabilityTD <- extract_relevant_sd_data(AdultLatency_m1_no, 
                                               "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisTDC + TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC)/3 > 0",
                                               "SubjectVariabilityTD")

SubjectVariabilityTD_MG <- extract_relevant_sd_data(AdultLatency_m1_no, 
                                               "TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_MG")

SubjectVariabilityTD_Q_F <- extract_relevant_sd_data(AdultLatency_m1_no, 
                                               "TaskQuestions:FamiliarityFamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_Q_F")

SubjectVariabilityTD_Q_UF <- extract_relevant_sd_data(AdultLatency_m1_no, 
                                               "TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_Q_UF")

# Overall Subject Variability in TD Group
SubjectVariabilityASDSmallerThanTD <- extract_relevant_sd_data(AdultLatency_m1_no,
                                              "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisASD + TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD) / 3 <
                                              (TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisTDC + TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC) / 3",
                                               "SubjectVariabilityASD<TD")


SubjectVariabilityASDSmallerThanTD_MG <- extract_relevant_sd_data(AdultLatency_m1_no,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD  <
                                              TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_MG<TD_MG")

SubjectVariabilityASDSmallerThanTD_Q_F <- extract_relevant_sd_data(AdultLatency_m1_no,
                                              "TaskQuestions:FamiliarityFamiliar:DiagnosisASD  <
                                              TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_Q_F<TD_Q_F")

SubjectVariabilityASDSmallerThanTD_Q_UF <- extract_relevant_sd_data(AdultLatency_m1_no,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD  <
                                              TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_Q_UF<TD_Q_UF")

DifferenceInDifferenceSubjectVariabilityUnfamiliarSmallerFamiliarity <- extract_relevant_sd_data(AdultLatency_m1_no,
                                              "(TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD - TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC) 
                                              < 
                                              (TaskQuestions:FamiliarityFamiliar:DiagnosisASD - TaskQuestions:FamiliarityFamiliar:DiagnosisTDC)",
                                              "DifferenceInDifferenceSubjectVariabilityUnfamiliarBiggerFamiliarity")

DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions <- extract_relevant_sd_data(AdultLatency_m1_no,
                                              "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC - TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD) 
                                              < 
                                              (TaskQuestions:FamiliarityFamiliar:DiagnosisTDC - TaskQuestions:FamiliarityFamiliar:DiagnosisASD)",
                                              "DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions")

# Overall Visit Variability across visits in Autism Group
VisitVariabilityASDOverall <- extract_relevant_sdvisit_data(AdultLatency_m1_no, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                                               "VisitVariabilityASDOverall")

# Overall Visit Variability across visits in TD Group
VisitVariabilityTDCOverall <- extract_relevant_sdvisit_data(AdultLatency_m1_no, 
                                               "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                                               "VisitVariabilityTDCOverall")


VisitVariabilityASDOverallHigherTDSOverall <- extract_relevant_sdvisit_data(AdultLatency_m1_no, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 >
                                               (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3",
                                               "VisitVariabilityASDOverallLowerTDSOverall")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASDMG <- extract_relevant_sdvisit_data(AdultLatency_m1_no, 
                                               "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                                               "VisitVariabilityASDMG")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDMG <- extract_relevant_sdvisit_data(AdultLatency_m1_no, 
                                               "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                                               "VisitVariabilityTDMG")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASD_Q_F <- extract_relevant_sdvisit_data(AdultLatency_m1_no, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > 0",
                                               "VisitVariabilityASD_Q_F")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDC_Q_F <- extract_relevant_sdvisit_data(AdultLatency_m1_no, 
                                               "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar > 0",
                                               "VisitVariabilityTDC_Q_F")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASD_Q_UF <- extract_relevant_sdvisit_data(AdultLatency_m1_no, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > 0",
                                               "VisitVariabilityASD_Q_UF")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDC_Q_UF <- extract_relevant_sdvisit_data(AdultLatency_m1_no, 
                                               "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > 0",
                                               "VisitVariabilityTDC_Q_UF")

# Overall Subject Variability across visits, differences
VisitVariabilityASDMGSlowerThanTDMG <- extract_relevant_sdvisit_data(AdultLatency_m1_no, 
                                               "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar",
                                               "VisitVariabilityASDMG>TDMG")

# Overall Subject Variability across visits, differences
VisitVariabilityASD_Q_F_SlowerThanTD_Q_F <- extract_relevant_sdvisit_data(AdultLatency_m1_no, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                                               "VisitVariabilityASD_Q_F_SlowerThanTD_Q_F")

# Overall Subject Variability across visits, differences
VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF <- extract_relevant_sdvisit_data(AdultLatency_m1_no, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                                               "VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF")


#DifferenceInDifference:
DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity <- extract_relevant_sdvisit_data(AdultLatency_m1_no, 
                                               "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)
                                               < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity")

DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG <- extract_relevant_sdvisit_data(AdultLatency_m1_no, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)
                                               > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG")


# Overall Sigma Variability across visits in Autism Group
SigmaASDOverall <- extract_relevant_sigma_data(AdultLatency_m1_no, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 < 0",
                                               "SigmaASDOverall")

# Overall Sigma Variability across visits in TD Group
SigmaTDCOverall <- extract_relevant_sigma_data(AdultLatency_m1_no, 
                                               "(sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) /3 < 0",
                                               "SigmaTDCOverall")


SigmaASDOverallHigherTDSOverall <- extract_relevant_nonlatency_data(AdultLatency_m1_no, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 <
                                               (sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3",
                                               "SigmaASDOverallHigherTDSOverall")

# Subject Variability across visits MG in Autism Group
SigmaASDMG <- extract_relevant_sigma_data(AdultLatency_m1_no, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < 0",
                                               "SigmaASDMG")

# Overall Subject Variability across visits in TD Group
SigmaTDMG <- extract_relevant_sigma_data(AdultLatency_m1_no, 
                                               "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < 0",
                                               "SigmaTDMG")

# Subject Variability across visits MG in Autism Group
SigmaASD_Q_F <- extract_relevant_sigma_data(AdultLatency_m1_no, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < 0",
                                               "SigmaASD_Q_F")

# Overall Subject Variability across visits in TD Group
SigmaTDC_Q_F <- extract_relevant_sigma_data(AdultLatency_m1_no, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar < 0",
                                               "SigmaTDC_Q_F")


# Subject Variability across visits MG in Autism Group
SigmaASD_Q_UF <- extract_relevant_sigma_data(AdultLatency_m1_no, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < 0 ",
                                               "SigmaASD_Q_UF")

# Overall Subject Variability across visits in TD Group
SigmaTDC_Q_UF <- extract_relevant_sigma_data(AdultLatency_m1_no, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar < 0",
                                               "SigmaTDC_Q_UF")

# Overall Subject Variability across visits, differences
SigmaASDMGSlowerThanTDMG <- extract_relevant_nonlatency_data(AdultLatency_m1_no, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                                               "SigmaASDMGSlowerThanTDMG")

# Overall Subject Variability across visits, differences
SigmaASD_Q_F_SlowerThanTD_Q_F <- extract_relevant_nonlatency_data(AdultLatency_m1_no, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                                               "SigmaASD_Q_F_SlowerThanTD_Q_F")

# Overall Subject Variability across visits, differences
SigmaASD_Q_UF_SlowerThanTD_Q_UF <- extract_relevant_nonlatency_data(AdultLatency_m1_no, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                                               "SigmaASD_Q_UF_SlowerThanTD_Q_UF")

#DifferenceInDifference:
DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity <- extract_relevant_nonlatency_data(AdultLatency_m1_no, 
                                               "(sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)
                                               < (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity")

DifferenceInDifferenceSigmaASDMGSmallerThanTDMG <- extract_relevant_nonlatency_data(AdultLatency_m1_no, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)
                                               > (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceSigmaASDMGSmallerThanTDMG")


# Correlation Estimates across visits in Autism Group
post <- as_draws_df(AdultLatency_m1_no)


# Apply the function for each case
cor_post_mu_MG_ASD <- Visitextract_and_rename(post, "DiagnosisASD", "TaskMatchingGame", "FamiliarityFamiliar")
cor_post_mu_MG_TDC <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskMatchingGame", "FamiliarityFamiliar")

cor_post_mu_Q_ASD_Familiar <- Visitextract_and_rename(post, "DiagnosisASD", "TaskQuestions", "FamiliarityFamiliar") %>%
  select(Visit2, Visit4, Visit6)

cor_post_mu_Q_TDC_Familiar <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskQuestions", "FamiliarityFamiliar") %>%
  select(Visit2, Visit4, Visit6)

cor_post_mu_Q_ASD_Unfamiliar <- Visitextract_and_rename(post, "DiagnosisASD", "TaskQuestions", "FamiliarityUnfamiliar") %>%
  select(Visit1, Visit3, Visit5, Visit7)

cor_post_mu_Q_TDC_Unfamiliar <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskQuestions", "FamiliarityUnfamiliar") %>%
  select(Visit1, Visit3, Visit5, Visit7)


CorrelationSummaryStatistics <- tibble(
       Estimate = c(mean(cor(cor_post_mu_MG_ASD)), mean(cor(cor_post_mu_Q_ASD_Familiar)), mean(cor(cor_post_mu_Q_ASD_Unfamiliar)), 
                    mean(cor(cor_post_mu_MG_TDC)), mean(cor(cor_post_mu_Q_TDC_Familiar)), mean(cor(cor_post_mu_Q_TDC_Unfamiliar))),
       CI.Lower = c(quantile(cor(cor_post_mu_MG_ASD), probs = 0.025), quantile(cor(cor_post_mu_Q_ASD_Familiar), probs = 0.025), quantile(cor(cor_post_mu_Q_ASD_Unfamiliar), probs = 0.025), 
                    quantile(cor(cor_post_mu_MG_TDC), probs = 0.025), quantile(cor(cor_post_mu_Q_TDC_Familiar), probs = 0.025), quantile(cor(cor_post_mu_Q_TDC_Unfamiliar), probs = 0.025)),
       CI.Upper = c(quantile(cor(cor_post_mu_MG_ASD), probs = 0.975), quantile(cor(cor_post_mu_Q_ASD_Familiar), probs = 0.975), quantile(cor(cor_post_mu_Q_ASD_Unfamiliar), probs = 0.975), 
                    quantile(cor(cor_post_mu_MG_TDC), probs = 0.975), quantile(cor(cor_post_mu_Q_TDC_Familiar), probs = 0.975), quantile(cor(cor_post_mu_Q_TDC_Unfamiliar), probs = 0.975)),
       Evid.Ratio = c(NA, NA, NA, NA, NA, NA),
       TestDescription = c(
  "CorrelationAcrossVisitsASDMG", "CorrelationAcrossVisitsASDFamiliarQuestions", "CorrelationAcrossVisitsASDUnfamiliarQuestions",
  "CorrelationAcrossVisitsTDMG", "CorrelationAcrossVisitsTDFamiliarQuestions", "CorrelationAcrossVisitsTDUnfamiliarQuestions"),
       )

HypothesisResultsAdultLatenciesModel1 <- rbind(OverallLatencyThreeConditionsASD,
                                               OverallLatencyThreeConditionsTD,
                                               MGOverallLatencyASD,
                                               Q_F_OverallLatencyASD,
                                               Q_UF_OverallLatencyASD,
                                               MGOverallLatencyTDC,
                                               Q_F_OverallLatencyTDC,
                                               Q_UF_OverallLatencyTDC,
                                               BetaParameterASD_MG,
                                               BetaParameterASD_Q_F,
                                               BetaParameterASD_Q_UF,
                                               BetaParameterASD_Overall,
                                               BetaParameterTDC_MG,
                                               BetaParameterTDC_Q_F,
                                               BetaParameterTDC_Q_UF,
                                               BetaParameterTDC_Overall,
                                               OverallBetaParameterASDLowerTD,
                                               BetaParameterASDFasterTD_MG,
                                               BetaParameterASDFasterTD_Q_F,
                                               BetaParameterASDFasterTD_Q_UF,
                                               OverallLatencyThreeConditionsASDFasterTD,
                                               WithinASDGroupMGSlowerQuestionsFamiliar,
                                               WithinTDGroupMGSlowerQuestionsFamiliar,
                                               WithinAutismGroupQuestionsUnfamiliarSlowerFamiliar,
                                               WithinTDGroupQuestionsUnfamiliarSlowerFamiliar,
                                               WithinConditionsMatchingGameASDFasterTD,
                                               WithinConditionsQuestionsFamiliarASDFasterTD,
                                               WithinConditionsQuestionsUnfamiliarASDFasterTD,
                                               DifferenceInDifferenceBetweenGroupsUnfamiliarBiggerFamiliarity,
                                               DifferenceInDifferenceBetweenGroupsMGBiggerThanConversations,
                                               SubjectVariabilityASD,
                                               SubjectVariabilityTD,
                                               SubjectVariabilityASDSmallerThanTD,
                                               SubjectVariabilityASD_MG,
                                               SubjectVariabilityASD_Q_F,
                                               SubjectVariabilityASD_Q_UF,
                                               SubjectVariabilityTD_MG,
                                               SubjectVariabilityTD_Q_F,
                                               SubjectVariabilityTD_Q_UF,
                                               SubjectVariabilityASDSmallerThanTD_MG,
                                               SubjectVariabilityASDSmallerThanTD_Q_F,
                                               SubjectVariabilityASDSmallerThanTD_Q_UF,
                                               DifferenceInDifferenceSubjectVariabilityUnfamiliarSmallerFamiliarity,
                                               DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions,
                                               VisitVariabilityASDMG,
                                               VisitVariabilityTDMG,
                                               VisitVariabilityASD_Q_F,
                                               VisitVariabilityTDC_Q_F,
                                               VisitVariabilityASD_Q_UF,
                                               VisitVariabilityTDC_Q_UF,
                                               VisitVariabilityASDOverall,
                                               VisitVariabilityTDCOverall,
                                               VisitVariabilityASDMGSlowerThanTDMG,
                                               VisitVariabilityASD_Q_F_SlowerThanTD_Q_F,
                                               VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF,
                                               VisitVariabilityASDOverallHigherTDSOverall,
                                               DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG,
                                               DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity,
                                               SigmaASDOverall,
                                               SigmaTDCOverall,
                                               SigmaASDOverallHigherTDSOverall,
                                               SigmaASDMG,
                                               SigmaTDMG,
                                               SigmaASD_Q_F,
                                               SigmaTDC_Q_F,
                                               SigmaASD_Q_UF,
                                               SigmaTDC_Q_UF,
                                               SigmaASDMGSlowerThanTDMG,
                                               SigmaASD_Q_F_SlowerThanTD_Q_F,
                                               SigmaASD_Q_UF_SlowerThanTD_Q_UF,
                                               DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity,
                                               DifferenceInDifferenceSigmaASDMGSmallerThanTDMG,
                                               CorrelationSummaryStatistics) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(HypothesisResultsAdultLatenciesModel1, here("VBMTurnTakingFiles", 'stats_for_paper/model1_adultnooverlaps_stats_for_paper.csv'))
```

### Visualisation of Model Estimates
```{r}
newdata <- subset(d, InterTurn == "Adult2Child") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) 

C2P_PredictedData <- as_tibble(predict(AdultLatency_m1_no, newdata = newdata)) %>%
  mutate(Visit = newdata$Visit) %>%
  mutate(Diagnosis = newdata$Diagnosis) %>%
  mutate(ID = newdata$ID) %>%
  mutate(Familiarity = newdata$Familiarity) %>%
  mutate(Task = newdata$Task) %>%
  mutate(size = Q97.5-Q2.5) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  group_by(Diagnosis, ID, Familiarity, Task) %>%
  dplyr::summarise(Estimate = mean(Estimate)) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

Posterior_df <- as_draws_df(AdultLatency_m1_no)

condition_posterior_TDC_MG <- Posterior_df[,"b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "MatchingGame",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_ASD_MG <- Posterior_df[,"b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "MatchingGame",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_TDC_Q_F <- Posterior_df[,"b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "Questions",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_ASD_Q_F <- Posterior_df[,"b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "Questions",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_TDC_Q_UF <- Posterior_df[,"b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar"] %>%
  mutate(Familiarity = "Unfamiliar",
         Task = "Questions",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent"))) 

condition_posterior_ASD_Q_UF <- Posterior_df[,"b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar"] %>%
  mutate(Familiarity = "Unfamiliar",
         Task = "Questions",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

posteriors <- rbind(condition_posterior_ASD_MG, condition_posterior_TDC_MG,
      condition_posterior_ASD_Q_F, condition_posterior_TDC_Q_F, 
      condition_posterior_ASD_Q_UF, condition_posterior_TDC_Q_UF)

Model1_Plot_Adult_ConditionsNoOverlaps <- ggplot() +
  geom_rect(aes(xmin=-Inf, xmax = 1.47, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_rect(aes(xmin=1.47, xmax = 2.48, ymin=-Inf, ymax=Inf), fill = "honeydew3", alpha = 0.3) +
  geom_rect(aes(xmin=2.48, xmax = 3.6, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_boxplot(aes(Condition, Estimate, color = Diagnosis, fill = Diagnosis), filter(posteriors, Diagnosis == "Autism Group"), width = 0.05, color = "black", position = position_nudge(x = -0.30), alpha = 0.9, outliers = F, show.legend = T) +
  geom_boxplot(aes(Condition, Estimate, color = Diagnosis, fill = Diagnosis), filter(posteriors, Diagnosis == "Typical Development"), width = 0.05, color = "black", position = position_nudge(x = -0.10), alpha = 0.9, outliers = F, show.legend = T) +
  geom_point(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "#009E73", alpha = 0.7, data = filter(C2P_PredictedData, Diagnosis == "Autism Group"), size = 2, position = position_nudge(x = -.22)) + 
  geom_point(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "#CC79A7", alpha = 0.7, data = filter(C2P_PredictedData, Diagnosis == "Typical Development"), size = 2, position = position_nudge(x = -.18)) + 
  geom_half_violin(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "black", alpha = 0.9, data = filter(posteriors, Diagnosis == "Autism Group"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  geom_half_violin(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "black", alpha = 0.9, data = filter(posteriors, Diagnosis == "Typical Development"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  #scale_fill_okabeito() +
  #scale_color_okabeito() +
  xlab(' ') +
  coord_flip() +
  ylab('Average Adult Response Latency (seconds)') +
  guides(color = guide_legend(reverse=TRUE), fill = guide_legend(reverse=TRUE)) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 15, color = "black"),
        legend.title = element_blank(),
        legend.position = c(0.25, 0.92),
        legend.key.size = unit(3, "lines"),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key = element_rect(fill = "transparent", color = NA),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 15, color = "black"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())
Model1_Plot_Adult_ConditionsNoOverlaps
```


## RQ1: Run Model without Sigma and Beta
```{r, eval = FALSE}
Latency_f1 <- bf(
  Latency ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task:Familiarity | r | Visit))

priorChild <- c(
  prior(normal(1, 1), class = b),
  prior(normal(0, 0.3), class = sd),
  prior(normal(0, 1), class = beta),
  prior(normal(0, 1), class = sigma),
  prior(lkj(2), class = cor)
)

job::job({
  ChildLatency_m1_no_sigma_no_beta <- brm(
    Latency_f1,
    data = subset(d, InterTurn == "Child2Adult"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = T,
    backend = "cmdstanr",
    iter = 3000,
    warmup = 500,
    init = 0,
    chains = 2,
    cores = 64,
    file = here("VBMTurnTakingFiles", "models","ChildLatency_m1_sigma_Visit_v1_finalJuly_no_sigma_no_beta"),
    control = list(adapt_delta = 0.99, max_treedepth = 20),
    stan_model_args = list(stanc_options = list("O1")))
})

pp_check(ChildLatency_m1_no_sigma_no_beta, ndraws = 100)
```

### Hypothesis Tests
```{r}
# Overall Estimates in Autism Group
OverallLatencyThreeConditionsASD <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                      "OverallLatencyThreeConditionsASD")

MGOverallLatencyASD <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                      "MGOverallLatencyASD>0")

Q_F_OverallLatencyASD <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > 0",
                      "Q_F_OverallLatencyASD>0")

Q_UF_OverallLatencyASD <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > 0",
                      "Q_UF_OverallLatencyASD>0")

# Overall Estimates in TD Group
OverallLatencyThreeConditionsTD <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3 > 0",
                      "OverallLatencyThreeConditionsTD")

MGOverallLatencyTDC <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                      "MGOverallLatencyTDC>0")

Q_F_OverallLatencyTDC <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar > 0",
                      "Q_F_OverallLatencyTDC>0")

Q_UF_OverallLatencyTDC <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > 0",
                      "Q_UF_OverallLatencyTDC>0")

# Overall Differences between Autism Group and Typical Development Group
OverallLatencyThreeConditionsASDFasterTD <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 
                                <
                                (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3",
                      "OverallLatencyThreeConditionsASD<TD")

# Differences within Autism Group across Conditions:
WithinASDGroupMGSlowerQuestionsFamiliar <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                      "WithinASDGroupMG>QuestionsFamiliar")

# Differences within TD Group across Conditions:
WithinTDGroupMGSlowerQuestionsFamiliar <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinTDGroupMG>QuestionsFamiliar")

# Differences within Autism Group across Familiarity:
WithinAutismGroupQuestionsUnfamiliarSlowerFamiliar <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                      "WithinAutismGroupQuestionsUnfamiliar>Familiar")

# Differences within TD Group across Familiarity:
WithinTDGroupQuestionsUnfamiliarSlowerFamiliar <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinTDGroupQuestionsUnfamiliar>Familiar")

# Differences between Autism Group and Typical Development Group Within MatchingGame
WithinConditionsMatchingGameASDFasterTD <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                      "WithinConditionsMatchingGameASD<TD")

# Differences between Autism Group and Typical Development Group Within Familiar Questions:
WithinConditionsQuestionsFamiliarASDFasterTD <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinConditionsQuestionsFamiliarASD<TD")

# Differences between Autism Group and Typical Development Group Within Unfamiliar Questions:
WithinConditionsQuestionsUnfamiliarASDFasterTD <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                      "WithinConditionsQuestionsUnfamiliarASD<TD")

# Differences between Autism Group and Typical Development Group in Differences within Familiarity
DifferenceInDifferenceBetweenGroupsUnfamiliarBiggerFamiliarity <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) < 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                      "DifferenceInDifferenceBetweenGroupsUnfamiliar>Familiarity")

# Differences between Autism Group and Typical Development Group in Differences within Conditions
DifferenceInDifferenceBetweenGroupsMGBiggerThanConversations <- extract_relevant_data(ChildLatency_m1_no_sigma_no_beta,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) > 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                      "DifferenceInDifferenceBetweenGroupsMG>Conversations")

# Overall Subject Variability in Autismm Group
SubjectVariabilityASD <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisASD + TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD)/3 > 0",
                                               "SubjectVariabilityASD")

SubjectVariabilityASD_MG <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_MG")

SubjectVariabilityASD_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "TaskQuestions:FamiliarityFamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_Q_F")

SubjectVariabilityASD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_Q_UF")

# Overall Subject Variability in TD Group
SubjectVariabilityTD <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisTDC + TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC)/3 > 0",
                                               "SubjectVariabilityTD")

SubjectVariabilityTD_MG <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_MG")

SubjectVariabilityTD_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "TaskQuestions:FamiliarityFamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_Q_F")

SubjectVariabilityTD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_Q_UF")

# Overall Subject Variability in TD Group
SubjectVariabilityASDSmallerThanTD <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta,
                                              "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisASD + TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD) / 3 <
                                              (TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisTDC + TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC) / 3",
                                               "SubjectVariabilityASD<TD")


SubjectVariabilityASDSmallerThanTD_MG <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD  <
                                              TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_MG<TD_MG")

SubjectVariabilityASDSmallerThanTD_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta,
                                              "TaskQuestions:FamiliarityFamiliar:DiagnosisASD  <
                                              TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_Q_F<TD_Q_F")

SubjectVariabilityASDSmallerThanTD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD  <
                                              TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_Q_UF<TD_Q_UF")

SubjectVariabilityASD_MG_SmallerThan_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD > TaskQuestions:FamiliarityFamiliar:DiagnosisASD",
                                               "SubjectVariabilityASD_MG_SmallerThan_Q_F")

SubjectVariabilityASD_Q_F_SmallerThan_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD > TaskQuestions:FamiliarityFamiliar:DiagnosisASD",
                                               "SubjectVariabilityASD_Q_F_SmallerThan_Q_UF")

SubjectVariabilityTDC_MG_SmallerThan_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC < TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityTDC_MG_SmallerThan_Q_F")

SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC > TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF")

DifferenceInDifferenceSubjectVariabilityUnfamiliarSmallerFamiliarity <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta,
                                              "(TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD - TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC) 
                                              < 
                                              (TaskQuestions:FamiliarityFamiliar:DiagnosisASD - TaskQuestions:FamiliarityFamiliar:DiagnosisTDC)",
                                              "DifferenceInDifferenceSubjectVariabilityUnfamiliarBiggerFamiliarity")

DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions <- extract_relevant_sd_data(ChildLatency_m1_no_sigma_no_beta,
                                              "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC - TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD) 
                                              < 
                                              (TaskQuestions:FamiliarityFamiliar:DiagnosisTDC - TaskQuestions:FamiliarityFamiliar:DiagnosisASD)",
                                              "DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions")

# Overall Visit Variability across visits in Autism Group
VisitVariabilityASDOverall <- extract_relevant_sdvisit_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                                               "VisitVariabilityASDOverall")

# Overall Visit Variability across visits in TD Group
VisitVariabilityTDCOverall <- extract_relevant_sdvisit_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                                               "VisitVariabilityTDCOverall")


VisitVariabilityASDOverallHigherTDSOverall <- extract_relevant_sdvisit_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 >
                                               (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3",
                                               "VisitVariabilityASDOverallLowerTDSOverall")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                                               "VisitVariabilityASDMG")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                                               "VisitVariabilityTDMG")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASD_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > 0",
                                               "VisitVariabilityASD_Q_F")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDC_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar > 0",
                                               "VisitVariabilityTDC_Q_F")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASD_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > 0",
                                               "VisitVariabilityASD_Q_UF")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDC_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > 0",
                                               "VisitVariabilityTDC_Q_UF")

# Overall Subject Variability across visits, differences
VisitVariabilityASDMGSlowerThanTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar",
                                               "VisitVariabilityASDMG>TDMG")

# Overall Subject Variability across visits, differences
VisitVariabilityASD_Q_F_SlowerThanTD_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                                               "VisitVariabilityASD_Q_F_SlowerThanTD_Q_F")

# Overall Subject Variability across visits, differences
VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                                               "VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF")

#DifferenceInDifference:
DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity <- extract_relevant_sdvisit_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)
                                               < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity")

DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_no_sigma_no_beta, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)
                                               > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG")


# Correlation Estimates across visits in Autism Group
post <- as_draws_df(ChildLatency_m1_no_sigma_no_beta)


# Apply the function for each case
cor_post_mu_MG_ASD <- Visitextract_and_rename(post, "DiagnosisASD", "TaskMatchingGame", "FamiliarityFamiliar") %>%
  cor() %>%
  as.matrix()

cor_post_mu_MG_TDC <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskMatchingGame", "FamiliarityFamiliar") %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_ASD_Familiar <- Visitextract_and_rename(post, "DiagnosisASD", "TaskQuestions", "FamiliarityFamiliar") %>%
  select(Visit2, Visit4, Visit6) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_TDC_Familiar <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskQuestions", "FamiliarityFamiliar") %>%
  select(Visit2, Visit4, Visit6) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_ASD_Unfamiliar <- Visitextract_and_rename(post, "DiagnosisASD", "TaskQuestions", "FamiliarityUnfamiliar") %>%
  select(Visit1, Visit3, Visit5, Visit7) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_TDC_Unfamiliar <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskQuestions", "FamiliarityUnfamiliar") %>%
  select(Visit1, Visit3, Visit5, Visit7) %>%
  cor() %>%
  as.matrix()

diag(cor_post_mu_MG_ASD) <- NA
diag(cor_post_mu_MG_TDC) <- NA
diag(cor_post_mu_Q_ASD_Familiar) <- NA
diag(cor_post_mu_Q_TDC_Familiar) <- NA
diag(cor_post_mu_Q_ASD_Unfamiliar) <- NA
diag(cor_post_mu_Q_TDC_Unfamiliar) <- NA

CorrelationSummaryStatistics <- tibble(
       Estimate = c(mean(cor_post_mu_MG_ASD, na.rm = TRUE), mean(cor_post_mu_Q_ASD_Familiar, na.rm = TRUE), mean(cor_post_mu_Q_ASD_Unfamiliar, na.rm = TRUE), 
                    mean(cor_post_mu_MG_TDC, na.rm = TRUE), mean(cor_post_mu_Q_TDC_Familiar, na.rm = TRUE), mean(cor_post_mu_Q_TDC_Unfamiliar, na.rm = TRUE)),
       CI.Lower = c(quantile(cor_post_mu_MG_ASD, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Familiar, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Unfamiliar, probs = 0.025, na.rm = TRUE), 
                    quantile(cor_post_mu_MG_TDC, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Familiar, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Unfamiliar, probs = 0.025, na.rm = TRUE)),
       CI.Upper = c(quantile(cor_post_mu_MG_ASD, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Familiar, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Unfamiliar, probs = 0.975, na.rm = TRUE), 
                    quantile(cor_post_mu_MG_TDC, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Familiar, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Unfamiliar, probs = 0.975, na.rm = TRUE)),
       Evid.Ratio = c(NA, NA, NA, NA, NA, NA),
       TestDescription = c(
  "CorrelationAcrossVisitsASDMG", "CorrelationAcrossVisitsASDFamiliarQuestions", "CorrelationAcrossVisitsASDUnfamiliarQuestions",
  "CorrelationAcrossVisitsTDMG", "CorrelationAcrossVisitsTDFamiliarQuestions", "CorrelationAcrossVisitsTDUnfamiliarQuestions"),
       )

HypothesisResultsChildLatenciesModel1 <- rbind(OverallLatencyThreeConditionsASD,
                                               OverallLatencyThreeConditionsTD,
                                               MGOverallLatencyASD,
                                               Q_F_OverallLatencyASD,
                                               Q_UF_OverallLatencyASD,
                                               MGOverallLatencyTDC,
                                               Q_F_OverallLatencyTDC,
                                               Q_UF_OverallLatencyTDC,
                                               OverallLatencyThreeConditionsASDFasterTD,
                                               WithinASDGroupMGSlowerQuestionsFamiliar,
                                               WithinTDGroupMGSlowerQuestionsFamiliar,
                                               WithinAutismGroupQuestionsUnfamiliarSlowerFamiliar,
                                               WithinTDGroupQuestionsUnfamiliarSlowerFamiliar,
                                               WithinConditionsMatchingGameASDFasterTD,
                                               WithinConditionsQuestionsFamiliarASDFasterTD,
                                               WithinConditionsQuestionsUnfamiliarASDFasterTD,
                                               DifferenceInDifferenceBetweenGroupsUnfamiliarBiggerFamiliarity,
                                               DifferenceInDifferenceBetweenGroupsMGBiggerThanConversations,
                                               SubjectVariabilityASD,
                                               SubjectVariabilityTD,
                                               SubjectVariabilityASDSmallerThanTD,
                                               SubjectVariabilityASD_MG,
                                               SubjectVariabilityASD_Q_F,
                                               SubjectVariabilityASD_Q_UF,
                                               SubjectVariabilityTD_MG,
                                               SubjectVariabilityTD_Q_F,
                                               SubjectVariabilityTD_Q_UF,
                                               SubjectVariabilityASDSmallerThanTD_MG,
                                               SubjectVariabilityASDSmallerThanTD_Q_F,
                                               SubjectVariabilityASDSmallerThanTD_Q_UF,
                                               SubjectVariabilityASD_MG_SmallerThan_Q_F,
                                               SubjectVariabilityASD_Q_F_SmallerThan_Q_UF,
                                               SubjectVariabilityTDC_MG_SmallerThan_Q_F,
                                               SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF,
                                               DifferenceInDifferenceSubjectVariabilityUnfamiliarSmallerFamiliarity,
                                               DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions,
                                               VisitVariabilityASDMG,
                                               VisitVariabilityTDMG,
                                               VisitVariabilityASD_Q_F,
                                               VisitVariabilityTDC_Q_F,
                                               VisitVariabilityASD_Q_UF,
                                               VisitVariabilityTDC_Q_UF,
                                               VisitVariabilityASDOverall,
                                               VisitVariabilityTDCOverall,
                                               VisitVariabilityASDMGSlowerThanTDMG,
                                               VisitVariabilityASD_Q_F_SlowerThanTD_Q_F,
                                               VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF,
                                               VisitVariabilityASDOverallHigherTDSOverall,
                                               DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG,
                                               DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity,
                                               CorrelationSummaryStatistics) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))


write.csv(HypothesisResultsChildLatenciesModel1, here('VBMTurnTakingFiles/stats_for_paper/model1_child_no_beta_no_sigma_stats_for_paper.csv'))
```

## RQ1: Run Model without Beta but With Sigma
```{r, eval = FALSE}
Latency_f1 <- bf(
  Latency ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task:Familiarity | r | Visit), 
  sigma ~ 0 + Diagnosis:Task:Familiarity + Diagnosis:Task:Familiarity:Visit +
    (0 + Task:Familiarity:Visit | p | gr(ID, by = Diagnosis)))

priorChild <- c(
  prior(normal(1, 1), class = b),
  prior(normal(0, 0.3), class = sd),
  prior(normal(0, 1), class = beta),
  prior(normal(0, 1), class = b, dpar = sigma),
  prior(normal(0, 0.1), class = sd, dpar = sigma),
  prior(lkj(2), class = cor)
)

job::job({
  ChildLatency_m1_no_beta_with_sigma <- brm(
    Latency_f1,
    data = subset(d, InterTurn == "Child2Adult"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = T,
    backend = "cmdstanr",
    iter = 3000,
    warmup = 500,
    init = 0,
    chains = 2,
    cores = 64,
    file = here("models","ChildLatency_m1_sigma_Visit_v1_finalJulyJuly_no_beta"),
    control = list(adapt_delta = 0.99, max_treedepth = 20),
    stan_model_args = list(stanc_options = list("O1")))
})
pp_check(ChildLatency_m1_no_beta_with_sigma, ndraws = 100)
```

### Hypothesis Tests
```{r}
# Overall Estimates in Autism Group
OverallLatencyThreeConditionsASD <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                      "OverallLatencyThreeConditionsASD")

MGOverallLatencyASD <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                      "MGOverallLatencyASD>0")

Q_F_OverallLatencyASD <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > 0",
                      "Q_F_OverallLatencyASD>0")

Q_UF_OverallLatencyASD <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > 0",
                      "Q_UF_OverallLatencyASD>0")

# Overall Estimates in TD Group
OverallLatencyThreeConditionsTD <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3 > 0",
                      "OverallLatencyThreeConditionsTD")

MGOverallLatencyTDC <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                      "MGOverallLatencyTDC>0")

Q_F_OverallLatencyTDC <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar > 0",
                      "Q_F_OverallLatencyTDC>0")

Q_UF_OverallLatencyTDC <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > 0",
                      "Q_UF_OverallLatencyTDC>0")

# Overall Differences between Autism Group and Typical Development Group
OverallLatencyThreeConditionsASDFasterTD <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 
                                <
                                (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3",
                      "OverallLatencyThreeConditionsASD<TD")

# Differences within Autism Group across Conditions:
WithinASDGroupMGSlowerQuestionsFamiliar <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                      "WithinASDGroupMG>QuestionsFamiliar")

# Differences within TD Group across Conditions:
WithinTDGroupMGSlowerQuestionsFamiliar <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinTDGroupMG>QuestionsFamiliar")

# Differences within Autism Group across Familiarity:
WithinAutismGroupQuestionsUnfamiliarSlowerFamiliar <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                      "WithinAutismGroupQuestionsUnfamiliar>Familiar")

# Differences within TD Group across Familiarity:
WithinTDGroupQuestionsUnfamiliarSlowerFamiliar <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinTDGroupQuestionsUnfamiliar>Familiar")

# Differences between Autism Group and Typical Development Group Within MatchingGame
WithinConditionsMatchingGameASDFasterTD <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                      "WithinConditionsMatchingGameASD<TD")

# Differences between Autism Group and Typical Development Group Within Familiar Questions:
WithinConditionsQuestionsFamiliarASDFasterTD <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinConditionsQuestionsFamiliarASD<TD")

# Differences between Autism Group and Typical Development Group Within Unfamiliar Questions:
WithinConditionsQuestionsUnfamiliarASDFasterTD <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                      "WithinConditionsQuestionsUnfamiliarASD<TD")

# Differences between Autism Group and Typical Development Group in Differences within Familiarity
DifferenceInDifferenceBetweenGroupsUnfamiliarBiggerFamiliarity <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) < 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                      "DifferenceInDifferenceBetweenGroupsUnfamiliar>Familiarity")

# Differences between Autism Group and Typical Development Group in Differences within Conditions
DifferenceInDifferenceBetweenGroupsMGBiggerThanConversations <- extract_relevant_data(ChildLatency_m1_no_beta_with_sigma,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) > 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                      "DifferenceInDifferenceBetweenGroupsMG>Conversations")

# Overall Subject Variability in Autismm Group
SubjectVariabilityASD <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisASD + TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD)/3 > 0",
                                               "SubjectVariabilityASD")

SubjectVariabilityASD_MG <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_MG")

SubjectVariabilityASD_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "TaskQuestions:FamiliarityFamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_Q_F")

SubjectVariabilityASD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_Q_UF")

# Overall Subject Variability in TD Group
SubjectVariabilityTD <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisTDC + TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC)/3 > 0",
                                               "SubjectVariabilityTD")

SubjectVariabilityTD_MG <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_MG")

SubjectVariabilityTD_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "TaskQuestions:FamiliarityFamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_Q_F")

SubjectVariabilityTD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_Q_UF")

# Overall Subject Variability in TD Group
SubjectVariabilityASDSmallerThanTD <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma,
                                              "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisASD + TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD) / 3 <
                                              (TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisTDC + TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC) / 3",
                                               "SubjectVariabilityASD<TD")


SubjectVariabilityASDSmallerThanTD_MG <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD  <
                                              TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_MG<TD_MG")

SubjectVariabilityASDSmallerThanTD_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma,
                                              "TaskQuestions:FamiliarityFamiliar:DiagnosisASD  <
                                              TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_Q_F<TD_Q_F")

SubjectVariabilityASDSmallerThanTD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD  <
                                              TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_Q_UF<TD_Q_UF")

SubjectVariabilityASD_MG_SmallerThan_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD > TaskQuestions:FamiliarityFamiliar:DiagnosisASD",
                                               "SubjectVariabilityASD_MG_SmallerThan_Q_F")

SubjectVariabilityASD_Q_F_SmallerThan_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD > TaskQuestions:FamiliarityFamiliar:DiagnosisASD",
                                               "SubjectVariabilityASD_Q_F_SmallerThan_Q_UF")

SubjectVariabilityTDC_MG_SmallerThan_Q_F <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC < TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityTDC_MG_SmallerThan_Q_F")

SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC > TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF")

DifferenceInDifferenceSubjectVariabilityUnfamiliarSmallerFamiliarity <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma,
                                              "(TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD - TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC) 
                                              < 
                                              (TaskQuestions:FamiliarityFamiliar:DiagnosisASD - TaskQuestions:FamiliarityFamiliar:DiagnosisTDC)",
                                              "DifferenceInDifferenceSubjectVariabilityUnfamiliarBiggerFamiliarity")

DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions <- extract_relevant_sd_data(ChildLatency_m1_no_beta_with_sigma,
                                              "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC - TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD) 
                                              < 
                                              (TaskQuestions:FamiliarityFamiliar:DiagnosisTDC - TaskQuestions:FamiliarityFamiliar:DiagnosisASD)",
                                              "DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions")

# Overall Visit Variability across visits in Autism Group
VisitVariabilityASDOverall <- extract_relevant_sdvisit_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                                               "VisitVariabilityASDOverall")

# Overall Visit Variability across visits in TD Group
VisitVariabilityTDCOverall <- extract_relevant_sdvisit_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                                               "VisitVariabilityTDCOverall")


VisitVariabilityASDOverallHigherTDSOverall <- extract_relevant_sdvisit_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 >
                                               (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3",
                                               "VisitVariabilityASDOverallLowerTDSOverall")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                                               "VisitVariabilityASDMG")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                                               "VisitVariabilityTDMG")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASD_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > 0",
                                               "VisitVariabilityASD_Q_F")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDC_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar > 0",
                                               "VisitVariabilityTDC_Q_F")

# Subject Variability across visits MG in Autism Group
VisitVariabilityASD_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > 0",
                                               "VisitVariabilityASD_Q_UF")

# Overall Subject Variability across visits in TD Group
VisitVariabilityTDC_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > 0",
                                               "VisitVariabilityTDC_Q_UF")

# Overall Subject Variability across visits, differences
VisitVariabilityASDMGSlowerThanTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar",
                                               "VisitVariabilityASDMG>TDMG")

# Overall Subject Variability across visits, differences
VisitVariabilityASD_Q_F_SlowerThanTD_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                                               "VisitVariabilityASD_Q_F_SlowerThanTD_Q_F")

# Overall Subject Variability across visits, differences
VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                                               "VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF")

#DifferenceInDifference:
DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity <- extract_relevant_sdvisit_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)
                                               < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity")

DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)
                                               > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG")


# Overall Sigma Variability across visits in Autism Group
SigmaASDOverall <- extract_relevant_sigma_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 < 0",
                                               "SigmaASDOverall")

# Overall Sigma Variability across visits in TD Group
SigmaTDCOverall <- extract_relevant_sigma_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "(sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) /3 < 0",
                                               "SigmaTDCOverall")


SigmaASDOverallHigherTDSOverall <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 >
                                               (sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3",
                                               "SigmaASDOverallHigherTDSOverall")

# Subject Variability across visits MG in Autism Group
SigmaASDMG <- extract_relevant_sigma_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < 0",
                                               "SigmaASDMG")

# Overall Subject Variability across visits in TD Group
SigmaTDMG <- extract_relevant_sigma_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < 0",
                                               "SigmaTDMG")

# Subject Variability across visits MG in Autism Group
SigmaASD_Q_F <- extract_relevant_sigma_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < 0",
                                               "SigmaASD_Q_F")

# Overall Subject Variability across visits in TD Group
SigmaTDC_Q_F <- extract_relevant_sigma_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar < 0",
                                               "SigmaTDC_Q_F")


# Subject Variability across visits MG in Autism Group
SigmaASD_Q_UF <- extract_relevant_sigma_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < 0 ",
                                               "SigmaASD_Q_UF")

# Overall Subject Variability across visits in TD Group
SigmaTDC_Q_UF <- extract_relevant_sigma_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar < 0",
                                               "SigmaTDC_Q_UF")

# Overall Subject Variability across visits, differences
SigmaASDMGSlowerThanTDMG <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                                               "SigmaASDMGSlowerThanTDMG")

# Overall Subject Variability across visits, differences
SigmaASD_Q_F_SlowerThanTD_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                                               "SigmaASD_Q_F_SlowerThanTD_Q_F")

# Overall Subject Variability across visits, differences
SigmaASD_Q_UF_SlowerThanTD_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                                               "SigmaASD_Q_UF_SlowerThanTD_Q_UF")

#Sigma across visits, differences
SigmaASD_MG_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit < 0",
                                               "SigmaASD_MG_VisitLowerZero")

SigmaTDC_MG_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit > 0",
                                               "SigmaTDC_MG_VisitLowerZero")

SigmaASD_MG_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
                                               "SigmaASD_MG_VisitLowerTDC")

SigmaASD_Overall_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit +
                                               sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit +
                                               sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 < 0",
                                               "SigmaASD_Overall_VisitLowerZero")

SigmaTDC_Overall_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "(sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit +
                                               sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit +
                                               sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 < 0",
                                               "SigmaTDC_Overall_VisitLowerZero")

# Sigma across visits, differences
SigmaASD_Q_F_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit > 0",
                                               "SigmaASD_Q_F_VisitLowerZero")

SigmaTDC_Q_F_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit < 0",
                                               "SigmaTDC_Q_F_VisitLowerZero")

SigmaASD_Q_F_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
                                               "SigmaASD_Q_F_VisitLowerTDC")

# Sigma across visits, differences
SigmaASD_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < 0",
                                               "SigmaASD_Q_UF_VisitLowerZero")

SigmaTDC_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > 0",
                                               "SigmaTDC_Q_UF_VisitLowerZero")

SigmaASD_Q_UF_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
                                               "SigmaASD_Q_UF_VisitLowerTDC")

SigmaVisitOverall_ASDLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit +
                                               sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit +
                                               sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 > (sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit +
                                               sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit +
                                               sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) /3",
                                               "SigmaVisitOverall_ASDLowerTDC")

#DifferenceInDifference:
DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "(sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)
                                               > (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity")

DifferenceInDifferenceSigmaASDMGSmallerThanTDMG <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)
                                               > (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceSigmaASDMGSmallerThanTDMG")

#WithinGroups
WithinGroupSigmaASD_Q_F_Faster_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaASD_Q_FFaster_UF")

WithinGroupSigmaTDC_Q_F_Faster_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaTDC_Q_F_Faster_UF")

WithinGroupSigmaASD_Q_F_Faster_MG <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaASD_Q_F_Faster_MG")

WithinGroupSigmaTDC_Q_F_Faster_MG <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma, 
                                               "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaTDC_Q_F_Faster_MG")


WithinGroupSigmaASD_Q_F_Lower_UF_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit",
                                               "WithinGroupSigmaASD_Q_F_Lower_UF_Visit")

WithinGroupSigmaTDC_Q_F_Lower_UF_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit",
                                               "WithinGroupSigmaTDC_Q_F_Lower_UF_Visit")

WithinGroupSigmaASD_Q_F_Lower_MG_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit",
                                               "WithinGroupSigmaASD_Q_F_Lower_MG_Visit")

WithinGroupSigmaTDC_Q_F_Lower_MG_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
                                               "WithinGroupSigmaTDC_Q_F_Lower_MG_Visit")


SigmaTDC_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > 0",
                                               "SigmaTDC_Q_UF_VisitLowerZero")

SigmaASD_Q_UF_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
                                               "SigmaASD_Q_UF_VisitLowerTDC")


DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "(sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) <
                                               (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit)", "DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF")


DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_no_beta_with_sigma,
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit) <
                                               (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit)", "DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F")



# Correlation Estimates across visits in Autism Group
post <- as_draws_df(ChildLatency_m1_no_beta_with_sigma)


# Apply the function for each case
cor_post_mu_MG_ASD <- Visitextract_and_rename(post, "DiagnosisASD", "TaskMatchingGame", "FamiliarityFamiliar") %>%
  cor() %>%
  as.matrix()

cor_post_mu_MG_TDC <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskMatchingGame", "FamiliarityFamiliar") %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_ASD_Familiar <- Visitextract_and_rename(post, "DiagnosisASD", "TaskQuestions", "FamiliarityFamiliar") %>%
  select(Visit2, Visit4, Visit6) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_TDC_Familiar <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskQuestions", "FamiliarityFamiliar") %>%
  select(Visit2, Visit4, Visit6) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_ASD_Unfamiliar <- Visitextract_and_rename(post, "DiagnosisASD", "TaskQuestions", "FamiliarityUnfamiliar") %>%
  select(Visit1, Visit3, Visit5, Visit7) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_TDC_Unfamiliar <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskQuestions", "FamiliarityUnfamiliar") %>%
  select(Visit1, Visit3, Visit5, Visit7) %>%
  cor() %>%
  as.matrix()

diag(cor_post_mu_MG_ASD) <- NA
diag(cor_post_mu_MG_TDC) <- NA
diag(cor_post_mu_Q_ASD_Familiar) <- NA
diag(cor_post_mu_Q_TDC_Familiar) <- NA
diag(cor_post_mu_Q_ASD_Unfamiliar) <- NA
diag(cor_post_mu_Q_TDC_Unfamiliar) <- NA

CorrelationSummaryStatistics <- tibble(
       Estimate = c(mean(cor_post_mu_MG_ASD, na.rm = TRUE), mean(cor_post_mu_Q_ASD_Familiar, na.rm = TRUE), mean(cor_post_mu_Q_ASD_Unfamiliar, na.rm = TRUE), 
                    mean(cor_post_mu_MG_TDC, na.rm = TRUE), mean(cor_post_mu_Q_TDC_Familiar, na.rm = TRUE), mean(cor_post_mu_Q_TDC_Unfamiliar, na.rm = TRUE)),
       CI.Lower = c(quantile(cor_post_mu_MG_ASD, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Familiar, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Unfamiliar, probs = 0.025, na.rm = TRUE), 
                    quantile(cor_post_mu_MG_TDC, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Familiar, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Unfamiliar, probs = 0.025, na.rm = TRUE)),
       CI.Upper = c(quantile(cor_post_mu_MG_ASD, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Familiar, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Unfamiliar, probs = 0.975, na.rm = TRUE), 
                    quantile(cor_post_mu_MG_TDC, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Familiar, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Unfamiliar, probs = 0.975, na.rm = TRUE)),
       Evid.Ratio = c(NA, NA, NA, NA, NA, NA),
       TestDescription = c(
  "CorrelationAcrossVisitsASDMG", "CorrelationAcrossVisitsASDFamiliarQuestions", "CorrelationAcrossVisitsASDUnfamiliarQuestions",
  "CorrelationAcrossVisitsTDMG", "CorrelationAcrossVisitsTDFamiliarQuestions", "CorrelationAcrossVisitsTDUnfamiliarQuestions"),
       )

HypothesisResultsChildLatenciesModel1 <- rbind(OverallLatencyThreeConditionsASD,
                                               OverallLatencyThreeConditionsTD,
                                               MGOverallLatencyASD,
                                               Q_F_OverallLatencyASD,
                                               Q_UF_OverallLatencyASD,
                                               MGOverallLatencyTDC,
                                               Q_F_OverallLatencyTDC,
                                               Q_UF_OverallLatencyTDC,
                                               OverallLatencyThreeConditionsASDFasterTD,
                                               WithinASDGroupMGSlowerQuestionsFamiliar,
                                               WithinTDGroupMGSlowerQuestionsFamiliar,
                                               WithinAutismGroupQuestionsUnfamiliarSlowerFamiliar,
                                               WithinTDGroupQuestionsUnfamiliarSlowerFamiliar,
                                               WithinConditionsMatchingGameASDFasterTD,
                                               WithinConditionsQuestionsFamiliarASDFasterTD,
                                               WithinConditionsQuestionsUnfamiliarASDFasterTD,
                                               DifferenceInDifferenceBetweenGroupsUnfamiliarBiggerFamiliarity,
                                               DifferenceInDifferenceBetweenGroupsMGBiggerThanConversations,
                                               SubjectVariabilityASD,
                                               SubjectVariabilityTD,
                                               SubjectVariabilityASDSmallerThanTD,
                                               SubjectVariabilityASD_MG,
                                               SubjectVariabilityASD_Q_F,
                                               SubjectVariabilityASD_Q_UF,
                                               SubjectVariabilityTD_MG,
                                               SubjectVariabilityTD_Q_F,
                                               SubjectVariabilityTD_Q_UF,
                                               SubjectVariabilityASDSmallerThanTD_MG,
                                               SubjectVariabilityASDSmallerThanTD_Q_F,
                                               SubjectVariabilityASDSmallerThanTD_Q_UF,
                                               SubjectVariabilityASD_MG_SmallerThan_Q_F,
                                               SubjectVariabilityASD_Q_F_SmallerThan_Q_UF,
                                               SubjectVariabilityTDC_MG_SmallerThan_Q_F,
                                               SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF,
                                               DifferenceInDifferenceSubjectVariabilityUnfamiliarSmallerFamiliarity,
                                               DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions,
                                               VisitVariabilityASDMG,
                                               VisitVariabilityTDMG,
                                               VisitVariabilityASD_Q_F,
                                               VisitVariabilityTDC_Q_F,
                                               VisitVariabilityASD_Q_UF,
                                               VisitVariabilityTDC_Q_UF,
                                               VisitVariabilityASDOverall,
                                               VisitVariabilityTDCOverall,
                                               VisitVariabilityASDMGSlowerThanTDMG,
                                               VisitVariabilityASD_Q_F_SlowerThanTD_Q_F,
                                               VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF,
                                               VisitVariabilityASDOverallHigherTDSOverall,
                                               DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG,
                                               DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity,
                                               SigmaASDOverall,
                                               SigmaTDCOverall,
                                               SigmaASDOverallHigherTDSOverall,
                                               SigmaASDMG,
                                               SigmaTDMG,
                                               SigmaASD_Q_F,
                                               SigmaTDC_Q_F,
                                               SigmaASD_Q_UF,
                                               SigmaTDC_Q_UF,
                                               SigmaASDMGSlowerThanTDMG,
                                               SigmaASD_Q_F_SlowerThanTD_Q_F,
                                               SigmaASD_Q_UF_SlowerThanTD_Q_UF,
                                               SigmaASD_MG_VisitLowerZero,
                                               SigmaTDC_MG_VisitLowerZero,
                                               SigmaASD_MG_VisitLowerTDC,
                                               SigmaASD_Q_F_VisitLowerZero,
                                               SigmaTDC_Q_F_VisitLowerZero,
                                               SigmaASD_Q_F_VisitLowerTDC,
                                               SigmaASD_Q_UF_VisitLowerZero,
                                               SigmaTDC_Q_UF_VisitLowerZero,
                                               SigmaASD_Q_UF_VisitLowerTDC,
                                               SigmaASD_Overall_VisitLowerZero,
                                               SigmaTDC_Overall_VisitLowerZero,
                                               WithinGroupSigmaASD_Q_F_Lower_UF_Visit,
                                               WithinGroupSigmaTDC_Q_F_Lower_UF_Visit,
                                               WithinGroupSigmaASD_Q_F_Lower_MG_Visit,
                                               WithinGroupSigmaTDC_Q_F_Lower_MG_Visit,
                                               WithinGroupSigmaASD_Q_F_Faster_UF,
                                               WithinGroupSigmaTDC_Q_F_Faster_UF,
                                               WithinGroupSigmaASD_Q_F_Faster_MG,
                                               WithinGroupSigmaTDC_Q_F_Faster_MG,
                                               SigmaVisitOverall_ASDLowerTDC,
                                               DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF,
                                               DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F,
                                               DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity,
                                               DifferenceInDifferenceSigmaASDMGSmallerThanTDMG,
                                               CorrelationSummaryStatistics) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(HypothesisResultsChildLatenciesModel1, here('VBMTurnTakingFiles/stats_for_paper/model1_child_no_beta_with_sigma_stats_for_paper.csv'))
```


## RQ3, Child Latency Individual Differences Model, No Overlaps
```{r}
d_no <- d %>% 
  subset(Latency > 0) %>%
  filter(InterTurn == "Child2Adult")

Latency_ID_f1 <- bf(
  Latency ~ 0 + Diagnosis:Task:Familiarity + 
    Diagnosis:Task:Familiarity:LanguageS_scaled + 
    Diagnosis:Task:Familiarity:AwarenessS_scaled + 
    Diagnosis:Task:Familiarity:MotivationS_scaled + 
    Diagnosis:Task:Familiarity:CognitionS_scaled + 
    Diagnosis:Task:Familiarity:MotorS_scaled + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task | r | Visit), 
  sigma ~ 0 + Diagnosis:Task:Familiarity +
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)),
  beta ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis))  +  
    (0 + Diagnosis:Task | r | Visit))

priorChild_no <- c(
  prior(normal(0, 2), class = b),
  prior(normal(0, 0.3), class = sd),
  prior(normal(0, 1), class = b, dpar = beta),
  prior(normal(0, 0.1), class = sd, dpar = beta),
  prior(normal(0, 1), class = b, dpar = sigma),
  prior(normal(0, 0.1), class = sd, dpar = sigma),
  prior(lkj(2), class = cor)
)

job::job({
  ChildLatency_m2_ID_NoOverlaps <- brm(
    Latency_ID_f1,
    data = d_no,
    family = exgaussian,
    prior = priorChild_no,
    sample_prior = T,
    backend = "cmdstanr",
    iter = 3000,
    warmup = 500,
    init = 0,
    chains = 2,
    cores = 64,
    file = here::here("models", "ChildLatency_m2_ID_NoOverlapsJulyJuly"),
    control = list(adapt_delta = 0.95, max_treedepth = 15),
    stan_model_args = list(stanc_options = list("O1"))
  )
})
```

### Hypothesis Tests
```{r}
LanguageASD_TG_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageASD_TG_F")

LanguageASD_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageASD_Q_F")

LanguageASD_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > 0",
                      "LanguageASD_Q_UF")

LanguageASD_overall <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > 0",
                      "LanguageASD_overall")

LanguageTDC_TG_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_TG_F")

LanguageTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_Q_F")

LanguageTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_Q_UF")

LanguageTDC_overall <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > 0",
                      "LanguageTDC_overall")

MotorASD_TG_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled < 0", "MotorASD_TG_F")
MotorASD_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled < 0", "MotorASD_Q_F")
MotorASD_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled < 0", "MotorASD_Q_UF")

#1
WithinGroupMotorASD_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled", "WithinGroupMotorASD_MGSlower_Q_F")

WithinGroupMotorASD_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled", "WithinGroupMotorASD_Q_UFSlower_Q_F")
#2
WithinGroupCognitionASD_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled < DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled", "WithinGroupCognitionASD_MGSlower_Q_F")

WithinGroupCognitionASD_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled", "WithinGroupCognitionASD_Q_UFSlower_Q_F")
#3
WithinGroupAwarenessASD_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled < DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled", "WithinGroupAwarenessASD_MGSlower_Q_F")

WithinGroupAwarenessASD_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled < DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled", "WithinGroupAwarenessASD_Q_UFSlower_Q_F")
#4
WithinGroupMotivationASD_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled", "WithinGroupMotivationASD_MGSlower_Q_F")

WithinGroupMotivationASD_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled", "WithinGroupMotivationASD_Q_UFSlower_Q_F")
#5
WithinGroupLanguageASD_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled", "WithinGroupLanguageASD_MGSlower_Q_F")

WithinGroupLanguageASD_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled", "WithinGroupLanguageASD_Q_UFSlower_Q_F")

#1
WithinGroupMotorTDC_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled", "WithinGroupMotorTDC_MGSlower_Q_F")

WithinGroupMotorTDC_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled", "WithinGroupMotorTDC_Q_UFSlower_Q_F")
#2
WithinGroupCognitionTDC_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled", "WithinGroupCognitionTDC_MGSlower_Q_F")

WithinGroupCognitionTDC_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled", "WithinGroupCognitionTDC_Q_UFSlower_Q_F")
#3
WithinGroupAwarenessTDC_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled", "WithinGroupAwarenessTDC_MGSlower_Q_F")

WithinGroupAwarenessTDC_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled", "WithinGroupAwarenessTDC_Q_UFSlower_Q_F")
#4
WithinGroupMotivationTDC_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled", "WithinGroupMotivationTDC_MGSlower_Q_F")

WithinGroupMotivationTDC_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled", "WithinGroupMotivationTDC_Q_UFSlower_Q_F")
#5
WithinGroupLanguageTDC_MGSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled", "WithinGroupLanguageTDC_MGSlower_Q_F")

WithinGroupLanguageTDC_Q_UFSlower_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled", "WithinGroupLanguageTDC_Q_UFSlower_Q_F")

MotorASD_overall <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)/3 < 0",  "MotorASD_overall")

MotorTDC_TG_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled < 0", "MotorTDC_TG_F")
MotorTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled < 0", "MotorTDC_Q_F")
MotorTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled < 0", "MotorTDC_Q_UF")
MotorTDC_overall <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)/3 < 0", "MotorTDC_overall")

CognitionASD_TG_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled < 0", "CognitionASD_TG_F")
CognitionASD_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled < 0", "CognitionASD_Q_F")
CognitionASD_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled < 0","CognitionASD_Q_UF")
CognitionASD_overall <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)/3 < 0","CognitionASD_overall")

CognitionTDC_TG_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled < 0","CognitionTDC_TG_F")
CognitionTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled < 0","CognitionTDC_Q_F")
CognitionTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled < 0","CognitionTDC_Q_UF")
CognitionTDC_overall <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)/3 < 0","CognitionTDC_overall")

AwarenessASD_TG_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled > 0","AwarenessASD_TG_F")
AwarenessASD_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled > 0","AwarenessASD_Q_F")
AwarenessASD_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled > 0", "AwarenessASD_Q_UF")
AwarenessASD_overall <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)/3 > 0", "AwarenessASD_overall")

AwarenessTDC_TG_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled > 0", "AwarenessTDC_TG_F")
AwarenessTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled > 0","AwarenessTDC_Q_F")
AwarenessTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled > 0","AwarenessTDC_Q_UF")
AwarenessTDC_overall <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)/3 > 0","AwarenessTDC_overall")

MotivationASD_TG_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled > 0","MotivationASD_TG_F")
MotivationASD_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled > 0","MotivationASD_Q_F")
MotivationASD_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled > 0","MotivationASD_Q_UF")
MotivationASD_overall <-extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)/3 > 0","MotivationASD_overall")

MotivationTDC_TG_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled < 0","MotivationTDC_TG_F")
MotivationTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled < 0","MotivationTDC_Q_F")
MotivationTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled < 0","MotivationTDC_Q_UF")
MotivationTDC_overall <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)/3 > 0","MotivationTDC_overall")


LanguageASD_TG_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageASD_TG_F")

LanguageASD_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageASD_Q_F")

LanguageASD_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > 0",
                      "LanguageASD_Q_UF")

LanguageASD_overall <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > 0",
                      "LanguageASD_overall")

LanguageTDC_TG_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_TG_F")

LanguageTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_Q_F")

LanguageTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > 0",
                      "LanguageTDC_Q_UF")

LanguageTDC_overall <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > 0",
                      "LanguageTDC_overall")


LanguageOverallASDSlowerTDC <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3 > (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)/3",
                      "LanguageOverallASDSlowerTDC")

MotorOverallASDSlowerTDC <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)/3 > 
                                          (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)/3",  
                                          "MotorOverallASDFasterTDC")

CognitionOverallASDSlowerTDC <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)/3 >
                                              (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)/3",
                                              "CognitionOverallASDSlowerTDC")

AwarenessOverallASDFasterTDC <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)/3 < (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)/3", "AwarenessOverallASDSlowerTDC")

MotivationOverallASDFasterTDC <-extract_relevant_data(ChildLatency_m2_ID_NoOverlaps, "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)/3 > (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)/3","MotivationOverallASDFasterTDC")

LanguageOverallASDSlowerTDC_MG <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled > DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_MG")

LanguageOverallASDSlowerTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_Q_F")

LanguageOverallASDSlowerTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_Q_UF")


MotorOverallASDSlowerTDC_MG <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled > DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled",
                      "MotorOverallASDSlowerTDC_MG")

MotorOverallASDSlowerTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled",
                      "MotorOverallASDSlowerTDC_Q_F")

MotorOverallASDSlowerTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled",
                      "MotorOverallASDSlowerTDC_Q_UF")

CognitionOverallASDSlowerTDC_MG <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled > DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled",
                      "CognitionOverallASDSlowerTDC_MG")

CognitionOverallASDSlowerTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled",
                      "CognitionOverallASDSlowerTDC_Q_F")

CognitionOverallASDSlowerTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled",
                      "CognitionOverallASDSlowerTDC_Q_UF")

AwarenessOverallASDSlowerTDC_MG <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled",
                      "AwarenessOverallASDSlowerTDC_MG")

AwarenessOverallASDSlowerTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled",
                      "AwarenessOverallASDSlowerTDC_Q_F")

AwarenessOverallASDSlowerTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled",
                      "AwarenessOverallASDSlowerTDC_Q_UF")

MotivationOverallASDSlowerTDC_MG <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled > DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled",
                      "MotivationOverallASDSlowerTDC_MG")

MotivationOverallASDSlowerTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled",
                      "MotivationOverallASDSlowerTDC_Q_F")

MotivationOverallASDSlowerTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled",
                      "MotivationOverallASDSlowerTDC_Q_UF")


DifferenceInDifferenceLanguageMGSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:LanguageS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled)",
                      "DifferenceInDifferenceLanguageMGSlowerQ_F")

DifferenceInDifferenceLanguageUFSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled)",
                      "DifferenceInDifferenceLanguageUFSlowerQ_F")

DifferenceInDifferenceMotorMGSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotorS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled)",
                      "DifferenceInDifferenceMotorMGSlowerQ_F")

DifferenceInDifferenceMotorUFSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotorS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotorS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotorS_scaled)",
                      "DifferenceInDifferenceMotorUFSlowerQ_F")

DifferenceInDifferenceCognitionMGSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:CognitionS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled)",
                      "DifferenceInDifferenceCognitionMGSlowerQ_F")

DifferenceInDifferenceCognitionUFSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:CognitionS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:CognitionS_scaled)",
                      "DifferenceInDifferenceCognitionUFSlowerQ_F")

DifferenceInDifferenceAwarenessMGSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:AwarenessS_scaled)
                      < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled)",
                      "DifferenceInDifferenceAwarenessMGSlowerQ_F")

DifferenceInDifferenceAwarenessUFSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:AwarenessS_scaled)
                      < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:AwarenessS_scaled)",
                      "DifferenceInDifferenceAwarenessUFSlowerQ_F")

DifferenceInDifferenceMotivationMGSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:MotivationS_scaled)
                      > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled)",
                      "DifferenceInDifferenceMotivationMGSlowerQ_F")

DifferenceInDifferenceMotivationUFSlowerQ_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:MotivationS_scaled)
                      < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:MotivationS_scaled)",
                      "DifferenceInDifferenceMotivationUFSlowerQ_F")

LanguageOverallASDSlowerTDC_Q_F <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_Q_F")

LanguageOverallASDSlowerTDC_Q_UF <- extract_relevant_data(ChildLatency_m2_ID_NoOverlaps,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled > DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:LanguageS_scaled",
                      "LanguageOverallASDSlowerTDC_Q_UF")

hypothesis_data_full <- rbind(
                              MotorASD_TG_F, MotorASD_Q_F, MotorASD_Q_UF, MotorASD_overall,
                              MotorTDC_TG_F, MotorTDC_Q_F, MotorTDC_Q_UF, MotorTDC_overall,
                              
                              CognitionASD_TG_F, CognitionASD_Q_F, CognitionASD_Q_UF, CognitionASD_overall,
                              CognitionTDC_TG_F, CognitionTDC_Q_F, CognitionTDC_Q_UF, CognitionTDC_overall,
                              
                              LanguageASD_TG_F, LanguageASD_Q_F, LanguageASD_Q_UF, LanguageASD_overall,
                              LanguageTDC_TG_F, LanguageTDC_Q_F, LanguageTDC_Q_UF, LanguageTDC_overall,
                              
                              AwarenessASD_TG_F, AwarenessASD_Q_F, AwarenessASD_Q_UF, AwarenessASD_overall,
                              AwarenessTDC_TG_F, AwarenessTDC_Q_F, AwarenessTDC_Q_UF, AwarenessTDC_overall,
                              
                              MotivationASD_TG_F, MotivationASD_Q_F, MotivationASD_Q_UF, MotivationASD_overall,
                              MotivationTDC_TG_F, MotivationTDC_Q_F, MotivationTDC_Q_UF, MotivationTDC_overall,
                              
                              LanguageOverallASDSlowerTDC, MotorOverallASDSlowerTDC, CognitionOverallASDSlowerTDC, AwarenessOverallASDFasterTDC, MotivationOverallASDFasterTDC,
                              
                              LanguageOverallASDSlowerTDC_MG, LanguageOverallASDSlowerTDC_Q_F, LanguageOverallASDSlowerTDC_Q_UF,
                              CognitionOverallASDSlowerTDC_MG, CognitionOverallASDSlowerTDC_Q_F, CognitionOverallASDSlowerTDC_Q_UF,
                              MotorOverallASDSlowerTDC_MG, MotorOverallASDSlowerTDC_Q_F, MotorOverallASDSlowerTDC_Q_UF,
                              AwarenessOverallASDSlowerTDC_MG, AwarenessOverallASDSlowerTDC_Q_F, AwarenessOverallASDSlowerTDC_Q_UF,
                              MotivationOverallASDSlowerTDC_MG, MotivationOverallASDSlowerTDC_Q_F, MotivationOverallASDSlowerTDC_Q_UF,
                              
                              DifferenceInDifferenceLanguageMGSlowerQ_F, DifferenceInDifferenceLanguageUFSlowerQ_F,
                              DifferenceInDifferenceMotorMGSlowerQ_F, DifferenceInDifferenceMotorUFSlowerQ_F,
                              DifferenceInDifferenceMotivationMGSlowerQ_F, DifferenceInDifferenceMotivationUFSlowerQ_F,
                              DifferenceInDifferenceCognitionMGSlowerQ_F, DifferenceInDifferenceCognitionUFSlowerQ_F,
                              DifferenceInDifferenceAwarenessMGSlowerQ_F, DifferenceInDifferenceAwarenessUFSlowerQ_F,
                              
                              WithinGroupLanguageASD_MGSlower_Q_F, WithinGroupLanguageASD_Q_UFSlower_Q_F,
                              WithinGroupCognitionASD_MGSlower_Q_F, WithinGroupCognitionASD_Q_UFSlower_Q_F,
                              WithinGroupMotorASD_MGSlower_Q_F, WithinGroupMotorASD_Q_UFSlower_Q_F,
                              WithinGroupAwarenessASD_MGSlower_Q_F, WithinGroupAwarenessASD_Q_UFSlower_Q_F,
                              WithinGroupMotivationASD_MGSlower_Q_F, WithinGroupMotivationASD_Q_UFSlower_Q_F,
                              
                              WithinGroupLanguageTDC_MGSlower_Q_F, WithinGroupLanguageTDC_Q_UFSlower_Q_F,
                              WithinGroupCognitionTDC_MGSlower_Q_F, WithinGroupCognitionTDC_Q_UFSlower_Q_F,
                              WithinGroupMotorTDC_MGSlower_Q_F, WithinGroupMotorTDC_Q_UFSlower_Q_F,
                              WithinGroupAwarenessTDC_MGSlower_Q_F, WithinGroupAwarenessTDC_Q_UFSlower_Q_F,
                              WithinGroupMotivationTDC_MGSlower_Q_F, WithinGroupMotivationTDC_Q_UFSlower_Q_F
                              
                              
                              ) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(hypothesis_data_full, here('VBMTurnTakingFiles', 'stats_for_paper/model2_child_no_overlaps_stats_for_paper.csv'))
```

### Visualisation of Model Estimates
```{r}
hypothesis_data_overall <- hypothesis_data_full[1:40, ] %>%
  #filter(str_detect(value, "overall")) %>%
  mutate(Parameter = sapply(strsplit(value, "_"), `[`,1)) %>%
  mutate(Diagnosis = sapply(Parameter, function(x) substr(x, nchar(x) - 2, nchar(x)))) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Parameter = str_replace(Parameter, "ASD", "")) %>%
  mutate(Parameter = str_replace(Parameter, "TDC", "")) %>%
  mutate(Parameter = factor(Parameter, levels = c("Motivation", "Awareness", "Language", "Cognition", "Motor"))) %>%
  mutate(Condition = sub(".*_(TG_F|Q_F|Q_UF)$", "\\1", value)) %>%
  mutate(Condition = str_replace_all(Condition, 
                                     c("MotorASD_overall" = "Overall", 
                                       "MotorTDC_overall" = "Overall", 
                                       "CognitionASD_overall" = "Overall", 
                                       "CognitionTDC_overall" = "Overall", 
                                       "LanguageASD_overall" = "Overall", 
                                       "LanguageTDC_overall" = "Overall",
                                       "AwarenessASD_overall" = "Overall", 
                                       "AwarenessTDC_overall" = "Overall", 
                                       "MotivationASD_overall" = "Overall", 
                                       "MotivationTDC_overall" = "Overall"))) %>%
  mutate(Condition = str_replace_all(Condition, 
                                     c("TG_F" = "Matching With Parent", 
                                       "Q_F" = "Convo With Parent", 
                                       "Q_UF" = "Convo With Experimenter",
                                       "Overall" = "Aggregated Estimate"))) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter", "Aggregated Estimate")))

Posterior_df <- as_draws_df(ChildLatency_m2_ID_NoOverlaps)

create_condition_posterior <- function(Posterior_df, Diagnosis, Task, Familiarity, Parameter) {
  column_name <- paste0("b_Diagnosis", Diagnosis, ":Task", Task, ":Familiarity", Familiarity, ":", Parameter)
  
  condition_posterior <- Posterior_df[, column_name] %>%
    mutate(Familiarity = Familiarity,
           Task = Task,
           Diagnosis = Diagnosis,
           Parameter = Parameter) %>%
    rename("Estimate" = !!sym(column_name)) %>%
    mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
    mutate(Condition = case_when(
      Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
      Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
      Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
    mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))
  
  return(condition_posterior)
}

Languagecondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "LanguageS_scaled")
Languagecondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "LanguageS_scaled")
Languagecondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "LanguageS_scaled")

Languagecondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "LanguageS_scaled")
Languagecondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "LanguageS_scaled")
Languagecondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "LanguageS_scaled")

Cognitioncondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "CognitionS_scaled")
Cognitioncondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "CognitionS_scaled")
Cognitioncondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "CognitionS_scaled")

Cognitioncondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "CognitionS_scaled")
Cognitioncondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "CognitionS_scaled")
Cognitioncondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "CognitionS_scaled")

Motorcondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "MotorS_scaled")
Motorcondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "MotorS_scaled")
Motorcondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "MotorS_scaled")

Motorcondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "MotorS_scaled")
Motorcondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "MotorS_scaled")
Motorcondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "MotorS_scaled")

Awarenesscondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "AwarenessS_scaled")
Awarenesscondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "AwarenessS_scaled")
Awarenesscondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "AwarenessS_scaled")

Awarenesscondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "AwarenessS_scaled")
Awarenesscondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "AwarenessS_scaled")
Awarenesscondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "AwarenessS_scaled")

Motivationcondition_posterior_TDC_MG <- create_condition_posterior(Posterior_df, "TDC", "MatchingGame", "Familiar", "MotivationS_scaled")
Motivationcondition_posterior_TDC_Q_F <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Familiar", "MotivationS_scaled")
Motivationcondition_posterior_TDC_Q_UF <- create_condition_posterior(Posterior_df, "TDC", "Questions", "Unfamiliar", "MotivationS_scaled")

Motivationcondition_posterior_ASD_MG <- create_condition_posterior(Posterior_df, "ASD", "MatchingGame", "Familiar", "MotivationS_scaled")
Motivationcondition_posterior_ASD_Q_F <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Familiar", "MotivationS_scaled")
Motivationcondition_posterior_ASD_Q_UF <- create_condition_posterior(Posterior_df, "ASD", "Questions", "Unfamiliar", "MotivationS_scaled")

full_posterior_predictions <- rbind(Languagecondition_posterior_TDC_MG, Languagecondition_posterior_TDC_Q_F, Languagecondition_posterior_TDC_Q_UF, 
      Languagecondition_posterior_ASD_MG, Languagecondition_posterior_ASD_Q_F, Languagecondition_posterior_ASD_Q_UF,
      
      Motorcondition_posterior_TDC_MG, Motorcondition_posterior_TDC_Q_F, Motorcondition_posterior_TDC_Q_UF, 
      Motorcondition_posterior_ASD_MG, Motorcondition_posterior_ASD_Q_F, Motorcondition_posterior_ASD_Q_UF,
  
      Awarenesscondition_posterior_TDC_MG, Awarenesscondition_posterior_TDC_Q_F, Awarenesscondition_posterior_TDC_Q_UF, 
      Awarenesscondition_posterior_ASD_MG, Awarenesscondition_posterior_ASD_Q_F, Awarenesscondition_posterior_ASD_Q_UF,
      
      Cognitioncondition_posterior_TDC_MG, Cognitioncondition_posterior_TDC_Q_F, Cognitioncondition_posterior_TDC_Q_UF, 
      Cognitioncondition_posterior_ASD_MG, Cognitioncondition_posterior_ASD_Q_F, Cognitioncondition_posterior_ASD_Q_UF,

      Motivationcondition_posterior_TDC_MG, Motivationcondition_posterior_TDC_Q_F, Motivationcondition_posterior_TDC_Q_UF, 
      Motivationcondition_posterior_ASD_MG, Motivationcondition_posterior_ASD_Q_F, Motivationcondition_posterior_ASD_Q_UF) %>%
  mutate(Parameter = str_replace(Parameter, "S_scaled", "")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter", "Aggregated Estimate"))) %>%
  mutate(Parameter = str_replace_all(Parameter, c("Motivation" = "Social Motivation",
                                                  "Cognition" = "Social Cognition",
                                                  "Awareness" = "Social Awareness"))) %>%
  mutate(Parameter = factor(Parameter, levels = c("Motor", "Language", "Social Motivation", "Social Awareness", "Social Cognition")))
  
Model2_Plot_Child_Conditions_NoOverlaps <- ggplot() +
  annotate("rect", xmin=-Inf, xmax = 1.47, ymin=-Inf, ymax=Inf, fill="honeydew4", color = "honeydew4", alpha = .3) +
  annotate("rect", xmin=1.47, xmax = 2.48, ymin=-Inf, ymax=Inf, fill="honeydew3", color = "honeydew3", alpha = .3) +
  annotate("rect", xmin=2.48, xmax = 3.49, ymin=-Inf, ymax=Inf, fill="honeydew4", color = "honeydew4", alpha = .3) +
  annotate("rect", xmin=3.49, xmax = 4.5, ymin=-Inf, ymax=Inf, fill="honeydew3", color = "honeydew3", alpha = .3) +
  annotate("rect", xmin= 4.5, xmax = Inf, ymin=-Inf, ymax=Inf, fill="honeydew4", color = "honeydew4", alpha = .3) +
  geom_hline(yintercept = 0, linetype = 2) +
  geom_vline(xintercept = 2.48, linetype = 1, color = "black", linewidth = 1) +
  geom_boxplot(aes(Parameter, Estimate, fill = Diagnosis, color = Diagnosis), data = filter(full_posterior_predictions, Diagnosis == "Autism Group"), position = position_nudge(x = -0.1), width = 0.05, color = "black", alpha = 0.9, outliers = F) +
  geom_boxplot(aes(Parameter, Estimate, fill = Diagnosis, color = Diagnosis), data = filter(full_posterior_predictions, Diagnosis == "Typical Development"), position = position_nudge(x = -0.2), width = 0.05, color = "black", alpha = 0.9, outliers = F) +
  geom_half_violin(aes(Parameter, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "black", alpha = 0.9, data = filter(full_posterior_predictions, Diagnosis == "Autism Group"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  geom_half_violin(aes(Parameter, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "black", alpha = 0.9, data = filter(full_posterior_predictions, Diagnosis == "Typical Development"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  facet_wrap(~Condition, nrow = 1) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  xlab(' ') +
  coord_flip() +
  ylab('Child Response Latency (seconds)') +
  guides(color = "none", fill = guide_legend(reverse=TRUE)) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        legend.position = c(0.05, 0.957),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(3, "lines"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"))

Model2_Plot_Child_Conditions_NoOverlaps
```


## RQ1, Child Response Latencies across Different Conditions as a function of Gender
```{r, eval = FALSE}
Latency_f1_Gender <- bf(
  Latency ~ 0 + Diagnosis:Task:Familiarity:Gender + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task:Gender | r | Visit), 
  sigma ~ 0 + Diagnosis:Task:Familiarity:Gender + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task:Gender | r | Visit),
  beta ~ 0 + Diagnosis:Task:Familiarity:Gender + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis))  +  
    (0 + Diagnosis:Task:Gender | r | Visit))

priorChild <- c(
  prior(normal(1, 1), class = b),
  prior(normal(0, 0.3), class = sd),
  prior(normal(0, 1), class = b, dpar = beta),
  prior(normal(0, 0.1), class = sd, dpar = beta),
  prior(normal(0, 1), class = b, dpar = sigma),
  prior(normal(0, 0.1), class = sd, dpar = sigma),
  prior(lkj(2), class = cor)
)

d %>%
  group_by(ID, Gender, Diagnosis) %>%
  dplyr::summarise(n()) %>%
  print(n = 50)

job::job({
  ChildLatency_m1_Gender <- brm(
    Latency_f1_Gender,
    data = subset(d, InterTurn == "Child2Adult"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = T,
    backend = "cmdstanr",
    iter = 3000,
    warmup = 500,
    init = 0,
    chains = 2,
    cores = 64,
    file = here("models","ChildLatency_m1_Gender"),
    control = list(adapt_delta = 0.97, max_treedepth = 15),
    stan_model_args = list(stanc_options = list("O1"))
  )
})

pp_check(ChildLatency_m1_Gender, ndraws = 100)

hypothesis(ChildLatency_m1_Gender, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale < DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale")

hypothesis(ChildLatency_m1_Gender, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderFemale = DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderMale")

hypothesis(ChildLatency_m1_Gender, "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale < DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale")
```

### Visualisation of Model Estimates
```{r}
newdata <- subset(d, InterTurn == "Child2Adult") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit, Gender) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) 

C2P_PredictedData <- as_tibble(predict(ChildLatency_m1_Gender, newdata = newdata)) %>%
  mutate(Visit = newdata$Visit) %>%
  mutate(Diagnosis = newdata$Diagnosis) %>%
  mutate(ID = newdata$ID) %>%
  mutate(Familiarity = newdata$Familiarity) %>%
  mutate(Task = newdata$Task) %>%
  mutate(Gender = newdata$Gender) %>%
  mutate(size = Q97.5-Q2.5) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  group_by(Diagnosis, ID, Familiarity, Task, Gender) %>%
  dplyr::summarise(Estimate = mean(Estimate)) %>%
  mutate(Gender = str_replace_all(Gender, "NonBinary", "Non-Binary"))

Model1_Plot_Child_Gender <- ggplot(C2P_PredictedData, aes(Gender, Estimate, fill = Diagnosis, color = Diagnosis)) +
  geom_rain(alpha = .5, boxplot.args = list(color = "black", outlier.shape = NA), rain.side = 'l') +
  theme_classic() +
  facet_wrap(~ Diagnosis) +
  scale_fill_manual(values = c("#009E73", "#CC79A7", "#f8f2bf")) +
  scale_color_manual(values = c("#009E73", "#CC79A7", "#f8f2bf")) +
  ggtitle('Child Response Latency Estimates across Genders') +
  xlab(' ') +
  ylab('Child Response Latency (seconds)') +
  guides(color = 'none', fill = guide_legend(title=" ")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        axis.text.y = element_text(size = 13, color = "black"),
        axis.title.y = element_text(size = 13, color = "black"),
        legend.title = element_blank(),
        legend.position = "none",
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))
Model1_Plot_Child_Gender
```

### Hypothesis Tests
```{r}
# Overall Estimates in Autism Group
OverallLatencyThreeConditionsASD_Male <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderMale +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale)/3 > 0",
                      "OverallLatencyThreeConditionsASD_Male")

OverallLatencyThreeConditionsASD_Female <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderFemale + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale)/3 > 0",
                      "OverallLatencyThreeConditionsASD_Female")

OverallLatencyThreeConditionsASD_NonBinary <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderNonBinary + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary)/3 > 0",
                      "OverallLatencyThreeConditionsASD_NonBinary")

MGOverallLatencyASD_Male <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale > 0",
                      "MGOverallLatencyASD_Male>0")

MGOverallLatencyASD_Female <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale > 0",
                      "MGOverallLatencyASD_Female>0")

MGOverallLatencyASD_NonBinary <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary > 0",
                      "MGOverallLatencyASD_NonBinary>0")

Q_F_OverallLatencyASD_Male <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderMale > 0",
                      "Q_F_OverallLatencyASD_Male>0")
Q_F_OverallLatencyASD_Female <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderFemale > 0",
                      "Q_F_OverallLatencyASD_Female>0")
Q_F_OverallLatencyASD_NonBinary <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderNonBinary > 0",
                      "Q_F_OverallLatencyASD_NonBinary>0")

Q_UF_OverallLatencyASD_Male <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale > 0",
                      "Q_UF_OverallLatencyASD_Male>0")
Q_UF_OverallLatencyASD_Female <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale > 0",
                      "Q_UF_OverallLatencyASD_Female>0")
Q_UF_OverallLatencyASD_NonBinary <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary > 0",
                      "Q_UF_OverallLatencyASD_NonBinary>0")

# Overall Estimates in TD Group
OverallLatencyThreeConditionsTD_Male <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderMale + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderMale + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderMale) / 3 > 0",
                      "OverallLatencyThreeConditionsTD_Male")
OverallLatencyThreeConditionsTD_Female <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderFemale + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderFemale + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderFemale) / 3 > 0",
                      "OverallLatencyThreeConditionsTD_Female")
OverallLatencyThreeConditionsTD_NonBinary <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderNonBinary + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary) / 3 > 0",
                      "OverallLatencyThreeConditionsTD_NonBinary")

MGOverallLatencyTDC_Male <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderMale > 0",
                      "MGOverallLatencyTDC_Male>0")
MGOverallLatencyTDC_Female <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderFemale > 0",
                      "MGOverallLatencyTDC_Female>0")
MGOverallLatencyTDC_NonBinary <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary > 0",
                      "MGOverallLatencyTDC_NonBinary>0")

Q_F_OverallLatencyTDC_Male <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderMale > 0",
                      "Q_F_OverallLatencyTDC_Male>0")
Q_F_OverallLatencyTDC_Female <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderFemale > 0",
                      "Q_F_OverallLatencyTDC_Female>0")
Q_F_OverallLatencyTDC_NonBinary <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderNonBinary > 0",
                      "Q_F_OverallLatencyTDC_NonBinary>0")

Q_UF_OverallLatencyTDC_Male <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderMale > 0",
                      "Q_UF_OverallLatencyTDC_Male>0")
Q_UF_OverallLatencyTDC_Female <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderFemale > 0",
                      "Q_UF_OverallLatencyTDC_Female>0")
Q_UF_OverallLatencyTDC_NonBinary <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary > 0",
                      "Q_UF_OverallLatencyTDC_NonBinary>0")

# Overall Differences between Autism Group and Typical Development Group
OverallLatencyThreeConditionsASDMaleSlowerASDFemale <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderMale + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale)/3 
                                >
                                (DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderFemale +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale) / 3",
                      "OverallLatencyThreeConditionsASDMaleSlowerASDFemale")

# Overall Differences between Autism Group and Typical Development Group
ASDMaleSlowerASDFemale_MG <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale > DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale",
                      "ASDMaleSlowerASDFemale_MG")

ASDMaleSlowerASDFemale_Q_F <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderMale > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderFemale",
                      "ASDMaleSlowerASDFemale_Q_F")

ASDMaleSlowerASDFemale_Q_UF <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale > DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale",
                      "ASDMaleSlowerASDFemale_Q_UF")

OverallLatencyThreeConditionsTDCMaleSlowerTDCFemale <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderMale + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderMale + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderMale)/3 
                                >
                                (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderFemale + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderFemale + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderFemale) / 3",
                      "OverallLatencyThreeConditionsTDCMaleSlowerTDCFemale")

TDCMaleSlowerTDCFemale_MG <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderMale > DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderFemale",
                      "TDCMaleSlowerTDCFemale_MG")

TDCMaleSlowerTDCFemale_Q_F <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderMale > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderFemale",
                      "TDCMaleSlowerTDCFemale_Q_F")

TDCMaleSlowerTDCFemale_Q_UF <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderMale < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderFemale",
                      "TDCMaleSlowerTDCFemale_Q_UF")

OverallLatencyThreeConditionsASDMaleSlowerASDNonBinary <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderMale + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale)/3 
                                >
                                (DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderNonBinary +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary) / 3",
                      "OverallLatencyThreeConditionsASDMaleSlowerASDNonBinary")

ASDMaleSlowerASDNonBinary_MG <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale > DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary",
                      "ASDMaleSlowerASDNonBinary_MG")

ASDMaleSlowerASDNonBinary_Q_F <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderMale > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderNonBinary",
                      "ASDMaleSlowerASDNonBinary_Q_F")

ASDMaleSlowerASDNonBinary_Q_UF <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale > DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary",
                      "ASDMaleSlowerASDNonBinary_Q_UF")

OverallLatencyThreeConditionsASDFemaleSlowerASDNonBinary <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderFemale + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale)/3 
                                >
                                (DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderNonBinary +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary) / 3",
                      "OverallLatencyThreeConditionsASDFemaleSlowerASDNonBinary")

ASDFemaleSlowerASDNonBinary_MG <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale > DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary",
                      "ASDFemaleSlowerASDNonBinary_MG")

ASDFemaleSlowerASDNonBinary_Q_F <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderFemale > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderNonBinary",
                      "ASDFemaleSlowerASDNonBinary_Q_F")

ASDFemaleSlowerASDNonBinary_MG_Q_UF <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale > DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary",
                      "ASDFemaleSlowerASDNonBinary_MG_Q_UF")

OverallLatencyThreeConditionsASDMaleSlowerTDCMale <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderMale + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale)/3 
                                <
                                (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderMale + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderMale + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderMale) / 3",
                      "OverallLatencyThreeConditionsASDMaleSlowerTDCMale")

ASDMaleSlowerTDCMale_MG <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderMale",
                      "ASDMaleSlowerTDCMale_MG")

ASDMaleSlowerTDCMale_Q_F <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderMale < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderMale",
                      "ASDMaleSlowerTDCMale_Q_F")

ASDMaleSlowerTDCMale_Q_UF <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderMale",
                      "ASDMaleSlowerTDCMale_Q_UF")


OverallLatencyThreeConditionsASDFemaleSlowerTDCFemale <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderFemale + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale)/3 
                                <
                                (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderFemale + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderFemale + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderFemale) / 3",
                      "OverallLatencyThreeConditionsASDFemaleSlowerTDCFemale")

ASDFemaleSlowerTDCFemale_MG <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderFemale",
                      "ASDFemaleSlowerTDCFemale_MG")

ASDFemaleSlowerTDCFemale_Q_F <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderFemale < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderFemale",
                      "ASDFemaleSlowerTDCFemale_Q_F")

ASDFemaleSlowerTDCFemale_Q_UF <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderFemale",
                      "ASDFemaleSlowerTDCFemale_Q_UF")


ASDMaleSlowerTDCFemale_MG <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderFemale",
                      "ASDMaleSlowerTDCFemale_MG")

ASDMaleSlowerTDCFemale_Q_F <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderMale < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderFemale",
                      "ASDMaleSlowerTDCFemale_Q_F")

ASDMaleSlowerTDCFemale_Q_UF <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderFemale",
                      "ASDMaleSlowerTDCFemale_Q_UF")

ASDFemaleSlowerTDCMale_MG <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderMale",
                      "ASDFemaleSlowerTDCMale_MG")

ASDFemaleSlowerTDCMale_Q_F <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderFemale < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderMale",
                      "ASDFemaleSlowerTDCMale_Q_F")

ASDFemaleSlowerTDCMale_Q_UF <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderMale",
                      "ASDFemaleSlowerTDCMale_Q_UF")

ASDMaleSlowerTDCMale_AcrossConditions <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderMale + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale) / 3
                      < (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderMale + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderMale + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderMale) / 3",
                      "ASDMaleSlowerTDCMale_AcrossConditions")

ASDFemaleSlowerTDCFemale_AcrossConditions <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderFemale + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale) / 3
                      < (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderFemale + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderFemale + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderFemale) / 3",
                      "ASDFemaleSlowerTDCFemale_AcrossConditions")

ASDMaleSlowerTDCFemale_AcrossConditions <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderMale + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale) / 3
                      < (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderFemale + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderFemale + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderFemale) / 3",
                      "ASDMaleSlowerTDCFemale_AcrossConditions")

ASDFemaleSlowerTDCMale_AcrossConditions <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderFemale + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale) / 3
                      < (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderMale + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderMale + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderMale) / 3",
                      "ASDFemaleSlowerTDCMale_AcrossConditions")

ASDNonBinSlowerTDCMale_MG <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderMale",
                      "ASDNonBinSlowerTDCMale_MG")

ASDNonBinSlowerTDCFemale_MG <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderFemale",
                      "ASDNonBinSlowerTDCFemale_MG")

ASDNonBinSlowerTDCMale_Q_F <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderNonBinary < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderMale",
                      "ASDNonBinSlowerTDCMale_Q_F")

ASDNonBinSlowerTDCFemale_Q_F <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderNonBinary < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderFemale",
                      "ASDNonBinSlowerTDCFemale_Q_F")

ASDNonBinSlowerTDCMale_Q_UF <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderMale",
                      "ASDNonBinSlowerTDCMale_Q_UF")

ASDNonBinSlowerTDCFemale_Q_UF <- extract_relevant_data(ChildLatency_m1_Gender,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderFemale",
                      "ASDNonBinSlowerTDCFemale_Q_UF")



ASDNonBinSlowerTDCMale_Overall <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderNonBinary + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary + DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary) / 3 < 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderMale + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale + DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale) / 3",
                      "ASDNonBinSlowerTDCMale_Overall")

ASDNonBinSlowerTDCFemale_Overall <- extract_relevant_data(ChildLatency_m1_Gender,
                      "(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderNonBinary + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary + DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary) / 3 < 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderFemale + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale + DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale) / 3",
                      "ASDNonBinSlowerTDCFemale_Overall")

# Overall values for Beta parameter
BetaParameterASD_MG_Male <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale > 0",
                 "BetaParameterASD_MG_Male")

BetaParameterASD_MG_Female <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale > 0",
                 "BetaParameterASD_MG_Female")

BetaParameterASD_MG_NonBinary <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary > 0",
                 "BetaParameterASD_MG_NonBinary")

BetaParameterASD_Q_F_Male <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderMale < 0",
                 "BetaParameterASD_Q_F_Male")

BetaParameterASD_Q_F_Female <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderFemale < 0",
                 "BetaParameterASD_Q_F_Female")

BetaParameterASD_Q_F_NonBinary <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderNonBinary < 0",
                 "BetaParameterASD_Q_F_Nonbinary")

BetaParameterASD_Q_UF_Male <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale < 0",
                 "BetaParameterASD_Q_UF_Male")

BetaParameterASD_Q_UF_Female <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale < 0",
                 "BetaParameterASD_Q_UF_Female")

BetaParameterASD_Q_UF_NonBinary <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary < 0",
                 "BetaParameterASD_Q_UF_NonBinary")

BetaParameterASD_Overall_Male <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "(beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderMale +
                 beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderMale +
                 beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderMale) / 3 < 0",
                 "BetaParameterASD_Overall_Male")

BetaParameterASD_Overall_Female <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "(beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderFemale +
                 beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderFemale +
                 beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderFemale) / 3 < 0",
                 "BetaParameterASD_Overall_Female")

BetaParameterASD_Overall_NonBinary <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "(beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary +
                 beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:GenderNonBinary +
                 beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary) / 3 < 0",
                 "BetaParameterASD_Overall_NonBinary")

BetaParameterTDC_MG_Male <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderMale > 0",
                 "BetaParameterTDC_MG_Male")

BetaParameterTDC_MG_Female <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderFemale > 0",
                 "BetaParameterTDC_MG_Female")

BetaParameterTDC_MG_NonBinary <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary > 0",
                 "BetaParameterTDC_MG_NonBinary")

BetaParameterTDC_Q_F_Male <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderMale < 0",
                 "BetaParameterTDC_Q_F_Male")

BetaParameterTDC_Q_F_Female <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderFemale < 0",
                 "BetaParameterTDC_Q_F_Female")

BetaParameterTDC_Q_F_NonBinary <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderNonBinary < 0",
                 "BetaParameterTDC_Q_F_Nonbinary")

BetaParameterTDC_Q_UF_Male <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderMale < 0",
                 "BetaParameterTDC_Q_UF_Male")

BetaParameterTDC_Q_UF_Female <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderFemale < 0",
                 "BetaParameterTDC_Q_UF_Female")

BetaParameterTDC_Q_UF_NonBinary <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary < 0",
                 "BetaParameterTDC_Q_UF_NonBinary")

BetaParameterTDC_Overall_Male <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "(beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderMale +
                 beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderMale +
                 beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderMale) / 3 < 0",
                 "BetaParameterTDC_Overall")

BetaParameterTDC_Overall_Female <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "(beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderFemale +
                 beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderFemale +
                 beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderFemale) / 3 < 0",
                 "BetaParameterTDC_Overall")

BetaParameterTDC_Overall_NonBinary <- extract_relevant_nonlatency_data(ChildLatency_m1_Gender,
                 "(beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:GenderNonBinary +
                 beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:GenderNonBinary +
                 beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:GenderNonBinary) / 3 < 0",
                 "BetaParameterTDC_Overall")


HypothesisResultsChildLatenciesModel1_Gender <- rbind(OverallLatencyThreeConditionsASD_Male,
                                               OverallLatencyThreeConditionsTD_Male,
                                               MGOverallLatencyASD_Male,
                                               Q_F_OverallLatencyASD_Male,
                                               Q_UF_OverallLatencyASD_Male,
                                               MGOverallLatencyTDC_Male,
                                               Q_F_OverallLatencyTDC_Male,
                                               Q_UF_OverallLatencyTDC_Male,
                                               
                                               OverallLatencyThreeConditionsASD_Female,
                                               OverallLatencyThreeConditionsTD_Female,
                                               MGOverallLatencyASD_Female,
                                               Q_F_OverallLatencyASD_Female,
                                               Q_UF_OverallLatencyASD_Female,
                                               MGOverallLatencyTDC_Female,
                                               Q_F_OverallLatencyTDC_Female,
                                               Q_UF_OverallLatencyTDC_Female,
                                               
                                               OverallLatencyThreeConditionsASD_NonBinary,
                                               OverallLatencyThreeConditionsTD_NonBinary,
                                               MGOverallLatencyASD_NonBinary,
                                               Q_F_OverallLatencyASD_NonBinary,
                                               Q_UF_OverallLatencyASD_NonBinary,
                                               MGOverallLatencyTDC_NonBinary,
                                               Q_F_OverallLatencyTDC_NonBinary,
                                               Q_UF_OverallLatencyTDC_NonBinary,
                                               
                                               OverallLatencyThreeConditionsASDMaleSlowerASDFemale,
                                               OverallLatencyThreeConditionsTDCMaleSlowerTDCFemale,
                                               OverallLatencyThreeConditionsASDMaleSlowerASDNonBinary,
                                               OverallLatencyThreeConditionsASDFemaleSlowerASDNonBinary,
                                               OverallLatencyThreeConditionsASDMaleSlowerTDCMale,
                                               OverallLatencyThreeConditionsASDFemaleSlowerTDCFemale,
                                               
                                               ASDMaleSlowerASDFemale_MG, 
                                               ASDMaleSlowerASDFemale_Q_F,
                                               ASDMaleSlowerASDFemale_Q_UF,
                                               TDCMaleSlowerTDCFemale_MG,
                                               TDCMaleSlowerTDCFemale_Q_F,
                                               TDCMaleSlowerTDCFemale_Q_UF,
                                               ASDMaleSlowerASDNonBinary_MG,
                                               ASDMaleSlowerASDNonBinary_Q_F,
                                               ASDMaleSlowerASDNonBinary_Q_UF,
                                               ASDFemaleSlowerASDNonBinary_MG,
                                               ASDFemaleSlowerASDNonBinary_Q_F,
                                               ASDFemaleSlowerASDNonBinary_MG_Q_UF,
                                               ASDMaleSlowerTDCMale_MG,
                                               ASDMaleSlowerTDCMale_Q_F,
                                               ASDMaleSlowerTDCMale_Q_UF,
                                               ASDFemaleSlowerTDCFemale_MG,
                                               ASDFemaleSlowerTDCFemale_Q_F,
                                               ASDFemaleSlowerTDCFemale_Q_UF,
                                               ASDMaleSlowerTDCMale_AcrossConditions,
                                               ASDFemaleSlowerTDCFemale_AcrossConditions,
                                               ASDMaleSlowerTDCFemale_AcrossConditions,
                                               ASDFemaleSlowerTDCMale_AcrossConditions,
                                               ASDMaleSlowerTDCFemale_MG,
                                               ASDMaleSlowerTDCFemale_Q_F,
                                               ASDMaleSlowerTDCFemale_Q_UF,
                                               ASDFemaleSlowerTDCMale_MG,
                                               ASDFemaleSlowerTDCMale_Q_F,
                                               ASDFemaleSlowerTDCMale_Q_UF,
                                               ASDNonBinSlowerTDCMale_MG,
                                               ASDNonBinSlowerTDCFemale_MG,
                                               ASDNonBinSlowerTDCMale_Q_F,
                                               ASDNonBinSlowerTDCFemale_Q_F,
                                               ASDNonBinSlowerTDCMale_Q_UF,
                                               ASDNonBinSlowerTDCFemale_Q_UF,
                                               ASDNonBinSlowerTDCMale_Overall,
                                               ASDNonBinSlowerTDCFemale_Overall,
                                               
                                               BetaParameterASD_MG_Male,
                                               BetaParameterASD_Q_F_Male,
                                               BetaParameterASD_Q_UF_Male,
                                               BetaParameterASD_Overall_Male,
                                               BetaParameterTDC_MG_Male,
                                               BetaParameterTDC_Q_F_Male,
                                               BetaParameterTDC_Q_UF_Male,
                                               BetaParameterTDC_Overall_Male,
                                               
                                               BetaParameterASD_MG_Female,
                                               BetaParameterASD_Q_F_Female,
                                               BetaParameterASD_Q_UF_Female,
                                               BetaParameterASD_Overall_Female,
                                               BetaParameterTDC_MG_Female,
                                               BetaParameterTDC_Q_F_Female,
                                               BetaParameterTDC_Q_UF_Female,
                                               BetaParameterTDC_Overall_Female,
                                               
                                               BetaParameterASD_MG_NonBinary,
                                               BetaParameterASD_Q_F_NonBinary,
                                               BetaParameterASD_Q_UF_NonBinary,
                                               BetaParameterASD_Overall_NonBinary,
                                               BetaParameterTDC_MG_NonBinary,
                                               BetaParameterTDC_Q_F_NonBinary,
                                               BetaParameterTDC_Q_UF_NonBinary,
                                               BetaParameterTDC_Overall_NonBinary) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

write.csv(HypothesisResultsChildLatenciesModel1_Gender, here('VBMTurnTakingFiles/stats_for_paper/model1_child_gender_stats_for_paper.csv'))
```

## RQ1, Surrogate Pairs
```{r}
# Separate the data into adult and child turns
adults <- d %>% filter(InterTurn == "Adult2Child")
children <- d %>% filter(InterTurn == "Child2Adult")

# Split data by ID
adult_list <- split(adults, adults$ID)
child_list <- split(children, children$ID)

# Function to calculate latency between turns and filter based on speaker changes
calculate_latency_and_filter <- function(df) {
  df <- df %>%
    arrange(StartTime) %>%
    mutate(PrevSpeaker = lag(Speaker),
           NextSpeaker = lead(Speaker)) %>%
    filter((Speaker == "Adult" & PrevSpeaker == "Child") |
           (Speaker == "Child" & PrevSpeaker == "Adult")) %>%
    mutate(Latency = StartTime - lag(EndTime))
  
  return(df)
}

# Create a function to shuffle adult IDs and match them with child IDs
create_surrogate_pairs <- function(child_list, adult_list) {
  child_ids <- names(child_list)
  adult_ids <- names(adult_list)
  
  # Shuffle the adult IDs to create surrogate pairings
  set.seed(10)  # Set seed for reproducibility
  shuffled_adult_ids <- sample(adult_ids)
  
  # Ensure there are no self-pairings
  while(any(child_ids == shuffled_adult_ids)) {
    shuffled_adult_ids <- sample(adult_ids)
  }
  
  surrogate_pairs <- list()
  
  for (i in seq_along(child_ids)) {
    child_id <- child_ids[i]
    surrogate_adult_id <- shuffled_adult_ids[i]
    
    child_data <- child_list[[child_id]]
    surrogate_adult_data <- adult_list[[surrogate_adult_id]]
    
    # Combine the child data with the surrogate adult data
    
    combined_data <- rbind(child_data, surrogate_adult_data) %>%
      calculate_latency_and_filter()
    
    surrogate_pairs[[child_id]] <- combined_data
  }
  
  # Combine all pairs into one dataframe
  surrogate_dataset <- bind_rows(surrogate_pairs)
  return(surrogate_dataset)
}

# Create surrogate pairs
surrogate_dataset <- create_surrogate_pairs(child_list, adult_list) %>%
  filter(!is.na(Latency))

range(surrogate_dataset$Latency)
mean(surrogate_dataset$Latency)

ggplot(surrogate_dataset) +
  geom_density(aes(x = Latency, fill = InterTurn)) +
  theme_bw()

# View the surrogate dataset
print(surrogate_dataset)
```

### Build Surrogate Model
```{r, eval = FALSE}
Latency_f1 <- bf(
  Latency ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task:Familiarity | r | Visit), 
  sigma ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task:Familiarity | r | Visit))

priorChild <- c(
  prior(normal(0, 5), class = b),
  prior(normal(0, 10), class = sd),
  prior(normal(0, 10), class = b, dpar = sigma),
  prior(normal(0, 10), class = sd, dpar = sigma),
  prior(lkj(2), class = cor)
)

ChildLatency_m1_prior <- brm(
    Latency_f1,
    subset(surrogate_dataset, InterTurn == "Child2Adult"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = "only",
    backend = "cmdstanr",
    iter = 1000,
    warmup = 200,
    init = 0,
    chains = 2,
    cores = 2,
    control = list(adapt_delta = 0.95, max_treedepth = 15),
    stan_model_args = list(stanc_options = list("O1"))
  )

pp_check(ChildLatency_m1_prior, ndraws = 100) 

surrogate_pp_check <- pp_check(ChildLatency_m1_prior, ndraws = 100) +
  xlim(c(-50, 50)) +
  theme(plot.title = element_text(hjust = 0.5, size=15, family="sans"),
        text = element_text(family="sans"),
        axis.text.x = element_text(size = 13),
        axis.title.x = element_text(size = 13),
        axis.text.y = element_blank(),
        axis.title.y = element_text(size = 13))

surrogate_dataset_sub <- surrogate_dataset %>%
  group_by(ID, Task) %>%
  sample_n(3)

job::job({
  ChildLatency_m1_surrogate <- brm(
    Latency_f1,
    data = subset(surrogate_dataset, InterTurn == "Child2Adult"),
    family = gaussian,
    prior = priorChild,
    sample_prior = T,
    backend = "cmdstanr",
    iter = 3000,
    warmup = 500,
    init = 0,
    chains = 2,
    cores = 64,
    file = here("models","ChildLatency_m1_surrogateNew"),
    control = list(adapt_delta = 0.999, max_treedepth = 20),
    stan_model_args = list(stanc_options = list("O1")))
})

pp_check(ChildLatency_m1_surrogate, ndraws = 100)
```

### Hypothesis Tests
```{r}
# Overall Estimates in Autism Group
OverallLatencyThreeConditionsASD <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
                      "OverallLatencyThreeConditionsASD")

MGOverallLatencyASD <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
                      "MGOverallLatencyASD>0")

Q_F_OverallLatencyASD <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > 0",
                      "Q_F_OverallLatencyASD>0")

Q_UF_OverallLatencyASD <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > 0",
                      "Q_UF_OverallLatencyASD>0")

# Overall Estimates in TD Group
OverallLatencyThreeConditionsTD <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3 > 0",
                      "OverallLatencyThreeConditionsTD")

MGOverallLatencyTDC <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
                      "MGOverallLatencyTDC>0")

Q_F_OverallLatencyTDC <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar > 0",
                      "Q_F_OverallLatencyTDC>0")

Q_UF_OverallLatencyTDC <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > 0",
                      "Q_UF_OverallLatencyTDC>0")

# Overall Differences between Autism Group and Typical Development Group
OverallLatencyThreeConditionsASDFasterTD <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar +DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 
                                <
                                (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3",
                      "OverallLatencyThreeConditionsASD<TD")


# Overall values for Beta parameter
# BetaParameterASD_MG <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
#                  "BetaParameterASD_MG")
# 
# BetaParameterASD_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < 0",
#                  "BetaParameterASD_Q_F")
# 
# BetaParameterASD_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < 0",
#                  "BetaParameterASD_Q_UF")
# 
# BetaParameterASD_Overall <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "(beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar +
#                  beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar +
#                  beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) / 3 < 0",
#                  "BetaParameterASD_Overall")
# 
# # Differences, Typical Development Group with Long Pauses
# BetaParameterTDC_MG <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
#                  "BetaParameterTDC_MG")
# 
# BetaParameterTDC_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar < 0",
#                  "BetaParameterTDC_Q_F")
# 
# BetaParameterTDC_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar < 0",
#                  "BetaParameterTDC_Q_UF")
# 
# BetaParameterTDC_Overall <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "(beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar +
#                  beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar +
#                  beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3 < 0",
#                  "BetaParameterTDC_Overall")
# 
# 
# 
# 
# WithinGroupBetaParameterASD_MG_Slower_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
#                  "WithinGroupBetaParameterASD_MG_Slower_Q_F")
# 
# WithinGroupBetaParameterASD_Q_F_Slower_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
#                  "WithinGroupBetaParameterASD_Q_F_Slower_Q_UF")
# 
# WithinGroupBetaParameterTDC_MG_Slower_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
#                  "WithinGroupBetaParameterTDC_MG_Slower_Q_F")
# 
# WithinGroupBetaParameterTDC_Q_F_Slower_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
#                  "WithinGroupBetaParameterTDC_Q_F_Slower_Q_UF")
# 
# DifferenceInDifferenceBetaParameterBetweenGroupsMGBiggerQ_F <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "(beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar - beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar) > 
#                  (beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar - beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar)",
#                  "DifferenceInDifferenceBetaParameterBetweenGroupsMGBiggerQ_F")
# 
# DifferenceInDifferenceBetaParameterBetweenGroupsFamiliarityBiggerUnfamiliarity <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "(beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar - beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar) < 
#                  (beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar - beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)",
#                  "DifferenceInDifferenceBetaParameterBetweenGroupsFamiliarityBiggerUnfamiliarity")
# 
# # Differences between Autism Group and Typical Development Group with Long Pauses
# OverallBetaParameterASDLowerTD <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                  "(beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar + beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar) / 3 < ((beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) / 3)",
#                  "OverallBetaParameterASD<TD")
# 
# BetaParameterASDFasterTD_MG <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                       "beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
#                       "BetaParameter_ASD_MG<TD_MG")
# 
# BetaParameterASDFasterTD_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                       "beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
#                       "BetaParameter_ASD_MG<TD_Q_F")
# 
# BetaParameterASDFasterTD_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate,
#                       "beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
#                       "BetaParameter_ASD_MG<TD_Q_UF")

# Differences within Autism Group across Conditions:
WithinASDGroupMGSlowerQuestionsFamiliar <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                      "WithinASDGroupMG>QuestionsFamiliar")

# Differences within TD Group across Conditions:
WithinTDGroupMGSlowerQuestionsFamiliar <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinTDGroupMG>QuestionsFamiliar")

# Differences within Autism Group across Familiarity:
WithinAutismGroupQuestionsUnfamiliarSlowerFamiliar <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > DiagnosisASD:TaskQuestions:FamiliarityFamiliar",
                      "WithinAutismGroupQuestionsUnfamiliar>Familiar")

# Differences within TD Group across Familiarity:
WithinTDGroupQuestionsUnfamiliarSlowerFamiliar <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinTDGroupQuestionsUnfamiliar>Familiar")

# Differences between Autism Group and Typical Development Group Within MatchingGame
WithinConditionsMatchingGameASDFasterTD <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                      "WithinConditionsMatchingGameASD<TD")

# Differences between Autism Group and Typical Development Group Within Familiar Questions:
WithinConditionsQuestionsFamiliarASDFasterTD <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar < DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                      "WithinConditionsQuestionsFamiliarASD<TD")

# Differences between Autism Group and Typical Development Group Within Unfamiliar Questions:
WithinConditionsQuestionsUnfamiliarASDFasterTD <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                      "WithinConditionsQuestionsUnfamiliarASD<TD")

# Differences between Autism Group and Typical Development Group in Differences within Familiarity
DifferenceInDifferenceBetweenGroupsUnfamiliarBiggerFamiliarity <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) < 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                      "DifferenceInDifferenceBetweenGroupsUnfamiliar>Familiarity")

# Differences between Autism Group and Typical Development Group in Differences within Conditions
DifferenceInDifferenceBetweenGroupsMGBiggerThanConversations <- extract_relevant_data(ChildLatency_m1_surrogate,
                      "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar) > 
                      (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                      "DifferenceInDifferenceBetweenGroupsMG>Conversations")

# Overall Subject Variability in Autismm Group
SubjectVariabilityASD <- extract_relevant_sd_data(ChildLatency_m1_surrogate, 
                                               "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisASD + TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD)/3 > 0",
                                               "SubjectVariabilityASD")

SubjectVariabilityASD_MG <- extract_relevant_sd_data(ChildLatency_m1_surrogate, 
                                               "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_MG")

SubjectVariabilityASD_Q_F <- extract_relevant_sd_data(ChildLatency_m1_surrogate, 
                                               "TaskQuestions:FamiliarityFamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_Q_F")

SubjectVariabilityASD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_surrogate, 
                                               "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD > 0",
                                               "SubjectVariabilityASD_Q_UF")

# Overall Subject Variability in TD Group
SubjectVariabilityTD <- extract_relevant_sd_data(ChildLatency_m1_surrogate, 
                                               "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisTDC + TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC)/3 > 0",
                                               "SubjectVariabilityTD")

SubjectVariabilityTD_MG <- extract_relevant_sd_data(ChildLatency_m1_surrogate, 
                                               "TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_MG")

SubjectVariabilityTD_Q_F <- extract_relevant_sd_data(ChildLatency_m1_surrogate, 
                                               "TaskQuestions:FamiliarityFamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_Q_F")

SubjectVariabilityTD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_surrogate, 
                                               "TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC > 0",
                                               "SubjectVariabilityTD_Q_UF")

# Overall Subject Variability in TD Group
SubjectVariabilityASDSmallerThanTD <- extract_relevant_sd_data(ChildLatency_m1_surrogate,
                                              "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisASD + TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD) / 3 <
                                              (TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC + 
                                               TaskQuestions:FamiliarityFamiliar:DiagnosisTDC + TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC) / 3",
                                               "SubjectVariabilityASD<TD")


SubjectVariabilityASDSmallerThanTD_MG <- extract_relevant_sd_data(ChildLatency_m1_surrogate,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD  <
                                              TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_MG<TD_MG")

SubjectVariabilityASDSmallerThanTD_Q_F <- extract_relevant_sd_data(ChildLatency_m1_surrogate,
                                              "TaskQuestions:FamiliarityFamiliar:DiagnosisASD  <
                                              TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_Q_F<TD_Q_F")

SubjectVariabilityASDSmallerThanTD_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_surrogate,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD  <
                                              TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC",
                                               "SubjectVariabilityASD_Q_UF<TD_Q_UF")

SubjectVariabilityASD_MG_SmallerThan_Q_F <- extract_relevant_sd_data(ChildLatency_m1_surrogate,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD > TaskQuestions:FamiliarityFamiliar:DiagnosisASD",
                                               "SubjectVariabilityASD_MG_SmallerThan_Q_F")

SubjectVariabilityASD_Q_F_SmallerThan_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_surrogate,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD > TaskQuestions:FamiliarityFamiliar:DiagnosisASD",
                                               "SubjectVariabilityASD_Q_F_SmallerThan_Q_UF")

SubjectVariabilityTDC_MG_SmallerThan_Q_F <- extract_relevant_sd_data(ChildLatency_m1_surrogate,
                                              "TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC < TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityTDC_MG_SmallerThan_Q_F")

SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF <- extract_relevant_sd_data(ChildLatency_m1_surrogate,
                                              "TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC > TaskQuestions:FamiliarityFamiliar:DiagnosisTDC",
                                               "SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF")

DifferenceInDifferenceSubjectVariabilityUnfamiliarSmallerFamiliarity <- extract_relevant_sd_data(ChildLatency_m1_surrogate,
                                              "(TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD - TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC) 
                                              < 
                                              (TaskQuestions:FamiliarityFamiliar:DiagnosisASD - TaskQuestions:FamiliarityFamiliar:DiagnosisTDC)",
                                              "DifferenceInDifferenceSubjectVariabilityUnfamiliarBiggerFamiliarity")

DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions <- extract_relevant_sd_data(ChildLatency_m1_surrogate,
                                              "(TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC - TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD) 
                                              < 
                                              (TaskQuestions:FamiliarityFamiliar:DiagnosisTDC - TaskQuestions:FamiliarityFamiliar:DiagnosisASD)",
                                              "DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions")

# # Overall Visit Variability across visits in Autism Group
# VisitVariabilityASDOverall <- extract_relevant_sdvisit_data(ChildLatency_m1_surrogate, 
#                                                "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
#                                                "VisitVariabilityASDOverall")
# 
# # Overall Visit Variability across visits in TD Group
# VisitVariabilityTDCOverall <- extract_relevant_sdvisit_data(ChildLatency_m1_surrogate, 
#                                                "(DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3 > 0",
#                                                "VisitVariabilityTDCOverall")
# 
# 
# VisitVariabilityASDOverallHigherTDSOverall <- extract_relevant_sdvisit_data(ChildLatency_m1_surrogate, 
#                                                "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityFamiliar + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 >
#                                                (DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3",
#                                                "VisitVariabilityASDOverallLowerTDSOverall")
# 
# # Subject Variability across visits MG in Autism Group
# VisitVariabilityASDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_surrogate, 
#                                                "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > 0",
#                                                "VisitVariabilityASDMG")
# 
# # Overall Subject Variability across visits in TD Group
# VisitVariabilityTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_surrogate, 
#                                                "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar > 0",
#                                                "VisitVariabilityTDMG")
# 
# # Subject Variability across visits MG in Autism Group
# VisitVariabilityASD_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1_surrogate, 
#                                                "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > 0",
#                                                "VisitVariabilityASD_Q_F")
# 
# # Overall Subject Variability across visits in TD Group
# VisitVariabilityTDC_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1_surrogate, 
#                                                "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar > 0",
#                                                "VisitVariabilityTDC_Q_F")
# 
# # Subject Variability across visits MG in Autism Group
# VisitVariabilityASD_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1_surrogate, 
#                                                "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > 0",
#                                                "VisitVariabilityASD_Q_UF")
# 
# # Overall Subject Variability across visits in TD Group
# VisitVariabilityTDC_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1_surrogate, 
#                                                "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > 0",
#                                                "VisitVariabilityTDC_Q_UF")
# 
# # Overall Subject Variability across visits, differences
# VisitVariabilityASDMGSlowerThanTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_surrogate, 
#                                                "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar",
#                                                "VisitVariabilityASDMG>TDMG")
# 
# # Overall Subject Variability across visits, differences
# VisitVariabilityASD_Q_F_SlowerThanTD_Q_F <- extract_relevant_sdvisit_data(ChildLatency_m1_surrogate, 
#                                                "DiagnosisASD:TaskQuestions:FamiliarityFamiliar > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
#                                                "VisitVariabilityASD_Q_F_SlowerThanTD_Q_F")
# 
# # Overall Subject Variability across visits, differences
# VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF <- extract_relevant_sdvisit_data(ChildLatency_m1_surrogate, 
#                                                "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
#                                                "VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF")
# 
# #DifferenceInDifference:
# DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity <- extract_relevant_sdvisit_data(ChildLatency_m1_surrogate, 
#                                                "(DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)
#                                                < (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
#                                                "DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity")
# 
# DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG <- extract_relevant_sdvisit_data(ChildLatency_m1_surrogate, 
#                                                "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)
#                                                > (DiagnosisASD:TaskQuestions:FamiliarityFamiliar - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
#                                                "DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG")


# Overall Sigma Variability across visits in Autism Group
SigmaASDOverall <- extract_relevant_sigma_data(ChildLatency_m1_surrogate, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 < 0",
                                               "SigmaASDOverall")

# Overall Sigma Variability across visits in TD Group
SigmaTDCOverall <- extract_relevant_sigma_data(ChildLatency_m1_surrogate, 
                                               "(sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar) /3 < 0",
                                               "SigmaTDCOverall")


SigmaASDOverallHigherTDSOverall <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar)/3 >
                                               (sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar + sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar  + sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)/3",
                                               "SigmaASDOverallHigherTDSOverall")

# Subject Variability across visits MG in Autism Group
SigmaASDMG <- extract_relevant_sigma_data(ChildLatency_m1_surrogate, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar < 0",
                                               "SigmaASDMG")

# Overall Subject Variability across visits in TD Group
SigmaTDMG <- extract_relevant_sigma_data(ChildLatency_m1_surrogate, 
                                               "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < 0",
                                               "SigmaTDMG")

# Subject Variability across visits MG in Autism Group
SigmaASD_Q_F <- extract_relevant_sigma_data(ChildLatency_m1_surrogate, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < 0",
                                               "SigmaASD_Q_F")

# Overall Subject Variability across visits in TD Group
SigmaTDC_Q_F <- extract_relevant_sigma_data(ChildLatency_m1_surrogate, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar < 0",
                                               "SigmaTDC_Q_F")


# Subject Variability across visits MG in Autism Group
SigmaASD_Q_UF <- extract_relevant_sigma_data(ChildLatency_m1_surrogate, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar < 0 ",
                                               "SigmaASD_Q_UF")

# Overall Subject Variability across visits in TD Group
SigmaTDC_Q_UF <- extract_relevant_sigma_data(ChildLatency_m1_surrogate, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar < 0",
                                               "SigmaTDC_Q_UF")

# Overall Subject Variability across visits, differences
SigmaASDMGSlowerThanTDMG <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar",
                                               "SigmaASDMGSlowerThanTDMG")

# Overall Subject Variability across visits, differences
SigmaASD_Q_F_SlowerThanTD_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar < sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar",
                                               "SigmaASD_Q_F_SlowerThanTD_Q_F")

# Overall Subject Variability across visits, differences
SigmaASD_Q_UF_SlowerThanTD_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar",
                                               "SigmaASD_Q_UF_SlowerThanTD_Q_UF")

# Sigma across visits, differences
# SigmaASD_MG_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit < 0",
#                                                "SigmaASD_MG_VisitLowerZero")

# SigmaTDC_MG_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit > 0",
#                                                "SigmaTDC_MG_VisitLowerZero")
# 
# SigmaASD_MG_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "SigmaASD_MG_VisitLowerTDC")
# 
# SigmaASD_Overall_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit + 
#                                                sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit +
#                                                sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 < 0",
#                                                "SigmaASD_Overall_VisitLowerZero")
# 
# SigmaTDC_Overall_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "(sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit + 
#                                                sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit +
#                                                sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 < 0",
#                                                "SigmaTDC_Overall_VisitLowerZero")
# 
# # Sigma across visits, differences
# SigmaASD_Q_F_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit > 0",
#                                                "SigmaASD_Q_F_VisitLowerZero")
# 
# SigmaTDC_Q_F_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit < 0",
#                                                "SigmaTDC_Q_F_VisitLowerZero")
# 
# SigmaASD_Q_F_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "SigmaASD_Q_F_VisitLowerTDC")
# 
# # Sigma across visits, differences
# SigmaASD_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < 0",
#                                                "SigmaASD_Q_UF_VisitLowerZero")
# 
# SigmaTDC_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > 0",
#                                                "SigmaTDC_Q_UF_VisitLowerZero")
# 
# SigmaASD_Q_UF_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "SigmaASD_Q_UF_VisitLowerTDC")
# 
# SigmaVisitOverall_ASDLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit + 
#                                                sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit +
#                                                sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit) / 3 > (sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit + 
#                                                sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit +
#                                                sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) /3",
#                                                "SigmaVisitOverall_ASDLowerTDC")

#DifferenceInDifference:
DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
                                               "(sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar)
                                               > (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity")

DifferenceInDifferenceSigmaASDMGSmallerThanTDMG <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
                                               "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar)
                                               > (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar)",
                                               "DifferenceInDifferenceSigmaASDMGSmallerThanTDMG")

#WithinGroups
WithinGroupSigmaASD_Q_F_Faster_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
                                               "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaASD_Q_FFaster_UF")

WithinGroupSigmaTDC_Q_F_Faster_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
                                               "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar > sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaTDC_Q_F_Faster_UF")

WithinGroupSigmaASD_Q_F_Faster_MG <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
                                               "sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar > sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaASD_Q_F_Faster_MG")

WithinGroupSigmaTDC_Q_F_Faster_MG <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
                                               "sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar < sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar ",
                                               "WithinGroupSigmaTDC_Q_F_Faster_MG")


# WithinGroupSigmaASD_Q_F_Lower_UF_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit",
#                                                "WithinGroupSigmaASD_Q_F_Lower_UF_Visit")
# 
# WithinGroupSigmaTDC_Q_F_Lower_UF_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit",
#                                                "WithinGroupSigmaTDC_Q_F_Lower_UF_Visit")
# 
# WithinGroupSigmaASD_Q_F_Lower_MG_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "WithinGroupSigmaASD_Q_F_Lower_MG_Visit")
# 
# WithinGroupSigmaTDC_Q_F_Lower_MG_Visit <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "WithinGroupSigmaTDC_Q_F_Lower_MG_Visit")
# 
# 
# SigmaTDC_Q_UF_VisitLowerZero <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit > 0",
#                                                "SigmaTDC_Q_UF_VisitLowerZero")
# 
# SigmaASD_Q_UF_VisitLowerTDC <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit < sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit",
#                                                "SigmaASD_Q_UF_VisitLowerTDC")
# 
# 
# DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "(sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:Visit) <
#                                                (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit)", "DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF")
# 
# 
# DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F <- extract_relevant_nonlatency_data(ChildLatency_m1_surrogate, 
#                                                "(sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:Visit) <
#                                                (sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar:Visit - sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:Visit)", "DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F")



# Correlation Estimates across visits in Autism Group
post <- as_draws_df(ChildLatency_m1_surrogate)


# Apply the function for each case
cor_post_mu_MG_ASD <- Visitextract_and_rename(post, "DiagnosisASD", "TaskMatchingGame", "FamiliarityFamiliar") %>%
  cor() %>%
  as.matrix()

cor_post_mu_MG_TDC <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskMatchingGame", "FamiliarityFamiliar") %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_ASD_Familiar <- Visitextract_and_rename(post, "DiagnosisASD", "TaskQuestions", "FamiliarityFamiliar") %>%
  select(Visit2, Visit4, Visit6) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_TDC_Familiar <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskQuestions", "FamiliarityFamiliar") %>%
  select(Visit2, Visit4, Visit6) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_ASD_Unfamiliar <- Visitextract_and_rename(post, "DiagnosisASD", "TaskQuestions", "FamiliarityUnfamiliar") %>%
  select(Visit1, Visit3, Visit5, Visit7) %>%
  cor() %>%
  as.matrix()

cor_post_mu_Q_TDC_Unfamiliar <- Visitextract_and_rename(post, "DiagnosisTDC", "TaskQuestions", "FamiliarityUnfamiliar") %>%
  select(Visit1, Visit3, Visit5, Visit7) %>%
  cor() %>%
  as.matrix()

diag(cor_post_mu_MG_ASD) <- NA
diag(cor_post_mu_MG_TDC) <- NA
diag(cor_post_mu_Q_ASD_Familiar) <- NA
diag(cor_post_mu_Q_TDC_Familiar) <- NA
diag(cor_post_mu_Q_ASD_Unfamiliar) <- NA
diag(cor_post_mu_Q_TDC_Unfamiliar) <- NA

CorrelationSummaryStatistics <- tibble(
       Estimate = c(mean(cor_post_mu_MG_ASD, na.rm = TRUE), mean(cor_post_mu_Q_ASD_Familiar, na.rm = TRUE), mean(cor_post_mu_Q_ASD_Unfamiliar, na.rm = TRUE), 
                    mean(cor_post_mu_MG_TDC, na.rm = TRUE), mean(cor_post_mu_Q_TDC_Familiar, na.rm = TRUE), mean(cor_post_mu_Q_TDC_Unfamiliar, na.rm = TRUE)),
       CI.Lower = c(quantile(cor_post_mu_MG_ASD, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Familiar, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Unfamiliar, probs = 0.025, na.rm = TRUE), 
                    quantile(cor_post_mu_MG_TDC, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Familiar, probs = 0.025, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Unfamiliar, probs = 0.025, na.rm = TRUE)),
       CI.Upper = c(quantile(cor_post_mu_MG_ASD, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Familiar, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_ASD_Unfamiliar, probs = 0.975, na.rm = TRUE), 
                    quantile(cor_post_mu_MG_TDC, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Familiar, probs = 0.975, na.rm = TRUE), quantile(cor_post_mu_Q_TDC_Unfamiliar, probs = 0.975, na.rm = TRUE)),
       Evid.Ratio = c(NA, NA, NA, NA, NA, NA),
       TestDescription = c(
  "CorrelationAcrossVisitsASDMG", "CorrelationAcrossVisitsASDFamiliarQuestions", "CorrelationAcrossVisitsASDUnfamiliarQuestions",
  "CorrelationAcrossVisitsTDMG", "CorrelationAcrossVisitsTDFamiliarQuestions", "CorrelationAcrossVisitsTDUnfamiliarQuestions"),
       )

HypothesisResultsChildLatenciesModel1 <- rbind(OverallLatencyThreeConditionsASD,
                                               OverallLatencyThreeConditionsTD,
                                               MGOverallLatencyASD,
                                               Q_F_OverallLatencyASD,
                                               Q_UF_OverallLatencyASD,
                                               MGOverallLatencyTDC,
                                               Q_F_OverallLatencyTDC,
                                               Q_UF_OverallLatencyTDC,
                                               # BetaParameterASD_MG,
                                               # BetaParameterASD_Q_F,
                                               # BetaParameterASD_Q_UF,
                                               # BetaParameterASD_Overall,
                                               # BetaParameterTDC_MG,
                                               # BetaParameterTDC_Q_F,
                                               # BetaParameterTDC_Q_UF,
                                               # BetaParameterTDC_Overall,
                                               # OverallBetaParameterASDLowerTD,
                                               # BetaParameterASDFasterTD_MG,
                                               # BetaParameterASDFasterTD_Q_F,
                                               # BetaParameterASDFasterTD_Q_UF,
                                               # WithinGroupBetaParameterASD_MG_Slower_Q_F,
                                               # WithinGroupBetaParameterTDC_MG_Slower_Q_F,
                                               # DifferenceInDifferenceBetaParameterBetweenGroupsMGBiggerQ_F,
                                               # WithinGroupBetaParameterASD_Q_F_Slower_Q_UF,
                                               # WithinGroupBetaParameterTDC_Q_F_Slower_Q_UF,
                                               # DifferenceInDifferenceBetaParameterBetweenGroupsFamiliarityBiggerUnfamiliarity,
                                               OverallLatencyThreeConditionsASDFasterTD,
                                               WithinASDGroupMGSlowerQuestionsFamiliar,
                                               WithinTDGroupMGSlowerQuestionsFamiliar,
                                               WithinAutismGroupQuestionsUnfamiliarSlowerFamiliar,
                                               WithinTDGroupQuestionsUnfamiliarSlowerFamiliar,
                                               WithinConditionsMatchingGameASDFasterTD,
                                               WithinConditionsQuestionsFamiliarASDFasterTD,
                                               WithinConditionsQuestionsUnfamiliarASDFasterTD,
                                               DifferenceInDifferenceBetweenGroupsUnfamiliarBiggerFamiliarity,
                                               DifferenceInDifferenceBetweenGroupsMGBiggerThanConversations,
                                               SubjectVariabilityASD,
                                               SubjectVariabilityTD,
                                               SubjectVariabilityASDSmallerThanTD,
                                               SubjectVariabilityASD_MG,
                                               SubjectVariabilityASD_Q_F,
                                               SubjectVariabilityASD_Q_UF,
                                               SubjectVariabilityTD_MG,
                                               SubjectVariabilityTD_Q_F,
                                               SubjectVariabilityTD_Q_UF,
                                               SubjectVariabilityASDSmallerThanTD_MG,
                                               SubjectVariabilityASDSmallerThanTD_Q_F,
                                               SubjectVariabilityASDSmallerThanTD_Q_UF,
                                               SubjectVariabilityASD_MG_SmallerThan_Q_F,
                                               SubjectVariabilityASD_Q_F_SmallerThan_Q_UF,
                                               SubjectVariabilityTDC_MG_SmallerThan_Q_F,
                                               SubjectVariabilityTDC_Q_F_SmallerThan_Q_UF,
                                               DifferenceInDifferenceSubjectVariabilityUnfamiliarSmallerFamiliarity,
                                               DifferenceInDifferenceSubjectVariabilityMatchingGameBiggerQuestions,
                                               VisitVariabilityASDMG,
                                               VisitVariabilityTDMG,
                                               VisitVariabilityASD_Q_F,
                                               VisitVariabilityTDC_Q_F,
                                               VisitVariabilityASD_Q_UF,
                                               VisitVariabilityTDC_Q_UF,
                                               VisitVariabilityASDOverall,
                                               VisitVariabilityTDCOverall,
                                               VisitVariabilityASDMGSlowerThanTDMG,
                                               VisitVariabilityASD_Q_F_SlowerThanTD_Q_F,
                                               VisitVariabilityASD_Q_UF_SlowerThanTD_Q_UF,
                                               VisitVariabilityASDOverallHigherTDSOverall,
                                               DifferenceInDifferenceVisitVariabilityASDMGSmallerThanTDMG,
                                               DifferenceInDifferenceVisitVariabilityASDFamiliarityTDUnfamiliarity,
                                               SigmaASDOverall,
                                               SigmaTDCOverall,
                                               SigmaASDOverallHigherTDSOverall,
                                               SigmaASDMG,
                                               SigmaTDMG,
                                               SigmaASD_Q_F,
                                               SigmaTDC_Q_F,
                                               SigmaASD_Q_UF,
                                               SigmaTDC_Q_UF,
                                               SigmaASDMGSlowerThanTDMG,
                                               SigmaASD_Q_F_SlowerThanTD_Q_F,
                                               SigmaASD_Q_UF_SlowerThanTD_Q_UF,
                                               # SigmaASD_MG_VisitLowerZero,
                                               # SigmaTDC_MG_VisitLowerZero,
                                               # SigmaASD_MG_VisitLowerTDC,
                                               # SigmaASD_Q_F_VisitLowerZero,
                                               # SigmaTDC_Q_F_VisitLowerZero,
                                               # SigmaASD_Q_F_VisitLowerTDC,
                                               # SigmaASD_Q_UF_VisitLowerZero,
                                               # SigmaTDC_Q_UF_VisitLowerZero,
                                               # SigmaASD_Q_UF_VisitLowerTDC,
                                               # SigmaASD_Overall_VisitLowerZero,
                                               # SigmaTDC_Overall_VisitLowerZero,
                                               # WithinGroupSigmaASD_Q_F_Lower_UF_Visit,
                                               # WithinGroupSigmaTDC_Q_F_Lower_UF_Visit,
                                               # WithinGroupSigmaASD_Q_F_Lower_MG_Visit,
                                               # WithinGroupSigmaTDC_Q_F_Lower_MG_Visit,
                                               WithinGroupSigmaASD_Q_F_Faster_UF,
                                               WithinGroupSigmaTDC_Q_F_Faster_UF,
                                               WithinGroupSigmaASD_Q_F_Faster_MG,
                                               WithinGroupSigmaTDC_Q_F_Faster_MG,
                                               # SigmaVisitOverall_ASDLowerTDC,
                                               # DifferenceInDifferenceSigmaVisit_Q_F_Lower_Q_UF,
                                               # DifferenceInDifferenceSigmaVisit_MG_Lower_Q_F,
                                               DifferenceInDifferenceSigmaASDFamiliarityBiggerTDUnfamiliarity,
                                               DifferenceInDifferenceSigmaASDMGSmallerThanTDMG,
                                               CorrelationSummaryStatistics) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))


write.csv(HypothesisResultsChildLatenciesModel1, here('VBMTurnTakingFiles/stats_for_paper/Model1_childsurrogate_stats_for_paper.csv'))
```

### Visualisation of Model Estimates
```{r}
newdata <- subset(d, InterTurn == "Child2Adult") %>%
  group_by(ID, Diagnosis, Task, Familiarity, Visit) %>%
  dplyr::summarise(n = n()) %>%
  select(-n) 

C2P_PredictedData <- as_tibble(predict(ChildLatency_m1_surrogate, newdata = newdata)) %>%
  mutate(Visit = newdata$Visit) %>%
  mutate(Diagnosis = newdata$Diagnosis) %>%
  mutate(ID = newdata$ID) %>%
  mutate(Familiarity = newdata$Familiarity) %>%
  mutate(Task = newdata$Task) %>%
  mutate(size = Q97.5-Q2.5) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  group_by(Diagnosis, ID, Familiarity, Task) %>%
  dplyr::summarise(Estimate = mean(Estimate)) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

Posterior_df <- as_draws_df(ChildLatency_m1_surrogate)

condition_posterior_TDC_MG <- Posterior_df[,"b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "MatchingGame",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_ASD_MG <- Posterior_df[,"b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "MatchingGame",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_TDC_Q_F <- Posterior_df[,"b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "Questions",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_ASD_Q_F <- Posterior_df[,"b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar"] %>%
  mutate(Familiarity = "Familiar",
         Task = "Questions",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

condition_posterior_TDC_Q_UF <- Posterior_df[,"b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar"] %>%
  mutate(Familiarity = "Unfamiliar",
         Task = "Questions",
         Diagnosis = "TDC") %>%
  rename("Estimate" = `b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent"))) 

condition_posterior_ASD_Q_UF <- Posterior_df[,"b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar"] %>%
  mutate(Familiarity = "Unfamiliar",
         Task = "Questions",
         Diagnosis = "ASD") %>%
  rename("Estimate" = `b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar`) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent")))

posteriors <- rbind(condition_posterior_ASD_MG, condition_posterior_TDC_MG,
      condition_posterior_ASD_Q_F, condition_posterior_TDC_Q_F, 
      condition_posterior_ASD_Q_UF, condition_posterior_TDC_Q_UF)

Model1_Plot_Child_ConditionsSurrogate <- Model1_Plot_Child_Conditions <- ggplot() +
  geom_rect(aes(xmin=-Inf, xmax = 1.47, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_rect(aes(xmin=1.47, xmax = 2.48, ymin=-Inf, ymax=Inf), fill = "honeydew3", alpha = 0.3) +
  geom_rect(aes(xmin=2.48, xmax = 3.6, ymin=-Inf, ymax=Inf), fill = "honeydew4", alpha = 0.3) +
  geom_boxplot(aes(Condition, Estimate, color = Diagnosis, fill = Diagnosis), filter(posteriors, Diagnosis == "Autism Group"), width = 0.05, color = "black", position = position_nudge(x = -0.30), alpha = 0.9, outliers = F, show.legend = T) +
  geom_boxplot(aes(Condition, Estimate, color = Diagnosis, fill = Diagnosis), filter(posteriors, Diagnosis == "Typical Development"), width = 0.05, color = "black", position = position_nudge(x = -0.10), alpha = 0.9, outliers = F, show.legend = T) +
  geom_point(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "#009E73", alpha = 0.7, data = filter(C2P_PredictedData, Diagnosis == "Autism Group"), size = 2, position = position_nudge(x = -.22)) + 
  geom_point(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "#CC79A7", alpha = 0.7, data = filter(C2P_PredictedData, Diagnosis == "Typical Development"), size = 2, position = position_nudge(x = -.18)) + 
  geom_half_violin(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#009E73", color = "black", alpha = 0.9, data = filter(posteriors, Diagnosis == "Autism Group"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  geom_half_violin(aes(Condition, Estimate, fill = Diagnosis, color = Diagnosis), fill = "#CC79A7", color = "black", alpha = 0.9, data = filter(posteriors, Diagnosis == "Typical Development"), side = "r", position = position_nudge(x = 0), adjust = 0.8) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  #scale_fill_okabeito() +
  #scale_color_okabeito() +
  xlab(' ') +
  coord_flip() +
  ylab('Average Child Response Latency (seconds)') +
  guides(color = guide_legend(reverse=TRUE), fill = guide_legend(reverse=TRUE)) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_text(size = 15, color = "black"),
        legend.title = element_blank(),
        legend.position = c(0.25, 0.92),
        legend.key.size = unit(3, "lines"),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key = element_rect(fill = "transparent", color = NA),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 15, color = "black"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

Model1_Plot_Child_ConditionsSurrogate
```


## RQ4, Removal of Utterances that are Solely Backchannels
```{r}
contains_backchannels <- d %>%
  mutate(Transcript = tolower(Transcript)) %>%
  mutate(Transcript = gsub("[[:punct:]]", "", Transcript)) %>%
  count(Transcript) %>%
  arrange(-n) %>%
  filter(n > 10) %>%
  filter(!Transcript %in% c("", " ", "  ", "   ")) %>%
  filter(!Transcript %in% c("which one", "okay your turn", "all right", "i dont know", "your turn", "and", "why",
                            "got it", "sing", "what else", "go ahead", "all right your turn", "in the middle",
                            "did you like your food", "say that again", "good", "my turn","gotcha",
                             "um i dont know", "uh i dont know", "okay all right", "i know", "i", "so"))

# Convert the data frame to an xtable object
xtable_df <- xtable(contains_backchannels)

# Print the xtable object, which generates the LaTeX code
print(xtable_df, type = "latex")

d_pred_nobackchannels <- d %>%
  rowwise() %>%
  filter(!sapply(Transcript, function(x) any(Transcript %in% contains_backchannels$Transcript))) %>%
  subset(InterTurn == "Child2Adult") %>%
  print(n = 50)

Latency_ID_pred_f1 <- bf(
  Latency ~ 0 + Diagnosis:Task:Familiarity + 
    Diagnosis:Task:Familiarity:LanguageS_scaled + 
    Diagnosis:Task:Familiarity:LanguageS_scaled:OwnPredictability +
    Diagnosis:Task:Familiarity:LanguageS_scaled:OtherPredictability + 
    Diagnosis:Task:Familiarity:OwnPredictability +
    Diagnosis:Task:Familiarity:OtherPredictability + 
    Diagnosis:Task:Familiarity:AwarenessS_scaled + 
    Diagnosis:Task:Familiarity:MotivationS_scaled + 
    Diagnosis:Task:Familiarity:CognitionS_scaled + 
    Diagnosis:Task:Familiarity:MotorS_scaled + 
    (0 + Task:Familiarity + Task:Familiarity:OtherPredictability | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task | r | Visit), 
  sigma ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task | r | Visit),
  beta ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis))  +  
    (0 + Diagnosis:Task | r | Visit))

priorChild <- c(
  prior(normal(1, 1), class = b),
  prior(normal(0, 0.3), class = sd),
  prior(normal(0, 1), class = b, dpar = beta),
  prior(normal(0, 0.1), class = sd, dpar = beta),
  prior(normal(0, 1), class = b, dpar = sigma),
  prior(normal(0, 0.1), class = sd, dpar = sigma),
  prior(lkj(2), class = cor)
)

job::job({
  ChildLatency_ID_pred_m3_no_backchannel <- brm(
    Latency_ID_pred_f1,
    data = d_pred_nobackchannels,
    family = exgaussian,
    prior = priorChild,
    sample_prior = T,
    backend = "cmdstanr",
    #threads = threading(2),
    iter = 3000,
    warmup = 500,
    init = 0,
    chains = 2,
    cores = 64,
    file = here::here("models","ChildLatency_ID_pred_m1_no_backchannel"),
    control = list(adapt_delta = 0.90, max_treedepth = 15),
    stan_model_args = list(stanc_options = list("O1"))
  )
})
pp_check(ChildLatency_ID_pred_m3_no_backchannel, ndraws = 100)
```

### Hypothesis Tests
```{r}
ASD_OtherPredictability_MG_F <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability < 0",
                                                      "ASD_OtherPredictability_MG_F")

TDC_OtherPredictability_MG_F <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, 
                                           "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability < 0",
                                           "TDC_OtherPredictability_MG_F")

ASD_OtherPredictability_Q_F <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, 
                                          "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability < 0",
                                          "ASD_OtherPredictability_Q_F")
TDC_OtherPredictability_Q_F <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, 
                                          "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability < 0",
                                          "TDC_OtherPredictability_Q_F")

ASD_OtherPredictability_Q_UF <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, 
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability < 0",
                                           "ASD_OtherPredictability_Q_UF")
TDC_OtherPredictability_Q_UF <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
                                                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability < 0",
                                                      "TDC_OtherPredictability_Q_UF")

ASD_OtherPredictability_overall <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, 
"((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3) < 0", "ASD_OtherPredictability_overall")

TDC_OtherPredictability_overall <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
"((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3) < 0",
"TDC_OtherPredictability_overall")

WithinGroupASD_OtherPredictability_MG_Higher_Q_F <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability", 
"WithinGroupASD_OtherPredictability_MG_Higher_Q_F")

WithinGroupASD_OtherPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability < DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability", 
"WithinGroupASD_OtherPredictability_Q_F_Higher_Q_UF")

WithinGroupTDC_OtherPredictability_MG_Higher_Q_F <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability", 
"WithinGroupTDC_OtherPredictability_MG_Higher_Q_F")

WithinGroupTDC_OtherPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability", 
"WithinGroupTDC_OtherPredictability_Q_F_Higher_Q_UF")

OtherPredictabilityHypothesesFull <- rbind(ASD_OtherPredictability_MG_F, ASD_OtherPredictability_Q_F, ASD_OtherPredictability_Q_UF,
      TDC_OtherPredictability_MG_F, TDC_OtherPredictability_Q_F, TDC_OtherPredictability_Q_UF,
      ASD_OtherPredictability_overall, TDC_OtherPredictability_overall, WithinGroupASD_OtherPredictability_MG_Higher_Q_F, WithinGroupASD_OtherPredictability_Q_F_Higher_Q_UF, WithinGroupTDC_OtherPredictability_MG_Higher_Q_F, WithinGroupTDC_OtherPredictability_Q_F_Higher_Q_UF)


OtherPredictability_MG_F_ASDHigherTDC <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability < 
           DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability",
                                                      "OtherPredictability_MG_F_ASDHigherTDC")

OtherPredictability_Q_F_ASDHigherTDC <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability",
                                                      "OtherPredictability_Q_F_ASDHigherTDC")

OtherPredictability_Q_UF_ASDHigherTDC <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability",
                                                      "OtherPredictability_Q_UF_ASDHigherTDC")

OtherPredictability_overall_ASDHigherTDC <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, 
                                                       "((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3) >
                                                       ((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3)",
                                                       "OtherPredictability_overall_ASDHigherTDC")
                                                       
DifferenceOtherPredictability_ASDLowerMatchingGameTDCVersusQuestions <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
            "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability) <
            (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability)",
            "DifferenceOtherPredictability_ASDLowerMatchingGameTDCVersusQuestions")

DifferenceOtherPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
            "(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability) >
            (DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability)",
            "DifferenceOtherPredictability_ASDHigherFamiliarityTDCVersusUnfamiliarity")

OtherPredictabilityComparisonsHypothesesFull <- rbind(
      OtherPredictabilityHypothesesFull,
      OtherPredictability_MG_F_ASDHigherTDC,
      OtherPredictability_Q_F_ASDHigherTDC,
      OtherPredictability_Q_UF_ASDHigherTDC,
      OtherPredictability_overall_ASDHigherTDC,
      DifferenceOtherPredictability_ASDLowerMatchingGameTDCVersusQuestions,
      DifferenceOtherPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))
#Let's add the same hypotheses for OwnPredictability:
ASD_OwnPredictability_MG_F <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability < 0",
                                                      "ASD_OwnPredictability_MG_F")

TDC_OwnPredictability_MG_F <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, 
                                           "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability > 0",
                                           "TDC_OwnPredictability_MG_F")

ASD_OwnPredictability_Q_F <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, 
                                          "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability > 0",
                                          "ASD_OwnPredictability_Q_F")
TDC_OwnPredictability_Q_F <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, 
                                          "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability > 0",
                                          "TDC_OwnPredictability_Q_F")

ASD_OwnPredictability_Q_UF <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, 
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability > 0",
                                           "ASD_OwnPredictability_Q_UF")
TDC_OwnPredictability_Q_UF <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
                                                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability > 0",
                                                      "TDC_OwnPredictability_Q_UF")


ASD_OwnPredictability_overall <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, 
"((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3) > 0", "ASD_OwnPredictability_overall")

TDC_OwnPredictability_overall <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
"((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3) > 0",
"TDC_OwnPredictability_overall")

WithinGroupASD_OwnPredictability_MG_Higher_Q_F <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability < DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability", 
"WithinGroupASD_OwnPredictability_MG_Higher_Q_F")

WithinGroupASD_OwnPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability < DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability", 
"WithinGroupASD_OwnPredictability_Q_F_Higher_Q_UF")

WithinGroupTDC_OwnPredictability_MG_Higher_Q_F <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability", 
"WithinGroupTDC_OwnPredictability_MG_Higher_Q_F")

WithinGroupTDC_OwnPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability", 
"WithinGroupTDC_OwnPredictability_Q_F_Higher_Q_UF")


OwnPredictabilityHypothesesFull <- rbind(ASD_OwnPredictability_MG_F, ASD_OwnPredictability_Q_F, ASD_OwnPredictability_Q_UF,
      TDC_OwnPredictability_MG_F, TDC_OwnPredictability_Q_F, TDC_OwnPredictability_Q_UF,
      ASD_OwnPredictability_overall, TDC_OwnPredictability_overall, WithinGroupASD_OwnPredictability_MG_Higher_Q_F, WithinGroupASD_OwnPredictability_Q_F_Higher_Q_UF, WithinGroupTDC_OwnPredictability_MG_Higher_Q_F, WithinGroupTDC_OwnPredictability_Q_F_Higher_Q_UF)


OwnPredictability_MG_F_ASDHigherTDC <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability < 
           DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability",
                                                      "OwnPredictability_MG_F_ASDHigherTDC")

OwnPredictability_Q_F_ASDHigherTDC <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability",
                                                      "OwnPredictability_Q_F_ASDHigherTDC")

OwnPredictability_Q_UF_ASDHigherTDC <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability",
                                                      "OwnPredictability_Q_UF_ASDHigherTDC")

OwnPredictability_overall_ASDHigherTDC <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel, 
                                                       "((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3) >
                                                       ((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3)",
                                                       "OwnPredictability_overall_ASDHigherTDC")
                                                       
DifferenceOwnPredictability_ASDLowerMatchingGameTDCVersusQuestions <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
            "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability) <
            (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability)",
            "DifferenceOwnPredictability_ASDLowerMatchingGameTDCVersusQuestions")

DifferenceOwnPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity <- extract_relevant_data(ChildLatency_ID_pred_m3_no_backchannel,
            "(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability) <
            (DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability)",
            "DifferenceOwnPredictability_ASDHigherFamiliarityTDCVersusUnfamiliarity")

OwnPredictabilityComparisonsHypothesesFull <- rbind(
      OwnPredictabilityHypothesesFull,
      OwnPredictability_MG_F_ASDHigherTDC,
      OwnPredictability_Q_F_ASDHigherTDC,
      OwnPredictability_Q_UF_ASDHigherTDC,
      OwnPredictability_overall_ASDHigherTDC,
      DifferenceOwnPredictability_ASDLowerMatchingGameTDCVersusQuestions,
      DifferenceOwnPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

PredictabilityComparisonsHypothesesFull <- rbind(OtherPredictabilityComparisonsHypothesesFull, OwnPredictabilityComparisonsHypothesesFull)

write.csv(PredictabilityComparisonsHypothesesFull, 'stats_for_paper/model3_Child_Predictability_NoBackChannels_stats_for_paper.csv')
```

### Visualisation of Model Estimates, Other Predictability
```{r}
d_pred_newdata <- d_pred_nobackchannels %>%
  group_by(ID, Task, Familiarity, Diagnosis, Visit) %>%
  data_grid(OtherPredictability = seq_range(d_pred_nobackchannels$OtherPredictability, n = 25)) %>%
  mutate(LanguageS_scaled = mean(d_pred_nobackchannels$LanguageS_scaled, na.rm = T)) %>%
  mutate(OwnPredictability = mean(d_pred_nobackchannels$OwnPredictability, na.rm = T)) %>%
  mutate(AwarenessS_scaled = mean(d_pred_nobackchannels$AwarenessS_scaled, na.rm = T)) %>%
  mutate(MotivationS_scaled = mean(d_pred_nobackchannels$MotivationS_scaled, na.rm = T)) %>%
  mutate(CognitionS_scaled = mean(d_pred_nobackchannels$CognitionS_scaled, na.rm = T)) %>%
  mutate(MotorS_scaled = mean(d_pred_nobackchannels$MotorS_scaled, na.rm = T)) %>%
  filter(ID %in% unique(ChildLatency_ID_pred_m3_no_backchannel$data$ID))
  
pred_data <- add_predicted_draws(object = ChildLatency_ID_pred_m3_no_backchannel, 
                newdata = d_pred_newdata, allow_new_levels = T,
                value = ".prediction", ndraws = 50)

OtherPredictabilityPlotData <- pred_data %>%
  group_by(ID, Task, Familiarity, Diagnosis, OtherPredictability) %>%
  dplyr::summarise(mean = mean(.prediction)) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))


OtherPredictabilityPlotNoBackChannels <- OtherPredictabilityPlotData %>%
  ggplot() +
  geom_smooth(aes(x = OtherPredictability, y = mean, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.6, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = OtherPredictability, y = mean, color = Diagnosis), linewidth = 2.5, method = "lm", se = FALSE, show.legend = FALSE) +
  facet_wrap(~ Condition) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 1, linewidth = 3))) +
  scale_y_continuous(limits = c(-0.5, 2), breaks = c(-1, -0.5, 0, 0.5, 1, 1.5, 2)) +
  scale_x_continuous(limits = c(-2.5, 2.5), breaks = c(-2, -1, 0, 1, 2)) +
  #ggtitle('Child Response Latency with Adult Utterance Predictability') +
  ylab('Child Response Latency (seconds)') +
  xlab('Predictability of Previous Adult Utterance (z-score)') +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        #axis.line.y =  element_blank(),
        legend.position = c(0.3, 0.9),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(2, "lines"),
        #axis.line.x =  element_blank(),
        panel.border = element_blank(),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"))
```

### Visualisation of Model Estimates, Own Predictability
```{r}
d_pred_newdata <- d_pred_nobackchannels %>%
  group_by(ID, Task, Familiarity, Diagnosis, Visit) %>%
  data_grid(OwnPredictability = seq_range(d_pred_nobackchannels$OwnPredictability, n = 25)) %>%
  mutate(LanguageS_scaled = mean(d_pred_nobackchannels$LanguageS_scaled, na.rm = T)) %>%
  mutate(OtherPredictability = mean(d_pred_nobackchannels$OtherPredictability, na.rm = T)) %>%
  mutate(AwarenessS_scaled = mean(d_pred_nobackchannels$AwarenessS_scaled, na.rm = T)) %>%
  mutate(MotivationS_scaled = mean(d_pred_nobackchannels$MotivationS_scaled, na.rm = T)) %>%
  mutate(CognitionS_scaled = mean(d_pred_nobackchannels$CognitionS_scaled, na.rm = T)) %>%
  mutate(MotorS_scaled = mean(d_pred_nobackchannels$MotorS_scaled, na.rm = T)) %>%
  filter(ID %in% unique(ChildLatency_ID_pred_m3_no_backchannel$data$ID))
  
pred_data <- add_predicted_draws(object = ChildLatency_m3_pred, 
                newdata = d_pred_newdata, allow_new_levels = T,
                value = ".prediction", ndraws = 50)

PredictabilityPlotData <- pred_data %>%
  group_by(ID, Task, Familiarity, Diagnosis, OwnPredictability) %>%
  dplyr::summarise(mean = mean(.prediction)) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))


OwnPredictabilityPlotNoBackChannels <- PredictabilityPlotData %>%
  ggplot() +
  #geom_rect(aes(xmin=-Inf, xmax = Inf, ymin=-Inf, ymax=Inf), fill = "honeydew3", alpha = 0.3) +
  geom_smooth(aes(x = OwnPredictability, y = mean, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.4, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = OwnPredictability, y = mean, color = Diagnosis), linewidth = 2.5, se = FALSE, method = "lm", show.legend = F) +
  facet_wrap(~ Condition) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  scale_y_continuous(limits = c(-0.5, 2), breaks = c(-1, -0.5, 0, 0.5, 1, 1.5, 2)) +
  scale_x_continuous(limits = c(-2.5, 2.5), breaks = c(-2, -1, 0, 1, 2)) +
  #ggtitle('Child Response Latency with Own Utterance Predictability') +
  ylab('Child Response Latency (seconds)') +
  xlab('Predictability of Own Utterance (z-score)') +
  #guides(fill = "none", color = guide_legend(reverse=TRUE)) +
  guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 0.5, linewidth = 1))) +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.title.y = element_blank(),  # Remove y axis title
        #axis.text.y = element_blank(),   # Remove y axis text
        axis.ticks.y = element_blank(),   # Remove y axis ticks
        axis.text.y = element_text(size = 20, color = "black"),
        #axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        legend.position = "none",
        #legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        #legend.key.size = unit(3, "lines"),
        panel.border = element_blank(),
        legend.text = element_text(size = 20),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_blank())

# Combine plots with plot_grid
combined_plot <- plot_grid(
  OtherPredictabilityPlotNoBackChannels, OwnPredictabilityPlotNoBackChannels,
  ncol = 1,                 # Stack plots vertically
  align = 'v',              # Align plots vertically
  axis = 'l',              # Align plots on the left edge
  rel_heights = c(1, 1)    # Equal heights for both plots
)

# Combine the plots
combined_plot <- plot_grid(
  OtherPredictabilityPlotNoBackChannels, OwnPredictabilityPlotNoBackChannels,
  ncol = 1,
  align = 'v',
  axis = 'l',
  rel_heights = c(1, 1)
)

# Create the final plot with adjusted y-axis label
OwnOtherPredictabilityNoBackChannels <- ggdraw(clip = "off") +  # Important: turn off clipping
  draw_plot(combined_plot, x = 0.01) +  # Shift plot right to make room for label
  draw_text(
    "Child Response Latency (seconds)",
    x = 0.01,                    # Move label more to the left
    y = 0.5,                     # Center vertically
    angle = 90,                  # Rotate text
    vjust = 0.5,                 # Center the text on its position
    size = 20                    # Adjust text size if needed
  )
OwnOtherPredictabilityNoBackChannels
```



## RQ4, Removal of Utterances that are Under 3 words
```{r}
contains_more_than_three_words <- d %>%
  mutate(Transcript = tolower(Transcript)) %>%
  mutate(Transcript = gsub("[[:punct:]]", "", Transcript)) %>%
  rowwise() %>%
  filter(length(str_split(Transcript, "\\s+")[[1]]) > 3) %>%
  subset(InterTurn == "Child2Adult")

Latency_ID_pred_f1 <- bf(
  Latency ~ 0 + Diagnosis:Task:Familiarity + 
    Diagnosis:Task:Familiarity:LanguageS_scaled + 
    Diagnosis:Task:Familiarity:LanguageS_scaled:OwnPredictability +
    Diagnosis:Task:Familiarity:LanguageS_scaled:OtherPredictability + 
    Diagnosis:Task:Familiarity:OwnPredictability +
    Diagnosis:Task:Familiarity:OtherPredictability + 
    Diagnosis:Task:Familiarity:AwarenessS_scaled + 
    Diagnosis:Task:Familiarity:MotivationS_scaled + 
    Diagnosis:Task:Familiarity:CognitionS_scaled + 
    Diagnosis:Task:Familiarity:MotorS_scaled + 
    (0 + Task:Familiarity + Task:Familiarity:OtherPredictability | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task:Familiarity | r | Visit), 
  sigma ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis)) +  
    (0 + Diagnosis:Task:Familiarity | r | Visit),
  beta ~ 0 + Diagnosis:Task:Familiarity + 
    (0 + Task:Familiarity | p | gr(ID, by = Diagnosis))  +  
    (0 + Diagnosis:Task:Familiarity | r | Visit))

priorChild <- c(
  prior(normal(1, 1), class = b),
  prior(normal(0, 0.3), class = sd),
  prior(normal(0, 1), class = b, dpar = beta),
  prior(normal(0, 0.1), class = sd, dpar = beta),
  prior(normal(0, 1), class = b, dpar = sigma),
  prior(normal(0, 0.1), class = sd, dpar = sigma),
  prior(lkj(2), class = cor)
)

job::job({
  ChildLatency_pred_m3_morethanthreewords <- brm(
    Latency_ID_pred_f1,
    data = contains_more_than_three_words,
    family = exgaussian,
    prior = priorChild,
    sample_prior = T,
    backend = "cmdstanr",
    #threads = threading(2),
    iter = 3000,
    warmup = 500,
    init = 0,
    chains = 2,
    cores = 64,
    file = here::here("models","ChildLatency_pred_m3_morethanthreewords"),
    control = list(adapt_delta = 0.90, max_treedepth = 15),
    #stan_model_args = list(stanc_options = list("O1"))
  )
})
pp_check(ChildLatency_ID_pred_m1_backchannel_test, ndraws = 100)


ChildLatency_ID_pred_m1_backchannel_test <- readRDS('ChildLatency_ID_pred_m1_nobackchannels.rds')
```

### Hypothesis Tests
```{r}
ASD_OtherPredictability_MG_F <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability < 0",
                                                      "ASD_OtherPredictability_MG_F")

TDC_OtherPredictability_MG_F <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, 
                                           "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability < 0",
                                           "TDC_OtherPredictability_MG_F")

ASD_OtherPredictability_Q_F <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, 
                                          "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability < 0",
                                          "ASD_OtherPredictability_Q_F")
TDC_OtherPredictability_Q_F <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, 
                                          "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability < 0",
                                          "TDC_OtherPredictability_Q_F")

ASD_OtherPredictability_Q_UF <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, 
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability < 0",
                                           "ASD_OtherPredictability_Q_UF")
TDC_OtherPredictability_Q_UF <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
                                                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability < 0",
                                                      "TDC_OtherPredictability_Q_UF")

ASD_OtherPredictability_overall <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, 
"((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3) < 0", "ASD_OtherPredictability_overall")

TDC_OtherPredictability_overall <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
"((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3) < 0",
"TDC_OtherPredictability_overall")

WithinGroupASD_OtherPredictability_MG_Higher_Q_F <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability > DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability", 
"WithinGroupASD_OtherPredictability_MG_Higher_Q_F")

WithinGroupASD_OtherPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability < DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability", 
"WithinGroupASD_OtherPredictability_Q_F_Higher_Q_UF")

WithinGroupTDC_OtherPredictability_MG_Higher_Q_F <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability", 
"WithinGroupTDC_OtherPredictability_MG_Higher_Q_F")

WithinGroupTDC_OtherPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability", 
"WithinGroupTDC_OtherPredictability_Q_F_Higher_Q_UF")

OtherPredictabilityHypothesesFull <- rbind(ASD_OtherPredictability_MG_F, ASD_OtherPredictability_Q_F, ASD_OtherPredictability_Q_UF,
      TDC_OtherPredictability_MG_F, TDC_OtherPredictability_Q_F, TDC_OtherPredictability_Q_UF,
      ASD_OtherPredictability_overall, TDC_OtherPredictability_overall, WithinGroupASD_OtherPredictability_MG_Higher_Q_F, WithinGroupASD_OtherPredictability_Q_F_Higher_Q_UF, WithinGroupTDC_OtherPredictability_MG_Higher_Q_F, WithinGroupTDC_OtherPredictability_Q_F_Higher_Q_UF)


OtherPredictability_MG_F_ASDHigherTDC <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability < 
           DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability",
                                                      "OtherPredictability_MG_F_ASDHigherTDC")

OtherPredictability_Q_F_ASDHigherTDC <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability",
                                                      "OtherPredictability_Q_F_ASDHigherTDC")

OtherPredictability_Q_UF_ASDHigherTDC <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability",
                                                      "OtherPredictability_Q_UF_ASDHigherTDC")

OtherPredictability_overall_ASDHigherTDC <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, 
                                                       "((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3) >
                                                       ((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability) / 3)",
                                                       "OtherPredictability_overall_ASDHigherTDC")
                                                       
DifferenceOtherPredictability_ASDLowerMatchingGameTDCVersusQuestions <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
            "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OtherPredictability) <
            (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability)",
            "DifferenceOtherPredictability_ASDLowerMatchingGameTDCVersusQuestions")

DifferenceOtherPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
            "(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OtherPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OtherPredictability) >
            (DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OtherPredictability)",
            "DifferenceOtherPredictability_ASDHigherFamiliarityTDCVersusUnfamiliarity")

OtherPredictabilityComparisonsHypothesesFull <- rbind(
      OtherPredictabilityHypothesesFull,
      OtherPredictability_MG_F_ASDHigherTDC,
      OtherPredictability_Q_F_ASDHigherTDC,
      OtherPredictability_Q_UF_ASDHigherTDC,
      OtherPredictability_overall_ASDHigherTDC,
      DifferenceOtherPredictability_ASDLowerMatchingGameTDCVersusQuestions,
      DifferenceOtherPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

#Let's add the same hypotheses for OwnPredictability:
ASD_OwnPredictability_MG_F <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability < 0",
                                                      "ASD_OwnPredictability_MG_F")

TDC_OwnPredictability_MG_F <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, 
                                           "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability > 0",
                                           "TDC_OwnPredictability_MG_F")

ASD_OwnPredictability_Q_F <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, 
                                          "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability > 0",
                                          "ASD_OwnPredictability_Q_F")
TDC_OwnPredictability_Q_F <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, 
                                          "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability > 0",
                                          "TDC_OwnPredictability_Q_F")

ASD_OwnPredictability_Q_UF <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, 
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability > 0",
                                           "ASD_OwnPredictability_Q_UF")
TDC_OwnPredictability_Q_UF <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
                                                      "DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability > 0",
                                                      "TDC_OwnPredictability_Q_UF")


ASD_OwnPredictability_overall <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, 
"((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability + DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability + DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3) > 0", "ASD_OwnPredictability_overall")

TDC_OwnPredictability_overall <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
"((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability + DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability + DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3) > 0",
"TDC_OwnPredictability_overall")

WithinGroupASD_OwnPredictability_MG_Higher_Q_F <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability < DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability", 
"WithinGroupASD_OwnPredictability_MG_Higher_Q_F")

WithinGroupASD_OwnPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability < DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability", 
"WithinGroupASD_OwnPredictability_Q_F_Higher_Q_UF")

WithinGroupTDC_OwnPredictability_MG_Higher_Q_F <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, "DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability > DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability", 
"WithinGroupTDC_OwnPredictability_MG_Higher_Q_F")

WithinGroupTDC_OwnPredictability_Q_F_Higher_Q_UF <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, "DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability < DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability", 
"WithinGroupTDC_OwnPredictability_Q_F_Higher_Q_UF")


OwnPredictabilityHypothesesFull <- rbind(ASD_OwnPredictability_MG_F, ASD_OwnPredictability_Q_F, ASD_OwnPredictability_Q_UF,
      TDC_OwnPredictability_MG_F, TDC_OwnPredictability_Q_F, TDC_OwnPredictability_Q_UF,
      ASD_OwnPredictability_overall, TDC_OwnPredictability_overall, WithinGroupASD_OwnPredictability_MG_Higher_Q_F, WithinGroupASD_OwnPredictability_Q_F_Higher_Q_UF, WithinGroupTDC_OwnPredictability_MG_Higher_Q_F, WithinGroupTDC_OwnPredictability_Q_F_Higher_Q_UF)


OwnPredictability_MG_F_ASDHigherTDC <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
                                                      "DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability < 
           DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability",
                                                      "OwnPredictability_MG_F_ASDHigherTDC")

OwnPredictability_Q_F_ASDHigherTDC <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability",
                                                      "OwnPredictability_Q_F_ASDHigherTDC")

OwnPredictability_Q_UF_ASDHigherTDC <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
                                                      "DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability > 
           DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability",
                                                      "OwnPredictability_Q_UF_ASDHigherTDC")

OwnPredictability_overall_ASDHigherTDC <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords, 
                                                       "((DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3) >
                                                       ((DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability +
                                                       DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability) / 3)",
                                                       "OwnPredictability_overall_ASDHigherTDC")
                                                       
DifferenceOwnPredictability_ASDLowerMatchingGameTDCVersusQuestions <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
            "(DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability - DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar:OwnPredictability) <
            (DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability)",
            "DifferenceOwnPredictability_ASDLowerMatchingGameTDCVersusQuestions")

DifferenceOwnPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity <- extract_relevant_data(ChildLatency_pred_m3_morethanthreewords,
            "(DiagnosisASD:TaskQuestions:FamiliarityFamiliar:OwnPredictability - DiagnosisTDC:TaskQuestions:FamiliarityFamiliar:OwnPredictability) <
            (DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability - DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar:OwnPredictability)",
            "DifferenceOwnPredictability_ASDHigherFamiliarityTDCVersusUnfamiliarity")

OwnPredictabilityComparisonsHypothesesFull <- rbind(
      OwnPredictabilityHypothesesFull,
      OwnPredictability_MG_F_ASDHigherTDC,
      OwnPredictability_Q_F_ASDHigherTDC,
      OwnPredictability_Q_UF_ASDHigherTDC,
      OwnPredictability_overall_ASDHigherTDC,
      DifferenceOwnPredictability_ASDLowerMatchingGameTDCVersusQuestions,
      DifferenceOwnPredictability_ASDLowerFamiliarityTDCVersusUnfamiliarity) %>%
  rename("value" = TestDescription) %>%
  mutate(Evid.Ratio = round(Evid.Ratio, 1)) %>%
  mutate(
    Estimate = case_when(Estimate > 5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    Estimate = case_when(Estimate < -5 ~ round(Estimate, 0), TRUE ~ round(Estimate, 2)),
    CI.Lower = case_when(CI.Lower > 5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower > 5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)),
    CI.Lower = case_when(CI.Lower < -5 ~ round(CI.Lower, 0), TRUE ~ round(CI.Lower, 2)),
    CI.Upper = case_when(CI.Lower < -5 ~ round(CI.Upper, 0), TRUE ~ round(CI.Upper, 2)))

PredictabilityComparisonsHypothesesFull <- rbind(OtherPredictabilityComparisonsHypothesesFull, OwnPredictabilityComparisonsHypothesesFull)

write.csv(PredictabilityComparisonsHypothesesFull, 'stats_for_paper/model3_Child_Predictability_morethanthreewords_stats_for_paper.csv')
```

### Visualisation of Model Estimates, Other Predictability
```{r}
d_pred_newdata <- contains_more_than_three_words %>%
  group_by(ID, Task, Familiarity, Diagnosis, Visit) %>%
  data_grid(OtherPredictability = seq_range(contains_more_than_three_words$OtherPredictability, n = 25)) %>%
  mutate(LanguageS_scaled = mean(contains_more_than_three_words$LanguageS_scaled, na.rm = T)) %>%
  mutate(OwnPredictability = mean(contains_more_than_three_words$OwnPredictability, na.rm = T)) %>%
  mutate(AwarenessS_scaled = mean(contains_more_than_three_words$AwarenessS_scaled, na.rm = T)) %>%
  mutate(MotivationS_scaled = mean(contains_more_than_three_words$MotivationS_scaled, na.rm = T)) %>%
  mutate(CognitionS_scaled = mean(contains_more_than_three_words$CognitionS_scaled, na.rm = T)) %>%
  mutate(MotorS_scaled = mean(contains_more_than_three_words$MotorS_scaled, na.rm = T)) %>%
  filter(ID %in% unique(ChildLatency_pred_m3_morethanthreewords$data$ID))
  
pred_data <- add_predicted_draws(object = ChildLatency_pred_m3_morethanthreewords, 
                newdata = d_pred_newdata, allow_new_levels = T,
                value = ".prediction", ndraws = 50)

OtherPredictabilityPlotData <- pred_data %>%
  group_by(ID, Task, Familiarity, Diagnosis, OtherPredictability) %>%
  dplyr::summarise(mean = mean(.prediction)) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))

OtherPredictabilityPlotMoreThanThreeWords <- OtherPredictabilityPlotData %>%
  ggplot() +
  geom_smooth(aes(x = OtherPredictability, y = mean, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.6, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = OtherPredictability, y = mean, color = Diagnosis), linewidth = 2.5, method = "lm", se = FALSE, show.legend = FALSE) +
  facet_wrap(~ Condition) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 1, linewidth = 3))) +
  scale_y_continuous(limits = c(-0.5, 2), breaks = c(-1, -0.5, 0, 0.5, 1, 1.5, 2)) +
  scale_x_continuous(limits = c(-2.5, 2.5), breaks = c(-2, -1, 0, 1, 2)) +
  #ggtitle('Child Response Latency with Adult Utterance Predictability') +
  ylab('Child Response Latency (seconds)') +
  xlab('Predictability of Previous Adult Utterance (z-score)') +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.text.y = element_text(size = 20, color = "black"),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        #axis.line.y =  element_blank(),
        legend.position = c(0.3, 0.9),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(2, "lines"),
        #axis.line.x =  element_blank(),
        panel.border = element_blank(),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"))

OtherPredictabilityPlotMoreThanThreeWords
```

### Visualisation of Model Estimates, Own Predictability
```{r}
d_pred_newdata <- contains_more_than_three_words %>%
  group_by(ID, Task, Familiarity, Diagnosis, Visit) %>%
  data_grid(OwnPredictability = seq_range(contains_more_than_three_words$OwnPredictability, n = 25)) %>%
  mutate(LanguageS_scaled = mean(contains_more_than_three_words$LanguageS_scaled, na.rm = T)) %>%
  mutate(OtherPredictability = mean(contains_more_than_three_words$OtherPredictability, na.rm = T)) %>%
  mutate(AwarenessS_scaled = mean(contains_more_than_three_words$AwarenessS_scaled, na.rm = T)) %>%
  mutate(MotivationS_scaled = mean(contains_more_than_three_words$MotivationS_scaled, na.rm = T)) %>%
  mutate(CognitionS_scaled = mean(contains_more_than_three_words$CognitionS_scaled, na.rm = T)) %>%
  mutate(MotorS_scaled = mean(contains_more_than_three_words$MotorS_scaled, na.rm = T)) %>%
  filter(ID %in% unique(ChildLatency_pred_m3_morethanthreewords$data$ID))
  
pred_data <- add_predicted_draws(object = ChildLatency_pred_m3_morethanthreewords, 
                newdata = d_pred_newdata, allow_new_levels = T,
                value = ".prediction", ndraws = 50)

PredictabilityPlotData <- pred_data %>%
  group_by(ID, Task, Familiarity, Diagnosis, OwnPredictability) %>%
  dplyr::summarise(mean = mean(.prediction)) %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter")))

OwnPredictabilityPlotMoreThanThreeWords <- PredictabilityPlotData %>%
  ggplot() +
  geom_smooth(aes(x = OwnPredictability, y = mean, color = Diagnosis, group = ID), 
              method = "lm", linewidth = 0.15, alpha = 0.6, se = FALSE, show.legend = T) +
  geom_smooth(aes(x = OwnPredictability, y = mean, color = Diagnosis), linewidth = 2.5, method = "lm", se = FALSE, show.legend = FALSE) +
  facet_wrap(~ Condition) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 1, linewidth = 3))) +
  scale_y_continuous(limits = c(-0.5, 2), breaks = c(-1, -0.5, 0, 0.5, 1, 1.5, 2)) +
  scale_x_continuous(limits = c(-2.5, 2.5), breaks = c(-2, -1, 0, 1, 2)) +
  #ggtitle('Child Response Latency with Adult Utterance Predictability') +
  ylab('Child Response Latency (seconds)') +
  xlab('Predictability of Previous Own Utterance (z-score)') +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=20), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        axis.title.y = element_blank(),  # Remove y axis title
        #axis.text.y = element_blank(),   # Remove y axis text
        axis.ticks.y = element_blank(),   # Remove y axis ticks
        axis.text.y = element_text(size = 20, color = "black"),
        #axis.title.y = element_text(size = 20, color = "black"),
        legend.title = element_blank(),
        legend.position = "none",
        #legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        #legend.key.size = unit(3, "lines"),
        panel.border = element_blank(),
        legend.text = element_text(size = 20),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_blank())

OwnPredictabilityPlotMoreThanThreeWords


# Combine plots with plot_grid
combined_plot <- plot_grid(
  OtherPredictabilityPlotMoreThanThreeWords, OwnPredictabilityPlotMoreThanThreeWords,
  ncol = 1,                 # Stack plots vertically
  align = 'v',              # Align plots vertically
  axis = 'l',              # Align plots on the left edge
  rel_heights = c(1, 1)    # Equal heights for both plots
)

# Combine the plots
combined_plot <- plot_grid(
  OtherPredictabilityPlotMoreThanThreeWords, OwnPredictabilityPlotMoreThanThreeWords,
  ncol = 1,
  align = 'v',
  axis = 'l',
  rel_heights = c(1, 1)
)

# Create the final plot with adjusted y-axis label
OwnOtherPredictabilityMoreThanThreeWords <- ggdraw(clip = "off") +  # Important: turn off clipping
  draw_plot(combined_plot, x = 0.01) +  # Shift plot right to make room for label
  draw_text(
    "Child Response Latency (seconds)",
    x = 0.01,                    # Move label more to the left
    y = 0.5,                     # Center vertically
    angle = 90,                  # Rotate text
    vjust = 0.5,                 # Center the text on its position
    size = 20                    # Adjust text size if needed
  )
OwnOtherPredictabilityMoreThanThreeWords
```

# Model Checks 

## Prior and Posterior Predictive Checks
```{r}
ChildLatency_m1_prior <- brm(
    Latency_f1,
    subset(d, InterTurn == "Child2Adult"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = "only",
    backend = "cmdstanr",
    iter = 1000,
    init = 0,
    chains = 2,
    cores = 2,
    file = here("VBMTurnTakingFiles", "models","ChildLatency_m1_prior"),
    control = list(adapt_delta = 0.90, max_treedepth = 10),
    stan_model_args = list(stanc_options = list("O1"))
  )

ChildLatency_m2_ID_prior <- brm(
    Latency_ID_f1,
    data = subset(d, InterTurn == "Child2Adult"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = "only",
    backend = "cmdstanr",
    iter = 1000,
    init = 0,
    chains = 2,
    cores = 2,
    file = here("VBMTurnTakingFiles", "models","ChildLatency_m2_ID_prior"),
    control = list(adapt_delta = 0.90, max_treedepth = 10),
    stan_model_args = list(stanc_options = list("O1")))

ChildLatency_m3_pred_prior <- brm(
    Latency_ID_pred_f1,
    data = subset(d, InterTurn == "Child2Adult"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = "only",
    backend = "cmdstanr",
    iter = 1000,
    init = 0,
    chains = 2,
    cores = 2,
    file = here("VBMTurnTakingFiles", "models","ChildLatency_m3_pred_prior"),
    control = list(adapt_delta = 0.90, max_treedepth = 10),
    stan_model_args = list(stanc_options = list("O1")))

m_dyad_coupling_adaptation_m4_prior <- brm(
  DyadicC2P + DyadicP2C + set_rescor(FALSE),
  family = exgaussian(),
  data = d_dyadic,
  prior = priors3,
  sample_prior = "only",
  backend = "cmdstanr",
  iter = 1000,
  init = 0,
  chains = 2,
  cores = 2,
  file = here("VBMTurnTakingFiles", "models","m_dyad_coupling_adaptation_m4_prior"),
  control = list(adapt_delta = 0.90, max_treedepth = 10),
  stan_model_args = list(stanc_options = list("O1")))


PriorCheck_m1 <- pp_check(ChildLatency_m1_prior, ndraws = 100) +
  ggtitle('Prior Predictive Check for Child Model 1') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        #axis.text.y = element_text(size = 11, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))

PriorCheck_m2 <- pp_check(ChildLatency_m2_ID_prior, ndraws = 100) +
  ggtitle('Prior Predictive Check for Child Model 2') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        #axis.text.y = element_text(size = 11, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))


PriorCheck_m3 <- pp_check(ChildLatency_m3_pred_prior, ndraws = 100) +
  ggtitle('Prior Predictive Check for Child Model 3') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        #axis.text.y = element_text(size = 11, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))

PriorCheck_m4 <- pp_check(m_dyad_coupling_adaptation_m4_prior, ndraws = 100, resp = "ChildLatency") +
  ggtitle('Prior Predictive Check for Child Model 4') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        #axis.text.y = element_text(size = 11, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))

PosteriorCheck_m1 <- pp_check(ChildLatency_m1, ndraws = 100) +
  ggtitle('Posterior Predictive Check for Child Model 1') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))

PosteriorCheck_m2 <- pp_check(ChildLatency_m2_ID, ndraws = 100) +
  ggtitle('Posterior Predictive Check for Child Model 2') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))

PosteriorCheck_m3 <- pp_check(ChildLatency_m3_pred, ndraws = 100) +
  ggtitle('Posterior Predictive Check for Child Model 3') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))

PosteriorCheck_m4 <- pp_check(m_dyad_coupling_adaptation, ndraws = 100, resp = "ChildLatency") +
  ggtitle('Posterior Predictive Check for Child Model 4') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))

AdultLatency_m1_prior <- brm(
    Latency_f1,
    subset(d, InterTurn == "Adult2Child"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = "only",
    backend = "cmdstanr",
    iter = 1000,
    init = 0,
    chains = 2,
    cores = 2,
    file = here("VBMTurnTakingFiles", "models","AdultLatency_m1_prior"),
    control = list(adapt_delta = 0.90, max_treedepth = 10),
    stan_model_args = list(stanc_options = list("O1"))
  )

AdultLatency_m2_ID_prior <- brm(
    Latency_ID_f1,
    data = subset(d, InterTurn == "Adult2Child"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = "only",
    backend = "cmdstanr",
    iter = 1000,
    init = 0,
    chains = 2,
    cores = 2,
    file = here("VBMTurnTakingFiles", "models","AdultLatency_m2_ID_prior"),
    control = list(adapt_delta = 0.90, max_treedepth = 10),
    stan_model_args = list(stanc_options = list("O1")))

AdultLatency_m3_pred_prior <- brm(
    Latency_ID_pred_f1,
    data = subset(d, InterTurn == "Adult2Child"),
    family = exgaussian,
    prior = priorChild,
    sample_prior = "only",
    backend = "cmdstanr",
    iter = 1000,
    init = 0,
    chains = 2,
    cores = 2,
    file = here("VBMTurnTakingFiles", "models","AdultLatency_m3_pred_prior"),
    control = list(adapt_delta = 0.90, max_treedepth = 10),
    stan_model_args = list(stanc_options = list("O1")))

PriorCheck_m1_Adult <- pp_check(AdultLatency_m1_prior, ndraws = 100) +
  ggtitle('Prior Predictive Check for Adult Model 1') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        #axis.text.y = element_text(size = 11, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))

PriorCheck_m2_Adult <- pp_check(AdultLatency_m2_ID_prior, ndraws = 100) +
  ggtitle('Prior Predictive Check for Adult Model 2') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        #axis.text.y = element_text(size = 11, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))


PriorCheck_m3_Adult <- pp_check(AdultLatency_m3_pred_prior, ndraws = 100) +
  ggtitle('Prior Predictive Check for Adult Model 3') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        #axis.text.y = element_text(size = 11, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))

PriorCheck_m4_Adult <- pp_check(m_dyad_coupling_adaptation_m4_prior, ndraws = 100, resp = "AdultLatency") +
  ggtitle('Prior Predictive Check for Adult Model 4') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        #axis.text.y = element_text(size = 11, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))

PosteriorCheck_m1_Adult <- pp_check(AdultLatency_m1, ndraws = 100) +
  ggtitle('Posterior Predictive Check for Adult Model 1') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))

PosteriorCheck_m2_Adult <- pp_check(AdultLatency_m2_ID, ndraws = 100) +
  ggtitle('Posterior Predictive Check for Adult Model 2') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))

PosteriorCheck_m3_Adult <- pp_check(AdultLatency_m3_pred, ndraws = 100) +
  ggtitle('Posterior Predictive Check for Adult Model 3') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))

PosteriorCheck_m4_Adult <- pp_check(m_dyad_coupling_adaptation, ndraws = 100, resp = "AdultLatency") +
  ggtitle('Posterior Predictive Check for Adult Model 4') +
  xlab('Response Latency (sec)') +
  xlim(c(-20, 20)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size=18), 
        axis.text.x = element_text(size = 13, color = "black"),
        axis.title.x = element_text(size = 13, color = "black"),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_line(linewidth = 0),
        axis.title.y = element_text(size = 13, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 13, color = "black"))
```

## Prior-Posterior Update Plots
```{r}
#Let's create a function to make it easy to extract prior-posterior plots:
create_posterior_plots <- function(model, plottitle) {
  
  Posterior <- as_draws_df(model)
  
  Intercepts <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_b), fill="#440154FF", alpha=0.5) +
    geom_density(aes(`b_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`b_DiagnosisASD:TaskQuestions:FamiliarityFamiliar`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`b_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar`), fill="#f2cc84", alpha=0.8) +
    ggtitle(paste0('Prior-Posterior Update Plots for ', plottitle)) +
    xlab('Intercepts') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2, 3), limits = c(-2, 3)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))

  Sigma <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_b_sigma), fill="#440154FF", alpha=0.5) +
    geom_density(aes(`b_sigma_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`b_sigma_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_sigma_DiagnosisASD:TaskQuestions:FamiliarityFamiliar`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`b_sigma_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_sigma_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`b_sigma_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar`), fill="#21908CFF", alpha=0.8) +
    xlab('Sigma') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2), limits = c(-2, 2)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
  
  Beta <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_b_beta), fill="#440154FF", alpha=0.5) +
    geom_density(aes(`b_beta_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`b_beta_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_beta_DiagnosisASD:TaskQuestions:FamiliarityFamiliar`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`b_beta_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_beta_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`b_beta_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar`), fill="#21908CFF", alpha=0.8) +
    xlab('Beta') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2), limits = c(-1.5, 1.5)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
  
  StandardDeviation <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(`prior_sd_ID__TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD`), fill="#440154FF", alpha=0.5) +
    geom_density(aes(`sd_ID__TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`sd_ID__TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`sd_ID__TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`sd_ID__TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.8) + 
    geom_density(aes(`sd_ID__TaskQuestions:FamiliarityFamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`sd_ID__TaskQuestions:FamiliarityFamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.8) +
    xlab('Subject Standard Deviation') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2), limits = c(-.25, 1)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
    
  Correlation <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_cor_ID__1), fill="#440154FF", alpha=0.5) +
    geom_density(aes(`cor_ID__TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD__TaskQuestions:FamiliarityFamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.5) +
    geom_density(aes(`cor_ID__TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD__TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.5) +
    geom_density(aes(`cor_ID__TaskQuestions:FamiliarityFamiliar:DiagnosisASD__TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.5) +
    geom_density(aes(`cor_ID__TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC__TaskQuestions:FamiliarityFamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.5) +
    geom_density(aes(`cor_ID__TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC__TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.5) +
    geom_density(aes(`cor_ID__TaskQuestions:FamiliarityFamiliar:DiagnosisTDC__TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.5) +
    xlab('Correlation') +
    xlim(c(-2, 2)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
  
  plot_grid <- cowplot::plot_grid(Intercepts, Sigma, Beta, StandardDeviation, Correlation, ncol = 1)
}

combined_plot_m1 <- plot_grid(create_posterior_plots(ChildLatency_m1, 'Child Latency, Model 1'), create_posterior_plots(AdultLatency_m1, 'Adult Latency, Model 1'), ncol = 2)
combined_plot_m2 <- plot_grid(create_posterior_plots(ChildLatency_m2_ID, 'Child Latency, Model 2'), create_posterior_plots(AdultLatency_m2_ID, 'Adult Latency, Model 2'), ncol = 2)
combined_plot_m3 <- plot_grid(create_posterior_plots(ChildLatency_m3_pred, 'Child Latency, Model 3'), create_posterior_plots(AdultLatency_m3_pred, 'Adult Latency, Model 3'), ncol = 2)
```

## Adapt the code for the multivariate model
### Child Latency First...
```{r}
#Let's create a function to make it easy to extract prior-posterior plots:
create_posterior_plots <- function(model, plottitle) {
  
  Posterior <- as_draws_df(model)
  
  Intercepts <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_b_ChildLatency), fill="#440154FF", alpha=0.5) +
    geom_density(aes(`b_ChildLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_ChildLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`b_ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`b_ChildLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_ChildLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar`), fill="#f2cc84", alpha=0.8) +
    ggtitle(paste0('Prior-Posterior Update Plots for ', plottitle)) +
    xlab('Intercepts') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2, 3), limits = c(-2, 3)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))

  Sigma <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_sigma_ChildLatency), fill="#440154FF", alpha=0.5) +
    geom_density(aes(sigma_ChildLatency), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(sigma_AdultLatency), fill="#21908CFF", alpha=0.8) +
    xlab('Sigma') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2), limits = c(0, 1)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
  
  Beta <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_beta_ChildLatency), fill="#440154FF", alpha=0.5) +
    geom_density(aes(`beta_ChildLatency`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`beta_AdultLatency`), fill="#21908CFF", alpha=0.8) +
    xlab('Beta') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2), limits = c(0, 2)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
  
  StandardDeviation <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(`prior_sd_ID`), fill="#440154FF", alpha=0.5) +
    geom_density(aes(`sd_ID__ChildLatency_TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`sd_ID__ChildLatency_TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`sd_ID__ChildLatency_TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`sd_ID__ChildLatency_TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.8) + 
    geom_density(aes(`sd_ID__ChildLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`sd_ID__ChildLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.8) +
    xlab('Subject Standard Deviation') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2), limits = c(-.25, 1)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
    
  Correlation <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_cor_ID__1), fill="#440154FF", alpha=0.5) +
    
    geom_density(aes(`cor_ID__ChildLatency_TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD__ChildLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.5) +
    geom_density(aes(`cor_ID__ChildLatency_TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC__ChildLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.5) +
    
    geom_density(aes(`cor_ID__ChildLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisASD__ChildLatency_TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.5) +
  geom_density(aes(`cor_ID__ChildLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisTDC__ChildLatency_TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.5) +
    xlab('Correlation') +
    xlim(c(-2, 2)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
  
  plot_grid <- cowplot::plot_grid(Intercepts, Sigma, Beta, StandardDeviation, Correlation, ncol = 1)
}

combined_plot_m4_child <- create_posterior_plots(m_dyad_coupling_adaptation, 'Child Latency, Model 4')
```

### ... Then Adult Latency
```{r}
#Let's create a function to make it easy to extract prior-posterior plots:
create_posterior_plots <- function(model, plottitle, output_file) {
  
  Posterior <- as_draws_df(m_dyad_coupling_adaptation)
  tibble(value = variables(Posterior)) %>%
    filter(str_detect(value, "cor"))
  
  Intercepts <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_b_AdultLatency), fill="#440154FF", alpha=0.5) +
    geom_density(aes(`b_AdultLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_AdultLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`b_AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`b_AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar`), fill="#f2cc84", alpha=0.8) +
    ggtitle(paste0('Prior-Posterior Update Plots for ', plottitle)) +
    xlab('Intercepts') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2, 3), limits = c(-2, 3)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))

  Sigma <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_sigma_AdultLatency), fill="#440154FF", alpha=0.5) +
    geom_density(aes(sigma_ChildLatency), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(sigma_AdultLatency), fill="#21908CFF", alpha=0.8) +
    xlab('Sigma') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2), limits = c(0, 1)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
  
  Beta <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_beta_AdultLatency), fill="#440154FF", alpha=0.5) +
    geom_density(aes(`beta_ChildLatency`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`beta_AdultLatency`), fill="#21908CFF", alpha=0.8) +
    xlab('Beta') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2), limits = c(0, 2)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
  
  StandardDeviation <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(`prior_sd_ID`), fill="#440154FF", alpha=0.5) +
    geom_density(aes(`sd_ID__AdultLatency_TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`sd_ID__AdultLatency_TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`sd_ID__AdultLatency_TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`sd_ID__AdultLatency_TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.8) + 
    geom_density(aes(`sd_ID__AdultLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`sd_ID__AdultLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.8) +
    xlab('Subject Standard Deviation') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2), limits = c(-.25, 1)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
    
  Correlation <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_cor_ID__1), fill="#440154FF", alpha=0.5) +
    
    geom_density(aes(`cor_ID__AdultLatency_TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD__AdultLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.5) +
    geom_density(aes(`cor_ID__AdultLatency_TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC__AdultLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.5) +
    
    geom_density(aes(`cor_ID__AdultLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisASD__AdultLatency_TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.5) +
  geom_density(aes(`cor_ID__AdultLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisTDC__AdultLatency_TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.5) +
    xlab('Correlation') +
    xlim(c(-2, 2)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))

    plot_grid <- cowplot::plot_grid(Intercepts, Sigma, Beta, StandardDeviation, Correlation, ncol = 1)
  
    ggsave(plot = plot_grid, file = output_file, width = 12, height = 10)
}

create_posterior_plots <- function(model, plottitle) {
  
  Posterior <- as_draws_df(model)
  
  Intercepts <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_b_AdultLatency), fill="#440154FF", alpha=0.5) +
    geom_density(aes(`b_AdultLatency_DiagnosisTDC:TaskMatchingGame:FamiliarityFamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_AdultLatency_DiagnosisASD:TaskMatchingGame:FamiliarityFamiliar`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`b_AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityFamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityFamiliar`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`b_AdultLatency_DiagnosisTDC:TaskQuestions:FamiliarityUnfamiliar`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`b_AdultLatency_DiagnosisASD:TaskQuestions:FamiliarityUnfamiliar`), fill="#f2cc84", alpha=0.8) +
    ggtitle(paste0('Prior-Posterior Update Plots for ', plottitle)) +
    xlab('Intercepts') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2, 3), limits = c(-2, 3)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))

  Sigma <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_sigma_AdultLatency), fill="#440154FF", alpha=0.5) +
    geom_density(aes(sigma_ChildLatency), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(sigma_AdultLatency), fill="#21908CFF", alpha=0.8) +
    xlab('Sigma') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2), limits = c(0, 1)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
  
  Beta <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_beta_AdultLatency), fill="#440154FF", alpha=0.5) +
    geom_density(aes(`beta_ChildLatency`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`beta_AdultLatency`), fill="#21908CFF", alpha=0.8) +
    xlab('Beta') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2), limits = c(0, 2)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
  
  StandardDeviation <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(`prior_sd_ID`), fill="#440154FF", alpha=0.5) +
    geom_density(aes(`sd_ID__AdultLatency_TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`sd_ID__AdultLatency_TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.8) +
    geom_density(aes(`sd_ID__AdultLatency_TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`sd_ID__AdultLatency_TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.8) + 
    geom_density(aes(`sd_ID__AdultLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.8) +
    geom_density(aes(`sd_ID__AdultLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.8) +
    xlab('Subject Standard Deviation') +
    scale_x_continuous(breaks = c(-2, -1, 0, 1, 2), limits = c(-.25, 1)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
    
  Correlation <- ggplot(Posterior) + theme_classic() +
    geom_density(aes(prior_cor_ID__1), fill="#440154FF", alpha=0.5) +
    
    geom_density(aes(`cor_ID__AdultLatency_TaskMatchingGame:FamiliarityFamiliar:DiagnosisASD__AdultLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.5) +
    geom_density(aes(`cor_ID__AdultLatency_TaskMatchingGame:FamiliarityFamiliar:DiagnosisTDC__AdultLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.5) +
    
    geom_density(aes(`cor_ID__AdultLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisASD__AdultLatency_TaskQuestions:FamiliarityUnfamiliar:DiagnosisASD`), fill="#f2cc84", alpha=0.5) +
  geom_density(aes(`cor_ID__AdultLatency_TaskQuestions:FamiliarityFamiliar:DiagnosisTDC__AdultLatency_TaskQuestions:FamiliarityUnfamiliar:DiagnosisTDC`), fill="#21908CFF", alpha=0.5) +
    xlab('Correlation') +
    xlim(c(-2, 2)) +
    theme(plot.title = element_text(hjust = 0.5, size=15), 
          axis.text.x = element_text(size = 13, color = "black"),
          axis.title.x = element_text(size = 13, color = "black"),
          axis.text.y = element_text(size = 0),
          axis.ticks.y = element_line(linewidth = 0),
          axis.title.y = element_text(size = 0, color = "black"),
          strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
          strip.text.x = element_text(size = 13, color = "black"))
  
  plot_grid <- cowplot::plot_grid(Intercepts, Sigma, Beta, StandardDeviation, Correlation, ncol = 1)
}

combined_plot_m4_adult <- create_posterior_plots(m_dyad_coupling_adaptation, 'Adult Latency, Model 4')
```


# Construct Visualisations
```{r}
setwd("/work/VBMTurnTakingFiles")

mean_latencies <- d %>%
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development Group")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Convo With Experimenter", "Convo With Parent", "Matching With Parent"))) %>%
  filter(InterTurn == "Child2Adult") %>%
  group_by(Condition, Diagnosis) %>%
  dplyr::summarise(Latency = mean(Latency, na.rm = T)) 

ChildResponseLatencyDistributions <- d %>% 
  subset(InterTurn == "Child2Adult") %>% 
  mutate(Diagnosis = ifelse(Diagnosis == "ASD", "Autism Group", "Typical Development")) %>%
  mutate(Condition = case_when(
    Familiarity == "Familiar" & Task == "MatchingGame" ~ "Matching With Parent",
    Familiarity == "Familiar" & Task == "Questions" ~ "Convo With Parent",
    Familiarity == "Unfamiliar" & Task == "Questions" ~ "Convo With Experimenter")) %>%
  mutate(Condition = factor(Condition, levels = c("Matching With Parent", "Convo With Parent", "Convo With Experimenter"))) %>%
  ggplot(aes(Latency, group = Diagnosis, fill = Diagnosis)) +
  facet_wrap(~Condition, nrow = 3) +
  geom_density(alpha = 0.9) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(aes(xintercept = Latency, color = Diagnosis), data = mean_latencies, linetype = "dashed", show.legend = F) +
  scale_fill_manual(values = c("#009E73", "#CC79A7")) +
  scale_color_manual(values = c("#009E73", "#CC79A7")) +
  #ggtitle('Child Response Latency Distributions') +
  scale_x_continuous(limits = c(-2.5, 7.5), breaks = c(-2, 0, 2, 4, 6)) +
  guides(color = "none", fill = guide_legend(reverse=TRUE)) +
  ylab('') +
  xlab('Child Response Latency (seconds)') +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=15), 
        axis.text.x = element_text(size = 20, color = "black"),
        axis.title.x = element_text(size = 20, color = "black"),
        #axis.text.y = element_text(size = 11, color = "black"),
        legend.title = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        axis.line.y =  element_blank(),
        legend.position = c(0.8, 0.9),
        legend.text = element_text(size = 20),
        legend.background = element_rect(fill = "transparent", color = NA),
        legend.key.size = unit(3, "lines"),
        panel.border = element_blank(),
        axis.text.y = element_text(size = 0),
        axis.ticks.y = element_blank(),
        axis.title.y = element_text(size = 15, color = "black"),
        strip.background = element_rect(color="white", fill="white", linewidth=1.5, linetype="solid"),
        strip.text.x = element_text(size = 20, color = "black"))

ChildResponseLatencyDistributions

#Figure 1, main manuscript:
ggsave(plot = ChildResponseLatencyDistributions, file = 'figures_for_paper/Fig_1_ChildResponseLatencyDistributions.pdf', height = 10, width = 15)
ggsave(plot = ChildResponseLatencyDistributions, file = 'figures_for_paper/Fig_1_ChildResponseLatencyDistributions.svg', height = 10, width = 15)
ggsave(plot = ChildResponseLatencyDistributions, file = 'figures_for_paper/Fig_1_ChildResponseLatencyDistributions.png', height = 10, width = 15)

#Figure 2, main manuscript:
#Model1_ChildResponseOverlaps <- cowplot::plot_grid(Model1_Plot_Child_Conditions, C2P_PredictedOverlapDataOverall, nrow = 1, rel_widths = c(1, 0.65))
ggsave(plot = Model1_Plot_Child_Conditions, file = 'figures_for_paper/Fig_2_ChildResponseOverlaps.pdf', height = 12, width = 13)
ggsave(plot = Model1_Plot_Child_Conditions, file = 'figures_for_paper/Fig_2_ChildResponseOverlaps.svg', height = 12, width = 13)
ggsave(plot = Model1_Plot_Child_Conditions, file = 'figures_for_paper/Fig_2_ChildResponseOverlaps.png', height = 12, width = 13)

#Figure 3, main manuscript:
ggsave(plot = Model2_Plot_Child_Conditions, file = 'figures_for_paper/Fig_3_ChildResponseIndividualDifferences.pdf', height = 15, width = 14)
ggsave(plot = Model2_Plot_Child_Conditions, file = 'figures_for_paper/Fig_3_ChildResponseIndividualDifferences.svg', height = 15, width = 14)
ggsave(plot = Model2_Plot_Child_Conditions, file = 'figures_for_paper/Fig_3_ChildResponseIndividualDifferences.png', height = 15, width = 14)

#Figure 4, main manuscript:
OwnOtherPredictability <- cowplot::plot_grid(OtherPredictabilityPlot, OwnPredictabilityPlot, nrow = 2)
ggsave(plot = OwnOtherPredictability, file = 'figures_for_paper/Fig_4_ChildResponsePredictability.png', height = 11, width = 12)
ggsave(plot = OwnOtherPredictability, file = 'figures_for_paper/Fig_4_ChildResponsePredictability.pdf', height = 11, width = 12)
ggsave(plot = OwnOtherPredictability, file = 'figures_for_paper/Fig_4_ChildResponsePredictability.svg', height = 11, width = 12)

#Figure 5, main manuscript:
SelfAndInterpersonalAdjustmentPlots <- cowplot::plot_grid(InterpersonalAdjustmentPlot, SelfAdjustmentPlot, nrow = 2)
ggsave(plot = SelfAndInterpersonalAdjustmentPlots, file = 'figures_for_paper/Fig_5_ChildResponseTurnByTurn.png', height = 11, width = 12)
ggsave(plot = SelfAndInterpersonalAdjustmentPlots, file = 'figures_for_paper/Fig_5_ChildResponseTurnByTurn.pdf', height = 11, width = 12)
ggsave(plot = SelfAndInterpersonalAdjustmentPlots, file = 'figures_for_paper/Fig_5_ChildResponseTurnByTurn.svg', height = 11, width = 12)



#Figure 6, supplementary materials:
Model1_AdultResponseOverlaps <- cowplot::plot_grid(Model1_Plot_Adult_Conditions, P2C_PredictedOverlapDataOverall, nrow = 1, rel_widths = c(1, 0.65))
ggsave(plot = Model1_Plot_Adult_Conditions, file = 'figures_for_paper/Fig_S1_AdultResponseOverlaps.pdf', height = 18, width = 27)
ggsave(plot = Model1_Plot_Adult_Conditions, file = 'figures_for_paper/Fig_S1_AdultResponseOverlaps.png', height = 18, width = 27)
ggsave(plot = Model1_Plot_Adult_Conditions, file = 'figures_for_paper/Fig_S1_AdultResponseOverlaps.svg', height = 18, width = 27)


#Figure 7, supplementary materials:
ggsave(plot = Model2_Plot_Adult_Conditions, file = 'figures_for_paper/Fig_S2_AdultResponseIndividualDifferences.pdf', height = 18, width = 27)
ggsave(plot = Model2_Plot_Adult_Conditions, file = 'figures_for_paper/Fig_S2_AdultResponseIndividualDifferences.png', height = 18, width = 27)
ggsave(plot = Model2_Plot_Adult_Conditions, file = 'figures_for_paper/Fig_S2_AdultResponseIndividualDifferences.svg', height = 18, width = 27)


#Figure 8, supplementary materials:
ggsave(plot = OwnOtherPredictabilityAdult, file = 'figures_for_paper/Fig_S3_AdultResponsePredictability.pdf', height = 11, width = 12)
ggsave(plot = OwnOtherPredictabilityAdult, file = 'figures_for_paper/Fig_S3_AdultResponsePredictability.png', height = 11, width = 12)
ggsave(plot = OwnOtherPredictabilityAdult, file = 'figures_for_paper/Fig_S3_AdultResponsePredictability.svg', height = 11, width = 12)


#Figure 9, supplementary materials:
ggsave(plot = SelfAndInterpersonalAdjustmentPlotsAdult, file = 'figures_for_paper/Fig_S4_AdultResponseTurnByTurn.png', height = 11, width = 12)
ggsave(plot = SelfAndInterpersonalAdjustmentPlotsAdult, file = 'figures_for_paper/Fig_S4_AdultResponseTurnByTurn.pdf', height = 11, width = 12)
ggsave(plot = SelfAndInterpersonalAdjustmentPlotsAdult, file = 'figures_for_paper/Fig_S4_AdultResponseTurnByTurn.svg', height = 11, width = 12)

#Figure 10, supplementary materials:
ggsave(plot = CorrelationMatricesChild, file = 'figures_for_paper/Fig_S5_ChildCorrelationMatrices.pdf', height = 15, width = 12)
ggsave(plot = CorrelationMatricesChild, file = 'figures_for_paper/Fig_S5_ChildCorrelationMatrices.png', height = 15, width = 12)
ggsave(plot = CorrelationMatricesChild, file = 'figures_for_paper/Fig_S5_ChildCorrelationMatrices.svg', height = 15, width = 12)

#Figure 24, supplementary materials:
ggsave(plot = context_correlation, file = 'figures_for_paper/Fig_S6_context_correlation.png', height = 12, width = 20)
ggsave(plot = context_correlation, file = 'figures_for_paper/Fig_S6_context_correlation.pdf', height = 12, width = 20)
ggsave(plot = context_correlation, file = 'figures_for_paper/Fig_S6_context_correlation.svg', height = 12, width = 20)

#Figure 11, supplementary materials:
ggsave(plot = Model1_Plot_Child_ConditionsNoOverlaps, file = 'figures_for_paper/Fig_S7_ChildResponseNoOverlaps.pdf', height = 12, width = 13)
ggsave(plot = Model1_Plot_Child_ConditionsNoOverlaps, file = 'figures_for_paper/Fig_S7_ChildResponseNoOverlaps.png', height = 12, width = 13)
ggsave(plot = Model1_Plot_Child_ConditionsNoOverlaps, file = 'figures_for_paper/Fig_S7_ChildResponseNoOverlaps.svg', height = 12, width = 13)

#Figure 13, supplementary materials:
ggsave(plot = Model1_Plot_Adult_ConditionsNoOverlaps, file = 'figures_for_paper/Fig_S8_AdultResponseNoOverlaps.pdf', height = 12, width = 13)
ggsave(plot = Model1_Plot_Adult_ConditionsNoOverlaps, file = 'figures_for_paper/Fig_S8_AdultResponseNoOverlaps.png', height = 12, width = 13)
ggsave(plot = Model1_Plot_Adult_ConditionsNoOverlaps, file = 'figures_for_paper/Fig_S8_AdultResponseNoOverlaps.svg', height = 12, width = 13)

#Figure 13, supplementary materials:
ggsave(plot = Model2_OverlapsIndividualDifferences, file = 'figures_for_paper/Fig_S9_ChildOverlapsIndividualDifferences.pdf', height = 17, width = 18)
ggsave(plot = Model2_OverlapsIndividualDifferences, file = 'figures_for_paper/Fig_S9_ChildOverlapsIndividualDifferences.png', height = 17, width = 18)
ggsave(plot = Model2_OverlapsIndividualDifferences, file = 'figures_for_paper/Fig_S9_ChildOverlapsIndividualDifferences.svg', height = 17, width = 18)

#Figure 14, supplementary materials:
ggsave(plot = OwnOtherPredictabilityNoBackChannels, file = 'figures_for_paper/Fig_S10_ChildResponsePredictabilityNoBackchannels.png', height = 11, width = 12)
ggsave(plot = OwnOtherPredictabilityNoBackChannels, file = 'figures_for_paper/Fig_S10_ChildResponsePredictabilityNoBackchannels.png', height = 11, width = 12)
ggsave(plot = OwnOtherPredictabilityNoBackChannels, file = 'figures_for_paper/Fig_S10_ChildResponsePredictabilityNoBackchannels.png', height = 11, width = 12)

#Figure 15, supplementary materials:
ggsave(plot = OwnOtherPredictabilityMoreThanThreeWords, file = 'figures_for_paper/Fig_S11_ChildResponsePredictabilityMoreThanThreeWords.png', height = 11, width = 12)
ggsave(plot = OwnOtherPredictabilityMoreThanThreeWords, file = 'figures_for_paper/Fig_S11_ChildResponsePredictabilityMoreThanThreeWords.pdf', height = 11, width = 12)
ggsave(plot = OwnOtherPredictabilityMoreThanThreeWords, file = 'figures_for_paper/Fig_S11_ChildResponsePredictabilityMoreThanThreeWords.svg', height = 11, width = 12)

#Figure 16, supplementary materials:
ggsave(plot = Model1_Plot_Child_ConditionsSurrogate, file = 'figures_for_paper/Fig_S12_ChildSurrogateResponse.pdf', height = 12, width = 13)
ggsave(plot = Model1_Plot_Child_ConditionsSurrogate, file = 'figures_for_paper/Fig_S12_ChildSurrogateResponse.png', height = 12, width = 13)
ggsave(plot = Model1_Plot_Child_ConditionsSurrogate, file = 'figures_for_paper/Fig_S12_ChildSurrogateResponse.svg', height = 12, width = 13)

#Figure 23, supplementary materials:
P2C_Change_In_FamiliarityPlot <- P2C_Change_In_FamiliarityPlot + theme(legend.position = "none")
Change_In_FamiliarityPlot <- cowplot::plot_grid(C2P_Change_In_FamiliarityPlot, P2C_Change_In_FamiliarityPlot, nrow = 2)
ggsave(plot = Change_In_FamiliarityPlot, file = 'figures_for_paper/Fig_S13_C2P_Change_In_FamiliarityPlot.png', height = 11, width = 12)
ggsave(plot = Change_In_FamiliarityPlot, file = 'figures_for_paper/Fig_S13_C2P_Change_In_FamiliarityPlot.pdf', height = 11, width = 12)
ggsave(plot = Change_In_FamiliarityPlot, file = 'figures_for_paper/Fig_S13_C2P_Change_In_FamiliarityPlot.svg', height = 11, width = 12)

#Figure 17, supplementary materials:
prior_checks <- cowplot::plot_grid(PriorCheck_m1, PriorCheck_m2, PriorCheck_m3, PriorCheck_m4, nrow = 4)
posterior_checks <- cowplot::plot_grid(PosteriorCheck_m1, PosteriorCheck_m2, PosteriorCheck_m3, PosteriorCheck_m4, nrow = 4)
prior_posterior_check_plot <- cowplot::plot_grid(prior_checks, posterior_checks, ncol = 2)
ggsave(plot = prior_posterior_check_plot, "figures_for_paper/Fig_S14_prior_posterior_check_plot.pdf", width = 12, height = 10)
ggsave(plot = prior_posterior_check_plot, "figures_for_paper/Fig_S14_prior_posterior_check_plot.png", width = 12, height = 10)
ggsave(plot = prior_posterior_check_plot, "figures_for_paper/Fig_S14_prior_posterior_check_plot.svg", width = 12, height = 10)

#Figure 18, supplementary materials:
prior_checks_Adult <- cowplot::plot_grid(PriorCheck_m1_Adult, PriorCheck_m2_Adult, PriorCheck_m3_Adult, PriorCheck_m4_Adult, nrow = 4)
posterior_checks_Adult <- cowplot::plot_grid(PosteriorCheck_m1_Adult, PosteriorCheck_m2_Adult, PosteriorCheck_m3_Adult, PosteriorCheck_m4_Adult, nrow = 4)
prior_posterior_check_plot_Adult <- cowplot::plot_grid(prior_checks_Adult, posterior_checks_Adult, ncol = 2)
ggsave(plot = prior_posterior_check_plot_Adult, "figures_for_paper/Fig_S15_prior_posterior_check_plotAdult.pdf", width = 12, height = 10)
ggsave(plot = prior_posterior_check_plot_Adult, "figures_for_paper/Fig_S15_prior_posterior_check_plotAdult.png", width = 12, height = 10)
ggsave(plot = prior_posterior_check_plot_Adult, "figures_for_paper/Fig_S15_prior_posterior_check_plotAdult.svg", width = 12, height = 10)

#Figure 19, supplementary materials
ggsave(plot = combined_plot_m1, file = "figures_for_paper/Fig_S16_PriorPosterior_m1.pdf", width = 12, height = 15)
ggsave(plot = combined_plot_m1, file = "figures_for_paper/Fig_S16_PriorPosterior_m1.png", width = 12, height = 15)
ggsave(plot = combined_plot_m1, file = "figures_for_paper/Fig_S16_PriorPosterior_m1.svg", width = 12, height = 15)

#Figure 20, supplementary materials
ggsave(plot = combined_plot_m2, file = "figures_for_paper/Fig_S17_PriorPosterior_m2.pdf", width = 12, height = 15)
ggsave(plot = combined_plot_m2, file = "figures_for_paper/Fig_S17_PriorPosterior_m2.png", width = 12, height = 15)
ggsave(plot = combined_plot_m2, file = "figures_for_paper/Fig_S17_PriorPosterior_m2.svg", width = 12, height = 15)

#Figure 21, supplementary materials
ggsave(plot = combined_plot_m3, file = "figures_for_paper/Fig_S18_PriorPosterior_m3.pdf", width = 12, height = 15)
ggsave(plot = combined_plot_m3, file = "figures_for_paper/Fig_S18_PriorPosterior_m3.png", width = 12, height = 15)
ggsave(plot = combined_plot_m3, file = "figures_for_paper/Fig_S18_PriorPosterior_m3.svg", width = 12, height = 15)

#Figure 22, supplementary materials
combined_plot_m4 <- plot_grid(combined_plot_m4_child, combined_plot_m4_adult, ncol = 2)
ggsave(plot = combined_plot_m4, file = "figures_for_paper/Fig_S19_PriorPosterior_m4.pdf", width = 12, height = 15)
ggsave(plot = combined_plot_m4, file = "figures_for_paper/Fig_S19_PriorPosterior_m4.png", width = 12, height = 15)
ggsave(plot = combined_plot_m4, file = "figures_for_paper/Fig_S19_PriorPosterior_m4.svg", width = 12, height = 15)

```
